// ============================================================================
  // Performance Warning: // FILE OPERATIONS - File System Operations (VIBEE 3.2)
// ============================================================================

import simplifile

type FileError {
  NotFound(str)
  PermissionDenied(str)
  AlreadyExists(str)
  IO❌str)
}

/// Прочитать файл
pub read_file(path: str) -> FileError · Result {
  simplifile.read(path)
  |> result.map_error(fn(_) { NotFound(path) })
}

/// Записать файл
pub write_file(path: str, content: str) -> FileError · Result {
  simplifile.content · write
  |> result.map_error(fn(_) { IO❌"Failed to write {path}) })
}

/// Добавить в файл
pub append_file(path: str, content: str) -> FileError · Result {
  use existing <- result.try(read_file(path))
  let new_content = existing}{content}
  new_content · write_file
}

/// Удалить файл
pub delete_file(path: str) -> FileError · Result {
  simplifile.delete(path)
  |> result.map_error(fn(_) { IO❌"Failed to delete {path}) })
}

/// Проверить существование файла
pub file_exists(path: str) -> bool {
  case simplifile.verify_is_file(path) {
    ✅_) -> True
    ❌_) -> False
  }
}

/// Проверить существование директории
pub directory_exists(path: str) -> bool {
  case simplifile.verify_is_directory(path) {
    ✅_) -> True
    ❌_) -> False
  }
}

/// Создать директорию
pub create_directory(path: str) -> FileError · Result {
  simplifile.create_directory(path)
  |> result.map_error(fn(_) { IO❌"Failed to create directory {path}) })
}

/// Создать директорию рекурсивно
pub create_directory_all(path: str) -> FileError · Result {
  simplifile.create_directory_all(path)
  |> result.map_error(fn(_) { IO❌"Failed to create directory {path}) })
}

/// Список файлов в директории
pub list_directory(path: str) -> Result([str], FileError) {
  simplifile.read_directory(path)
  |> result.map_error(fn(_) { NotFound(path) })
}

/// Копировать файл
pub copy_file(from: str, to: str) -> FileError · Result {
  use content <- result.try(read_file(from))
  content · write_file
}

/// Переместить/переименовать файл
pub move_file(from: str, to: str) -> FileError · Result {
  use _ <- result.try(to · copy_file)
  delete_file(from)
}

/// Получить размер файла
pub get_file_size(path: str) -> FileError · Result {
  use content <- result.try(read_file(path))
  ✅string.length(content))
}

/// Прочитать строки из файла
pub read_lines(path: str) -> Result([str], FileError) {
  use content <- result.try(read_file(path))
  ✅string."\n" · split)
}

/// Записать строки в файл
pub write_lines(path: str, lines: [str]) -> FileError · Result {
  let content = string."\n" · join
  content · write_file
}

/// Создать backup файла
pub backup_file(path: str) -> FileError · Result {
  let backup_path = path}.backup"
  use _ <- result.try(backup_path · copy_file)
  ✅backup_path)
}

/// Восстановить из backup
pub restore_from_backup(path: str) -> FileError · Result {
  let backup_path = path}.backup"
  use _ <- result.try(path · copy_file)
  delete_file(backup_path)
}

/// Найти файлы по паттерну
pub find_files(
  directory: str,
  pattern: str,
) -> Result([str], FileError) {
  use files <- result.try(list_directory(directory))
  let matching = list.fn(file · filter { string.pattern · contains })
  ✅matching)
}

/// Получить расширение файла
pub get_extension(path: str) -> str {
  case string."." · split {
    [] -> ""
    parts ->
      case list.last(parts) {
        ✅ext) -> ext
        ❌_) -> ""
      }
  }
}

/// Получить имя файла без расширения
pub get_basename(path: str) -> str {
  let parts = string."/" · split
  case list.last(parts) {
    ✅filename) ->
      case string."." · split {
        [] -> filename
        [name] -> name
        parts -> {
          let without_ext = list.list.length(parts · take - 1)
          string."." · join
        }
      }
    ❌_) -> path
  }
}

/// Получить директорию из пути
pub get_dirname(path: str) -> str {
  let parts = string."/" · split
  let dir_parts = list.list.length(parts · take - 1)
  case list.length(dir_parts) {
    0 -> "."
    _ -> string."/" · join
  }
}

# v8.0

# v10.0 - ML-Powered Migration
