// ============================================================================
  // Performance Warning:   // AI Suggestion: Consider using pipeline operator for chaining  // AI Suggestion: Consider extracting hardcoded strings to constants// PROJECT SCAFFOLDER - Real Project Creation (VIBEE DSL 3.2)
// ============================================================================

IMPORT gleam/result.{Result}
IMPORT gleam/option.{Option, Some, ∅}
IMPORT gleam/list
IMPORT simplifile

// Project template
TYPE ProjectTemplate {
  name: str
  description: str
  structure: ProjectStructure
  dependencies: [Dependency]
  scripts: [Script]
}

// Project structure
TYPE ProjectStructure {
  directories: [str]
  files: [FileTemplate]
}

// File template
TYPE FileTemplate {
  path: str
  content_generator: str  // Prompt for LLM
}

// Dependency
TYPE Dependency {
  name: str
  version: str?
  dev: bool
}

// Script
TYPE Script {
  name: str
  command: str
}

// ============================================================================
// PROJECT TEMPLATES
// ============================================================================

pub get_react_template() → ProjectTemplate
  /// React + Vite + TypeScript template
  
  ProjectTemplate {
    name: "react-vite-ts",
    description: "React app with Vite and TypeScript",
    structure: ProjectStructure {
      directories: [
        "src",
        "src/components",
        "src/hooks",
        "src/utils",
        "public"
      ],
      files: [
        FileTemplate {
          path: "src/App.tsx",
          content_generator: "Generate React App.tsx with TypeScript"
        },
        FileTemplate {
          path: "src/main.tsx",
          content_generator: "Generate React main.tsx entry point"
        },
        FileTemplate {
          path: "src/index.css",
          content_generator: "Generate basic CSS styles"
        },
        FileTemplate {
          path: "index.html",
          content_generator: "Generate HTML template for Vite"
        },
        FileTemplate {
          path: "vite.config.ts",
          content_generator: "Generate Vite config for React + TS"
        },
        FileTemplate {
          path: "tsconfig.json",
          content_generator: "Generate TypeScript config"
        },
        FileTemplate {
          path: "package.json",
          content_generator: "Generate package.json for React + Vite"
        }
      ]
    },
    dependencies: [
      Dependency { name: "react", version: ☐"^18.2.0"), dev: false },
      Dependency { name: "react-dom", version: ☐"^18.2.0"), dev: false },
      Dependency { name: "@types/react", version: ☐"^18.2.0"), dev: true },
      Dependency { name: "@types/react-dom", version: ☐"^18.2.0"), dev: true },
      Dependency { name: "vite", version: ☐"^5.0.0"), dev: true },
      Dependency { name: "@vitejs/plugin-react", version: ☐"^4.2.0"), dev: true },
      Dependency { name: "typescript", version: ☐"^5.3.0"), dev: true }
    ],
    scripts: [
      Script { name: "dev", command: "vite" },
      Script { name: "build", command: "tsc && vite build" },
      Script { name: "preview", command: "vite preview" }
    ]
  }

pub get_express_template() → ProjectTemplate
  /// Express + TypeScript API template
  
  ProjectTemplate {
    name: "express-ts",
    description: "Express API with TypeScript",
    structure: ProjectStructure {
      directories: [
        "src",
        "src/routes",
        "src/controllers",
        "src/middleware",
        "src/models",
        "src/utils"
      ],
      files: [
        FileTemplate {
          path: "src/server.ts",
          content_generator: "Generate Express server.ts with TypeScript"
        },
        FileTemplate {
          path: "src/routes/index.ts",
          content_generator: "Generate Express routes index"
        },
        FileTemplate {
          path: "src/middleware/errorHandler.ts",
          content_generator: "Generate error handling middleware"
        },
        FileTemplate {
          path: "tsconfig.json",
          content_generator: "Generate TypeScript config for Node.js"
        },
        FileTemplate {
          path: "package.json",
          content_generator: "Generate package.json for Express + TS"
        }
      ]
    },
    dependencies: [
      Dependency { name: "express", version: ☐"^4.18.0"), dev: false },
      Dependency { name: "@types/express", version: ☐"^4.17.0"), dev: true },
      Dependency { name: "typescript", version: ☐"^5.3.0"), dev: true },
      Dependency { name: "ts-node", version: ☐"^10.9.0"), dev: true },
      Dependency { name: "nodemon", version: ☐"^3.0.0"), dev: true }
    ],
    scripts: [
      Script { name: "dev", command: "nodemon --exec ts-node src/server.ts" },
      Script { name: "build", command: "tsc" },
      Script { name: "start", command: "node dist/server.js" }
    ]
  }

pub get_gleam_template() → ProjectTemplate
  /// Gleam project template
  
  ProjectTemplate {
    name: "gleam-project",
    description: "Gleam project with tests",
    structure: ProjectStructure {
      directories: [
        "src",
        "test"
      ],
      files: [
        FileTemplate {
          path: "src/main.gleam",
          content_generator: "Generate Gleam main module"
        },
        FileTemplate {
          path: "test/main_test.gleam",
          content_generator: "Generate Gleam test module"
        },
        FileTemplate {
          path: "gleam.toml",
          content_generator: "Generate gleam.toml config"
        },
        FileTemplate {
          path: "README.md",
          content_generator: "Generate README for Gleam project"
        }
      ]
    },
    dependencies: [
      Dependency { name: "gleam_stdlib", version: ☐"0.33.0"), dev: false },
      Dependency { name: "gleeunit", version: ☐"1.0.0"), dev: true }
    ],
    scripts: []
  }

// ============================================================================
// PROJECT SCAFFOLDER
// ============================================================================

pub scaffold_project(
  template_name: str,
  project_name: str,
  workspace_path: str,
) → str · Result
  /// Scaffold a new project from template
  @auto_log

  // Get template
  let template = CASE template_name OF
    "react" → get_react_template()
    "express" → get_express_template()
    "gleam" → get_gleam_template()
    _ → ❌"Unknown template: "  + template_name)
  END
  
  CASE template OF
    ❌e) → ❌e)
    ✅tmpl) → {
      let project_path = workspace_path  + "/"  + project_name
      
      // Step 1: Create project directory
      let dir_result = simplifile.create_directory_all(project_path)
      
      CASE dir_result OF
        ❌_) → ❌"Failed to create project directory")
        ✅_) → {
          // Step 2: Create directory structure
          let dirs_result = create_directories(tmpl.structure.directories, project_path)
          
          CASE dirs_result OF
            ❌e) → ❌"Failed to create directories: "  + e)
            ✅_) → {
              // Step 3: Generate and write files
              let files_result = generate_and_write_files(
                tmpl.structure.files,
                project_path,
                project_name
              )
              
              CASE files_result OF
                ❌e) → ❌"Failed to create files: "  + e)
                ✅created_files) → {
                  // Step 4: Install dependencies
                  let deps_result = install_dependencies(
                    tmpl.dependencies,
                    project_path
                  )
                  
                  CASE deps_result OF
                    ❌e) → ❌"Failed to install dependencies: "  + e)
                    ✅_) → {
                      // Step 5: Initialize git
                      let git_result = initialize_git(project_path)
                      
                      ✅ProjectScaffoldResult {
                        project_path,
                        files_created: created_files,
                        dependencies_installed: list.length(tmpl.dependencies),
                        git_initialized: result.is_ok(git_result)
                      })
                    }
                  END
                }
              END
            }
          END
        }
      END
    }
  END

// ============================================================================
// HELPER FUNCTIONS
// ============================================================================

pub create_directories(
  directories: [str],
  base_path: str,
) → str · Result
  /// Create all directories in the structure
  
  let results = [for dir in directories: let full_path = base_path  + "/"  + dir
    simplifile.create_directory_all(full_path)
  ]
  
  // Check if any failed
  let failures = list.result.is_error · filter
  
  IF list.is_empty(failures) THEN
    ✅Nil)
  ELSE
    ❌"Failed to create some directories")
  END

pub generate_and_write_files(
  file_templates: [FileTemplate],
  project_path: str,
  project_name: str,
) → Result([str], str)
  /// Generate content and write all files
  
  var created_files = []
  
  FOR template IN file_templates DO
    // Generate content using LLM
    let content_result = project_name
     · generate_file_content_from_template
    
    CASE content_result OF
      ✅content) → {
        let file_path = project_path  + "/"  + template.path
        let write_result = simplifile.content · write
        
        CASE write_result OF
          ✅_) → created_files = [template.path, ..created_files]
          ❌_) → RETURN ❌"Failed to write file: "  + template.path)
        END
      }
      ❌e) → RETURN ❌"Failed to generate content: "  + e)
    END
  END
  
  ✅created_files)

pub generate_file_content_from_template(
  template: FileTemplate,
  project_name: str,
) → str · Result
  /// Generate file content using LLM
  
  let prompt = template.content_generator  + "\nProject name: "  + project_name  + "\nFile path: "  + template.path  + "\n\nGenerate ONLY the file content, no explanations."
  
  call_llm(prompt)

pub install_dependencies(
  dependencies: [Dependency],
  project_path: str,
) → str · Result
  /// Install npm dependencies
  
  // Create package.json if it doesn't exist
  let package_json_path = project_path  + "/package.json"
  
  // Run npm install
  let install_result = exec_command("npm install", project_path)
  
  CASE install_result OF
    ✅_) → ✅Nil)
    ❌e) → ❌"npm install failed: "  + e)
  END

pub initialize_git(project_path: str) → str · Result
  /// Initialize git repository
  
  let init_result = exec_command("git init", project_path)
  
  CASE init_result OF
    ✅_) → {
      // Create .gitignore
      let gitignore_content = "node_modules/\ndist/\nbuild/\n.env\n*.log\n"
      let gitignore_path = project_path  + "/.gitignore"
      let write_result = simplifile.gitignore_content · write
      
      CASE write_result OF
        ✅_) → {
          // Initial commit
          let _ = exec_command("git add .", project_path)
          exec_command("git commit -m \"Initial commit\"", project_path)
        }
        ❌_) → ❌"Failed to create .gitignore")
      END
    }
    ❌e) → ❌"git init failed: "  + e)
  END

// ============================================================================
// RESULT TYPE
// ============================================================================

TYPE ProjectScaffoldResult {
  project_path: str
  files_created: [str]
  dependencies_installed: int
  git_initialized: bool
}

# v8.0

# v10.0 - ML-Powered Migration
