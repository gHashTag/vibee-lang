name: mcp_core
version: "1.0.0"
language: zig
module: mcp_core
description: Core MCP (Model Context Protocol) implementation in Zig

behaviors:
  - name: handle_mcp_request
    given: MCP request received from client
    when: handle_request function called
    then: Request processed and response returned
    test_cases:
      - name: handle_list_tools
        input: {method: "tools/list"}
        expected: {status: "success", tools: []}
      - name: handle_call_tool
        input: {method: "tools/call", tool: "test"}
        expected: {status: "success", result: "ok"}

  - name: manage_mcp_session
    given: Client connects to MCP server
    when: Session management functions called
    then: Session created, maintained, and cleaned up
    test_cases:
      - name: create_session
        input: {client_id: "test-client"}
        expected: {session_id: "uuid", status: "active"}
      - name: close_session
        input: {session_id: "uuid"}
        expected: {status: "closed"}

  - name: serialize_mcp_messages
    given: MCP message object
    when: Serialization function called
    then: Message converted to JSON format
    test_cases:
      - name: serialize_request
        input: {method: "test", params: {}}
        expected: '{"jsonrpc":"2.0","method":"test","params":{}}'
      - name: serialize_response
        input: {result: "ok"}
        expected: '{"jsonrpc":"2.0","result":"ok"}'

types:
  MCPRequest:
    jsonrpc: str
    method: str
    params: json
    id: optional<int>

  MCPResponse:
    jsonrpc: str
    result: optional<json>
    error: optional<MCPError>
    id: optional<int>

  MCPError:
    code: int
    message: str
    data: optional<json>

  MCPSession:
    session_id: str
    client_id: str
    created_at: int
    last_activity: int
    status: str

  MCPTool:
    name: str
    description: str
    input_schema: json
    output_schema: json

functions:
  - name: handle_request
    params: {request: MCPRequest}
    returns: MCPResponse
    description: Process incoming MCP request

  - name: create_session
    params: {client_id: str}
    returns: MCPSession
    description: Create new MCP session

  - name: close_session
    params: {session_id: str}
    returns: bool
    description: Close existing session

  - name: serialize_request
    params: {request: MCPRequest}
    returns: str
    description: Serialize request to JSON

  - name: serialize_response
    params: {response: MCPResponse}
    returns: str
    description: Serialize response to JSON

  - name: list_tools
    params: {}
    returns: list<MCPTool>
    description: List all available MCP tools

  - name: call_tool
    params: {tool_name: str, params: json}
    returns: json
    description: Execute MCP tool with parameters

imports:
  - std.json
  - std.mem
  - std.ArrayList
  - std.StringHashMap

optimization:
  target: zig
  level: ReleaseFast
  features:
    - inline_small_functions
    - unroll_loops
    - vectorize

performance:
  expected_latency_ms: 5
  max_memory_mb: 50
  concurrent_sessions: 1000
