name: mcp_tools
version: "1.0.0"
language: zig
module: mcp_tools
description: MCP tools collection - Telegram, AI, Payments, RAG

behaviors:
  - name: telegram_send_message
    given: Telegram bot token and chat ID
    when: send_message tool called
    then: Message sent to Telegram chat
    test_cases:
      - name: send_text_message
        input: {chat_id: 123, text: "Hello"}
        expected: {status: "sent", message_id: 456}
      - name: send_with_keyboard
        input: {chat_id: 123, text: "Choose", keyboard: [["A", "B"]]}
        expected: {status: "sent", message_id: 457}

  - name: telegram_get_dialogs
    given: Telegram session active
    when: get_dialogs tool called
    then: List of dialogs returned
    test_cases:
      - name: get_recent_dialogs
        input: {limit: 10}
        expected: {dialogs: [], count: 10}

  - name: ai_generate_image
    given: FLUX API credentials
    when: generate_image tool called
    then: Image generated and URL returned
    test_cases:
      - name: generate_simple_image
        input: {prompt: "cat", model: "flux-schnell"}
        expected: {status: "success", url: "https://..."}

  - name: ai_generate_video
    given: Kling API credentials
    when: generate_video tool called
    then: Video generated and URL returned
    test_cases:
      - name: generate_short_video
        input: {prompt: "dancing cat", duration: 5}
        expected: {status: "success", url: "https://..."}

  - name: payment_create_invoice
    given: Payment provider credentials
    when: create_invoice tool called
    then: Invoice created and payment URL returned
    test_cases:
      - name: create_robokassa_invoice
        input: {amount: 100, currency: "RUB", description: "Test"}
        expected: {status: "created", url: "https://..."}

  - name: rag_search_context
    given: Vector database with embeddings
    when: search_context tool called
    then: Relevant context retrieved
    test_cases:
      - name: search_by_query
        input: {query: "how to deploy", limit: 5}
        expected: {results: [], count: 5}

types:
  TelegramMessage:
    chat_id: int
    text: str
    keyboard: optional<list<list<str>>>
    parse_mode: optional<str>

  TelegramDialog:
    id: int
    title: str
    unread_count: int
    last_message: optional<str>

  AIImageRequest:
    prompt: str
    model: str
    width: optional<int>
    height: optional<int>

  AIVideoRequest:
    prompt: str
    duration: int
    model: optional<str>

  PaymentInvoice:
    amount: float
    currency: str
    description: str
    provider: str

  RAGSearchQuery:
    query: str
    limit: int
    threshold: optional<float>

  RAGSearchResult:
    text: str
    score: float
    metadata: json

functions:
  # Telegram tools
  - name: telegram_send_message
    params: {message: TelegramMessage}
    returns: json
    description: Send message to Telegram chat

  - name: telegram_get_dialogs
    params: {limit: int}
    returns: list<TelegramDialog>
    description: Get list of Telegram dialogs

  - name: telegram_search_messages
    params: {query: str, limit: int}
    returns: list<json>
    description: Search messages in Telegram

  # AI tools
  - name: ai_generate_image
    params: {request: AIImageRequest}
    returns: json
    description: Generate image using FLUX

  - name: ai_generate_video
    params: {request: AIVideoRequest}
    returns: json
    description: Generate video using Kling

  - name: ai_text_to_speech
    params: {text: str, voice: str}
    returns: json
    description: Convert text to speech using ElevenLabs

  # Payment tools
  - name: payment_create_invoice
    params: {invoice: PaymentInvoice}
    returns: json
    description: Create payment invoice

  - name: payment_check_status
    params: {invoice_id: str}
    returns: json
    description: Check payment status

  # RAG tools
  - name: rag_search_context
    params: {query: RAGSearchQuery}
    returns: list<RAGSearchResult>
    description: Search relevant context in vector DB

  - name: rag_add_document
    params: {text: str, metadata: json}
    returns: json
    description: Add document to vector DB

imports:
  - std.json
  - std.http
  - std.mem
  - std.ArrayList

optimization:
  target: zig
  level: ReleaseFast
  features:
    - inline_small_functions
    - unroll_loops

performance:
  expected_latency_ms: 100
  max_memory_mb: 200
  concurrent_requests: 100
