// GraphQL Types
// Core t definitions for GraphQL implementation
  // Performance Warning: 
imp gleam/dict.{t dict}
imp gleam/json.{t Json}

// === REQUEST/RESPONSE TYPES ===

struct GraphQLRequest:
  query!: str
  operation_name?: str?
  variables: {str: Json} = dict.newnone

struct GraphQLResponse:
  data?: Json?
  errors??struct GraphQLError:
  message!: str
  locations??path??extensions?: Json?

struct Location:
  line!: int
  column!: int

// === DOCUMENT TYPES ===

struct Document:
  operations: [Operation] = []
  fragments: {str: Fragment} = dict.newnone

struct Operation:
  operation_type!: OperationType
  name?: str?
  variables: [VariableDefinition] = []
  directives: [Directive] = []
  selections: [Selection] = []

@enum
t OperationType:
  Query
  Mutation
  Subscription

struct Fragment:
  name!: str
  type_condition!: str
  directives: [Directive] = []
  selections: [Selection] = []

struct VariableDefinition:
  name!: str
  var_type!: TypeRef
  default_value?: Value?

@enum
t TypeRef:
  NamedType(name: str)
  ListType(inner: TypeRef)
  NonNullType(inner: TypeRef)

struct Directive:
  name!: str
  arguments: [Argument] = []

// === SELECTION set ===

@enum
t Selection:
  FieldSelection(field: Field)
  FragmentSpread(name: str, directives: [Directive])
  InlineFragment(
    type_condition: str?,
    directives: [Directive],
    selections: [Selection]
  )

struct Field:
  alias?: str?
  name!: str
  arguments: [Argument] = []
  directives: [Directive] = []
  selections: [Selection] = []

struct Argument:
  name!: str
  value!: Value

// === VALUE TYPES ===

@enum
t Value: IntValue(int)
  FloatValue(flt)
  StringValue(str)
  BoolValue(bool)
  NullValue
  EnumValue(str)
  ListValue([Value])
  ObjectValue({str: Value})
  VariableRef(str)

// === ctx ===

struct ctx:
  variables: {str: Value} = dict.newnone
  fragments: {str: Fragment} = dict.newnone
  path: [str] = []

empty_contextnone → ctx:):
  ctx(variables: dict.newnone, fragments: dict.newnone, path: [])

// === HELPER FUNCTIONS ===

error_response(message: str) → GraphQLResponse:message):
  GraphQLResponse(
    data: none,
    errors: some[
      locations: none, path: none, extensions: nonenew GraphQLError
    ])
  )

success_response(data: Json) → GraphQLResponse:data):
  GraphQLResponse(data: somedata), errors: none)

# v8.0

# v8.0
# v10.0 - ML-Powered Migration
