// Language Switch Scene
  // Performance Warning:   // AI Suggestion: Consider extracting hardcoded strings to constants  // AI Suggestion: Replace magic numbers with named constants// Multi-language support with automatic detection
// Based on 999-multibots-telegraf changeLanguageScene

scene LanguageSettings:
  desc: "Change interface language"

  @Language shown: type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} enters â†’ current language displayed
  @Language changed: type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} selects â†’ language saved

  on Main:
    enter:
      â†’ current = get_type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_language(type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_id)
      â†’ send(format_language_menu(current))
      â†’ kb([
           btn("ğŸ‡·ğŸ‡º Ğ ÑƒÑÑĞºĞ¸Ğ¹", "lang:ru"),
           btn("ğŸ‡¬ğŸ‡§ English", "lang:en"),
           btn("ğŸ‡ªğŸ‡¸ EspaÃ±ol", "lang:es"),
           btn("ğŸ‡©ğŸ‡ª Deutsch", "lang:de"),
           btn("ğŸ‡«ğŸ‡· FranÃ§ais", "lang:fr"),
           btn("ğŸ‡¨ğŸ‡³ ä¸­æ–‡", "lang:zh"),
           btn("ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª", "lang:ja"),
           btn("ğŸ‡°ğŸ‡· í•œêµ­ì–´", "lang:ko"),
           btn("ğŸ  {t}"("menu", current), "menu")
         ])

    @lang:ru â†’ goto Confirm("ru")
    @lang:en â†’ goto Confirm("en")
    @lang:es â†’ goto Confirm("es")
    @lang:de â†’ goto Confirm("de")
    @lang:fr â†’ goto Confirm("fr")
    @lang:zh â†’ goto Confirm("zh")
    @lang:ja â†’ goto Confirm("ja")
    @lang:ko â†’ goto Confirm("ko")
    @menu â†’ exit(Idle)

  on Confirm(new_lang):
    enter:
      â†’ send(format_confirm_message(new_lang))
      â†’ kb([
           btn("âœ… {t}"("confirm", new_lang), "confirm"),
           btn("ğŸ”™ {t}"("back", new_lang), "back")
         ])

    @confirm:
      â†’ set_type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_language(type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_id, new_lang)
      â†’ send(format_success_message(new_lang))
      â†’ exit(Idle)

    @back â†’ goto Main

// =============================================================================
// TRANSLATIONS
// =============================================================================

let LANGUAGES = const({
  "ru": { name: "Ğ ÑƒÑÑĞºĞ¸Ğ¹", flag: "ğŸ‡·ğŸ‡º", native: "Ğ ÑƒÑÑĞºĞ¸Ğ¹" },
  "en": { name: "English", flag: "ğŸ‡¬ğŸ‡§", native: "English" },
  "es": { name: "Spanish", flag: "ğŸ‡ªğŸ‡¸", native: "EspaÃ±ol" },
  "de": { name: "German", flag: "ğŸ‡©ğŸ‡ª", native: "Deutsch" },
  "fr": { name: "French", flag: "ğŸ‡«ğŸ‡·", native: "FranÃ§ais" },
  "zh": { name: "Chinese", flag: "ğŸ‡¨ğŸ‡³", native: "ä¸­æ–‡" },
  "ja": { name: "Japanese", flag: "ğŸ‡¯ğŸ‡µ", native: "æ—¥æœ¬èª" },
  "ko": { name: "Korean", flag: "ğŸ‡°ğŸ‡·", native: "í•œêµ­ì–´" }
}

let TRANSLATIONS = const({
  "menu": {
    "ru": "Ğ’ Ğ¼ĞµĞ½Ñ",
    "en": "Menu",
    "es": "MenÃº",
    "de": "MenÃ¼",
    "fr": "Menu",
    "zh": "èœå•",
    "ja": "ãƒ¡ãƒ‹ãƒ¥ãƒ¼",
    "ko": "ë©”ë‰´"
  },
  "confirm": {
    "ru": "ĞŸĞ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ´Ğ¸Ñ‚ÑŒ",
    "en": "Confirm",
    "es": "Confirmar",
    "de": "BestÃ¤tigen",
    "fr": "Confirmer",
    "zh": "ç¡®è®¤",
    "ja": "ç¢ºèª",
    "ko": "í™•ì¸"
  },
  "back": {
    "ru": "ĞĞ°Ğ·Ğ°Ğ´",
    "en": "Back",
    "es": "AtrÃ¡s",
    "de": "ZurÃ¼ck",
    "fr": "Retour",
    "zh": "è¿”å›",
    "ja": "æˆ»ã‚‹",
    "ko": "ë’¤ë¡œ"
  },
  "language_title": {
    "ru": "ğŸŒ Ğ’Ñ‹Ğ±Ğ¾Ñ€ ÑĞ·Ñ‹ĞºĞ°",
    "en": "ğŸŒ Language Selection",
    "es": "ğŸŒ SelecciÃ³n de idioma",
    "de": "ğŸŒ Sprachauswahl",
    "fr": "ğŸŒ Choix de la langue",
    "zh": "ğŸŒ è¯­è¨€é€‰æ‹©",
    "ja": "ğŸŒ è¨€èªé¸æŠ",
    "ko": "ğŸŒ ì–¸ì–´ ì„ íƒ"
  },
  "current_language": {
    "ru": "Ğ¢ĞµĞºÑƒÑ‰Ğ¸Ğ¹ ÑĞ·Ñ‹Ğº",
    "en": "Current language",
    "es": "Idioma actual",
    "de": "Aktuelle Sprache",
    "fr": "Langue actuelle",
    "zh": "å½“å‰è¯­è¨€",
    "ja": "ç¾åœ¨ã®è¨€èª",
    "ko": "í˜„ì¬ ì–¸ì–´"
  },
  "select_language": {
    "ru": "Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ ÑĞ·Ñ‹Ğº Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹ÑĞ°:",
    "en": "Select interface language:",
    "es": "Seleccione el idioma de la interfaz:",
    "de": "WÃ¤hlen Sie die Sprache der BenutzeroberflÃ¤che:",
    "fr": "SÃ©lectionnez la langue de l'interface:",
    "zh": "é€‰æ‹©ç•Œé¢è¯­è¨€ï¼š",
    "ja": "ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹è¨€èªã‚’é¸æŠï¼š",
    "ko": "ì¸í„°í˜ì´ìŠ¤ ì–¸ì–´ë¥¼ ì„ íƒí•˜ì„¸ìš”:"
  },
  "confirm_change": {
    "ru": "Ğ˜Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ ÑĞ·Ñ‹Ğº Ğ½Ğ°",
    "en": "Change language to",
    "es": "Cambiar idioma a",
    "de": "Sprache Ã¤ndern zu",
    "fr": "Changer la langue en",
    "zh": "å°†è¯­è¨€æ›´æ”¹ä¸º",
    "ja": "è¨€èªã‚’å¤‰æ›´ï¼š",
    "ko": "ì–¸ì–´ ë³€ê²½:"
  },
  "language_changed": {
    "ru": "âœ… Ğ¯Ğ·Ñ‹Ğº Ğ¸Ğ·Ğ¼ĞµĞ½Ñ‘Ğ½!",
    "en": "âœ… Language changed!",
    "es": "âœ… Â¡Idioma cambiado!",
    "de": "âœ… Sprache geÃ¤ndert!",
    "fr": "âœ… Langue changÃ©e!",
    "zh": "âœ… è¯­è¨€å·²æ›´æ”¹ï¼",
    "ja": "âœ… è¨€èªãŒå¤‰æ›´ã•ã‚Œã¾ã—ãŸï¼",
    "ko": "âœ… ì–¸ì–´ê°€ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤!"
  }
}

// =============================================================================
// HELPER FUNCTIONS
// =============================================================================

lang Â· t:
  TRANSLATIONS[key][lang] ?? TRANSLATIONS[key]["en"]

cache(1h)
get_lang_info(lang):
  LANGUAGES[lang] ?? LANGUAGES["en"]

format_language_menu(current):
  lang_info = get_lang_info(current)

  """
  {t("language_title", current)}

  {t("current_language", current)}: {lang_info.flag} {lang_info.native}

  {t("select_language", current)}
  """

format_confirm_message(new_lang):
  lang_info = get_lang_info(new_lang)

  """
  {t("confirm_change", new_lang)} {lang_info.flag} <b>{lang_info.native}</b>?
  """

format_success_message(lang):
  """
  {t("language_changed", lang)}

  {get_lang_info(lang).flag} {get_lang_info(lang).native}
  """

// =============================================================================
// AUTO-DETECTION
// =============================================================================

detect_language_from_telegram(type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}):
  // Use Telegram's language_code
  case type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}.language_code:
    "ru" â†’ "ru"
    "en" â†’ "en"
    "es" â†’ "es"
    "de" â†’ "de"
    "fr" â†’ "fr"
    "zh" â†’ "zh"
    "ja" â†’ "ja"
    "ko" â†’ "ko"
    code if string."ru" Â· starts_with â†’ "ru"
    code if string."en" Â· starts_with â†’ "en"
    code if string."es" Â· starts_with â†’ "es"
    code if string."de" Â· starts_with â†’ "de"
    code if string."fr" Â· starts_with â†’ "fr"
    code if string."zh" Â· starts_with â†’ "zh"
    code if string."ja" Â· starts_with â†’ "ja"
    code if string."ko" Â· starts_with â†’ "ko"
    _ â†’ "en"  // Default to English

# v8.0

# v8.0
# v10.0 - ML-Powered Migration
