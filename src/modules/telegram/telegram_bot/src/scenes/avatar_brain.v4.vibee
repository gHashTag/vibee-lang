// Avatar Brain Wizard
  // Performance Warning:   // AI Suggestion: Consider extracting hardcoded strings to constants  // AI Suggestion: Replace magic numbers with named constants// Configure AI personality and behavior for digital avatars
// Based on 999-multibots-telegraf avatarBrainWizard

import "../i18n/scenes_i18n.vibee" as i18n

scene AvatarBrain:
  desc: "Configure AI avatar personality, tone, and knowledge"

  @spec "Personality set": type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} configures ‚Üí avatar brain updated
  @spec "Knowledge base added": type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} provides docs ‚Üí indexed

  on Main:
    enter:
      ‚Üí lang = get_type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_language(type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_id)
      ‚Üí brain_config = get_avatar_brain(type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_id)
      ‚Üí case brain_config:
           ‚àÖ-> reply(case lang:
             "en" ‚Üí """
               üß† <b>Avatar Brain Setup</b>

               Create a unique personality for your avatar!
               """
             _ ‚Üí """
               üß† <b>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–æ–∑–≥–∞ –∞–≤–∞—Ç–∞—Ä–∞</b>

               –°–æ–∑–¥–∞–π—Ç–µ —É–Ω–∏–∫–∞–ª—å–Ω—É—é –ª–∏—á–Ω–æ—Å—Ç—å –¥–ª—è –≤–∞—à–µ–≥–æ –∞–≤–∞—Ç–∞—Ä–∞!
               """)
           config ‚Üí reply(case lang:
             "en" ‚Üí """
               üß† <b>Avatar Brain</b>

               üë§ Name: #{config.name}
               üé≠ Personality: #{config.personality}
               üéØ Role: #{config.role}

               üìö Knowledge base: #{config.knowledge_count} documents
               """
             _ ‚Üí """
               üß† <b>–ú–æ–∑–≥ –∞–≤–∞—Ç–∞—Ä–∞</b>

               üë§ –ò–º—è: #{config.name}
               üé≠ –õ–∏—á–Ω–æ—Å—Ç—å: #{config.personality}
               üéØ –†–æ–ª—å: #{config.role}

               üìö –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π: #{config.knowledge_count} –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
               """)
      ‚Üí show_keyboard([
           button(case lang: "en" ‚Üí "üë§ Name and role" _ ‚Üí "üë§ –ò–º—è –∏ —Ä–æ–ª—å", "name_role"),
           button(case lang: "en" ‚Üí "üé≠ Personality" _ ‚Üí "üé≠ –õ–∏—á–Ω–æ—Å—Ç—å", "personality"),
           button(case lang: "en" ‚Üí "üó£Ô∏è Communication style" _ ‚Üí "üó£Ô∏è –°—Ç–∏–ª—å –æ–±—â–µ–Ω–∏—è", "communication"),
           button(case lang: "en" ‚Üí "üìö Knowledge base" _ ‚Üí "üìö –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π", "knowledge"),
           button(case lang: "en" ‚Üí "üéØ Goals and tasks" _ ‚Üí "üéØ –¶–µ–ª–∏ –∏ –∑–∞–¥–∞—á–∏", "goals"),
           button(case lang: "en" ‚Üí "‚ö° Quick replies" _ ‚Üí "‚ö° –ë—ã—Å—Ç—Ä—ã–µ –æ—Ç–≤–µ—Ç—ã", "quick_replies"),
           button("common", "menu" ¬∑ t, "menu")
         ])

    callback "name_role" ‚Üí transition ConfigureNameRole
    callback "personality" ‚Üí transition ConfigurePersonality
    callback "communication" ‚Üí transition ConfigureCommunication
    callback "knowledge" ‚Üí transition ConfigureKnowledge
    callback "goals" ‚Üí transition ConfigureGoals
    callback "quick_replies" ‚Üí transition ConfigureQuickReplies
    callback "menu" ‚Üí exit(Idle)

  on ConfigureNameRole:
    enter:
      ‚Üí lang = get_type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_language(type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_id)
      ‚Üí current = get_avatar_brain(type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_id)
      ‚Üí reply(case lang:
           "en" ‚Üí """
             üë§ <b>Avatar name and role</b>

             Current name: #{current?.name ?? "Not set"}
             Current role: #{current?.role ?? "Not set"}

             Enter avatar name:
             """
           _ ‚Üí """
             üë§ <b>–ò–º—è –∏ —Ä–æ–ª—å –∞–≤–∞—Ç–∞—Ä–∞</b>

             –¢–µ–∫—É—â–µ–µ –∏–º—è: #{current?.name ?? "–ù–µ –∑–∞–¥–∞–Ω–æ"}
             –¢–µ–∫—É—â–∞—è —Ä–æ–ª—å: #{current?.role ?? "–ù–µ –∑–∞–¥–∞–Ω–∞"}

             –í–≤–µ–¥–∏—Ç–µ –∏–º—è –∞–≤–∞—Ç–∞—Ä–∞:
             """)
      ‚Üí show_keyboard([
           button("common", "back" ¬∑ t, "back")
         ])

    message TextMessage(name):
      ‚Üí save_avatar_name(type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_id, name)
      ‚Üí reply("‚úÖ –ò–º—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ: <b>#{name}</b>\n\n–¢–µ–ø–µ—Ä—å –≤—ã–±–µ—Ä–∏—Ç–µ —Ä–æ–ª—å:")
      ‚Üí show_keyboard([
           button("üíº –ë–∏–∑–Ω–µ—Å-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç", "role:business"),
           button("üéì –ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å", "role:teacher"),
           button("üõí –ü—Ä–æ–¥–∞–≤–µ—Ü", "role:sales"),
           button("üé≠ –†–∞–∑–≤–ª–µ–∫–∞—Ç–µ–ª—å", "role:entertainer"),
           button("üí° –≠–∫—Å–ø–µ—Ä—Ç", "role:expert"),
           button("‚úèÔ∏è –°–≤–æ—è —Ä–æ–ª—å", "role:custom"),
           button("üîô –ù–∞–∑–∞–¥", "back")
         ])

    callback /^role:(.+)$/:
      ‚Üí role_id = extract_id(callback_data)
      ‚Üí case role_id:
           "custom" ‚Üí transition CustomRole
           _ ‚Üí {
             ‚Üí role = get_role_template(role_id)
             ‚Üí save_avatar_role(type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_id, role)
             ‚Üí reply("‚úÖ –†–æ–ª—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞: <b>#{role.name}</b>")
             ‚Üí transition Main
           }

    callback "back" ‚Üí transition Main

  on CustomRole:
    enter:
      ‚Üí reply("""
        ‚úèÔ∏è <b>–°–≤–æ—è —Ä–æ–ª—å</b>

        –û–ø–∏—à–∏—Ç–µ —Ä–æ–ª—å –≤–∞—à–µ–≥–æ –∞–≤–∞—Ç–∞—Ä–∞:

        <i>–ü—Ä–∏–º–µ—Ä: "–≠–∫—Å–ø–µ—Ä—Ç –ø–æ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞–º, –ø–æ–º–æ–≥–∞–µ—Ç –Ω–æ–≤–∏—á–∫–∞–º —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è –≤ –±–ª–æ–∫—á–µ–π–Ω–µ"</i>
        """)
      ‚Üí show_keyboard([
           button("üîô –ù–∞–∑–∞–¥", "back")
         ])

    message TextMessage(description):
      ‚Üí save_avatar_role(type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_id, { id: "custom", name: "–°–≤–æ—è —Ä–æ–ª—å", description }
      ‚Üí reply("‚úÖ –†–æ–ª—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!")
      ‚Üí transition Main

    callback "back" ‚Üí transition ConfigureNameRole

  on ConfigurePersonality:
    enter:
      ‚Üí reply("""
        üé≠ <b>–õ–∏—á–Ω–æ—Å—Ç—å –∞–≤–∞—Ç–∞—Ä–∞</b>

        –í—ã–±–µ—Ä–∏—Ç–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —á–µ—Ä—Ç—ã —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∞:
        """)
      ‚Üí show_keyboard([
           button("üòä –î—Ä—É–∂–µ–ª—é–±–Ω—ã–π", "trait:friendly"),
           button("üíº –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π", "trait:professional"),
           button("üòÑ –í–µ—Å—ë–ª—ã–π", "trait:funny"),
           button("üßê –°–µ—Ä—å—ë–∑–Ω—ã–π", "trait:serious"),
           button("ü§ó –≠–º–ø–∞—Ç–∏—á–Ω—ã–π", "trait:empathetic"),
           button("‚ö° –≠–Ω–µ—Ä–≥–∏—á–Ω—ã–π", "trait:energetic"),
           button("üßò –°–ø–æ–∫–æ–π–Ω—ã–π", "trait:calm"),
           button("üéØ –¶–µ–ª–µ—É—Å—Ç—Ä–µ–º–ª—ë–Ω–Ω—ã–π", "trait:driven"),
           button("‚úÖ –ì–æ—Ç–æ–≤–æ", "done"),
           button("üîô –ù–∞–∑–∞–¥", "back")
         ])
      ‚Üí stay(selected_traits: get_avatar_traits(type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_id) ?? [])

    callback /^trait:(.+)$/:
      ‚Üí trait_id = extract_id(callback_data)
      ‚Üí new_traits = trait_id ¬∑ toggle_trait
      ‚Üí reply("–í—ã–±—Ä–∞–Ω–æ: {format_traits}"(new_traits))
      ‚Üí stay(selected_traits: new_traits)

    callback "done":
      ‚Üí save_avatar_traits(type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_id, selected_traits)
      ‚Üí reply("‚úÖ –õ–∏—á–Ω–æ—Å—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞!")
      ‚Üí transition Main

    callback "back" ‚Üí transition Main

  on ConfigureCommunication:
    enter:
      ‚Üí current = get_avatar_communication(type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_id)
      ‚Üí reply("""
        üó£Ô∏è <b>–°—Ç–∏–ª—å –æ–±—â–µ–Ω–∏—è</b>

        –ö–∞–∫ –∞–≤–∞—Ç–∞—Ä –±—É–¥–µ—Ç –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞–º?
        """)
      ‚Üí show_keyboard([
           button("üëã –ù–∞ \"—Ç—ã\"", "style:informal"),
           button("ü§ù –ù–∞ \"–í—ã\"", "style:formal"),
           button("üòé –ú–æ–ª–æ–¥—ë–∂–Ω—ã–π —Å–ª–µ–Ω–≥", "style:slang"),
           button("üìö –ê–∫–∞–¥–µ–º–∏—á–µ—Å–∫–∏–π", "style:academic"),
           button("üîô –ù–∞–∑–∞–¥", "back")
         ])

    callback /^style:(.+)$/:
      ‚Üí style_id = extract_id(callback_data)
      ‚Üí save_avatar_communication(type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_id, style_id)
      ‚Üí reply("‚úÖ –°—Ç–∏–ª—å –æ–±—â–µ–Ω–∏—è: <b>#{get_style_name(style_id)}</b>")
      ‚Üí transition ConfigureTone

    callback "back" ‚Üí transition Main

  on ConfigureTone:
    enter:
      ‚Üí reply("""
        üéµ <b>–¢–æ–Ω —Å–æ–æ–±—â–µ–Ω–∏–π</b>

        –í—ã–±–µ—Ä–∏—Ç–µ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ç–æ–Ω:
        """)
      ‚Üí show_keyboard([
           button("üòä –ü–æ–∑–∏—Ç–∏–≤–Ω—ã–π", "tone:positive"),
           button("üòê –ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π", "tone:neutral"),
           button("üî• –ú–æ—Ç–∏–≤–∏—Ä—É—é—â–∏–π", "tone:motivating"),
           button("ü§î –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π", "tone:analytical"),
           button("‚ù§Ô∏è –ó–∞–±–æ—Ç–ª–∏–≤—ã–π", "tone:caring"),
           button("üîô –ù–∞–∑–∞–¥", "back")
         ])

    callback /^tone:(.+)$/:
      ‚Üí tone_id = extract_id(callback_data)
      ‚Üí save_avatar_tone(type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_id, tone_id)
      ‚Üí reply("‚úÖ –¢–æ–Ω —Å–æ–æ–±—â–µ–Ω–∏–π: <b>#{get_tone_name(tone_id)}</b>")
      ‚Üí transition Main

    callback "back" ‚Üí transition ConfigureCommunication

  on ConfigureKnowledge:
    enter:
      ‚Üí lang = get_type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_language(type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_id)
      ‚Üí knowledge = get_avatar_knowledge(type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_id)
      ‚Üí reply(case lang:
           "en" ‚Üí """
             üìö <b>Knowledge base</b>

             Documents in base: #{length(knowledge)}

             Add documents so the avatar can answer questions on your topic.
             """
           _ ‚Üí """
             üìö <b>–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π</b>

             –î–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≤ –±–∞–∑–µ: #{length(knowledge)}

             –î–æ–±–∞–≤—å—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã, —á—Ç–æ–±—ã –∞–≤–∞—Ç–∞—Ä –º–æ–≥ –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –ø–æ –≤–∞—à–µ–π —Ç–µ–º–µ.
             """)
      ‚Üí show_keyboard([
           button(case lang: "en" ‚Üí "üìÑ Add text" _ ‚Üí "üìÑ –î–æ–±–∞–≤–∏—Ç—å —Ç–µ–∫—Å—Ç", "add_text"),
           button(case lang: "en" ‚Üí "üìé Upload file" _ ‚Üí "üìé –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª", "add_file"),
           button(case lang: "en" ‚Üí "üîó Add link" _ ‚Üí "üîó –î–æ–±–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫—É", "add_url"),
           button(case lang: "en" ‚Üí "üìã View base" _ ‚Üí "üìã –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –±–∞–∑—É", "view"),
           button(case lang: "en" ‚Üí "üóëÔ∏è Clear base" _ ‚Üí "üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –±–∞–∑—É", "clear"),
           button("common", "back" ¬∑ t, "back")
         ])

    callback "add_text" ‚Üí transition AddKnowledgeText
    callback "add_file" ‚Üí transition AddKnowledgeFile
    callback "add_url" ‚Üí transition AddKnowledgeUrl
    callback "view" ‚Üí transition ViewKnowledge
    callback "clear" ‚Üí transition ConfirmClearKnowledge
    callback "back" ‚Üí transition Main

  on AddKnowledgeText:
    enter:
      ‚Üí reply("""
        üìÑ <b>–î–æ–±–∞–≤–∏—Ç—å —Ç–µ–∫—Å—Ç</b>

        –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç, –∫–æ—Ç–æ—Ä—ã–π –∞–≤–∞—Ç–∞—Ä –¥–æ–ª–∂–µ–Ω –∑–Ω–∞—Ç—å:

        <i>–ú–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å FAQ, –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞, –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –∏ —Ç.–¥.</i>
        """)
      ‚Üí show_keyboard([
           button("üîô –û—Ç–º–µ–Ω–∞", "cancel")
         ])

    message TextMessage(text):
      ‚Üí case string.length(text) < 50:
           true ‚Üí reply("‚ùå –¢–µ–∫—Å—Ç —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π (–º–∏–Ω. 50 —Å–∏–º–≤–æ–ª–æ–≤)") && stay
           false ‚Üí {
             ‚Üí doc_id = add_knowledge_document(type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_id, "text", text)
             ‚Üí index_document(doc_id)
             ‚Üí reply("‚úÖ –¢–µ–∫—Å—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ –±–∞–∑—É –∑–Ω–∞–Ω–∏–π!\n\n–î–æ–±–∞–≤—å—Ç–µ –µ—â—ë –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –ì–æ—Ç–æ–≤–æ.")
             ‚Üí show_keyboard([
                  button("‚úÖ –ì–æ—Ç–æ–≤–æ", "done"),
                  button("‚ûï –ï—â—ë —Ç–µ–∫—Å—Ç", "more")
                ])
           }

    callback "done" ‚Üí transition ConfigureKnowledge
    callback "more" ‚Üí enter
    callback "cancel" ‚Üí transition ConfigureKnowledge

  on AddKnowledgeFile:
    enter:
      ‚Üí reply("""
        üìé <b>–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª</b>

        –û—Ç–ø—Ä–∞–≤—å—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç:
        ‚Ä¢ PDF
        ‚Ä¢ TXT
        ‚Ä¢ DOCX
        ‚Ä¢ MD

        –ú–∞–∫—Å–∏–º—É–º: 10 MB
        """)
      ‚Üí show_keyboard([
           button("üîô –û—Ç–º–µ–Ω–∞", "cancel")
         ])

    message file_name ¬∑ DocumentMessage:
      ‚Üí case validate_document(file_name):
           ‚úÖ_) ‚Üí {
             ‚Üí doc_id = add_knowledge_document(type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_id, "file", file_id, file_name)
             ‚Üí process_document_async(doc_id)
             ‚Üí reply("‚úÖ –§–∞–π–ª <b>#{file_name}</b> –∑–∞–≥—Ä—É–∂–µ–Ω!\n\n–û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–π–º—ë—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç.")
             ‚Üí transition ConfigureKnowledge
           }
           ‚ùåmsg) ‚Üí {
             ‚Üí reply("‚ùå {msg}")
             ‚Üí stay
           }

    callback "cancel" ‚Üí transition ConfigureKnowledge

  on AddKnowledgeUrl:
    enter:
      ‚Üí reply("""
        üîó <b>–î–æ–±–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫—É</b>

        –û—Ç–ø—Ä–∞–≤—å—Ç–µ URL —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–ª—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏:

        <i>–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è: —Å—Ç–∞—Ç—å–∏, –±–ª–æ–≥–∏, –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è</i>
        """)
      ‚Üí show_keyboard([
           button("üîô –û—Ç–º–µ–Ω–∞", "cancel")
         ])

    message TextMessage(url):
      ‚Üí case validate_url(url):
           ‚úÖ_) ‚Üí {
             ‚Üí doc_id = add_knowledge_document(type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_id, "url", url)
             ‚Üí url ¬∑ fetch_and_index_url
             ‚Üí reply("‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ –æ—á–µ—Ä–µ–¥—å –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏!")
             ‚Üí transition ConfigureKnowledge
           }
           ‚ùåmsg) ‚Üí {
             ‚Üí reply("‚ùå {msg}")
             ‚Üí stay
           }

    callback "cancel" ‚Üí transition ConfigureKnowledge

  on ViewKnowledge:
    enter:
      ‚Üí documents = get_avatar_knowledge(type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_id)
      ‚Üí case documents:
           [] ‚Üí reply("üìö –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π –ø—É—Å—Ç–∞")
           list ‚Üí reply("""
             üìö <b>–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π</b>

             #{format_knowledge_list(list)}
             """)
      ‚Üí buttons = documents
           ¬∑ take(5)
           ¬∑ map(fn(d) { button("üóëÔ∏è {d}".title, "delete:{d}".id) }
      ‚Üí show_keyboard(buttons  + [
           button("üîô –ù–∞–∑–∞–¥", "back")
         ])

    callback /^delete:(.+)$/:
      ‚Üí doc_id = extract_id(callback_data)
      ‚Üí delete_knowledge_document(type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_id, doc_id)
      ‚Üí reply("‚úÖ –î–æ–∫—É–º–µ–Ω—Ç —É–¥–∞–ª—ë–Ω")
      ‚Üí enter

    callback "back" ‚Üí transition ConfigureKnowledge

  on ConfirmClearKnowledge:
    enter:
      ‚Üí count = length(get_avatar_knowledge(type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_id))
      ‚Üí reply("""
        ‚ö†Ô∏è <b>–û—á–∏—Å—Ç–∏—Ç—å –±–∞–∑—É –∑–Ω–∞–Ω–∏–π?</b>

        –ë—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤: #{count}

        –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ!
        """)
      ‚Üí show_keyboard([
           button("üóëÔ∏è –î–∞, –æ—á–∏—Å—Ç–∏—Ç—å", "confirm"),
           button("üîô –û—Ç–º–µ–Ω–∞", "cancel")
         ])

    callback "confirm":
      ‚Üí clear_avatar_knowledge(type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_id)
      ‚Üí reply("‚úÖ –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π –æ—á–∏—â–µ–Ω–∞")
      ‚Üí transition ConfigureKnowledge

    callback "cancel" ‚Üí transition ConfigureKnowledge

  on ConfigureGoals:
    enter:
      ‚Üí goals = get_avatar_goals(type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_id)
      ‚Üí reply("""
        üéØ <b>–¶–µ–ª–∏ –∏ –∑–∞–¥–∞—á–∏ –∞–≤–∞—Ç–∞—Ä–∞</b>

        –ß—Ç–æ –¥–æ–ª–∂–µ–Ω –¥–µ–ª–∞—Ç—å –≤–∞—à –∞–≤–∞—Ç–∞—Ä?

        –¢–µ–∫—É—â–∏–µ —Ü–µ–ª–∏:
        #{format_goals(goals)}
        """)
      ‚Üí show_keyboard([
           button("üí∞ –ü—Ä–æ–¥–∞–≤–∞—Ç—å", "goal:sell"),
           button("üìö –û–±—É—á–∞—Ç—å", "goal:teach"),
           button("‚ùì –û—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã", "goal:support"),
           button("üé≠ –†–∞–∑–≤–ª–µ–∫–∞—Ç—å", "goal:entertain"),
           button("üì¢ –ò–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å", "goal:inform"),
           button("‚úèÔ∏è –°–≤–æ—è —Ü–µ–ª—å", "goal:custom"),
           button("‚úÖ –ì–æ—Ç–æ–≤–æ", "done"),
           button("üîô –ù–∞–∑–∞–¥", "back")
         ])
      ‚Üí stay(selected_goals)

    callback /^goal:(.+)$/:
      ‚Üí goal_id = extract_id(callback_data)
      ‚Üí case goal_id:
           "custom" ‚Üí transition CustomGoal(selected_goals)
           _ ‚Üí {
             ‚Üí new_goals = goal_id ¬∑ toggle_goal
             ‚Üí reply("–¶–µ–ª–∏: {format_goals}"(new_goals))
             ‚Üí stay(selected_goals: new_goals)
           }

    callback "done":
      ‚Üí save_avatar_goals(type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_id, selected_goals)
      ‚Üí reply("‚úÖ –¶–µ–ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!")
      ‚Üí transition Main

    callback "back" ‚Üí transition Main

  on CustomGoal(current_goals):
    enter:
      ‚Üí reply("‚úèÔ∏è –û–ø–∏—à–∏—Ç–µ —Ü–µ–ª—å –∞–≤–∞—Ç–∞—Ä–∞:")
      ‚Üí show_keyboard([
           button("üîô –û—Ç–º–µ–Ω–∞", "cancel")
         ])

    message TextMessage(goal_text):
      ‚Üí new_goals = [...current_goals, { id: generate_id(), name: goal_text, custom: true }]
      ‚Üí reply("‚úÖ –¶–µ–ª—å –¥–æ–±–∞–≤–ª–µ–Ω–∞!")
      ‚Üí transition ConfigureGoals

    callback "cancel" ‚Üí transition ConfigureGoals

  on ConfigureQuickReplies:
    enter:
      ‚Üí replies = get_avatar_quick_replies(type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_id)
      ‚Üí reply("""
        ‚ö° <b>–ë—ã—Å—Ç—Ä—ã–µ –æ—Ç–≤–µ—Ç—ã</b>

        –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —à–∞–±–ª–æ–Ω—ã –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ —á–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã.

        –®–∞–±–ª–æ–Ω–æ–≤: #{length(replies)}
        """)
      ‚Üí buttons = replies
           ¬∑ take(5)
           ¬∑ map(fn(r) { button("‚úèÔ∏è {r}".trigger, "edit:{r}".id) }
      ‚Üí show_keyboard(buttons  + [
           button("‚ûï –î–æ–±–∞–≤–∏—Ç—å", "add"),
           button("üîô –ù–∞–∑–∞–¥", "back")
         ])

    callback "add" ‚Üí transition AddQuickReply
    callback /^edit:(.+)$/:
      ‚Üí reply_id = extract_id(callback_data)
      ‚Üí transition EditQuickReply(reply_id)
    callback "back" ‚Üí transition Main

  on AddQuickReply:
    enter:
      ‚Üí reply("""
        ‚ûï <b>–ù–æ–≤—ã–π –±—ã—Å—Ç—Ä—ã–π –æ—Ç–≤–µ—Ç</b>

        –í–≤–µ–¥–∏—Ç–µ —Ç—Ä–∏–≥–≥–µ—Ä (—Å–ª–æ–≤–æ –∏–ª–∏ —Ñ—Ä–∞–∑—É, –Ω–∞ –∫–æ—Ç–æ—Ä—É—é –∞–≤–∞—Ç–∞—Ä –¥–æ–ª–∂–µ–Ω —Ä–µ–∞–≥–∏—Ä–æ–≤–∞—Ç—å):

        <i>–ü—Ä–∏–º–µ—Ä: "—Ü–µ–Ω–∞", "–∫–∞–∫ –∫—É–ø–∏—Ç—å", "–∫–æ–Ω—Ç–∞–∫—Ç—ã"</i>
        """)
      ‚Üí show_keyboard([
           button("üîô –û—Ç–º–µ–Ω–∞", "cancel")
         ])
      ‚Üí stay(step: "trigger")

    message TextMessage(text):
      ‚Üí case step:
           "trigger" ‚Üí {
             ‚Üí reply("–¢–µ–ø–µ—Ä—å –≤–≤–µ–¥–∏—Ç–µ –æ—Ç–≤–µ—Ç –∞–≤–∞—Ç–∞—Ä–∞:")
             ‚Üí stay(trigger: text, step: "response")
           }
           "response" ‚Üí {
             ‚Üí add_quick_reply(type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_id, trigger, text)
             ‚Üí reply("‚úÖ –ë—ã—Å—Ç—Ä—ã–π –æ—Ç–≤–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω!\n\n<b>–¢—Ä–∏–≥–≥–µ—Ä:</b> #{trigger}\n<b>–û—Ç–≤–µ—Ç:</b> #{text}")
             ‚Üí transition ConfigureQuickReplies
           }

    callback "cancel" ‚Üí transition ConfigureQuickReplies

// =============================================================================
// CONSTANTS
// =============================================================================

let ROLE_TEMPLATES = const({
  "business": { name: "–ë–∏–∑–Ω–µ—Å-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç", description: "–ü–æ–º–æ–≥–∞—é —Å –±–∏–∑–Ω–µ—Å-–≤–æ–ø—Ä–æ—Å–∞–º–∏, –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–µ–π –∏ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é" },
  "teacher": { name: "–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å", description: "–û–±—É—á–∞—é –∏ –æ–±—ä—è—Å–Ω—è—é —Å–ª–æ–∂–Ω—ã–µ —Ç–µ–º—ã –ø—Ä–æ—Å—Ç—ã–º —è–∑—ã–∫–æ–º" },
  "sales": { name: "–ü—Ä–æ–¥–∞–≤–µ—Ü", description: "–ü–æ–º–æ–≥–∞—é —Å –≤—ã–±–æ—Ä–æ–º –ø—Ä–æ–¥—É–∫—Ç–∞ –∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ–º –ø–æ–∫—É–ø–∫–∏" },
  "entertainer": { name: "–†–∞–∑–≤–ª–µ–∫–∞—Ç–µ–ª—å", description: "–°–æ–∑–¥–∞—é –ø–æ–∑–∏—Ç–∏–≤–Ω–æ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –∏ —Ä–∞–∑–≤–ª–µ–∫–∞—é" },
  "expert": { name: "–≠–∫—Å–ø–µ—Ä—Ç", description: "–î–∞—é —ç–∫—Å–ø–µ—Ä—Ç–Ω—ã–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ –≤ —Å–≤–æ–µ–π –æ–±–ª–∞—Å—Ç–∏" }
}

let PERSONALITY_TRAITS = const({
  "friendly": "üòä –î—Ä—É–∂–µ–ª—é–±–Ω—ã–π",
  "professional": "üíº –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π",
  "funny": "üòÑ –í–µ—Å—ë–ª—ã–π",
  "serious": "üßê –°–µ—Ä—å—ë–∑–Ω—ã–π",
  "empathetic": "ü§ó –≠–º–ø–∞—Ç–∏—á–Ω—ã–π",
  "energetic": "‚ö° –≠–Ω–µ—Ä–≥–∏—á–Ω—ã–π",
  "calm": "üßò –°–ø–æ–∫–æ–π–Ω—ã–π",
  "driven": "üéØ –¶–µ–ª–µ—É—Å—Ç—Ä–µ–º–ª—ë–Ω–Ω—ã–π"
}

// =============================================================================
// HELPER FUNCTIONS
// =============================================================================

cache(5m)
get_role_template(role_id):
  ROLE_TEMPLATES[role_id]

cache(1h)
get_style_name(style_id):
  case style_id:
    "informal" ‚Üí "–ù–∞ \"—Ç—ã\""
    "formal" ‚Üí "–ù–∞ \"–í—ã\""
    "slang" ‚Üí "–ú–æ–ª–æ–¥—ë–∂–Ω—ã–π —Å–ª–µ–Ω–≥"
    "academic" ‚Üí "–ê–∫–∞–¥–µ–º–∏—á–µ—Å–∫–∏–π"
    _ ‚Üí style_id

cache(1h)
get_tone_name(tone_id):
  case tone_id:
    "positive" ‚Üí "–ü–æ–∑–∏—Ç–∏–≤–Ω—ã–π"
    "neutral" ‚Üí "–ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π"
    "motivating" ‚Üí "–ú–æ—Ç–∏–≤–∏—Ä—É—é—â–∏–π"
    "analytical" ‚Üí "–ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π"
    "caring" ‚Üí "–ó–∞–±–æ—Ç–ª–∏–≤—ã–π"
    _ ‚Üí tone_id

trait_id ¬∑ toggle_trait:
  case trait_id ¬∑ contains:
    true ‚Üí { it != trait_id }
    false ‚Üí [trait_id, ...traits]

format_traits(traits ¬∑ filter:
  traits
    ¬∑ map({ PERSONALITY_TRAITS[it] ?? it }
    ¬∑ join(", ")

goal_id ¬∑ toggle_goal:
  case { it.id == goal_id }:
    true ‚Üí filter(goals, { it.id != goal_id }
    false ‚Üí [...goals, { id: goal_id, name: get_goal_name(goal_id ¬∑ any }]

cache(1h)
get_goal_name(goal_id):
  case goal_id:
    "sell" ‚Üí "üí∞ –ü—Ä–æ–¥–∞–≤–∞—Ç—å"
    "teach" ‚Üí "üìö –û–±—É—á–∞—Ç—å"
    "support" ‚Üí "‚ùì –û—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã"
    "entertain" ‚Üí "üé≠ –†–∞–∑–≤–ª–µ–∫–∞—Ç—å"
    "inform" ‚Üí "üì¢ –ò–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å"
    _ ‚Üí goal_id

format_goals(goals):
  case goals:
    [] ‚Üí "(–Ω–µ –∑–∞–¥–∞–Ω—ã)"
    list ‚Üí list ¬∑ map({ it.name } ¬∑ join("\n")

format_knowledge_list(documents):
  documents
    ¬∑ map(fn(d) {
         type_icon = case d.type: "text" ‚Üí "üìÑ" "file" ‚Üí "üìé" "url" ‚Üí "üîó" _ ‚Üí "üì¶"
         "#{type_icon} #{d.title} (#{d.word_count} —Å–ª–æ–≤)"
       }
    ¬∑ join("\n")

validate_document(file_name):
  ext = string.lowercase(get_file_extension(file_name))
  case ext in ["pdf", "txt", "docx", "md"]:
    true ‚Üí ‚úÖtrue)
    false ‚Üí ‚ùå"–ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ PDF, TXT, DOCX –∏–ª–∏ MD.")

validate_url(url):
  case string."http" ¬∑ starts_with:
    true ‚Üí ‚úÖtrue)
    false ‚Üí ‚ùå"–í–≤–µ–¥–∏—Ç–µ –ø–æ–ª–Ω—ã–π URL, –Ω–∞—á–∏–Ω–∞—é—â–∏–π—Å—è —Å http:// –∏–ª–∏ https://")

# v8.0

# v10.0 - ML-Powered Migration
