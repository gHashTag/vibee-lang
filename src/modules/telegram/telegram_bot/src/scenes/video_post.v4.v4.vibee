# Video Post Scene
  // Performance Warning:   // AI Suggestion: Consider extracting hardcoded strings to constants  // AI Suggestion: Replace magic numbers with named constants# Publish videos to Telegram channels and groups
  // AI Suggestion: Code is deeply nested, consider refactoring# Based on 999-multibots-telegraf videoPostScene

import "../i18n/scenes_i18n.vibee" as i18n

scene VideoPost:
  desc: "Publish videos to Telegram channels and groups"

  @spec "Video published": video selected ‚Üí channel picked ‚Üí posted
  @spec "Scheduled": video ‚Üí schedule time ‚Üí queued

  on Main:
    enter:
      ‚Üí lang = get_type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_language(type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_id)
      ‚Üí type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_channels = get_type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_channels(type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_id)
      ‚Üí scheduled_count = get_scheduled_posts_count(type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_id)
      ‚Üí reply(case lang:
           "en" ‚Üí """
             üì∫ <b>Video Publishing</b>

             Publish videos to your channels and groups.

             üì¢ Connected channels: #{length(type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_channels)}
             üìÖ Scheduled: #{scheduled_count}
             """
           _ ‚Üí """
             üì∫ <b>–ü—É–±–ª–∏–∫–∞—Ü–∏—è –≤–∏–¥–µ–æ</b>

             –ü—É–±–ª–∏–∫—É–π—Ç–µ –≤–∏–¥–µ–æ –≤ —Å–≤–æ–∏ –∫–∞–Ω–∞–ª—ã –∏ –≥—Ä—É–ø–ø—ã.

             üì¢ –ü–æ–¥–∫–ª—é—á—ë–Ω–Ω—ã–µ –∫–∞–Ω–∞–ª—ã: #{length(type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_channels)}
             üìÖ –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ: #{scheduled_count}
             """)
      ‚Üí show_keyboard([
           button(case lang: "en" ‚Üí "üì§ Publish video" _ ‚Üí "üì§ –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –≤–∏–¥–µ–æ", "publish"),
           button(case lang: "en" ‚Üí "üìÖ Scheduled" _ ‚Üí "üìÖ –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ", "scheduled"),
           button(case lang: "en" ‚Üí "üì¢ My channels" _ ‚Üí "üì¢ –ú–æ–∏ –∫–∞–Ω–∞–ª—ã", "channels"),
           button(case lang: "en" ‚Üí "üìä Statistics" _ ‚Üí "üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞", "stats"),
           button("common", "menu" ¬∑ t, "menu")
         ])

    callback "publish" ‚Üí transition SelectVideo
    callback "scheduled" ‚Üí transition ScheduledPosts
    callback "channels" ‚Üí transition ManageChannels
    callback "stats" ‚Üí transition PostStats
    callback "menu" ‚Üí exit(Idle)

  on SelectVideo:
    enter:
      ‚Üí lang = get_type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_language(type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_id)
      ‚Üí reply(case lang:
           "en" ‚Üí """
             üìπ <b>Select video</b>

             Send a video or choose from saved:
             """
           _ ‚Üí """
             üìπ <b>–í—ã–±–µ—Ä–∏—Ç–µ –≤–∏–¥–µ–æ</b>

             –û—Ç–ø—Ä–∞–≤—å—Ç–µ –≤–∏–¥–µ–æ –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ –∏–∑ –≥–æ—Ç–æ–≤—ã—Ö:
             """)
      ‚Üí recent_videos = get_type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_videos(type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_id, limit: 5)
      ‚Üí video_buttons = recent_videos
           ¬∑ map({ button("üé¨ {truncate}"(it.name, 20), "video:{it}".id) }
      ‚Üí show_keyboard(video_buttons  + [
           button(case lang: "en" ‚Üí "üìÅ Video gallery" _ ‚Üí "üìÅ –ì–∞–ª–µ—Ä–µ—è –≤–∏–¥–µ–æ", "gallery"),
           button("common", "back" ¬∑ t, "back")
         ])
      ‚Üí stay(recent_videos)

    message VideoMessage(video_url):
      ‚Üí reply("‚è≥ –ó–∞–≥—Ä—É–∂–∞—é –≤–∏–¥–µ–æ...")
      ‚Üí result = upload_video(type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_id, video_url)
      ‚Üí case result:
           ‚úÖvideo) ‚Üí transition SelectChannel(video)
           ‚ùåmsg) ‚Üí reply("‚ùå {msg}") && stay

    callback /^video:(.+)$/:
      ‚Üí video_id = extract_id(callback_data)
      ‚Üí video = recent_videos ¬∑ find({ it.id == video_id }
      ‚Üí transition SelectChannel(video)

    callback "gallery" ‚Üí transition VideoGallery

    callback "back" ‚Üí transition Main

  on VideoGallery:
    enter:
      ‚Üí videos = get_type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_videos(type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_id, limit: 20)
      ‚Üí case videos:
           [] ‚Üí {
             ‚Üí reply("üì≠ –£ –≤–∞—Å –Ω–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ")
             ‚Üí transition SelectVideo
           }
           list ‚Üí {
             ‚Üí reply("""
               üìÅ <b>–ì–∞–ª–µ—Ä–µ—è –≤–∏–¥–µ–æ</b>

               –í—Å–µ–≥–æ: #{length(list)}
               """)
             ‚Üí buttons = list
                  ¬∑ take(10)
                  ¬∑ map({ button("üé¨ {truncate}"(it.name, 25), "video:{it}".id) }
             ‚Üí show_keyboard(buttons  + [
                  button("üîô –ù–∞–∑–∞–¥", "back")
                ])
             ‚Üí stay(videos: list)
           }

    callback /^video:(.+)$/:
      ‚Üí video_id = extract_id(callback_data)
      ‚Üí video = videos ¬∑ find({ it.id == video_id }
      ‚Üí transition SelectChannel(video)

    callback "back" ‚Üí transition SelectVideo

  on SelectChannel(video):
    enter:
      ‚Üí channels = get_type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_channels(type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_id)
      ‚Üí case channels:
           [] ‚Üí {
             ‚Üí reply("""
               üì¢ <b>–ù–µ—Ç –ø–æ–¥–∫–ª—é—á—ë–Ω–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤</b>

               –°–Ω–∞—á–∞–ª–∞ –ø–æ–¥–∫–ª—é—á–∏—Ç–µ –∫–∞–Ω–∞–ª –∏–ª–∏ –≥—Ä—É–ø–ø—É.
               """)
             ‚Üí show_keyboard([
                  button("‚ûï –ü–æ–¥–∫–ª—é—á–∏—Ç—å –∫–∞–Ω–∞–ª", "add_channel"),
                  button("üîô –ù–∞–∑–∞–¥", "back")
                ])
           }
           list ‚Üí {
             ‚Üí reply("""
               üì¢ <b>–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞–Ω–∞–ª</b>

               –ö—É–¥–∞ –æ–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –≤–∏–¥–µ–æ?
               """)
             ‚Üí channel_buttons = list
                  ¬∑ map(fn(c) { button(channel_icon(c.type) + " {c}".title, "channel:{c}".id) }
             ‚Üí show_keyboard(channel_buttons  + [
                  button("üì¢ –ù–µ—Å–∫–æ–ª—å–∫–æ –∫–∞–Ω–∞–ª–æ–≤", "multi"),
                  button("‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫–∞–Ω–∞–ª", "add_channel"),
                  button("üîô –ù–∞–∑–∞–¥", "back")
                ])
             ‚Üí stay(channels: list)
           }

    callback /^channel:(.+)$/:
      ‚Üí channel_id = extract_id(callback_data)
      ‚Üí channel = channels ¬∑ find({ it.id == channel_id }
      ‚Üí transition [channel] ¬∑ ComposePost

    callback "multi" ‚Üí transition channels ¬∑ MultiChannelSelect
    callback "add_channel" ‚Üí transition AddChannel(video)
    callback "back" ‚Üí transition SelectVideo

  on all_channels ¬∑ MultiChannelSelect:
    enter:
      ‚Üí reply("""
        üì¢ <b>–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞–Ω–∞–ª—ã</b>

        –í—ã–±—Ä–∞–Ω–æ: #{length(selected ?? [])}

        –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–∞–Ω–∞–ª—ã –¥–ª—è –≤—ã–±–æ—Ä–∞:
        """)
      ‚Üí channel_buttons = all_channels
           ¬∑ map(fn(c) {
                is_selected = (selected ?? []) ¬∑ any({ it.id == c.id }
                icon = case is_selected: true ‚Üí "‚úÖ" false ‚Üí "‚¨ú"
                button(" {c}{icon}".title, "toggle:{c}".id)
              }
      ‚Üí show_keyboard(channel_buttons  + [
           button("‚úÖ –ì–æ—Ç–æ–≤–æ", "done") ¬∑ if_enabled(length(selected ?? []) > 0),
           button("üîô –ù–∞–∑–∞–¥", "back")
         ])
      ‚Üí stay(selected ?? [])

    callback /^toggle:(.+)$/:
      ‚Üí channel_id = extract_id(callback_data)
      ‚Üí channel = all_channels ¬∑ find({ it.id == channel_id }
      ‚Üí new_selected = channel ¬∑ toggle_selection
      ‚Üí stay(selected: new_selected)
      ‚Üí enter

    callback "done":
      ‚Üí transition selected ¬∑ ComposePost

    callback "back" ‚Üí transition SelectChannel(video)

  on channels ¬∑ ComposePost:
    enter:
      ‚Üí channel_names = channels ¬∑ map({ it.title } ¬∑ join(", ")
      ‚Üí reply("""
        ‚úèÔ∏è <b>–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –ø–æ—Å—Ç–∞</b>

        üìπ –í–∏–¥–µ–æ: #{video.name}
        üì¢ –ö–∞–Ω–∞–ª—ã: #{channel_names}

        –î–æ–±–∞–≤—å—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∫ –≤–∏–¥–µ–æ:
        <i>–ò–ª–∏ –Ω–∞–∂–º–∏—Ç–µ "–ë–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è"</i>
        """)
      ‚Üí show_keyboard([
           button("üìù –ë–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è", "no_caption"),
           button("üîô –ù–∞–∑–∞–¥", "back")
         ])

    message TextMessage(caption):
      ‚Üí case string.length(caption) > 1024:
           true ‚Üí reply("‚ùå –û–ø–∏—Å–∞–Ω–∏–µ —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω–æ–µ (–º–∞–∫—Å–∏–º—É–º 1024 —Å–∏–º–≤–æ–ª–∞)") && stay
           false ‚Üí transition channels, caption ¬∑ PostSettings

    callback "no_caption" ‚Üí transition channels, ‚àÖ¬∑ PostSettings
    callback "back" ‚Üí transition SelectChannel(video)

  on channels, caption ¬∑ PostSettings:
    enter:
      ‚Üí reply("""
        ‚öôÔ∏è <b>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏</b>

        üìπ –í–∏–¥–µ–æ: #{video.name}
        üìù –û–ø–∏—Å–∞–Ω–∏–µ: #{caption_preview(caption)}
        üì¢ –ö–∞–Ω–∞–ª—ã: #{length(channels)}

        –í—ã–±–µ—Ä–∏—Ç–µ –æ–ø—Ü–∏–∏:
        """)
      ‚Üí show_keyboard([
           button("üîï –ë–µ–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è: {bool_label}"(settings.silent ?? false), "toggle_silent"),
           button("üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏: {bool_label}"(settings.comments ?? true), "toggle_comments"),
           button("üìÖ –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å", "schedule"),
           button("‚úÖ –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å —Å–µ–π—á–∞—Å", "publish"),
           button("üîô –ù–∞–∑–∞–¥", "back")
         ])
      ‚Üí stay(settings ?? { silent: false, comments: true }

    callback "toggle_silent":
      ‚Üí new_settings = {settings..., silent: !settings.silent }
      ‚Üí stay(settings: new_settings)
      ‚Üí enter

    callback "toggle_comments":
      ‚Üí new_settings = {settings..., comments: !settings.comments }
      ‚Üí stay(settings: new_settings)
      ‚Üí enter

    callback "schedule" ‚Üí transition channels, caption, settings ¬∑ SchedulePost

    callback "publish":
      ‚Üí transition channels, caption, settings, ‚àÖ¬∑ PublishingProgress

    callback "back" ‚Üí transition channels ¬∑ ComposePost

  on channels, caption, settings ¬∑ SchedulePost:
    enter:
      ‚Üí reply("""
        üìÖ <b>–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏</b>

        –í—ã–±–µ—Ä–∏—Ç–µ –≤—Ä–µ–º—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏:
        """)
      ‚Üí quick_times = generate_quick_times()
      ‚Üí time_buttons = quick_times
           ¬∑ map(fn(t) { button("üïê {t}".label, "time:{t}".timestamp) }
      ‚Üí show_keyboard(time_buttons  + [
           button("üìÜ –í—ã–±—Ä–∞—Ç—å –¥–∞—Ç—É", "custom_date"),
           button("üîô –ù–∞–∑–∞–¥", "back")
         ])
      ‚Üí stay(quick_times)

    callback /^time:(.+)$/:
      ‚Üí timestamp = extract_id(callback_data)
      ‚Üí transition channels, caption, settings, timestamp ¬∑ ConfirmSchedule

    callback "custom_date" ‚Üí transition channels, caption, settings ¬∑ CustomDateTime
    callback "back" ‚Üí transition channels, caption ¬∑ PostSettings

  on channels, caption, settings ¬∑ CustomDateTime:
    enter:
      ‚Üí reply("""
        üìÜ <b>–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è</b>

        –í–≤–µ–¥–∏—Ç–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ:
        <code>2024-01-15 14:30</code>

        –ò–ª–∏ —Ç–æ–ª—å–∫–æ –≤—Ä–µ–º—è –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ —Å–µ–≥–æ–¥–Ω—è:
        <code>18:00</code>
        """)
      ‚Üí show_keyboard([
           button("üîô –ù–∞–∑–∞–¥", "back")
         ])

    message TextMessage(input):
      ‚Üí case parse_datetime(input):
           ‚úÖtimestamp) ‚Üí transition channels, caption, settings, timestamp ¬∑ ConfirmSchedule
           ‚ùåmsg) ‚Üí reply("‚ùå {msg}") && stay

    callback "back" ‚Üí transition channels, caption, settings ¬∑ SchedulePost

  on channels, caption, settings, timestamp ¬∑ ConfirmSchedule:
    enter:
      ‚Üí channel_names = channels ¬∑ map({ it.title } ¬∑ join(", ")
      ‚Üí formatted_time = format_datetime(timestamp)
      ‚Üí reply("""
        ‚úÖ <b>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</b>

        üìπ –í–∏–¥–µ–æ: #{video.name}
        üì¢ –ö–∞–Ω–∞–ª—ã: #{channel_names}
        üìÖ –í—Ä–µ–º—è: #{formatted_time}

        –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –ø—É–±–ª–∏–∫–∞—Ü–∏—é?
        """)
      ‚Üí show_keyboard([
           button("‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å", "confirm"),
           button("üìÖ –ò–∑–º–µ–Ω–∏—Ç—å –≤—Ä–µ–º—è", "change_time"),
           button("üîô –û—Ç–º–µ–Ω–∞", "cancel")
         ])

    callback "confirm":
      ‚Üí schedule_post(type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_id, video, channels, caption, settings, timestamp)
      ‚Üí reply("‚úÖ –ü—É–±–ª–∏–∫–∞—Ü–∏—è –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∞ –Ω–∞ {format_datetime}"(timestamp))
      ‚Üí transition Main

    callback "change_time" ‚Üí transition channels, caption, settings ¬∑ SchedulePost
    callback "cancel" ‚Üí transition Main

  on channels, caption, settings, scheduled_time ¬∑ PublishingProgress:
    enter:
      ‚Üí reply("‚è≥ –ü—É–±–ª–∏–∫—É—é –≤–∏–¥–µ–æ...")
      ‚Üí results = channels, caption, settings ¬∑ publish_to_channels
      ‚Üí transition PublishResults(results)

  on PublishResults(results):
    enter:
      ‚Üí lang = get_type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_language(type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_id)
      ‚Üí success_count = results ¬∑ filter({ it.success } ¬∑ length
      ‚Üí fail_count = results ¬∑ filter({ !it.success } ¬∑ length
      ‚Üí reply(case lang:
           "en" ‚Üí """
             üìä <b>Publishing results</b>

             ‚úÖ Success: #{success_count}
             ‚ùå Errors: #{fail_count}

             #{format_publish_results(results)}
             """
           _ ‚Üí """
             üìä <b>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—É–±–ª–∏–∫–∞—Ü–∏–∏</b>

             ‚úÖ –£—Å–ø–µ—à–Ω–æ: #{success_count}
             ‚ùå –û—à–∏–±–∫–∏: #{fail_count}

             #{format_publish_results(results)}
             """)
      ‚Üí show_keyboard([
           button(case lang: "en" ‚Üí "üì§ Publish more" _ ‚Üí "üì§ –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –µ—â—ë", "publish"),
           button(case lang: "en" ‚Üí "üìä Statistics" _ ‚Üí "üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞", "stats"),
           button("common", "menu" ¬∑ t, "menu")
         ])

    callback "publish" ‚Üí transition SelectVideo
    callback "stats" ‚Üí transition PostStats
    callback "menu" ‚Üí exit(Idle)

  on ScheduledPosts:
    enter:
      ‚Üí lang = get_type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_language(type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_id)
      ‚Üí posts = get_scheduled_posts(type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_id)
      ‚Üí case posts:
           [] ‚Üí {
             ‚Üí reply(case lang: "en" ‚Üí "üì≠ No scheduled publications" _ ‚Üí "üì≠ –ù–µ—Ç –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø—É–±–ª–∏–∫–∞—Ü–∏–π")
             ‚Üí show_keyboard([
                  button(case lang: "en" ‚Üí "üì§ Schedule" _ ‚Üí "üì§ –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å", "schedule"),
                  button("common", "back" ¬∑ t, "back")
                ])
           }
           list ‚Üí {
             ‚Üí reply(case lang:
                  "en" ‚Üí """
                    üìÖ <b>Scheduled publications</b>

                    Total: #{length(list)}
                    """
                  _ ‚Üí """
                    üìÖ <b>–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏</b>

                    –í—Å–µ–≥–æ: #{length(list)}
                    """)
             ‚Üí buttons = list
                  ¬∑ take(10)
                  ¬∑ map(fn(p) { button("üìÖ {format_datetime}"(p.scheduled_at) + " - {truncate}"(p.video_name, 15), "post:{p}".id) }
             ‚Üí show_keyboard(buttons  + [
                  button("common", "back" ¬∑ t, "back")
                ])
             ‚Üí stay(posts: list)
           }

    callback /^post:(.+)$/:
      ‚Üí post_id = extract_id(callback_data)
      ‚Üí post = posts ¬∑ find({ it.id == post_id }
      ‚Üí transition ScheduledPostDetails(post)

    callback "schedule" ‚Üí transition SelectVideo
    callback "back" ‚Üí transition Main

  on ScheduledPostDetails(post):
    enter:
      ‚Üí reply("""
        üìÖ <b>–ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø—É–±–ª–∏–∫–∞—Ü–∏—è</b>

        üìπ –í–∏–¥–µ–æ: #{post.video_name}
        üì¢ –ö–∞–Ω–∞–ª—ã: #{post.channels ¬∑ map({ it.title } ¬∑ join(", ")}
        üïê –í—Ä–µ–º—è: #{format_datetime(post.scheduled_at)}
        üìù –û–ø–∏—Å–∞–Ω–∏–µ: #{caption_preview(post.caption)}
        """)
      ‚Üí show_keyboard([
           button("‚úèÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å –≤—Ä–µ–º—è", "edit_time"),
           button("üì§ –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å —Å–µ–π—á–∞—Å", "publish_now"),
           button("‚ùå –û—Ç–º–µ–Ω–∏—Ç—å", "cancel"),
           button("üîô –ù–∞–∑–∞–¥", "back")
         ])

    callback "edit_time" ‚Üí transition EditScheduledTime(post)
    callback "publish_now":
      ‚Üí publish_to_channels(post.video, post.channels, post.caption, post.settings)
      ‚Üí delete_scheduled_post(post.id)
      ‚Üí reply("‚úÖ –û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ!")
      ‚Üí transition ScheduledPosts
    callback "cancel" ‚Üí transition ConfirmCancelScheduled(post)
    callback "back" ‚Üí transition ScheduledPosts

  on EditScheduledTime(post):
    enter:
      ‚Üí reply("üìÖ –í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –≤—Ä–µ–º—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏:")
      ‚Üí show_keyboard([
           button("üîô –û—Ç–º–µ–Ω–∞", "cancel")
         ])

    message TextMessage(input):
      ‚Üí case parse_datetime(input):
           ‚úÖnew_time) ‚Üí {
             ‚Üí update_scheduled_post(post.id, new_time)
             ‚Üí reply("‚úÖ –í—Ä–µ–º—è –∏–∑–º–µ–Ω–µ–Ω–æ –Ω–∞ {format_datetime}"(new_time))
             ‚Üí transition ScheduledPosts
           }
           ‚ùåmsg) ‚Üí reply("‚ùå {msg}") && stay

    callback "cancel" ‚Üí transition ScheduledPostDetails(post)

  on ConfirmCancelScheduled(post):
    enter:
      ‚Üí reply("""
        ‚ö†Ô∏è <b>–û—Ç–º–µ–Ω–∏—Ç—å –ø—É–±–ª–∏–∫–∞—Ü–∏—é?</b>

        üìπ #{post.video_name}
        üïê #{format_datetime(post.scheduled_at)}
        """)
      ‚Üí show_keyboard([
           button("‚ùå –î–∞, –æ—Ç–º–µ–Ω–∏—Ç—å", "confirm"),
           button("üîô –ù–µ—Ç", "back")
         ])

    callback "confirm":
      ‚Üí delete_scheduled_post(post.id)
      ‚Üí reply("‚úÖ –ü—É–±–ª–∏–∫–∞—Ü–∏—è –æ—Ç–º–µ–Ω–µ–Ω–∞")
      ‚Üí transition ScheduledPosts

    callback "back" ‚Üí transition ScheduledPostDetails(post)

  on ManageChannels:
    enter:
      ‚Üí channels = get_type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_channels(type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_id)
      ‚Üí reply("""
        üì¢ <b>–ú–æ–∏ –∫–∞–Ω–∞–ª—ã</b>

        –ü–æ–¥–∫–ª—é—á–µ–Ω–æ: #{length(channels)}
        """)
      ‚Üí channel_buttons = channels
           ¬∑ map(fn(c) { button(channel_icon(c.type) + " {c}".title, "channel:{c}".id) }
      ‚Üí show_keyboard(channel_buttons  + [
           button("‚ûï –ü–æ–¥–∫–ª—é—á–∏—Ç—å –∫–∞–Ω–∞–ª", "add"),
           button("üîô –ù–∞–∑–∞–¥", "back")
         ])
      ‚Üí stay(channels)

    callback /^channel:(.+)$/:
      ‚Üí channel_id = extract_id(callback_data)
      ‚Üí channel = channels ¬∑ find({ it.id == channel_id }
      ‚Üí transition ChannelSettings(channel)

    callback "add" ‚Üí transition AddChannel(‚àÖ)
    callback "back" ‚Üí transition Main

  on AddChannel(pending_video):
    enter:
      ‚Üí reply("""
        ‚ûï <b>–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫–∞–Ω–∞–ª–∞</b>

        –î–æ–±–∞–≤—å—Ç–µ –±–æ—Ç–∞ @vibee_bot –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –≤ –≤–∞—à –∫–∞–Ω–∞–ª —Å –ø—Ä–∞–≤–∞–º–∏:
        ‚Ä¢ –ü—É–±–ª–∏–∫–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
        ‚Ä¢ –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π

        –ó–∞—Ç–µ–º –ø–µ—Ä–µ—à–ª–∏—Ç–µ –ª—é–±–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–∑ –∫–∞–Ω–∞–ª–∞ —Å—é–¥–∞.
        """)
      ‚Üí show_keyboard([
           button("‚ùì –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è", "help"),
           button("üîô –û—Ç–º–µ–Ω–∞", "cancel")
         ])

    message ForwardedMessage(from_chat):
      ‚Üí case from_chat:
           ‚òêchat) ‚Üí {
             ‚Üí result = verify_channel_access(chat.id)
             ‚Üí case result:
                  ‚úÖ_) ‚Üí {
                    ‚Üí save_type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_channel(type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_id, chat)
                    ‚Üí reply("‚úÖ –ö–∞–Ω–∞–ª <b>{chat}"."</b> –ø–æ–¥–∫–ª—é—á—ë–Ω!{title}")
                    ‚Üí case pending_video:
                         ‚òêvideo) ‚Üí transition SelectChannel(video)
                         ‚àÖ-> transition ManageChannels
                  }
                  ‚ùåmsg) ‚Üí reply("‚ùå {msg}") && stay
           }
           ‚àÖ-> reply("‚ùå –ü–µ—Ä–µ—à–ª–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–∑ –∫–∞–Ω–∞–ª–∞") && stay

    callback "help":
      ‚Üí reply("""
        üìö <b>–ö–∞–∫ –ø–æ–¥–∫–ª—é—á–∏—Ç—å –∫–∞–Ω–∞–ª</b>

        1. –û—Ç–∫—Ä–æ–π—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞–Ω–∞–ª–∞
        2. –í—ã–±–µ—Ä–∏—Ç–µ "–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã"
        3. –î–æ–±–∞–≤—å—Ç–µ @vibee_bot
        4. –í–∫–ª—é—á–∏—Ç–µ –ø—Ä–∞–≤–∞:
           ‚úÖ –ü—É–±–ª–∏–∫–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
           ‚úÖ –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π
        5. –ü–µ—Ä–µ—à–ª–∏—Ç–µ –ª—é–±–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–∑ –∫–∞–Ω–∞–ª–∞ —Å—é–¥–∞
        """)

    callback "cancel":
      ‚Üí case pending_video:
           ‚òêvideo) ‚Üí transition SelectChannel(video)
           ‚àÖ-> transition ManageChannels

  on ChannelSettings(channel):
    enter:
      ‚Üí stats = get_channel_stats(channel.id)
      ‚Üí reply("""
        üì¢ <b>#{channel.title}</b>

        #{channel_icon(channel.type)} –¢–∏–ø: #{channel_type_label(channel.type)}
        üë• –ü–æ–¥–ø–∏—Å—á–∏–∫–∏: #{format_number(stats.subscribers)}
        üìä –ü—É–±–ª–∏–∫–∞—Ü–∏–π —á–µ—Ä–µ–∑ VIBEE: #{stats.posts_count}

        –ù–∞—Å—Ç—Ä–æ–π–∫–∏:
        """)
      ‚Üí show_keyboard([
           button("üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞", "stats"),
           button("‚ùå –û—Ç–∫–ª—é—á–∏—Ç—å", "disconnect"),
           button("üîô –ù–∞–∑–∞–¥", "back")
         ])

    callback "stats":
      ‚Üí detailed_stats = get_detailed_channel_stats(channel.id)
      ‚Üí reply(format_detailed_stats(detailed_stats))

    callback "disconnect" ‚Üí transition ConfirmDisconnect(channel)
    callback "back" ‚Üí transition ManageChannels

  on ConfirmDisconnect(channel):
    enter:
      ‚Üí reply("""
        ‚ö†Ô∏è <b>–û—Ç–∫–ª—é—á–∏—Ç—å –∫–∞–Ω–∞–ª?</b>

        üì¢ #{channel.title}

        –í—ã —Å–º–æ–∂–µ—Ç–µ –ø–æ–¥–∫–ª—é—á–∏—Ç—å –µ–≥–æ —Å–Ω–æ–≤–∞.
        """)
      ‚Üí show_keyboard([
           button("‚ùå –î–∞, –æ—Ç–∫–ª—é—á–∏—Ç—å", "confirm"),
           button("üîô –ù–µ—Ç", "cancel")
         ])

    callback "confirm":
      ‚Üí disconnect_channel(type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_id, channel.id)
      ‚Üí reply("‚úÖ –ö–∞–Ω–∞–ª –æ—Ç–∫–ª—é—á—ë–Ω")
      ‚Üí transition ManageChannels

    callback "cancel" ‚Üí transition ChannelSettings(channel)

  on PostStats:
    enter:
      ‚Üí stats = get_posting_stats(type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_id)
      ‚Üí reply("""
        üìä <b>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–π</b>

        üìπ –í—Å–µ–≥–æ –ø—É–±–ª–∏–∫–∞—Ü–∏–π: #{stats.total_posts}
        üëÅÔ∏è –ü—Ä–æ—Å–º–æ—Ç—Ä–æ–≤: #{format_number(stats.total_views)}
        ‚ù§Ô∏è –†–µ–∞–∫—Ü–∏–π: #{format_number(stats.total_reactions)}

        <b>–ó–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π:</b>
        üìπ –ü—É–±–ª–∏–∫–∞—Ü–∏–π: #{stats.month_posts}
        üëÅÔ∏è –ü—Ä–æ—Å–º–æ—Ç—Ä–æ–≤: #{format_number(stats.month_views)}

        <b>–¢–æ–ø –∫–∞–Ω–∞–ª—ã –ø–æ –æ—Ö–≤–∞—Ç—É:</b>
        #{format_top_channels(stats.top_channels)}
        """)
      ‚Üí show_keyboard([
           button("üìà –ü–æ–¥—Ä–æ–±–Ω–µ–µ", "detailed"),
           button("üîô –ù–∞–∑–∞–¥", "back")
         ])

    callback "detailed" ‚Üí transition DetailedStats
    callback "back" ‚Üí transition Main

  on DetailedStats:
    enter:
      ‚Üí detailed = get_detailed_posting_stats(type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_id)
      ‚Üí reply("""
        üìà <b>–î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</b>

        <b>–õ—É—á—à–µ–µ –≤—Ä–µ–º—è –ø—É–±–ª–∏–∫–∞—Ü–∏–π:</b>
        #{format_best_times(detailed.best_times)}

        <b>–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã:</b>
        #{format_formats(detailed.formats)}

        <b>–†–æ—Å—Ç –∞—É–¥–∏—Ç–æ—Ä–∏–∏:</b>
        #{format_growth(detailed.audience_growth)}
        """)
      ‚Üí show_keyboard([
           button("üîô –ù–∞–∑–∞–¥", "back")
         ])

    callback "back" ‚Üí transition PostStats

# =============================================================================
# HELPER FUNCTIONS
# =============================================================================

cache(24h)
@spec "Returns icon for channel type": channel_type ‚Üí emoji
channel_icon(channel_type):
  case channel_type:
    "channel" ‚Üí "üì¢"
    "supergroup" ‚Üí "üë•"
    "group" ‚Üí "üë•"
    _ ‚Üí "üí¨"

cache(24h)
@spec "Returns label for channel type": channel_type ‚Üí label
channel_type_label(channel_type):
  case channel_type:
    "channel" ‚Üí "–ö–∞–Ω–∞–ª"
    "supergroup" ‚Üí "–°—É–ø–µ—Ä–≥—Ä—É–ø–ø–∞"
    "group" ‚Üí "–ì—Ä—É–ø–ø–∞"
    _ ‚Üí "–ß–∞—Ç"

cache(24h)
@spec "Returns emoji for boolean": value ‚Üí emoji
bool_label(value):
  case value: true ‚Üí "‚úÖ" false ‚Üí "‚ùå"

caption_preview(caption):
  case caption:
    ‚àÖ-> "[–±–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è]"
    ‚òêtext) ‚Üí 50 ¬∑ truncate

max ¬∑ truncate:
  case string.length(text) > max:
    true ‚Üí string.0, max ¬∑ slice + "..."
    false ‚Üí text

format_number(n):
  case n:
    _ if n >= 1000000 ‚Üí to_string(n / 1000000) + "M"
    _ if n >= 1000 ‚Üí to_string(n / 1000) + "K"
    _ ‚Üí to_string(n)

item ¬∑ toggle_selection:
  case selected ¬∑ any({ it.id == item.id }:
    true ‚Üí selected ¬∑ filter({ it.id != item.id }
    false ‚Üí [item, ...selected]

generate_quick_times():
  now = get_current_time()
  [
    { label: "–ß–µ—Ä–µ–∑ 1 —á–∞—Å", timestamp: 1 ¬∑ add_hours },
    { label: "–ß–µ—Ä–µ–∑ 3 —á–∞—Å–∞", timestamp: 3 ¬∑ add_hours },
    { label: "–°–µ–≥–æ–¥–Ω—è 18:00", timestamp: 0 ¬∑ today_at },
    { label: "–°–µ–≥–æ–¥–Ω—è 21:00", timestamp: 0 ¬∑ today_at },
    { label: "–ó–∞–≤—Ç—Ä–∞ 10:00", timestamp: 0 ¬∑ tomorrow_at },
    { label: "–ó–∞–≤—Ç—Ä–∞ 18:00", timestamp: 0 ¬∑ tomorrow_at }
  ]

format_datetime(timestamp):
  "DD.MM.YYYY HH:mm" ¬∑ format_date

format_publish_results(results):
  results
    ¬∑ map(fn(r) {
         icon = case r.success: true ‚Üí "‚úÖ" false ‚Üí "‚ùå"
         " {r}{icon}".channel_title ++ case r.error: ‚òêe) ‚Üí ": {e}" ‚àÖ-> ""
       }
    ¬∑ join("\n")

format_top_channels(channels):
  channels
    ¬∑ take(3)
    ¬∑ map_with_index(i ¬∑ fn {
         to_string(i + 1) + ". {c}"." ‚Äî {format_number}{title}"(c.views) + " –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤"
       }
    ¬∑ join("\n")

format_best_times(times):
  times
    ¬∑ map(fn(t) { "‚Ä¢ {t}"." {t}{day}".":00 ‚Äî {t}{hour}"."% –≤–æ–≤–ª–µ—á—ë–Ω–Ω–æ—Å—Ç—å {engagement}" }
    ¬∑ join("\n")

format_formats(formats):
  formats
    ¬∑ map({ "‚Ä¢ {it}".": {to_string}{name}"(it.percent) + "%" }
    ¬∑ join("\n")

format_growth(growth):
  "+{format_number}"(growth.new_subscribers) + " –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤ –∑–∞ –º–µ—Å—è—Ü"

format_detailed_stats(stats):
  """
  üìä <b>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–∞–Ω–∞–ª–∞</b>

  üëÅÔ∏è –°—Ä–µ–¥–Ω–∏–π –æ—Ö–≤–∞—Ç: #{format_number(stats.avg_reach)}
  ‚ù§Ô∏è –°—Ä–µ–¥–Ω–∏–µ —Ä–µ–∞–∫—Ü–∏–∏: #{stats.avg_reactions}
  üí¨ –°—Ä–µ–¥–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏: #{stats.avg_comments}
  üìà ER (Engagement Rate): #{stats.engagement_rate}%
  """

# v8.0

# v10.0 - ML-Powered Migration
