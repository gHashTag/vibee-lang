// Avatar Brain Wizard
  // Performance Warning:   // AI Suggestion: Consider extracting hardcoded strings to constants  // AI Suggestion: Replace magic numbers with named constants// Configure AI personality and behavior for digital avatars
// Based on 999-multibots-telegraf avatarBrainWizard

import ../i18n/scenes_i18n.vibee as i18n

scene AvatarBrain:,
  desc: "Configure AI avatar personality, tone, and knowledge"

  @Personality set: type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} configures ‚Üí avatar brain updated
  @Knowledge base added: type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} provides docs ‚Üí indexed

  on Main:
    enter:
      ‚Üí lang = get_type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_language(type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_id)
      ‚Üí brain_config = get_avatar_brain(type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_id)
      ‚Üí case brain_config:
           ‚àÖ-> send(case lang:
             "en" ‚Üí """
               üß† <b>Avatar Brain Setup</b>

               Create a unique personality for your avatar!
               """
             _ ‚Üí """
               üß† <b>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–æ–∑–≥–∞ –∞–≤–∞—Ç–∞—Ä–∞</b>

               –°–æ–∑–¥–∞–π—Ç–µ —É–Ω–∏–∫–∞–ª—å–Ω—É—é –ª–∏—á–Ω–æ—Å—Ç—å –¥–ª—è –≤–∞—à–µ–≥–æ –∞–≤–∞—Ç–∞—Ä–∞!
               """)
           config ‚Üí send(case lang:
             "en" ‚Üí """
               üß† <b>Avatar Brain</b>

               üë§ Name: #{config.name}
               üé≠ Personality: #{config.personality}
               üéØ Role: #{config.role}

               üìö Knowledge base: #{config.knowledge_count} documents
               """
             _ ‚Üí """
               üß† <b>–ú–æ–∑–≥ –∞–≤–∞—Ç–∞—Ä–∞</b>

               üë§ –ò–º—è: #{config.name}
               üé≠ –õ–∏—á–Ω–æ—Å—Ç—å: #{config.personality}
               üéØ –†–æ–ª—å: #{config.role}

               üìö –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π: #{config.knowledge_count} –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
               """)
      ‚Üí kb([
           btn(case lang: "en" ‚Üí "üë§ Name and role" _ ‚Üí "üë§ –ò–º—è –∏ —Ä–æ–ª—å", "name_role"),
           btn(case lang: "en" ‚Üí "üé≠ Personality" _ ‚Üí "üé≠ –õ–∏—á–Ω–æ—Å—Ç—å", "personality"),
           btn(case lang: "en" ‚Üí "üó£Ô∏è Communication style" _ ‚Üí "üó£Ô∏è –°—Ç–∏–ª—å –æ–±—â–µ–Ω–∏—è", "communication"),
           btn(case lang: "en" ‚Üí "üìö Knowledge base" _ ‚Üí "üìö –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π", "knowledge"),
           btn(case lang: "en" ‚Üí "üéØ Goals and tasks" _ ‚Üí "üéØ –¶–µ–ª–∏ –∏ –∑–∞–¥–∞—á–∏", "goals"),
           btn(case lang: "en" ‚Üí "‚ö° Quick replies" _ ‚Üí "‚ö° –ë—ã—Å—Ç—Ä—ã–µ –æ—Ç–≤–µ—Ç—ã", "quick_replies"),
           btn("common", "menu" ¬∑ t, "menu")
         ])

    @name_role ‚Üí goto ConfigureNameRole
    @personality ‚Üí goto ConfigurePersonality
    @communication ‚Üí goto ConfigureCommunication
    @knowledge ‚Üí goto ConfigureKnowledge
    @goals ‚Üí goto ConfigureGoals
    @quick_replies ‚Üí goto ConfigureQuickReplies
    @menu ‚Üí exit(Idle)

  on ConfigureNameRole:
    enter:
      ‚Üí lang = get_type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_language(type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_id)
      ‚Üí current = get_avatar_brain(type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_id)
      ‚Üí send(case lang:
           "en" ‚Üí """
             üë§ <b>Avatar name and role</b>

             Current name: #{current?.name ?? "Not set"}
             Current role: #{current?.role ?? "Not set"}

             Enter avatar name:
             """
           _ ‚Üí """
             üë§ <b>–ò–º—è –∏ —Ä–æ–ª—å –∞–≤–∞—Ç–∞—Ä–∞</b>

             –¢–µ–∫—É—â–µ–µ –∏–º—è: #{current?.name ?? "–ù–µ –∑–∞–¥–∞–Ω–æ"}
             –¢–µ–∫—É—â–∞—è —Ä–æ–ª—å: #{current?.role ?? "–ù–µ –∑–∞–¥–∞–Ω–∞"}

             –í–≤–µ–¥–∏—Ç–µ –∏–º—è –∞–≤–∞—Ç–∞—Ä–∞:
             """)
      ‚Üí kb([
           btn("common", "back" ¬∑ t, "back")
         ])

    msg(name):
      ‚Üí save_avatar_name(type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_id, name)
      ‚Üí send("‚úÖ –ò–º—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ: <b>#{name}</b>\n\n–¢–µ–ø–µ—Ä—å –≤—ã–±–µ—Ä–∏—Ç–µ —Ä–æ–ª—å:")
      ‚Üí kb([
           btn("üíº –ë–∏–∑–Ω–µ—Å-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç", "role:business"),
           btn("üéì –ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å", "role:teacher"),
           btn("üõí –ü—Ä–æ–¥–∞–≤–µ—Ü", "role:sales"),
           btn("üé≠ –†–∞–∑–≤–ª–µ–∫–∞—Ç–µ–ª—å", "role:entertainer"),
           btn("üí° –≠–∫—Å–ø–µ—Ä—Ç", "role:expert"),
           btn("‚úèÔ∏è –°–≤–æ—è —Ä–æ–ª—å", "role:custom"),
           btn("üîô –ù–∞–∑–∞–¥", "back")
         ])

    callback /^role:(.+)$/:
      ‚Üí role_id = extract_id(callback_data)
      ‚Üí case role_id:
           "custom" ‚Üí goto CustomRole
           _ ‚Üí {
             ‚Üí role = get_role_template(role_id)
             ‚Üí save_avatar_role(type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_id, role)
             ‚Üí send("‚úÖ –†–æ–ª—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞: <b>#{role.name}</b>")
             ‚Üí goto Main
           }

    @back ‚Üí goto Main

  on CustomRole:
    enter:
      ‚Üí send("""
        ‚úèÔ∏è <b>–°–≤–æ—è —Ä–æ–ª—å</b>

        –û–ø–∏—à–∏—Ç–µ —Ä–æ–ª—å –≤–∞—à–µ–≥–æ –∞–≤–∞—Ç–∞—Ä–∞:

        <i>–ü—Ä–∏–º–µ—Ä: "–≠–∫—Å–ø–µ—Ä—Ç –ø–æ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞–º, –ø–æ–º–æ–≥–∞–µ—Ç –Ω–æ–≤–∏—á–∫–∞–º —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è –≤ –±–ª–æ–∫—á–µ–π–Ω–µ"</i>
        """)
      ‚Üí kb([
           btn("üîô –ù–∞–∑–∞–¥", "back")
         ])

    msg(description):
      ‚Üí save_avatar_role(type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_id, { id: "custom", name: "–°–≤–æ—è —Ä–æ–ª—å", description }
      ‚Üí send("‚úÖ –†–æ–ª—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!")
      ‚Üí goto Main

    @back ‚Üí goto ConfigureNameRole

  on ConfigurePersonality:
    enter:
      ‚Üí send("""
        üé≠ <b>–õ–∏—á–Ω–æ—Å—Ç—å –∞–≤–∞—Ç–∞—Ä–∞</b>

        –í—ã–±–µ—Ä–∏—Ç–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —á–µ—Ä—Ç—ã —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∞:
        """)
      ‚Üí kb([
           btn("üòä –î—Ä—É–∂–µ–ª—é–±–Ω—ã–π", "trait:friendly"),
           btn("üíº –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π", "trait:professional"),
           btn("üòÑ –í–µ—Å—ë–ª—ã–π", "trait:funny"),
           btn("üßê –°–µ—Ä—å—ë–∑–Ω—ã–π", "trait:serious"),
           btn("ü§ó –≠–º–ø–∞—Ç–∏—á–Ω—ã–π", "trait:empathetic"),
           btn("‚ö° –≠–Ω–µ—Ä–≥–∏—á–Ω—ã–π", "trait:energetic"),
           btn("üßò –°–ø–æ–∫–æ–π–Ω—ã–π", "trait:calm"),
           btn("üéØ –¶–µ–ª–µ—É—Å—Ç—Ä–µ–º–ª—ë–Ω–Ω—ã–π", "trait:driven"),
           btn("‚úÖ –ì–æ—Ç–æ–≤–æ", "done"),
           btn("üîô –ù–∞–∑–∞–¥", "back")
         ])
      ‚Üí stay(selected_traits: get_avatar_traits(type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_id) ?? [])

    callback /^trait:(.+)$/:
      ‚Üí trait_id = extract_id(callback_data)
      ‚Üí new_traits = trait_id ¬∑ toggle_trait
      ‚Üí send("–í—ã–±—Ä–∞–Ω–æ: {format_traits}"(new_traits))
      ‚Üí stay(selected_traits: new_traits)

    @done:
      ‚Üí save_avatar_traits(type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_id, selected_traits)
      ‚Üí send("‚úÖ –õ–∏—á–Ω–æ—Å—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞!")
      ‚Üí goto Main

    @back ‚Üí goto Main

  on ConfigureCommunication:
    enter:
      ‚Üí current = get_avatar_communication(type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_id)
      ‚Üí send("""
        üó£Ô∏è <b>–°—Ç–∏–ª—å –æ–±—â–µ–Ω–∏—è</b>

        –ö–∞–∫ –∞–≤–∞—Ç–∞—Ä –±—É–¥–µ—Ç –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞–º?
        """)
      ‚Üí kb([
           btn("üëã –ù–∞ \"—Ç—ã\"", "style:informal"),
           btn("ü§ù –ù–∞ \"–í—ã\"", "style:formal"),
           btn("üòé –ú–æ–ª–æ–¥—ë–∂–Ω—ã–π —Å–ª–µ–Ω–≥", "style:slang"),
           btn("üìö –ê–∫–∞–¥–µ–º–∏—á–µ—Å–∫–∏–π", "style:academic"),
           btn("üîô –ù–∞–∑–∞–¥", "back")
         ])

    callback /^style:(.+)$/:
      ‚Üí style_id = extract_id(callback_data)
      ‚Üí save_avatar_communication(type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_id, style_id)
      ‚Üí send("‚úÖ –°—Ç–∏–ª—å –æ–±—â–µ–Ω–∏—è: <b>#{get_style_name(style_id)}</b>")
      ‚Üí goto ConfigureTone

    @back ‚Üí goto Main

  on ConfigureTone:
    enter:
      ‚Üí send("""
        üéµ <b>–¢–æ–Ω —Å–æ–æ–±—â–µ–Ω–∏–π</b>

        –í—ã–±–µ—Ä–∏—Ç–µ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ç–æ–Ω:
        """)
      ‚Üí kb([
           btn("üòä –ü–æ–∑–∏—Ç–∏–≤–Ω—ã–π", "tone:positive"),
           btn("üòê –ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π", "tone:neutral"),
           btn("üî• –ú–æ—Ç–∏–≤–∏—Ä—É—é—â–∏–π", "tone:motivating"),
           btn("ü§î –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π", "tone:analytical"),
           btn("‚ù§Ô∏è –ó–∞–±–æ—Ç–ª–∏–≤—ã–π", "tone:caring"),
           btn("üîô –ù–∞–∑–∞–¥", "back")
         ])

    callback /^tone:(.+)$/:
      ‚Üí tone_id = extract_id(callback_data)
      ‚Üí save_avatar_tone(type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_id, tone_id)
      ‚Üí send("‚úÖ –¢–æ–Ω —Å–æ–æ–±—â–µ–Ω–∏–π: <b>#{get_tone_name(tone_id)}</b>")
      ‚Üí goto Main

    @back ‚Üí goto ConfigureCommunication

  on ConfigureKnowledge:
    enter:
      ‚Üí lang = get_type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_language(type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_id)
      ‚Üí knowledge = get_avatar_knowledge(type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_id)
      ‚Üí send(case lang:
           "en" ‚Üí """
             üìö <b>Knowledge base</b>

             Documents in base: #{len(knowledge)}

             Add documents so the avatar can answer questions on your topic.
             """
           _ ‚Üí """
             üìö <b>–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π</b>

             –î–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≤ –±–∞–∑–µ: #{len(knowledge)}

             –î–æ–±–∞–≤—å—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã, —á—Ç–æ–±—ã –∞–≤–∞—Ç–∞—Ä –º–æ–≥ –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –ø–æ –≤–∞—à–µ–π —Ç–µ–º–µ.
             """)
      ‚Üí kb([
           btn(case lang: "en" ‚Üí "üìÑ Add text" _ ‚Üí "üìÑ –î–æ–±–∞–≤–∏—Ç—å —Ç–µ–∫—Å—Ç", "add_text"),
           btn(case lang: "en" ‚Üí "üìé Upload file" _ ‚Üí "üìé –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª", "add_file"),
           btn(case lang: "en" ‚Üí "üîó Add link" _ ‚Üí "üîó –î–æ–±–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫—É", "add_url"),
           btn(case lang: "en" ‚Üí "üìã View base" _ ‚Üí "üìã –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –±–∞–∑—É", "view"),
           btn(case lang: "en" ‚Üí "üóëÔ∏è Clear base" _ ‚Üí "üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –±–∞–∑—É", "clear"),
           btn("common", "back" ¬∑ t, "back")
         ])

    @add_text ‚Üí goto AddKnowledgeText
    @add_file ‚Üí goto AddKnowledgeFile
    @add_url ‚Üí goto AddKnowledgeUrl
    @view ‚Üí goto ViewKnowledge
    @clear ‚Üí goto ConfirmClearKnowledge
    @back ‚Üí goto Main

  on AddKnowledgeText:
    enter:
      ‚Üí send("""
        üìÑ <b>–î–æ–±–∞–≤–∏—Ç—å —Ç–µ–∫—Å—Ç</b>

        –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç, –∫–æ—Ç–æ—Ä—ã–π –∞–≤–∞—Ç–∞—Ä –¥–æ–ª–∂–µ–Ω –∑–Ω–∞—Ç—å:

        <i>–ú–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å FAQ, –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞, –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –∏ —Ç.–¥.</i>
        """)
      ‚Üí kb([
           btn("üîô –û—Ç–º–µ–Ω–∞", "cancel")
         ])

    msg(text):
      ‚Üí when len(text) < 50 ‚Üí send("‚ùå –¢–µ–∫—Å—Ç —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π (–º–∏–Ω. 50 —Å–∏–º–≤–æ–ª–æ–≤)") && stay
           false ‚Üí {
             ‚Üí doc_id = add_knowledge_document(type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_id, "text", text)
             ‚Üí index_document(doc_id)
             ‚Üí send("‚úÖ –¢–µ–∫—Å—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ –±–∞–∑—É –∑–Ω–∞–Ω–∏–π!\n\n–î–æ–±–∞–≤—å—Ç–µ –µ—â—ë –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –ì–æ—Ç–æ–≤–æ.")
             ‚Üí kb([
                  btn("‚úÖ –ì–æ—Ç–æ–≤–æ", "done"),
                  btn("‚ûï –ï—â—ë —Ç–µ–∫—Å—Ç", "more")
                ])
           }

    @done ‚Üí goto ConfigureKnowledge
    @more ‚Üí enter
    @cancel ‚Üí goto ConfigureKnowledge

  on AddKnowledgeFile:
    enter:
      ‚Üí send("""
        üìé <b>–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª</b>

        –û—Ç–ø—Ä–∞–≤—å—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç:
        ‚Ä¢ PDF
        ‚Ä¢ TXT
        ‚Ä¢ DOCX
        ‚Ä¢ MD

        –ú–∞–∫—Å–∏–º—É–º: 10 MB
        """)
      ‚Üí kb([
           btn("üîô –û—Ç–º–µ–Ω–∞", "cancel")
         ])

    message file_name ¬∑ DocumentMessage:
      ‚Üí case validate_document(file_name):
           ‚úÖ_) ‚Üí {
             ‚Üí doc_id = add_knowledge_document(type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_id, "file", file_id, file_name)
             ‚Üí process_document_async(doc_id)
             ‚Üí send("‚úÖ –§–∞–π–ª <b>#{file_name}</b> –∑–∞–≥—Ä—É–∂–µ–Ω!\n\n–û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–π–º—ë—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç.")
             ‚Üí goto ConfigureKnowledge
           }
           ‚ùåmsg) ‚Üí {
             ‚Üí send("‚ùå {msg}")
             ‚Üí stay
           }

    @cancel ‚Üí goto ConfigureKnowledge

  on AddKnowledgeUrl:
    enter:
      ‚Üí send("""
        üîó <b>–î–æ–±–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫—É</b>

        –û—Ç–ø—Ä–∞–≤—å—Ç–µ URL —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–ª—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏:

        <i>–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è: —Å—Ç–∞—Ç—å–∏, –±–ª–æ–≥–∏, –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è</i>
        """)
      ‚Üí kb([
           btn("üîô –û—Ç–º–µ–Ω–∞", "cancel")
         ])

    msg(url):
      ‚Üí case validate_url(url):
           ‚úÖ_) ‚Üí {
             ‚Üí doc_id = add_knowledge_document(type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_id, "url", url)
             ‚Üí url ¬∑ fetch_and_index_url
             ‚Üí send("‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ –æ—á–µ—Ä–µ–¥—å –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏!")
             ‚Üí goto ConfigureKnowledge
           }
           ‚ùåmsg) ‚Üí {
             ‚Üí send("‚ùå {msg}")
             ‚Üí stay
           }

    @cancel ‚Üí goto ConfigureKnowledge

  on ViewKnowledge:
    enter:
      ‚Üí documents = get_avatar_knowledge(type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_id)
      ‚Üí case documents:
           [] ‚Üí send("üìö –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π –ø—É—Å—Ç–∞")
           list ‚Üí send("""
             üìö <b>–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π</b>

             #{format_knowledge_list(list)}
             """)
      ‚Üí buttons = documents
           |take(5)
           ¬∑ map{ d btn("üóëÔ∏è {d}".title, "delete:{d}".ID) }
      ‚Üí kb(buttons  + [
           btn("üîô –ù–∞–∑–∞–¥", "back")
         ])

    callback /^delete:(.+)$/:
      ‚Üí doc_id = extract_id(callback_data)
      ‚Üí delete_knowledge_document(type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_id, doc_id)
      ‚Üí send("‚úÖ –î–æ–∫—É–º–µ–Ω—Ç —É–¥–∞–ª—ë–Ω")
      ‚Üí enter

    @back ‚Üí goto ConfigureKnowledge

  on ConfirmClearKnowledge:
    enter:
      ‚Üí count = len(get_avatar_knowledge(type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_id))
      ‚Üí send("""
        ‚ö†Ô∏è <b>–û—á–∏—Å—Ç–∏—Ç—å –±–∞–∑—É –∑–Ω–∞–Ω–∏–π?</b>

        –ë—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤: #{count}

        –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ!
        """)
      ‚Üí kb([
           btn("üóëÔ∏è –î–∞, –æ—á–∏—Å—Ç–∏—Ç—å", "confirm"),
           btn("üîô –û—Ç–º–µ–Ω–∞", "cancel")
         ])

    @confirm:
      ‚Üí clear_avatar_knowledge(type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_id)
      ‚Üí send("‚úÖ –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π –æ—á–∏—â–µ–Ω–∞")
      ‚Üí goto ConfigureKnowledge

    @cancel ‚Üí goto ConfigureKnowledge

  on ConfigureGoals:
    enter:
      ‚Üí goals = get_avatar_goals(type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_id)
      ‚Üí send("""
        üéØ <b>–¶–µ–ª–∏ –∏ –∑–∞–¥–∞—á–∏ –∞–≤–∞—Ç–∞—Ä–∞</b>

        –ß—Ç–æ –¥–æ–ª–∂–µ–Ω –¥–µ–ª–∞—Ç—å –≤–∞—à –∞–≤–∞—Ç–∞—Ä?

        –¢–µ–∫—É—â–∏–µ —Ü–µ–ª–∏:
        #{format_goals(goals)}
        """)
      ‚Üí kb([
           btn("üí∞ –ü—Ä–æ–¥–∞–≤–∞—Ç—å", "goal:sell"),
           btn("üìö –û–±—É—á–∞—Ç—å", "goal:teach"),
           btn("‚ùì –û—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã", "goal:support"),
           btn("üé≠ –†–∞–∑–≤–ª–µ–∫–∞—Ç—å", "goal:entertain"),
           btn("üì¢ –ò–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å", "goal:inform"),
           btn("‚úèÔ∏è –°–≤–æ—è —Ü–µ–ª—å", "goal:custom"),
           btn("‚úÖ –ì–æ—Ç–æ–≤–æ", "done"),
           btn("üîô –ù–∞–∑–∞–¥", "back")
         ])
      ‚Üí stay(selected_goals)

    callback /^goal:(.+)$/:
      ‚Üí goal_id = extract_id(callback_data)
      ‚Üí case goal_id:
           "custom" ‚Üí goto CustomGoal(selected_goals)
           _ ‚Üí {
             ‚Üí new_goals = goal_id ¬∑ toggle_goal
             ‚Üí send("–¶–µ–ª–∏: {format_goals}"(new_goals))
             ‚Üí stay(selected_goals: new_goals)
           }

    @done:
      ‚Üí save_avatar_goals(type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_id, selected_goals)
      ‚Üí send("‚úÖ –¶–µ–ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!")
      ‚Üí goto Main

    @back ‚Üí goto Main

  on CustomGoal(current_goals):
    enter:
      ‚Üí send("‚úèÔ∏è –û–ø–∏—à–∏—Ç–µ —Ü–µ–ª—å –∞–≤–∞—Ç–∞—Ä–∞:")
      ‚Üí kb([
           btn("üîô –û—Ç–º–µ–Ω–∞", "cancel")
         ])

    msg(goal_text):
      ‚Üí new_goals = [...current_goals, { id: generate_id(), name: goal_text, custom: true }]
      ‚Üí send("‚úÖ –¶–µ–ª—å –¥–æ–±–∞–≤–ª–µ–Ω–∞!")
      ‚Üí goto ConfigureGoals

    @cancel ‚Üí goto ConfigureGoals

  on ConfigureQuickReplies:
    enter:
      ‚Üí replies = get_avatar_quick_replies(type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_id)
      ‚Üí send("""
        ‚ö° <b>–ë—ã—Å—Ç—Ä—ã–µ –æ—Ç–≤–µ—Ç—ã</b>

        –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —à–∞–±–ª–æ–Ω—ã –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ —á–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã.

        –®–∞–±–ª–æ–Ω–æ–≤: #{len(replies)}
        """)
      ‚Üí buttons = replies
           |take(5)
           ¬∑ map{ r btn("‚úèÔ∏è {r}".trigger, "edit:{r}".ID) }
      ‚Üí kb(buttons  + [
           btn("‚ûï –î–æ–±–∞–≤–∏—Ç—å", "add"),
           btn("üîô –ù–∞–∑–∞–¥", "back")
         ])

    @add ‚Üí goto AddQuickReply
    callback /^edit:(.+)$/:
      ‚Üí reply_id = extract_id(callback_data)
      ‚Üí goto EditQuickReply(reply_id)
    @back ‚Üí goto Main

  on AddQuickReply:
    enter:
      ‚Üí send("""
        ‚ûï <b>–ù–æ–≤—ã–π –±—ã—Å—Ç—Ä—ã–π –æ—Ç–≤–µ—Ç</b>

        –í–≤–µ–¥–∏—Ç–µ —Ç—Ä–∏–≥–≥–µ—Ä (—Å–ª–æ–≤–æ –∏–ª–∏ —Ñ—Ä–∞–∑—É, –Ω–∞ –∫–æ—Ç–æ—Ä—É—é –∞–≤–∞—Ç–∞—Ä –¥–æ–ª–∂–µ–Ω —Ä–µ–∞–≥–∏—Ä–æ–≤–∞—Ç—å):

        <i>–ü—Ä–∏–º–µ—Ä: "—Ü–µ–Ω–∞", "–∫–∞–∫ –∫—É–ø–∏—Ç—å", "–∫–æ–Ω—Ç–∞–∫—Ç—ã"</i>
        """)
      ‚Üí kb([
           btn("üîô –û—Ç–º–µ–Ω–∞", "cancel")
         ])
      ‚Üí stay(step: "trigger")

    msg(text):
      ‚Üí case step:
           "trigger" ‚Üí {
             ‚Üí send("–¢–µ–ø–µ—Ä—å –≤–≤–µ–¥–∏—Ç–µ –æ—Ç–≤–µ—Ç –∞–≤–∞—Ç–∞—Ä–∞:")
             ‚Üí stay(trigger: text, step: "response")
           }
           "response" ‚Üí {
             ‚Üí add_quick_reply(type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_id, trigger, text)
             ‚Üí send("‚úÖ –ë—ã—Å—Ç—Ä—ã–π –æ—Ç–≤–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω!\n\n<b>–¢—Ä–∏–≥–≥–µ—Ä:</b> #{trigger}\n<b>–û—Ç–≤–µ—Ç:</b> #{text}")
             ‚Üí goto ConfigureQuickReplies
           }

    @cancel ‚Üí goto ConfigureQuickReplies

// =============================================================================
// CONSTANTS
// =============================================================================

let ROLE_TEMPLATES = const({
  "business": { name: "–ë–∏–∑–Ω–µ—Å-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç", description: "–ü–æ–º–æ–≥–∞—é —Å –±–∏–∑–Ω–µ—Å-–≤–æ–ø—Ä–æ—Å–∞–º–∏, –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–µ–π –∏ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é" },
  "teacher": { name: "–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å", description: "–û–±—É—á–∞—é –∏ –æ–±—ä—è—Å–Ω—è—é —Å–ª–æ–∂–Ω—ã–µ —Ç–µ–º—ã –ø—Ä–æ—Å—Ç—ã–º —è–∑—ã–∫–æ–º" },
  "sales": { name: "–ü—Ä–æ–¥–∞–≤–µ—Ü", description: "–ü–æ–º–æ–≥–∞—é —Å –≤—ã–±–æ—Ä–æ–º –ø—Ä–æ–¥—É–∫—Ç–∞ –∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ–º –ø–æ–∫—É–ø–∫–∏" },
  "entertainer": { name: "–†–∞–∑–≤–ª–µ–∫–∞—Ç–µ–ª—å", description: "–°–æ–∑–¥–∞—é –ø–æ–∑–∏—Ç–∏–≤–Ω–æ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –∏ —Ä–∞–∑–≤–ª–µ–∫–∞—é" },
  "expert": { name: "–≠–∫—Å–ø–µ—Ä—Ç", description: "–î–∞—é —ç–∫—Å–ø–µ—Ä—Ç–Ω—ã–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ –≤ —Å–≤–æ–µ–π –æ–±–ª–∞—Å—Ç–∏" }
}

let PERSONALITY_TRAITS = const({
  "friendly": "üòä –î—Ä—É–∂–µ–ª—é–±–Ω—ã–π",
  "professional": "üíº –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π",
  "funny": "üòÑ –í–µ—Å—ë–ª—ã–π",
  "serious": "üßê –°–µ—Ä—å—ë–∑–Ω—ã–π",
  "empathetic": "ü§ó –≠–º–ø–∞—Ç–∏—á–Ω—ã–π",
  "energetic": "‚ö° –≠–Ω–µ—Ä–≥–∏—á–Ω—ã–π",
  "calm": "üßò –°–ø–æ–∫–æ–π–Ω—ã–π",
  "driven": "üéØ –¶–µ–ª–µ—É—Å—Ç—Ä–µ–º–ª—ë–Ω–Ω—ã–π"
}

// =============================================================================
// HELPER FUNCTIONS
// =============================================================================

cache(5m)
get_role_template(role_id):
  ROLE_TEMPLATES[role_id]

cache(1h)
get_style_name(style_id):
  case style_id:
    "informal" ‚Üí "–ù–∞ \"—Ç—ã\""
    "formal" ‚Üí "–ù–∞ \"–í—ã\""
    "slang" ‚Üí "–ú–æ–ª–æ–¥—ë–∂–Ω—ã–π —Å–ª–µ–Ω–≥"
    "academic" ‚Üí "–ê–∫–∞–¥–µ–º–∏—á–µ—Å–∫–∏–π"
    _ ‚Üí style_id

cache(1h)
get_tone_name(tone_id):
  case tone_id:
    "positive" ‚Üí "–ü–æ–∑–∏—Ç–∏–≤–Ω—ã–π"
    "neutral" ‚Üí "–ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π"
    "motivating" ‚Üí "–ú–æ—Ç–∏–≤–∏—Ä—É—é—â–∏–π"
    "analytical" ‚Üí "–ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π"
    "caring" ‚Üí "–ó–∞–±–æ—Ç–ª–∏–≤—ã–π"
    _ ‚Üí tone_id

trait_id ¬∑ toggle_trait:
  when trait_id ¬∑ contains ‚Üí { it != trait_id }
    false ‚Üí [trait_id, ...traits]

format_traits(traits ¬∑ filter:
  traits
    |map( PERSONALITY_TRAITS[it] ?? it }
    |join(", ")

goal_id ¬∑ toggle_goal:
  when { it.ID == goal_id } ‚Üí filter(goals, { it.ID != goal_id }
    false ‚Üí [...goals, { id: goal_id, name: get_goal_name(goal_id ¬∑ any }]

cache(1h)
get_goal_name(goal_id):
  case goal_id:
    "sell" ‚Üí "üí∞ –ü—Ä–æ–¥–∞–≤–∞—Ç—å"
    "teach" ‚Üí "üìö –û–±—É—á–∞—Ç—å"
    "support" ‚Üí "‚ùì –û—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã"
    "entertain" ‚Üí "üé≠ –†–∞–∑–≤–ª–µ–∫–∞—Ç—å"
    "inform" ‚Üí "üì¢ –ò–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å"
    _ ‚Üí goal_id

format_goals(goals):
  case goals:
    [] ‚Üí "(–Ω–µ –∑–∞–¥–∞–Ω—ã)"
    list ‚Üí list |map( it.name }|join("\n")

format_knowledge_list(documents):
  documents
    ¬∑ map{ d
         type_icon = case d.type: "text" ‚Üí "üìÑ" "file" ‚Üí "üìé" "url" ‚Üí "üîó" _ ‚Üí "üì¶"
         "#{type_icon} #{d.title} (#{d.word_count} —Å–ª–æ–≤)"
       }
    |join("\n")

validate_document(file_name):
  ext = string.lowercase(get_file_extension(file_name))
  when ext in ["pdf", "txt", "docx", "md"] ‚Üí ‚úÖtrue)
    false ‚Üí ‚ùå"–ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ PDF, TXT, DOCX –∏–ª–∏ MD.")

validate_url(url):
  when string."http" ¬∑ starts_with ‚Üí ‚úÖtrue)
    false ‚Üí ‚ùå"–í–≤–µ–¥–∏—Ç–µ –ø–æ–ª–Ω—ã–π URL, –Ω–∞—á–∏–Ω–∞—é—â–∏–π—Å—è —Å http:// –∏–ª–∏ https://")

# v8.0

# v10.0 - ML-Powered Migration
