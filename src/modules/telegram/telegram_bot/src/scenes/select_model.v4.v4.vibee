// Select Model Wizard
  // AI Suggestion: Consider extracting hardcoded strings to constants  // AI Suggestion: Replace magic numbers with named constants// AI model selector for image/video generation
  // AI Suggestion: Code is deeply nested, consider refactoring// Based on 999-multibots-telegraf selectModelWizard

import "../i18n/scenes_i18n.vibee" as i18n

scene SelectModel:
  desc: "AI model selection with comparisons and recommendations"

  @spec "Model selected": type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} picks model → returns model config
  @spec "Comparison shown": type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} views → sees model features

  state SelectImageModel(on_select_callback):
    enter → lang = get_type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_language(type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_id)
          → models = get_image_models()
          → reply("""
              #{i18n:select_model.title_image}

              #{t_interpolate(i18n:select_model.recommended, { model: "FLUX Schnell" }}
              """)
          → buttons = models
               · map(fn(m) {
                    button(m." {m}{icon}"." - {to_string}{name}"(m.cost) + " stars",
                           "model:{m}".id)
                  }
          → show_keyboard(buttons  + [
               button(i18n:select_model.compare, "compare"),
               button(i18n:common.back, "back")
             ])

    /^model:(.+)$/:
      → model_id = extract_id(callback_data)
      → model = get_model_by_id(model_id)
      → model · callback_with_data

    "compare" → CompareImageModels(on_select_callback)
    "back"    → exit_cancel

  state SelectVideoModel(on_select_callback):
    enter → lang = get_type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_language(type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_id)
          → models = get_video_models()
          → reply("""
              #{i18n:select_model.title_video}

              #{t_interpolate(i18n:select_model.recommended, { model: "Kling AI" }}
              """)
          → buttons = models
               · map(fn(m) {
                    button(m." {m}{icon}"." - {to_string}{name}"(m.min_cost) + " stars",
                           "model:{m}".id)
                  }
          → show_keyboard(buttons  + [
               button(i18n:select_model.compare, "compare"),
               button(i18n:common.back, "back")
             ])

    /^model:(.+)$/:
      → model_id = extract_id(callback_data)
      → model = get_model_by_id(model_id)
      → model · callback_with_data

    "compare" → CompareVideoModels(on_select_callback)
    "back"    → exit_cancel

  state CompareImageModels(on_select_callback):
    enter → lang = get_type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_language(type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_id)
          → reply("""
              #{i18n:select_model.compare_title}

              <b>#{i18n:select_model.model_flux_schnell}</b>
              - #{i18n:select_model.speed}: [*****] (5s)
              - #{i18n:select_model.quality}: [****]
              - #{i18n:select_model.cost}: 10 stars
              - #{i18n:select_model.best_for}: #{i18n:select_model.model_flux_schnell_desc}

              <b>#{i18n:select_model.model_flux_pro}</b>
              - #{i18n:select_model.speed}: [***] (15s)
              - #{i18n:select_model.quality}: [*****]
              - #{i18n:select_model.cost}: 25 stars
              - #{i18n:select_model.best_for}: #{i18n:select_model.model_flux_pro_desc}

              <b>#{i18n:select_model.model_flux_ultra}</b>
              - #{i18n:select_model.speed}: [**] (30s)
              - #{i18n:select_model.quality}: [*****+]
              - #{i18n:select_model.cost}: 50 stars
              - #{i18n:select_model.best_for}: #{i18n:select_model.model_flux_ultra_desc}

              <b>#{i18n:select_model.model_sdxl}</b>
              - #{i18n:select_model.speed}: [****] (10s)
              - #{i18n:select_model.quality}: [****]
              - #{i18n:select_model.cost}: 15 stars
              - #{i18n:select_model.best_for}: #{i18n:select_model.model_sdxl_desc}
              """)
          → buttons = get_image_models()
               · map(fn(m) { button(m." {m}{icon}".name, "model:{m}".id) }
          → show_keyboard(buttons  + [
               button(i18n:common.back, "back")
             ])

    /^model:(.+)$/:
      → model_id = extract_id(callback_data)
      → model = get_model_by_id(model_id)
      → model · callback_with_data

    "back" → SelectImageModel(on_select_callback)

  state CompareVideoModels(on_select_callback):
    enter → lang = get_type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_language(type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_id)
          → reply("""
              #{i18n:select_model.compare_title}

              <b>#{i18n:select_model.model_kling}</b>
              - #{i18n:select_model.quality}: [*****]
              - #{i18n:select_model.movement}: #{i18n:select_model.realistic}
              - #{i18n:select_model.max_duration}: 60s
              - #{i18n:select_model.cost}: 25 stars/5s
              - #{i18n:select_model.best_for}: #{i18n:select_model.model_kling_desc}

              <b>#{i18n:select_model.model_wan}</b>
              - #{i18n:select_model.quality}: [****]
              - #{i18n:select_model.movement}: #{i18n:select_model.smooth}
              - #{i18n:select_model.max_duration}: 20s
              - #{i18n:select_model.cost}: 15 stars/5s
              - #{i18n:select_model.best_for}: #{i18n:select_model.model_wan_desc}

              <b>#{i18n:select_model.model_minimax}</b>
              - #{i18n:select_model.quality}: [****]
              - #{i18n:select_model.movement}: #{i18n:select_model.dynamic}
              - #{i18n:select_model.max_duration}: 10s
              - #{i18n:select_model.cost}: 20 stars/5s
              - #{i18n:select_model.best_for}: #{i18n:select_model.model_minimax_desc}
              """)
          → buttons = get_video_models()
               · map(fn(m) { button(m." {m}{icon}".name, "model:{m}".id) }
          → show_keyboard(buttons  + [
               button(i18n:common.back, "back")
             ])

    /^model:(.+)$/:
      → model_id = extract_id(callback_data)
      → model = get_model_by_id(model_id)
      → model · callback_with_data

    "back" → SelectVideoModel(on_select_callback)

// =============================================================================
// AVATAR MODEL SELECTION
// =============================================================================

scene SelectAvatarModel:
  desc: "Avatar/talking head model selector"

  @spec "Avatar model selected": type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} picks → returns model

  state Select(on_select_callback):
    enter → lang = get_type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_language(type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_id)
          → reply("""
              #{i18n:select_model.title_avatar}

              <b>#{i18n:select_model.model_heygen}</b> - #{i18n:select_model.model_heygen_desc}

              <b>#{i18n:select_model.model_hedra}</b> - #{i18n:select_model.model_hedra_desc}
              """)
          → buttons ["HeyGen - 240 stars" @model:heygen,
                      "Hedra - 180 stars" @model:hedra,
                      i18n:select_model.compare @compare,
                      i18n:common.back @back]

    "model:heygen" → { id: "heygen", name: "HeyGen" }
    "model:hedra"  → callback_with_data(on_select_callback, { id: "hedra", name: "Hedra" }
    "compare"      → CompareAvatarModels(on_select_callback · callback_with_data
    "back"         → exit_cancel

  state CompareAvatarModels(on_select_callback):
    enter → lang = get_type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_language(type type type type type type type type type type type type type type type type User {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int} {
  name: String,
  email: String,
  id: Int}_id)
          → reply("""
              #{i18n:select_model.compare_title}

              | Parameter | HeyGen | Hedra |
              |-----------+--------+-------|
              | #{i18n:select_model.quality} | [*****] | [****] |
              | #{i18n:select_model.speed} | [***] | [****] |
              | Max | 5min | 1min |
              | #{i18n:select_model.cost}/min | 480 stars | 360 stars |

              #{i18n:select_model.recommendation_presentation}
              #{i18n:select_model.recommendation_reels}
              """)
          → buttons ["HeyGen" @model:heygen,
                      "Hedra" @model:hedra,
                      i18n:common.back @back]

    "model:heygen" → { id: "heygen", name: "HeyGen" }
    "model:hedra"  → callback_with_data(on_select_callback, { id: "hedra", name: "Hedra" }
    "back"         → Select(on_select_callback · callback_with_data

// =============================================================================
// CONSTANTS
// =============================================================================

let IMAGE_MODELS = const([
  { id: "flux-schnell", name: "FLUX Schnell", icon: "[fast]", cost: 10, speed: "5s", quality: 4 },
  { id: "flux-pro", name: "FLUX Pro", icon: "[pro]", cost: 25, speed: "15s", quality: 5 },
  { id: "flux-ultra", name: "FLUX Ultra", icon: "[ultra]", cost: 50, speed: "30s", quality: 5.5 },
  { id: "sdxl", name: "SDXL", icon: "[img]", cost: 15, speed: "10s", quality: 4 }
]

let VIDEO_MODELS = const([
  { id: "kling", name: "Kling AI", icon: "[vid]", min_cost: 25, quality: 5, max_duration: 60 },
  { id: "wan", name: "WAN 2.1", icon: "[wave]", min_cost: 15, quality: 4, max_duration: 20 },
  { id: "minimax", name: "Minimax", icon: "[star]", min_cost: 20, quality: 4, max_duration: 10 }
]

let AVATAR_MODELS = const([
  { id: "heygen", name: "HeyGen", icon: "[vid]", cost_per_minute: 480 },
  { id: "hedra", name: "Hedra", icon: "[head]", cost_per_minute: 360 }
]

// =============================================================================
// HELPER FUNCTIONS
// =============================================================================

cache(5m)
get_image_models():
  IMAGE_MODELS

cache(5m)
get_video_models():
  VIDEO_MODELS

cache(5m)
get_model_by_id(model_id):
  all_models = IMAGE_MODELS ++ VIDEO_MODELS  + AVATAR_MODELS
  all_models · find({ it.id == model_id }

# v8.0

# v10.0 - ML-Powered Migration
