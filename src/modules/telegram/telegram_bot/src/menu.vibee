// menu.gleam - New 3-category menu structure
import gleam/option.{type Option, None, Some}

pub type MenuCategory {
  AICreate
  MyContent
  More
}

pub type MenuItem {
  MenuItem(
    id: String,
    title: String,
    description: String,
    icon: String,
    category: MenuCategory,
    cost: Option(Int),
    popular: Bool,
  )
}

// Main menu with 3 categories
pub fn main_menu_buttons(balance: Int) -> List(List(String)) {
  let low_balance = balance < 50
  
  [
    ["ğŸ¨ AI Create", "ğŸ“Š My Content"],
    ["âš™ï¸ More", if low_balance { "ğŸ’° Buy Credits âš ï¸" } else { "ğŸ’° Buy Credits" }],
  ]
}

// AI Create submenu with Popular section
pub fn ai_create_menu() -> List(List(String)) {
  [
    ["ğŸ”¥ Popular"],
    ["ğŸ“¸ Images", "ğŸ¬ Videos"],
    ["ğŸµ Audio", "ğŸ‘¤ Avatars"],
    ["ğŸ” Search", "ğŸ  Main Menu"],
  ]
}

// Popular features (top 5 most used)
pub fn popular_features() -> List(MenuItem) {
  [
    MenuItem(
      id: "neurophoto",
      title: "NeuroPhoto",
      description: "AI image generation (3 models)",
      icon: "ğŸ¨",
      category: AICreate,
      cost: Some(5),
      popular: True,
    ),
    MenuItem(
      id: "reels_creator",
      title: "Reels Creator",
      description: "Viral short videos",
      icon: "ğŸ¬",
      category: AICreate,
      cost: Some(50),
      popular: True,
    ),
    MenuItem(
      id: "voice_clone",
      title: "Voice Clone",
      description: "Clone any voice",
      icon: "ğŸ¤",
      category: AICreate,
      cost: Some(200),
      popular: True,
    ),
    MenuItem(
      id: "talking_photo",
      title: "Talking Photo",
      description: "Animate photos with speech",
      icon: "ğŸ—£ï¸",
      category: AICreate,
      cost: Some(30),
      popular: True,
    ),
    MenuItem(
      id: "text_to_image",
      title: "Text to Image",
      description: "Generate images from text",
      icon: "ğŸ–¼ï¸",
      category: AICreate,
      cost: Some(10),
      popular: True,
    ),
  ]
}

// Image features
pub fn image_features() -> List(MenuItem) {
  [
    MenuItem(
      id: "neurophoto",
      title: "NeuroPhoto",
      description: "AI image generation",
      icon: "ğŸ¨",
      category: AICreate,
      cost: Some(5),
      popular: True,
    ),
    MenuItem(
      id: "text_to_image",
      title: "Text to Image",
      description: "Generate from text",
      icon: "ğŸ–¼ï¸",
      category: AICreate,
      cost: Some(10),
      popular: True,
    ),
    MenuItem(
      id: "image_enhancement",
      title: "Image Enhancement",
      description: "Upscale & improve",
      icon: "âœ¨",
      category: AICreate,
      cost: Some(8),
      popular: False,
    ),
    MenuItem(
      id: "background_removal",
      title: "Background Removal",
      description: "Remove backgrounds",
      icon: "ğŸ­",
      category: AICreate,
      cost: Some(5),
      popular: False,
    ),
  ]
}

// Video features
pub fn video_features() -> List(MenuItem) {
  [
    MenuItem(
      id: "reels_creator",
      title: "Reels Creator",
      description: "Viral short videos",
      icon: "ğŸ¬",
      category: AICreate,
      cost: Some(50),
      popular: True,
    ),
    MenuItem(
      id: "talking_photo",
      title: "Talking Photo",
      description: "Animate photos",
      icon: "ğŸ—£ï¸",
      category: AICreate,
      cost: Some(30),
      popular: True,
    ),
    MenuItem(
      id: "image_to_video",
      title: "Image to Video",
      description: "Animate images",
      icon: "ğŸï¸",
      category: AICreate,
      cost: Some(40),
      popular: False,
    ),
    MenuItem(
      id: "text_to_video",
      title: "Text to Video",
      description: "Generate from text",
      icon: "ğŸ“¹",
      category: AICreate,
      cost: Some(60),
      popular: False,
    ),
  ]
}

// Audio features
pub fn audio_features() -> List(MenuItem) {
  [
    MenuItem(
      id: "voice_clone",
      title: "Voice Clone",
      description: "Clone any voice",
      icon: "ğŸ¤",
      category: AICreate,
      cost: Some(200),
      popular: True,
    ),
    MenuItem(
      id: "text_to_speech",
      title: "Text to Speech",
      description: "Natural TTS",
      icon: "ğŸ”Š",
      category: AICreate,
      cost: Some(5),
      popular: False,
    ),
    MenuItem(
      id: "music_generation",
      title: "Music Generation",
      description: "AI music creation",
      icon: "ğŸµ",
      category: AICreate,
      cost: Some(25),
      popular: False,
    ),
  ]
}

// Avatar features
pub fn avatar_features() -> List(MenuItem) {
  [
    MenuItem(
      id: "digital_avatar",
      title: "Digital Avatar",
      description: "Create digital avatar",
      icon: "ğŸ‘¤",
      category: AICreate,
      cost: Some(100),
      popular: False,
    ),
    MenuItem(
      id: "3d_avatar",
      title: "3D Avatar",
      description: "3D character",
      icon: "ğŸ­",
      category: AICreate,
      cost: Some(150),
      popular: False,
    ),
    MenuItem(
      id: "photo_avatar",
      title: "Photo Avatar",
      description: "From your photo",
      icon: "ğŸ“¸",
      category: AICreate,
      cost: Some(80),
      popular: False,
    ),
  ]
}

// My Content menu
pub fn my_content_menu() -> List(List(String)) {
  [
    ["ğŸ“œ History", "â­ Favorites"],
    ["ğŸ“ Collections", "ğŸ“Š Statistics"],
    ["ğŸ  Main Menu"],
  ]
}

// More menu
pub fn more_menu() -> List(List(String)) {
  [
    ["ğŸ‘¤ Profile", "ğŸ’° Buy Credits"],
    ["ğŸ” Search", "â“ Help"],
    ["ğŸ’¬ Support", "âš™ï¸ Settings"],
    ["ğŸ  Main Menu"],
  ]
}

// Search features by query
pub fn search_features(query: String) -> List(MenuItem) {
  let all_features = list.concat([
    popular_features(),
    image_features(),
    video_features(),
    audio_features(),
    avatar_features(),
  ])
  
  // Simple search by title or description
  list.filter(all_features, fn(item) {
    let query_lower = string.lowercase(query)
    let title_lower = string.lowercase(item.title)
    let desc_lower = string.lowercase(item.description)
    
    string.contains(title_lower, query_lower) || 
    string.contains(desc_lower, query_lower)
  })
}

// Get feature by ID
pub fn get_feature(id: String) -> Option(MenuItem) {
  let all_features = list.concat([
    popular_features(),
    image_features(),
    video_features(),
    audio_features(),
    avatar_features(),
  ])
  
  list.find(all_features, fn(item) { item.id == id })
  |> result.to_option()
}

// Format feature info message
pub fn format_feature_info(item: MenuItem, balance: Int) -> String {
  let cost_text = case item.cost {
    Some(cost) -> {
      let affordable = balance >= cost
      let emoji = if affordable { "âœ…" } else { "âŒ" }
      emoji <> "{ Cost: }int".to_string(cost) <> " credits"
    }
    None -> "ğŸ†“ Free"
  }
  
  let popular_badge = if item.popular { " ğŸ”¥" } else { "" }
  
  item.icon <> "{ }item".title <> "{\1}\n\n" <>
  item."{\1}\n\n" <>
  cost_text
}
