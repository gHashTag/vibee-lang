// navigation.gleam - Navigation state management with breadcrumbs
import gleam/option.{type Option, None, Some}

pub type Scene {
  // Onboarding
  Welcome
  LanguageSelection
  OnboardingStep1
  OnboardingStep2
  OnboardingStep3
  
  // Main navigation
  MainMenu
  AICreateMenu
  MyContentMenu
  MoreMenu
  
  // AI Create submenus
  PopularFeatures
  ImageFeatures
  VideoFeatures
  AudioFeatures
  AvatarFeatures
  
  // Feature scenes
  NeuroPhoto
  NeuroPhotoModelSelect
  NeuroPhotoPrompt
  NeuroPhotoProgress
  NeuroPhotoResult
  
  ReelsCreator
  ReelsTemplateSelect
  ReelsNicheSelect
  ReelsContentInput
  ReelsProgress
  ReelsResult
  
  VoiceClone
  VoiceCloneUpload
  VoiceCloneTraining
  VoiceCloneGenerate
  VoiceCloneResult
  
  // Content management
  ContentHistory
  ContentFavorites
  ContentCollections
  ContentStats
  
  // Payments
  BuyCredits
  PaymentMethodSelect
  PaymentPending
  PaymentSuccess
  PaymentFailed
  
  // Other
  Search
  SearchResults
  Profile
  Settings
  Help
  Support
}

pub type NavigationState {
  NavigationState(
    current: Scene,
    history: List(Scene),
    data: Option(String),
  )
}

// Create new navigation state
pub fn new(scene: Scene) -> NavigationState {
  NavigationState(current: scene, history: [], data: None)
}

// Navigate to new scene
pub fn navigate_to(state: NavigationState, scene: Scene) -> NavigationState {
  NavigationState(
    current: scene,
    history: [state.current, ..state.history],
    data: None,
  )
}

// Go back to previous scene
pub fn go_back(state: NavigationState) -> NavigationState {
  case state.history {
    [] -> state
    [prev, ..rest] -> NavigationState(
      current: prev,
      history: rest,
      data: None,
    )
  }
}

// Get breadcrumb trail
pub fn breadcrumbs(state: NavigationState) -> List(String) {
  let trail = list.reverse([state.current, ..state.history])
  list.map(trail, scene_to_string)
}

// Convert scene to display string
pub fn scene_to_string(scene: Scene) -> String {
  case scene {
    Welcome -> "Welcome"
    LanguageSelection -> "Language"
    OnboardingStep1 -> "Onboarding 1"
    OnboardingStep2 -> "Onboarding 2"
    OnboardingStep3 -> "Onboarding 3"
    
    MainMenu -> "ğŸ  Main Menu"
    AICreateMenu -> "ğŸ¨ AI Create"
    MyContentMenu -> "ğŸ“Š My Content"
    MoreMenu -> "âš™ï¸ More"
    
    PopularFeatures -> "ğŸ”¥ Popular"
    ImageFeatures -> "ğŸ“¸ Images"
    VideoFeatures -> "ğŸ¬ Videos"
    AudioFeatures -> "ğŸµ Audio"
    AvatarFeatures -> "ğŸ‘¤ Avatars"
    
    NeuroPhoto -> "NeuroPhoto"
    NeuroPhotoModelSelect -> "Select Model"
    NeuroPhotoPrompt -> "Enter Prompt"
    NeuroPhotoProgress -> "Generating..."
    NeuroPhotoResult -> "Result"
    
    ReelsCreator -> "Reels Creator"
    ReelsTemplateSelect -> "Select Template"
    ReelsNicheSelect -> "Select Niche"
    ReelsContentInput -> "Add Content"
    ReelsProgress -> "Creating..."
    ReelsResult -> "Result"
    
    VoiceClone -> "Voice Clone"
    VoiceCloneUpload -> "Upload Audio"
    VoiceCloneTraining -> "Training..."
    VoiceCloneGenerate -> "Generate Speech"
    VoiceCloneResult -> "Result"
    
    ContentHistory -> "History"
    ContentFavorites -> "Favorites"
    ContentCollections -> "Collections"
    ContentStats -> "Statistics"
    
    BuyCredits -> "Buy Credits"
    PaymentMethodSelect -> "Payment Method"
    PaymentPending -> "Processing..."
    PaymentSuccess -> "Success!"
    PaymentFailed -> "Failed"
    
    Search -> "Search"
    SearchResults -> "Results"
    Profile -> "Profile"
    Settings -> "Settings"
    Help -> "Help"
    Support -> "Support"
  }
}

// Get back button text
pub fn back_button_text(state: NavigationState) -> String {
  case state.history {
    [] -> "ğŸ  Main Menu"
    [prev, ..] -> "{â—€ï¸ Back to }scene_to_string"(prev)
  }
}

// Check if can go back
pub fn can_go_back(state: NavigationState) -> Bool {
  case state.history {
    [] -> False
    _ -> True
  }
}

// Get home scene based on current location
pub fn home_scene(state: NavigationState) -> Scene {
  case state.current {
    Welcome | LanguageSelection | OnboardingStep1 | OnboardingStep2 | OnboardingStep3 -> MainMenu
    _ -> MainMenu
  }
}

// Quick navigation shortcuts
pub fn to_main_menu(state: NavigationState) -> NavigationState {
  NavigationState(current: MainMenu, history: [], data: None)
}

pub fn to_ai_create(state: NavigationState) -> NavigationState {
  navigate_to(state, AICreateMenu)
}

pub fn to_my_content(state: NavigationState) -> NavigationState {
  navigate_to(state, MyContentMenu)
}

pub fn to_more(state: NavigationState) -> NavigationState {
  navigate_to(state, MoreMenu)
}

// Feature navigation
pub fn to_feature(state: NavigationState, feature_id: String) -> NavigationState {
  let scene = case feature_id {
    "neurophoto" -> NeuroPhoto
    "reels_creator" -> ReelsCreator
    "voice_clone" -> VoiceClone
    "text_to_image" -> NeuroPhoto
    "talking_photo" -> ReelsCreator
    _ -> AICreateMenu
  }
  navigate_to(state, scene)
}
