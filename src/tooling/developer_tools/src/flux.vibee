// FLUX Image Generation Tools
// Complete FLUX model family via FAL.AI and Black Forest Labs
  // AI Suggestion: Replace magic numbers with named constants  // AI Suggestion: Consider extracting hardcoded strings to constants// Migrated to compact syntax with @policy references

// =============================================================================
// FLUX SCHNELL (Fast, Default)
// =============================================================================

POST @SLOW https://queue.fal.run/fal-ai/flux/schnell "Generate image using FLUX Schnell - fast and efficient"
  metrics("ai.flux")
  @Image generated: prompt valid → generate() → result.image_url != null
  @auth Bearer(FAL_KEY)

  prompt: str!               @body
  image_size: str = "landscape__"  @body
  num_inference_steps: int = 4  @body
  seed: int?                 @body
  enable_safety_checker: bool = true  @body

  → { images: list!, seed: int!, prompt: str! }

// =============================================================================
// FLUX PRO (High Quality)
// =============================================================================

POST @AI https://queue.fal.run/fal-ai/flux-pro "Generate image using FLUX Pro - professional quality"
  metrics("ai.flux")
  @Image generated: prompt valid → generate() → result.image_url != null
  @auth Bearer(FAL_KEY)

  prompt: str!               @body
  image_size: str = "landscape__"  @body
  num_inference_steps: int = 25  @body
  guidance_scale: float = 3.5  @body
  seed: int?                 @body
  safety_tolerance: int = 2  @body

  → { images: list!, seed: int!, prompt: str! }

// =============================================================================
// FLUX PRO v1.1 (Latest Pro)
// =============================================================================

POST @AI https://queue.fal.run/fal-ai/flux-pro/v1.1 "Generate image using FLUX Pro 1.1 - latest professional model"
  metrics("ai.flux")
  @Image generated: prompt valid → generate() → result.image_url != null
  @auth Bearer(FAL_KEY)

  prompt: str!               @body
  image_size: str = "landscape__"  @body
  num_inference_steps: int = 25  @body
  guidance_scale: float = 3.5  @body
  seed: int?                 @body
  safety_tolerance: int = 2  @body

  → { images: list!, seed: int!, prompt: str! }

// =============================================================================
// FLUX PRO ULTRA (Highest Quality)
// =============================================================================

POST @AI https://queue.fal.run/fal-ai/flux-pro/v1.1-ultra "Generate image using FLUX Pro Ultra - highest quality"
  metrics("ai.flux")
  @Image generated: prompt valid → generate() → result.image_url != null
  @auth Bearer(FAL_KEY)

  prompt: str!               @body
  aspect_ratio: str = "16:9"  @body
  seed: int?                 @body
  safety_tolerance: int = 2  @body
  raw: bool = false          @body

  → { images: list!, seed: int!, prompt: str! }

// =============================================================================
// FLUX DEV (Development/Testing)
// =============================================================================

POST @SLOW https://queue.fal.run/fal-ai/flux/dev "Generate image using FLUX Dev - for testing and development"
  metrics("ai.flux")
  @Image generated: prompt valid → generate() → result.image_url != null
  @auth Bearer(FAL_KEY)

  prompt: str!               @body
  image_size: str = "landscape__"  @body
  num_inference_steps: int = 28  @body
  guidance_scale: float = 3.5  @body
  seed: int?                 @body
  enable_safety_checker: bool = true  @body

  → { images: list!, seed: int!, prompt: str! }

// =============================================================================
// FLUX LORA (Custom Trained Models)
// =============================================================================

POST @AI https://queue.fal.run/fal-ai/flux-lora "Generate image using FLUX LoRA - custom trained models"
  metrics("ai.flux")
  @Image generated: prompt + lora valid → generate() → result.image_url != null
  @auth Bearer(FAL_KEY)

  prompt: str!               @body
  loras: list!               @body
  image_size: str = "landscape__"  @body
  num_inference_steps: int = 28  @body
  guidance_scale: float = 3.5  @body
  seed: int?                 @body
  enable_safety_checker: bool = true  @body

  → { images: list!, seed: int!, prompt: str! }

// =============================================================================
// FLUX KONTEXT (Image + Text)
// =============================================================================

POST @AI https://queue.fal.run/fal-ai/flux-kontext "Generate image with Kontext - image + text understanding"
  metrics("ai.flux")
  @Kontext generated: prompt + image valid → generate() → result.image_url != null
  @auth Bearer(FAL_KEY)

  prompt: str!               @body
  image_url: str?            body("input_image_url")
  image_size: str = "landscape__"  @body
  num_inference_steps: int = 28  @body
  guidance_scale: float = 3.5  @body
  seed: int?                 @body

  → { images: list!, seed: int! }

POST @AI https://queue.fal.run/fal-ai/flux-kontext-max "Generate image with Kontext Max - enhanced image understanding"
  metrics("ai.flux")
  @Kontext Max generated: prompt + image valid → generate() → result.image_url != null
  @auth Bearer(FAL_KEY)

  prompt: str!               @body
  image_url: str?            body("input_image_url")
  aspect_ratio: str = "16:9" @body
  seed: int?                 @body

  → { images: list!, seed: int! }

// =============================================================================
// FLUX FILL (Inpainting/Outpainting)
// =============================================================================

POST @AI https://queue.fal.run/fal-ai/flux-pro/v1/fill "Fill/inpaint image regions using FLUX"
  metrics("ai.flux")
  @Fill applied: image + mask valid → generate() → result.image_url != null
  @auth Bearer(FAL_KEY)

  prompt: str!               @body
  image_url: str!            @body
  mask_url: str!             @body
  seed: int?                 @body
  safety_tolerance: int = 2  @body

  → { images: list!, seed: int! }

// =============================================================================
// FLUX REDUX (Image Variations)
// =============================================================================

POST @AI https://queue.fal.run/fal-ai/flux-pro/v1.1/redux "Generate variations of an image using FLUX Redux"
  metrics("ai.flux")
  @Variation generated: image valid → generate() → result.image_url != null
  @auth Bearer(FAL_KEY)

  image_url: str!            @body
  prompt: str?               @body
  aspect_ratio: str = "16:9" @body
  seed: int?                 @body

  → { images: list!, seed: int! }

// =============================================================================
// UNIFIED IMAGE GENERATION PIPELINE
// =============================================================================

@pipeline
tool generate_image:
  desc: "Generate image using best available FLUX model"
  @Auto generation: selects model based on quality/speed needs
  circuit_breaker(threshold: 3, timeout: 60000)

  prompt: str!
  quality: str = "standard"  // fast, standard, pro, ultra
  style: str?
  lora_url: str?
  reference_image: str?

  step select_model:
    → case quality, lora_url, reference_image:
         _, ☐lora), _ → "flux_lora"
         _, _, ☐ref) → "flux_kontext"
         "fast", _, _ → "flux_schnell"
         "standard", _, _ → "flux_dev"
         "pro", _, _ → "flux_pro__"
         "ultra", _, _ → "flux_pro_ultra"
         _ → "flux_schnell"

  step enhance_prompt:
    → case style:
         ☐s) → "{prompt}, {s} style"
         ∅-> prompt

  step generate:
    → case selected_model:
         "flux_schnell" → flux_schnell(enhanced_prompt)
         "flux_dev" → flux_dev(enhanced_prompt)
         "flux_pro__" → flux_pro__(enhanced_prompt)
         "flux_pro_ultra" → flux_pro_ultra(enhanced_prompt)
         "flux_lora" → loras: [{ path: lora_url, scale: 0.8 }] · flux_lora
         "flux_kontext" → image_url: reference_image · flux_kontext
         _ → flux_schnell(enhanced_prompt)

  → { image_url: str!, model: str!, seed: int! }

// =============================================================================
// SDXL (Stable Diffusion XL)
// =============================================================================

POST @SLOW https://queue.fal.run/fal-ai/stable-diffusion-xl "Generate image using Stable Diffusion XL"
  metrics("ai.flux")
  @SDXL generated: prompt valid → generate() → result.image_url != null
  @auth Bearer(FAL_KEY)

  prompt: str!               @body
  negative_prompt: str = ""  @body
  image_size: str = "landscape__"  @body
  num_inference_steps: int = 30  @body
  guidance_scale: float = 7.5  @body
  seed: int?                 @body
  scheduler: str = "DPM ++ 2M Karras"  @body

  → { images: list!, seed: int! }

POST @FAST https://queue.fal.run/fal-ai/stable-diffusion-xl-turbo "Generate image using SDXL Turbo - fast generation"
  metrics("ai.flux")
  @SDXL Turbo generated: prompt valid → generate() → result.image_url != null
  @auth Bearer(FAL_KEY)

  prompt: str!               @body
  image_size: str = "square"  @body
  num_inference_steps: int = 4  @body
  seed: int?                 @body

  → { images: list!, seed: int! }

// =============================================================================
// ADDITIONAL IMAGE MODELS
// =============================================================================

POST @AI https://queue.fal.run/fal-ai/ideogram/v2 "Generate image using Ideogram - good for text in images"
  metrics("ai.flux")
  @Ideogram generated: prompt valid → generate() → result.image_url != null
  @auth Bearer(FAL_KEY)

  prompt: str!               @body
  aspect_ratio: str = "16:9" @body
  style_type: str = "auto"   @body
  magic_prompt_option: str = "auto"  @body
  seed: int?                 @body

  → { images: list!, seed: int! }

POST @AI https://queue.fal.run/fal-ai/recraft-v3 "Generate image using Recraft V3 - vector and design focused"
  metrics("ai.flux")
  @Recraft generated: prompt valid → generate() → result.image_url != null
  @auth Bearer(FAL_KEY)

  prompt: str!               @body
  style: str = "realistic_image"  @body
  image_size: str = "1024x1024"  @body
  seed: int?                 @body

  → { images: list!, seed: int! }

POST @AI https://queue.fal.run/fal-ai/luma-photon "Generate image using Luma Photon - high quality realistic"
  metrics("ai.flux")
  @Photon generated: prompt valid → generate() → result.image_url != null
  @auth Bearer(FAL_KEY)

  prompt: str!               @body
  aspect_ratio: str = "16:9" @body
  seed: int?                 @body

  → { images: list!, seed: int! }

// =============================================================================
// PRICING CONSTANTS
// =============================================================================

let FLUX_PRICING = const({
  "flux_schnell": { "per_image": 0.003, "speed": "fast", "quality": 4 },
  "flux_dev": { "per_image": 0.025, "speed": "medium", "quality": 4.5 },
  "flux_pro": { "per_image": 0.05, "speed": "slow", "quality": 5 },
  "flux_pro__": { "per_image": 0.05, "speed": "slow", "quality": 5 },
  "flux_pro_ultra": { "per_image": 0.06, "speed": "very_slow", "quality": 5 },
  "flux_lora": { "per_image": 0.03, "speed": "medium", "quality": 4.5 },
  "sdxl": { "per_image": 0.008, "speed": "medium", "quality": 4 },
  "sdxl_turbo": { "per_image": 0.002, "speed": "very_fast", "quality": 3.5 }
}

let RECOMMENDED_MODELS = const({
  "default": "flux_schnell",
  "portraits": "flux_pro__",
  "commercial": "flux_pro_ultra",
  "text_in_image": "ideogram",
  "logos": "recraft",
  "realistic": "luma_photon",
  "artistic": "flux_dev",
  "budget": "sdxl_turbo"
}

# v8.0

# v10.0 - ML-Powered Migration
