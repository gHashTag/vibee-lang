name: evolution_queen
version: "1.0.0"
language: gleam
module: honeycomb/queen/evolution_queen
description: |
  üëë QUEEN BEE - Main Evolution Orchestrator
  
  –ö–æ—Ä–æ–ª–µ–≤–∞ —É–ª—å—è –∫–æ–æ—Ä–¥–∏–Ω–∏—Ä—É–µ—Ç –≤—Å—é –≥–µ–Ω–µ–∞–ª–æ–≥–∏—á–µ—Å–∫—É—é —ç–≤–æ–ª—é—Ü–∏—é –∫–æ–¥–∞.
  –û–Ω–∞ —É–ø—Ä–∞–≤–ª—è–µ—Ç –≤—Å–µ–º–∏ –ø—á–µ–ª–∞–º–∏ –∏ —Å–ª–µ–¥–∏—Ç –∑–∞ —Ç–µ–º, —á—Ç–æ–±—ã –≤–µ—Å—å —Ä—É—á–Ω–æ–π –∫–æ–¥
  –±—ã–ª –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω –≤ .vibee —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ —Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω.

behaviors:
  - name: orchestrate_evolution
    given: Repository with manual code
    when: Evolution cycle starts
    then: All manual code converted to specs and regenerated
    test_cases:
      - name: full_repository_evolution
        input: {repo_path: "/workspaces/vibee-lang", manual_files: 169}
        expected: {specs_generated: 169, code_regenerated: 169, manual_files_remaining: 0}

  - name: coordinate_hive
    given: Multiple bee workers active
    when: Tasks distributed
    then: All bees work in harmony
    test_cases:
      - name: coordinate_all_bees
        input: {scouts: 5, workers: 10, guards: 5, nurses: 5, drones: 3}
        expected: {tasks_completed: 100, efficiency: 0.95}

  - name: track_genealogy
    given: Code file with evolution history
    when: Genealogy tracked
    then: Complete evolution tree available
    test_cases:
      - name: track_file_generations
        input: {file: "vibee_v3_1.gleam", generation: 0}
        expected: {generations: 4, current_gen: 4, status: "optimized"}

  - name: plan_migration
    given: Scan results from scouts
    when: Migration plan created
    then: Optimal migration strategy generated
    test_cases:
      - name: create_migration_plan
        input: {manual_files: 169, dependencies: 500}
        expected: {phases: 7, estimated_time: "6 weeks", success_probability: 0.98}

types:
  EvolutionQueen:
    hive_id: String
    active_bees: Int
    evolution_phase: EvolutionPhase
    genealogy_tree: GenealogyTree
    migration_plan: MigrationPlan
    metrics: HiveMetrics

  EvolutionPhase:
    phase_number: Int
    phase_name: String  # "scouting" | "analysis" | "specification" | "generation" | "validation" | "optimization" | "cleanup"
    status: String      # "pending" | "in_progress" | "completed"
    progress: Float

  GenealogyTree:
    root_files: List(FileNode)
    total_generations: Int
    current_generation: Int

  FileNode:
    path: String
    generation: Int
    status: String  # "manual" | "spec" | "generated" | "optimized" | "evolved"
    parent: Option(String)
    children: List(String)
    created_at: String
    evolved_at: Option(String)

  MigrationPlan:
    phases: List(MigrationPhase)
    total_files: Int
    estimated_time: String
    success_probability: Float

  MigrationPhase:
    phase_number: Int
    phase_name: String
    tasks: List(Task)
    dependencies: List(Int)
    estimated_duration: String

  Task:
    task_id: String
    task_type: String  # "scan" | "analyze" | "generate_spec" | "generate_code" | "validate" | "optimize" | "cleanup"
    file_path: String
    assigned_bee: String
    status: String
    priority: Int

  HiveMetrics:
    manual_code_percentage: Float
    generated_code_percentage: Float
    spec_coverage: Float
    evolution_generation: Int
    scout_reports: Int
    worker_output: Int
    guard_checks: Int
    nurse_cleanups: Int
    drone_optimizations: Int
    overall_health: Float

functions:
  - name: create_queen
    params: {hive_id: String}
    returns: EvolutionQueen
    description: Create new evolution queen

  - name: start_evolution_cycle
    params: {queen: EvolutionQueen, repo_path: String}
    returns: Result(EvolutionQueen, String)
    description: Start complete evolution cycle

  - name: coordinate_scouts
    params: {queen: EvolutionQueen}
    returns: Result(List(ScanReport), String)
    description: Coordinate scout bees to scan repository

  - name: analyze_reports
    params: {queen: EvolutionQueen, reports: List(ScanReport)}
    returns: Result(GenealogyTree, String)
    description: Analyze scout reports and build genealogy tree

  - name: create_migration_plan
    params: {queen: EvolutionQueen, tree: GenealogyTree}
    returns: Result(MigrationPlan, String)
    description: Create optimal migration plan

  - name: coordinate_nurses
    params: {queen: EvolutionQueen, plan: MigrationPlan}
    returns: Result(List(SpecFile), String)
    description: Coordinate nurse bees to generate specs

  - name: coordinate_workers
    params: {queen: EvolutionQueen, specs: List(SpecFile)}
    returns: Result(List(GeneratedFile), String)
    description: Coordinate worker bees to generate code

  - name: coordinate_guards
    params: {queen: EvolutionQueen, files: List(GeneratedFile)}
    returns: Result(ValidationReport, String)
    description: Coordinate guard bees to validate code

  - name: coordinate_drones
    params: {queen: EvolutionQueen, files: List(GeneratedFile)}
    returns: Result(OptimizationReport, String)
    description: Coordinate drone bees to optimize code

  - name: execute_cleanup
    params: {queen: EvolutionQueen}
    returns: Result(CleanupReport, String)
    description: Execute final cleanup phase

  - name: update_metrics
    params: {queen: EvolutionQueen}
    returns: EvolutionQueen
    description: Update hive metrics

  - name: get_hive_status
    params: {queen: EvolutionQueen}
    returns: HiveStatus
    description: Get current hive status

  - name: is_evolution_complete
    params: {queen: EvolutionQueen}
    returns: Bool
    description: Check if evolution is complete (0% manual code)

imports:
  - gleam/io
  - gleam/list
  - gleam/result
  - gleam/string
  - gleam/option
  - honeycomb/scouts/code_scanner
  - honeycomb/nurses/spec_generator
  - honeycomb/workers/gleam_worker
  - honeycomb/guards/quality_guard
  - honeycomb/drones/performance_drone
