name: violation_scanner
version: "1.0.0"
language: zig
module: violation_scanner
target: scanner.zig
description: Repository scanner for manual code violations

behaviors:
  - name: scan_repository
    given: Repository path
    when: Scan initiated
    then: All violations found and reported
    test_cases:
      - name: clean_repository
        input: {path: "src/pollen"}
        expected: {violations: 0, clean: true}
      - name: violations_found
        input: {path: "src/modules"}
        expected: {violations: 3, clean: false}

  - name: classify_file
    given: File path
    when: File classification requested
    then: File type determined
    test_cases:
      - name: classify_spec
        input: {path: "src/pollen/test/spec.vibee"}
        expected: {type: "Specification", allowed: true}
      - name: classify_manual_code
        input: {path: "src/modules/test.zig"}
        expected: {type: "ManualCode", allowed: false}

  - name: detect_violation
    given: File and classification
    when: Violation check performed
    then: Violation detected or cleared
    test_cases:
      - name: manual_code_violation
        input: {file: "src/modules/test.zig", type: "ManualCode"}
        expected: {violation: true, severity: "Critical"}

types:
  ScanConfig:
    path: String
    recursive: Bool
    strict: Bool
    verbose: Bool
    
  ScanResult:
    total_files: Int
    scanned_files: Int
    violations: List<Violation>
    clean: Bool
    duration_ms: Int
    
  Violation:
    file: String
    type: ViolationType
    severity: Severity
    message: String
    fixable: Bool
    suggestion: String
    
  ViolationType:
    - ManualCode
    - WrongLocation
    - MissingSpec
    - EditedGenerated
    - EmptyDirectory
    
  Severity:
    - Critical
    - High
    - Medium
    - Low
    - Info
    
  FileClassification:
    - Specification
    - Generated
    - Documentation
    - Configuration
    - Archive
    - Forbidden
    
  ScanStatistics:
    total_files: Int
    specs: Int
    generated: Int
    docs: Int
    violations: Int
    by_severity: Map<Severity, Int>

functions:
  - name: scan_repository
    params: {config: ScanConfig}
    returns: Result<ScanResult, Error>
    
  - name: scan_directory
    params: {path: String, recursive: Bool}
    returns: Result<List<String>, Error>
    
  - name: classify_file
    params: {path: String}
    returns: FileClassification
    
  - name: detect_violation
    params: {path: String, classification: FileClassification}
    returns: Option<Violation>
    
  - name: is_allowed_file
    params: {path: String}
    returns: Bool
    
  - name: is_manual_code
    params: {path: String}
    returns: Bool
    
  - name: generate_report
    params: {result: ScanResult}
    returns: String
    
  - name: calculate_statistics
    params: {result: ScanResult}
    returns: ScanStatistics

imports:
  - std
  - std.fs
  - vibee_guard
