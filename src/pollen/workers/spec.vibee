name: worker_bees
version: "1.0.0"
language: gleam
module: honeycomb/workers
description: |
  üë∑ WORKER BEES - Code Generators
  
  –†–∞–±–æ—á–∏–µ –ø—á–µ–ª—ã –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç –∫–æ–¥ –∏–∑ .vibee —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–π.
  –ö–∞–∂–¥—ã–π worker —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –Ω–∞ —Å–≤–æ–µ–º —è–∑—ã–∫–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è.

behaviors:
  - name: generate_code_from_spec
    given: Valid .vibee specification
    when: Worker bee processes spec
    then: Code generated in target language
    test_cases:
      - name: generate_gleam_code
        input: {spec_path: "pollen/core/example.vibee", target: "gleam"}
        expected: {generated: true, output_path: "storage/gleam/example.gleam", lines: 50}
      - name: generate_zig_code
        input: {spec_path: "pollen/core/example.vibee", target: "zig"}
        expected: {generated: true, output_path: "storage/zig/example.zig", lines: 45}

  - name: validate_spec
    given: Specification file
    when: Worker validates before generation
    then: Spec is valid or errors reported
    test_cases:
      - name: valid_spec
        input: {spec_path: "pollen/core/valid.vibee"}
        expected: {valid: true, errors: []}
      - name: invalid_spec
        input: {spec_path: "pollen/core/invalid.vibee"}
        expected: {valid: false, errors: ["Missing 'behaviors' field"]}

  - name: batch_generate
    given: Multiple spec files
    when: Batch generation requested
    then: All specs processed efficiently
    test_cases:
      - name: generate_100_files
        input: {specs: 100, target: "gleam"}
        expected: {generated: 100, failed: 0, time_seconds: 5.0}

  - name: incremental_generation
    given: Previously generated code exists
    when: Spec unchanged
    then: Skip generation (use cache)
    test_cases:
      - name: skip_unchanged_spec
        input: {spec_path: "pollen/core/unchanged.vibee", cache_hit: true}
        expected: {generated: false, cached: true, time_ms: 1}

types:
  WorkerBee:
    worker_id: String
    language: String  # "gleam" | "zig" | "rust" | "typescript"
    status: WorkerStatus
    tasks_completed: Int
    tasks_failed: Int
    lines_generated: Int

  WorkerStatus:
    status: String  # "idle" | "working" | "error"
    current_task: Option(Task)
    last_error: Option(String)

  Task:
    task_id: String
    spec_path: String
    output_path: String
    priority: Int
    started_at: Option(String)
    completed_at: Option(String)

  GenerationResult:
    success: Bool
    output_path: String
    lines_generated: Int
    time_ms: Int
    errors: List(String)
    warnings: List(String)

  SpecValidation:
    valid: Bool
    errors: List(String)
    warnings: List(String)

functions:
  - name: create_worker
    params: {worker_id: String, language: String}
    returns: WorkerBee
    description: Create new worker bee for specific language

  - name: generate_from_spec
    params: {worker: WorkerBee, spec_path: String}
    returns: Result(GenerationResult, String)
    description: Generate code from specification

  - name: validate_spec
    params: {spec_path: String}
    returns: SpecValidation
    description: Validate specification before generation

  - name: batch_generate
    params: {worker: WorkerBee, spec_paths: List(String)}
    returns: Result(List(GenerationResult), String)
    description: Generate code from multiple specs

  - name: get_worker_status
    params: {worker: WorkerBee}
    returns: WorkerStatus
    description: Get current worker status

  - name: reset_worker
    params: {worker: WorkerBee}
    returns: WorkerBee
    description: Reset worker to idle state

imports:
  - gleam/io
  - gleam/list
  - gleam/result
  - gleam/string
  - gleam/option
