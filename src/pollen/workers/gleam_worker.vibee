name: gleam_worker
version: "1.0.0"
language: gleam
module: honeycomb/workers/gleam_worker
description: |
  ðŸ‘· GLEAM WORKER - Gleam Code Generator
  
  Ð¡Ð¿ÐµÑ†Ð¸Ð°Ð»Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ð¹ worker Ð´Ð»Ñ Ð³ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ð¸ Gleam ÐºÐ¾Ð´Ð° Ð¸Ð· .vibee ÑÐ¿ÐµÑ†Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ð¹.

behaviors:
  - name: generate_gleam_module
    given: .vibee spec with types and functions
    when: Gleam code generation requested
    then: Valid Gleam module generated
    test_cases:
      - name: generate_simple_module
        input: 
          spec:
            name: "example"
            types: [{name: "User", fields: {name: "String", age: "Int"}}]
            functions: [{name: "create_user", params: {name: "String", age: "Int"}, returns: "User"}]
        expected:
          code: |
            pub type User {
              User(name: String, age: Int)
            }
            
            pub fn create_user(name: String, age: Int) -> User {
              User(name: name, age: age)
            }

  - name: generate_tests
    given: .vibee spec with test_cases
    when: Test generation requested
    then: Gleam test file generated
    test_cases:
      - name: generate_test_file
        input:
          spec:
            behaviors:
              - name: "add"
                test_cases:
                  - name: "add_positive"
                    input: {a: 1, b: 2}
                    expected: 3
        expected:
          test_code: |
            import gleeunit
            import gleeunit/should
            
            pub fn add_positive_test() {
              add(1, 2) |> should.equal(3)
            }

types:
  GleamWorker:
    worker_id: String
    templates: GleamTemplates
    style_config: StyleConfig

  GleamTemplates:
    module_header: String
    type_definition: String
    function_definition: String
    test_definition: String

  StyleConfig:
    indent_size: Int
    use_trailing_commas: Bool
    max_line_length: Int

functions:
  - name: create_gleam_worker
    params: {worker_id: String}
    returns: GleamWorker

  - name: generate_module
    params: {worker: GleamWorker, spec: Spec}
    returns: Result(String, String)

  - name: generate_type
    params: {worker: GleamWorker, type_def: TypeDef}
    returns: String

  - name: generate_function
    params: {worker: GleamWorker, func_def: FunctionDef}
    returns: String

  - name: generate_test
    params: {worker: GleamWorker, test_case: TestCase}
    returns: String

  - name: format_code
    params: {code: String}
    returns: String

imports:
  - gleam/io
  - gleam/list
  - gleam/result
  - gleam/string
