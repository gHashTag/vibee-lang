name: vibee_stdlib_core
version: "1.0.0"
language: zig
module: core
description: VIBEE Standard Library - Core Types (Option, Result, Box, Rc)

behaviors:
  - name: option_some_value
    given: Option with Some value
    when: isSome() called
    then: Returns true
    test_cases:
      - name: option_some_returns_true
        input: {value: 42}
        expected: {is_some: true, is_none: false}

  - name: option_none_value
    given: Option with None
    when: isNone() called
    then: Returns true
    test_cases:
      - name: option_none_returns_true
        input: {value: null}
        expected: {is_some: false, is_none: true}

  - name: option_unwrap
    given: Option with Some value
    when: unwrap() called
    then: Returns inner value
    test_cases:
      - name: unwrap_some_value
        input: {value: 42}
        expected: {result: 42}

  - name: option_unwrap_or
    given: Option with None
    when: unwrapOr(default) called
    then: Returns default value
    test_cases:
      - name: unwrap_or_returns_default
        input: {value: null, default: 0}
        expected: {result: 0}

  - name: result_ok_value
    given: Result with Ok value
    when: isOk() called
    then: Returns true
    test_cases:
      - name: result_ok_returns_true
        input: {value: 42}
        expected: {is_ok: true, is_err: false}

  - name: result_err_value
    given: Result with Err value
    when: isErr() called
    then: Returns true
    test_cases:
      - name: result_err_returns_true
        input: {error: "failed"}
        expected: {is_ok: false, is_err: true}

  - name: box_heap_allocation
    given: Value to allocate on heap
    when: Box.init() called
    then: Value stored on heap
    test_cases:
      - name: box_stores_value
        input: {value: 42}
        expected: {stored: 42}

  - name: rc_reference_counting
    given: Rc with value
    when: clone() called
    then: Reference count increases
    test_cases:
      - name: rc_clone_increases_count
        input: {value: 42}
        expected: {count_before: 1, count_after: 2}

types:
  Option:
    T: generic
    variants:
      - Some: T
      - None: void

  Result:
    T: generic
    E: generic
    variants:
      - Ok: T
      - Err: E

  Box:
    T: generic
    fields:
      ptr: pointer_to_T
      allocator: Allocator

  Rc:
    T: generic
    fields:
      ptr: pointer_to_RcInner
      
  RcInner:
    T: generic
    fields:
      value: T
      count: usize
      allocator: Allocator

functions:
  - name: Option.isSome
    params: {self: Option}
    returns: bool
    
  - name: Option.isNone
    params: {self: Option}
    returns: bool
    
  - name: Option.unwrap
    params: {self: Option}
    returns: T
    
  - name: Option.unwrapOr
    params: {self: Option, default: T}
    returns: T
    
  - name: Option.map
    params: {self: Option, f: function}
    returns: Option
    
  - name: Result.isOk
    params: {self: Result}
    returns: bool
    
  - name: Result.isErr
    params: {self: Result}
    returns: bool
    
  - name: Result.unwrap
    params: {self: Result}
    returns: T
    
  - name: Result.unwrapErr
    params: {self: Result}
    returns: E
    
  - name: Result.unwrapOr
    params: {self: Result, default: T}
    returns: T
    
  - name: Box.init
    params: {allocator: Allocator, value: T}
    returns: Box
    
  - name: Box.deinit
    params: {self: Box}
    returns: void
    
  - name: Box.get
    params: {self: Box}
    returns: pointer_to_T
    
  - name: Rc.init
    params: {allocator: Allocator, value: T}
    returns: Rc
    
  - name: Rc.clone
    params: {self: Rc}
    returns: Rc
    
  - name: Rc.deinit
    params: {self: Rc}
    returns: void
    
  - name: Rc.get
    params: {self: Rc}
    returns: pointer_to_T
    
  - name: Rc.strongCount
    params: {self: Rc}
    returns: usize

imports:
  - std
