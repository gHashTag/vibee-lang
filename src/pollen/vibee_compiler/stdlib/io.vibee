name: vibee_stdlib_io
version: "1.0.0"
language: zig
module: io
description: VIBEE Standard Library - I/O (File, Stdin, Stdout, Buffered I/O)

behaviors:
  - name: stdout_print
    given: Stdout instance
    when: print() called with text
    then: Text written to stdout
    test_cases:
      - name: print_hello_world
        input: {text: "Hello, World!"}
        expected: {written: true}

  - name: file_create_write
    given: File path
    when: create() and write() called
    then: File created with content
    test_cases:
      - name: create_and_write_file
        input: {path: "/tmp/test.txt", content: "Hello"}
        expected: {created: true, size: 5}

  - name: file_open_read
    given: Existing file
    when: open() and read() called
    then: File content read
    test_cases:
      - name: open_and_read_file
        input: {path: "/tmp/test.txt"}
        expected: {content: "Hello"}

  - name: file_seek
    given: Open file
    when: seek(position) called
    then: File pointer moved
    test_cases:
      - name: seek_to_position
        input: {path: "/tmp/test.txt", position: 10}
        expected: {position: 10}

  - name: buffered_reader
    given: BufReader instance
    when: readLine() called
    then: Line read from buffer
    test_cases:
      - name: read_line_from_buffer
        input: {content: "Line 1\nLine 2\n"}
        expected: {line: "Line 1"}

  - name: buffered_writer
    given: BufWriter instance
    when: write() called multiple times
    then: Data buffered and flushed
    test_cases:
      - name: buffer_and_flush
        input: {writes: ["Hello, ", "World!"]}
        expected: {output: "Hello, World!"}

  - name: read_file_convenience
    given: File path
    when: readFile() called
    then: Entire file content returned
    test_cases:
      - name: read_entire_file
        input: {path: "/tmp/test.txt"}
        expected: {content: "Hello, World!"}

  - name: write_file_convenience
    given: File path and content
    when: writeFile() called
    then: Content written to file
    test_cases:
      - name: write_content_to_file
        input: {path: "/tmp/test.txt", content: "New content"}
        expected: {written: true}

types:
  Stdin:
    fields:
      reader: FileReader

  Stdout:
    fields:
      writer: FileWriter

  Stderr:
    fields:
      writer: FileWriter

  File:
    fields:
      file: StdFile

  OpenMode:
    variants:
      - Read
      - Write
      - ReadWrite

  BufReader:
    T: generic
    fields:
      unbuffered_reader: T
      buf: array_u8_4096
      start: usize
      end: usize

  BufWriter:
    T: generic
    fields:
      unbuffered_writer: T
      buf: array_u8_4096
      end: usize

functions:
  - name: Stdin.init
    params: {}
    returns: Stdin
    
  - name: Stdin.readLine
    params: {self: Stdin, allocator: Allocator}
    returns: Result_String_Error
    
  - name: Stdin.readAll
    params: {self: Stdin, allocator: Allocator}
    returns: Result_String_Error
    
  - name: Stdout.init
    params: {}
    returns: Stdout
    
  - name: Stdout.print
    params: {self: Stdout, fmt: string, args: anytype}
    returns: Result_void_Error
    
  - name: Stdout.println
    params: {self: Stdout, fmt: string, args: anytype}
    returns: Result_void_Error
    
  - name: Stdout.write
    params: {self: Stdout, bytes: slice_u8}
    returns: Result_void_Error
    
  - name: Stderr.init
    params: {}
    returns: Stderr
    
  - name: Stderr.print
    params: {self: Stderr, fmt: string, args: anytype}
    returns: Result_void_Error
    
  - name: Stderr.println
    params: {self: Stderr, fmt: string, args: anytype}
    returns: Result_void_Error
    
  - name: File.open
    params: {path: string, mode: OpenMode}
    returns: Result_File_Error
    
  - name: File.create
    params: {path: string}
    returns: Result_File_Error
    
  - name: File.close
    params: {self: File}
    returns: void
    
  - name: File.read
    params: {self: File, buffer: slice_u8}
    returns: Result_usize_Error
    
  - name: File.readAll
    params: {self: File, allocator: Allocator}
    returns: Result_String_Error
    
  - name: File.write
    params: {self: File, bytes: slice_u8}
    returns: Result_void_Error
    
  - name: File.seek
    params: {self: File, pos: u64}
    returns: Result_void_Error
    
  - name: File.size
    params: {self: File}
    returns: Result_u64_Error
    
  - name: BufReader.init
    params: {reader: T}
    returns: BufReader
    
  - name: BufReader.readLine
    params: {self: BufReader, allocator: Allocator}
    returns: Result_String_Error
    
  - name: BufWriter.init
    params: {writer: T}
    returns: BufWriter
    
  - name: BufWriter.write
    params: {self: BufWriter, bytes: slice_u8}
    returns: Result_void_Error
    
  - name: BufWriter.flush
    params: {self: BufWriter}
    returns: Result_void_Error
    
  - name: readFile
    params: {allocator: Allocator, path: string}
    returns: Result_String_Error
    
  - name: writeFile
    params: {path: string, content: string}
    returns: Result_void_Error

imports:
  - std
  - core
