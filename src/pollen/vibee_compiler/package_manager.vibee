name: vibee_package_manager
version: "1.0.0"
language: zig
module: package_manager
description: VIBEE Package Manager - Create, build, test, and publish packages

behaviors:
  - name: create_new_project
    given: Project name provided
    when: vibee new command executed
    then: Project structure created with vibee.toml
    test_cases:
      - name: create_hello_world
        input: {name: "hello_world"}
        expected: {created: true, files: ["vibee.toml", "src/main.vibee", "README.md"]}

  - name: add_dependency
    given: Existing project
    when: vibee add command executed
    then: Dependency added to vibee.toml
    test_cases:
      - name: add_stdlib_module
        input: {package: "vibee-http", version: "1.0.0"}
        expected: {added: true, in_toml: true}

  - name: build_project
    given: Project with source files
    when: vibee build command executed
    then: Project compiled to binary
    test_cases:
      - name: build_hello_world
        input: {project: "hello_world"}
        expected: {compiled: true, binary: "hello_world", time_ms: 54}

  - name: run_project
    given: Compiled project
    when: vibee run command executed
    then: Binary executed
    test_cases:
      - name: run_hello_world
        input: {project: "hello_world"}
        expected: {executed: true, output: "Hello, World!"}

  - name: test_project
    given: Project with tests
    when: vibee test command executed
    then: All tests run
    test_cases:
      - name: run_all_tests
        input: {project: "hello_world"}
        expected: {tests_run: 5, tests_passed: 5, tests_failed: 0}

  - name: publish_package
    given: Package ready for release
    when: vibee publish command executed
    then: Package uploaded to registry
    test_cases:
      - name: publish_to_registry
        input: {package: "my-lib", version: "1.0.0"}
        expected: {published: true, url: "https://packages.vibee-lang.org/my-lib/1.0.0"}

  - name: install_dependencies
    given: Project with dependencies in vibee.toml
    when: vibee install command executed
    then: All dependencies downloaded
    test_cases:
      - name: install_deps
        input: {dependencies: ["vibee-http", "vibee-json"]}
        expected: {installed: 2, failed: 0}

  - name: update_dependencies
    given: Project with outdated dependencies
    when: vibee update command executed
    then: Dependencies updated to latest versions
    test_cases:
      - name: update_all_deps
        input: {current: "1.0.0", latest: "1.2.0"}
        expected: {updated: true, version: "1.2.0"}

types:
  Project:
    fields:
      name: string
      version: string
      authors: array_string
      dependencies: HashMap_string_string
      dev_dependencies: HashMap_string_string

  Package:
    fields:
      name: string
      version: string
      description: string
      repository: string
      license: string

  Dependency:
    fields:
      name: string
      version: string
      source: DependencySource

  DependencySource:
    variants:
      - Registry: string
      - Git: GitSource
      - Path: string

  GitSource:
    fields:
      url: string
      branch: Option_string
      tag: Option_string
      rev: Option_string

  BuildConfig:
    fields:
      optimization: OptimizationLevel
      target: string
      features: array_string

  OptimizationLevel:
    variants:
      - O0
      - O1
      - O2
      - O3

functions:
  - name: new_project
    params: {name: string, template: Option_string}
    returns: Result_Project_Error
    description: Create new VIBEE project
    
  - name: add_dependency
    params: {project: Project, name: string, version: string}
    returns: Result_void_Error
    description: Add dependency to project
    
  - name: remove_dependency
    params: {project: Project, name: string}
    returns: Result_void_Error
    description: Remove dependency from project
    
  - name: build_project
    params: {project: Project, config: BuildConfig}
    returns: Result_BuildResult_Error
    description: Build project to binary
    
  - name: run_project
    params: {project: Project, args: array_string}
    returns: Result_i32_Error
    description: Run compiled binary
    
  - name: test_project
    params: {project: Project, filter: Option_string}
    returns: Result_TestResult_Error
    description: Run project tests
    
  - name: publish_package
    params: {package: Package, token: string}
    returns: Result_string_Error
    description: Publish package to registry
    
  - name: install_dependencies
    params: {project: Project}
    returns: Result_InstallResult_Error
    description: Install all dependencies
    
  - name: update_dependencies
    params: {project: Project, packages: Option_array_string}
    returns: Result_UpdateResult_Error
    description: Update dependencies to latest versions
    
  - name: search_packages
    params: {query: string, limit: usize}
    returns: Result_array_Package_Error
    description: Search packages in registry
    
  - name: show_package
    params: {name: string, version: Option_string}
    returns: Result_Package_Error
    description: Show package information
    
  - name: init_project
    params: {path: string}
    returns: Result_Project_Error
    description: Initialize VIBEE project in existing directory
    
  - name: clean_project
    params: {project: Project}
    returns: Result_void_Error
    description: Clean build artifacts
    
  - name: check_project
    params: {project: Project}
    returns: Result_CheckResult_Error
    description: Check project without building
    
  - name: format_project
    params: {project: Project}
    returns: Result_FormatResult_Error
    description: Format all source files
    
  - name: lint_project
    params: {project: Project}
    returns: Result_LintResult_Error
    description: Lint project for issues

result_types:
  BuildResult:
    fields:
      binary_path: string
      compile_time_ms: i64
      binary_size_kb: usize
      
  TestResult:
    fields:
      tests_run: usize
      tests_passed: usize
      tests_failed: usize
      duration_ms: i64
      
  InstallResult:
    fields:
      installed: usize
      failed: usize
      duration_ms: i64
      
  UpdateResult:
    fields:
      updated: usize
      unchanged: usize
      failed: usize
      
  CheckResult:
    fields:
      errors: usize
      warnings: usize
      
  FormatResult:
    fields:
      files_formatted: usize
      
  LintResult:
    fields:
      issues: usize
      warnings: usize

imports:
  - std
  - core
  - collections
  - io
