name: vibee_cli_complete
version: "1.0.0"
language: zig
module: vibee_cli
target: vibee.zig
description: Complete VIBEE CLI - all commands implemented

behaviors:
  - name: cli_main
    given: Command line arguments
    when: vibee command executed
    then: Appropriate subcommand dispatched
    test_cases:
      - name: no_args_shows_help
        input: {args: []}
        expected: {exit_code: 0, output: "Usage: vibee"}
      - name: unknown_command
        input: {args: ["unknown"]}
        expected: {exit_code: 1, error: "Unknown command"}

  - name: guard_watch
    given: Project directory
    when: vibee guard watch executed
    then: File system watcher started
    test_cases:
      - name: watch_starts_successfully
        input: {path: ".", daemon: false}
        expected: {watching: true, message: "Watching for changes..."}
      - name: watch_daemon_mode
        input: {path: ".", daemon: true}
        expected: {pid: 12345, message: "Guard started in background"}

  - name: guard_scan
    given: Project directory
    when: vibee guard scan executed
    then: Repository scanned for violations
    test_cases:
      - name: clean_repository
        input: {path: ".", strict: false}
        expected: {violations: 0, exit_code: 0}
      - name: violations_found
        input: {path: ".", strict: true}
        expected: {violations: 3, exit_code: 1}

  - name: guard_install_hooks
    given: Git repository
    when: vibee guard install-hooks executed
    then: Pre-commit hook installed
    test_cases:
      - name: install_in_git_repo
        input: {repo_path: "."}
        expected: {installed: true, hook_path: ".git/hooks/pre-commit"}
      - name: not_a_git_repo
        input: {repo_path: "/tmp"}
        expected: {installed: false, error: "Not a git repository"}

  - name: guard_fix
    given: Violations in repository
    when: vibee guard fix executed
    then: Violations automatically fixed
    test_cases:
      - name: fix_manual_code
        input: {auto: true, violations: 3}
        expected: {fixed: 2, manual_review: 1}
      - name: dry_run
        input: {auto: false, dry_run: true}
        expected: {would_fix: 3, applied: 0}

  - name: init_project
    given: Empty directory
    when: vibee init executed
    then: Project structure created
    test_cases:
      - name: init_with_defaults
        input: {name: "my-project", target: "zig"}
        expected: {created: true, dirs: 6, files: 10}

  - name: generate_code
    given: Specification file
    when: vibee gen executed
    then: Code generated
    test_cases:
      - name: gen_single_spec
        input: {spec: "hello.vibee", target: "zig"}
        expected: {generated: true, output: "storage/zig/hello.zig"}

  - name: build_project
    given: Generated code
    when: vibee build executed
    then: Project compiled
    test_cases:
      - name: build_success
        input: {release: false}
        expected: {compiled: true, binary: "vibee"}

types:
  CLIArgs:
    command: String
    subcommand: String
    flags: List<Flag>
    args: List<String>
    
  Flag:
    name: String
    value: String
    
  Command:
    - Guard
    - Init
    - Gen
    - Build
    - Watch
    - Doctor
    
  GuardCommand:
    - Watch
    - Scan
    - InstallHooks
    - UninstallHooks
    - Fix
    - Status
    
  WatchConfig:
    path: String
    daemon: Bool
    recursive: Bool
    
  ScanConfig:
    path: String
    strict: Bool
    verbose: Bool
    
  ScanResult:
    total_files: Int
    violations: List<Violation>
    clean: Bool
    exit_code: Int
    
  Violation:
    file: String
    type: ViolationType
    severity: Severity
    message: String
    fixable: Bool
    
  ViolationType:
    - ManualCode
    - WrongLocation
    - MissingSpec
    - EditedGenerated
    
  Severity:
    - Critical
    - High
    - Medium
    - Low
    
  FixResult:
    fixed: Int
    manual_review: Int
    errors: Int
    
  HookInstallResult:
    installed: Bool
    hook_path: String
    error: String

functions:
  - name: main
    params: {args: List<String>}
    returns: Result<Int, Error>
    
  - name: parse_args
    params: {args: List<String>}
    returns: Result<CLIArgs, Error>
    
  - name: dispatch_command
    params: {cli_args: CLIArgs}
    returns: Result<Int, Error>
    
  # Guard commands
  - name: guard_watch
    params: {config: WatchConfig}
    returns: Result<Void, Error>
    
  - name: guard_scan
    params: {config: ScanConfig}
    returns: Result<ScanResult, Error>
    
  - name: guard_install_hooks
    params: {repo_path: String}
    returns: Result<HookInstallResult, Error>
    
  - name: guard_uninstall_hooks
    params: {repo_path: String}
    returns: Result<Bool, Error>
    
  - name: guard_fix
    params: {auto: Bool, dry_run: Bool}
    returns: Result<FixResult, Error>
    
  - name: guard_status
    params: {}
    returns: Result<ScanResult, Error>
    
  # Project commands
  - name: init_project
    params: {name: String, target: String}
    returns: Result<Void, Error>
    
  - name: generate_code
    params: {spec_path: String}
    returns: Result<String, Error>
    
  - name: build_project
    params: {release: Bool}
    returns: Result<Void, Error>
    
  # Utility functions
  - name: is_git_repo
    params: {path: String}
    returns: Bool
    
  - name: find_violations
    params: {path: String}
    returns: List<Violation>
    
  - name: fix_violation
    params: {violation: Violation}
    returns: Result<Bool, Error>
    
  - name: create_spec_from_code
    params: {code_file: String}
    returns: Result<String, Error>

imports:
  - std
  - std.fs
  - std.process
  - std.io
  - vibee_guard
