name: swe_agent_orchestrator
version: "1.0.0"
language: zig
module: swe_agent_orchestrator
target: orchestrator.zig
description: Orchestrates multiple SWE agents for optimal task execution

behaviors:
  - name: route_task
    given: Task and available agents
    when: Task received
    then: Best agent selected and task routed
    test_cases:
      - name: route_code_generation
        input: {task: "generate", agents: ["aider", "gpt-engineer"]}
        expected: {selected: "gpt-engineer", reason: "best for generation"}

  - name: parallel_execution
    given: Multiple independent tasks
    when: Parallel mode enabled
    then: Tasks distributed across agents
    test_cases:
      - name: parallel_reviews
        input: {tasks: 3, agents: ["aider", "sweep", "gpt-engineer"]}
        expected: {completed: 3, time_saved: 60}

  - name: consensus_review
    given: Code to review
    when: Multiple agents review
    then: Consensus review generated
    test_cases:
      - name: three_agent_consensus
        input: {code: "main.zig", agents: ["aider", "sweep", "gpt-engineer"]}
        expected: {consensus: true, confidence: 0.85}

  - name: fallback_execution
    given: Primary agent fails
    when: Fallback enabled
    then: Secondary agent takes over
    test_cases:
      - name: aider_fails_sweep_succeeds
        input: {task: "fix_issue", primary: "aider", fallback: "sweep"}
        expected: {completed: true, agent_used: "sweep"}

  - name: cost_optimization
    given: Task and budget
    when: Cost optimization enabled
    then: Cheapest capable agent selected
    test_cases:
      - name: select_cheapest
        input: {task: "review", budget: 0.10, agents: ["aider", "claude"]}
        expected: {selected: "aider", cost: 0.05}

types:
  Orchestrator:
    agents: List<SWEAgent>
    strategy: Strategy
    config: OrchestratorConfig
    
  Strategy:
    - BestForTask
    - Parallel
    - Consensus
    - CostOptimized
    - RoundRobin
    
  OrchestratorConfig:
    max_parallel: Int
    fallback_enabled: Bool
    consensus_threshold: Float
    cost_limit: Float
    
  Task:
    type: TaskType
    description: String
    priority: Priority
    deadline: Int
    
  TaskType:
    - CodeGeneration
    - CodeReview
    - Refactoring
    - BugFix
    - Testing
    - Documentation
    
  Priority:
    - Critical
    - High
    - Medium
    - Low
    
  TaskResult:
    task: Task
    agent: String
    success: Bool
    duration: Int
    cost: Float
    
  ConsensusReview:
    reviews: List<Review>
    consensus: Bool
    confidence: Float
    final_verdict: String
    
  AgentScore:
    agent: String
    score: Float
    reason: String

functions:
  - name: create_orchestrator
    params: {agents: List<SWEAgent>, strategy: Strategy}
    returns: Result<Orchestrator, Error>
    
  - name: route_task
    params: {orchestrator: Orchestrator, task: Task}
    returns: Result<SWEAgent, Error>
    
  - name: execute_parallel
    params: {orchestrator: Orchestrator, tasks: List<Task>}
    returns: Result<List<TaskResult>, Error>
    
  - name: consensus_review
    params: {orchestrator: Orchestrator, code: String}
    returns: Result<ConsensusReview, Error>
    
  - name: select_best_agent
    params: {task: Task, agents: List<SWEAgent>}
    returns: Result<AgentScore, Error>
    
  - name: execute_with_fallback
    params: {task: Task, primary: SWEAgent, fallback: SWEAgent}
    returns: Result<TaskResult, Error>
    
  - name: optimize_cost
    params: {task: Task, agents: List<SWEAgent>, budget: Float}
    returns: Result<SWEAgent, Error>

imports:
  - std
  - swe_agent_base
  - aider_agent
  - sweep_agent
