name: sweep_agent
version: "1.0.0"
language: zig
module: sweep_agent
target: sweep_agent.zig
description: Sweep GitHub integration - AI that turns issues into PRs

behaviors:
  - name: issue_to_pr
    given: GitHub issue number
    when: Sweep processes issue
    then: Pull request created automatically
    test_cases:
      - name: create_pr_from_bug
        input: {issue: 123, repo: "vibee/vibee"}
        expected: {pr_created: true, pr_number: 456}

  - name: review_pr
    given: Pull request number
    when: Sweep reviews PR
    then: Review comments added
    test_cases:
      - name: review_code_changes
        input: {pr: 456, repo: "vibee/vibee"}
        expected: {comments: 3, approved: false}

  - name: update_pr
    given: PR and feedback
    when: Sweep updates PR
    then: PR updated with fixes
    test_cases:
      - name: fix_review_comments
        input: {pr: 456, comments: ["fix typo", "add tests"]}
        expected: {updated: true, commits: 2}

  - name: generate_tests
    given: Code changes in PR
    when: Tests requested
    then: Tests generated and added
    test_cases:
      - name: add_unit_tests
        input: {pr: 456, coverage_target: 80}
        expected: {tests_added: 5, coverage: 85}

types:
  SweepConfig:
    github_token: String
    repo: String
    branch: String
    auto_merge: Bool
    
  SweepIssue:
    number: Int
    title: String
    body: String
    labels: List<String>
    
  SweepPR:
    number: Int
    title: String
    description: String
    files: List<String>
    commits: List<Commit>
    
  Commit:
    sha: String
    message: String
    author: String
    timestamp: Int
    
  SweepReview:
    pr_number: Int
    comments: List<ReviewComment>
    approved: Bool
    changes_requested: Bool
    
  ReviewComment:
    file: String
    line: Int
    body: String
    severity: String

functions:
  - name: sweep_init
    params: {config: SweepConfig}
    returns: Result<Void, Error>
    
  - name: sweep_issue_to_pr
    params: {issue: SweepIssue}
    returns: Result<SweepPR, Error>
    
  - name: sweep_review_pr
    params: {pr_number: Int}
    returns: Result<SweepReview, Error>
    
  - name: sweep_update_pr
    params: {pr_number: Int, instructions: String}
    returns: Result<SweepPR, Error>
    
  - name: sweep_generate_tests
    params: {pr_number: Int}
    returns: Result<List<String>, Error>
    
  - name: sweep_merge_pr
    params: {pr_number: Int}
    returns: Result<Bool, Error>

imports:
  - std
  - std.http
  - std.json
  - swe_agent_base
