name: aider_agent
version: "1.0.0"
language: zig
module: aider_agent
target: aider_agent.zig
description: Aider CLI integration - AI pair programming in terminal

behaviors:
  - name: edit_files
    given: Files and edit instructions
    when: Aider edit command called
    then: Files edited with AI assistance
    test_cases:
      - name: edit_single_file
        input: {files: ["main.zig"], instructions: "add error handling"}
        expected: {edited: true, changes: 5}

  - name: chat_with_code
    given: Message and code context
    when: Aider chat called
    then: AI response with code suggestions
    test_cases:
      - name: ask_about_function
        input: {message: "how to optimize this?", context: ["slow.zig"]}
        expected: {response: "Use memoization", suggestions: 3}

  - name: auto_commit
    given: Changes made by Aider
    when: Edit complete
    then: Git commit created automatically
    test_cases:
      - name: commit_after_edit
        input: {changes: 10, message: "fix: optimize performance"}
        expected: {committed: true, hash: "abc123"}

  - name: refactor_code
    given: Code and refactoring instructions
    when: Aider refactor called
    then: Code refactored across multiple files
    test_cases:
      - name: extract_function
        input: {files: ["main.zig"], instructions: "extract helper function"}
        expected: {refactored: true, new_functions: 1}

types:
  AiderConfig:
    model: String
    edit_format: EditFormat
    auto_commits: Bool
    git_diffs: Bool
    show_diffs: Bool
    
  EditFormat:
    - Whole
    - Diff
    - Udiff
    
  AiderEdit:
    files: List<String>
    instructions: String
    context: List<String>
    
  AiderResponse:
    success: Bool
    changes: List<FileChange>
    message: String
    commit_hash: String
    
  FileChange:
    file: String
    lines_added: Int
    lines_removed: Int
    diff: String
    
  AiderChat:
    message: String
    context: List<String>
    history: List<ChatMessage>
    
  ChatMessage:
    role: Role
    content: String
    timestamp: Int
    
  Role:
    - User
    - Assistant
    - System

functions:
  - name: aider_init
    params: {config: AiderConfig}
    returns: Result<Void, Error>
    
  - name: aider_edit
    params: {edit: AiderEdit}
    returns: Result<AiderResponse, Error>
    
  - name: aider_chat
    params: {chat: AiderChat}
    returns: Result<String, Error>
    
  - name: aider_add_files
    params: {files: List<String>}
    returns: Result<Void, Error>
    
  - name: aider_commit
    params: {message: String}
    returns: Result<String, Error>
    
  - name: aider_undo
    params: {}
    returns: Result<Void, Error>
    
  - name: aider_diff
    params: {}
    returns: Result<String, Error>

imports:
  - std
  - std.process
  - std.fs
  - swe_agent_base
