name: vibee_cli
version: "1.0.0"
language: zig
module: vibee_cli
target: vibee.zig
description: VIBEE Compiler CLI - автоматическая магия компилятора

behaviors:
  - name: init_project
    given: User runs 'vibee init'
    when: CLI parses arguments
    then: Project structure created with templates
    test_cases:
      - name: init_with_defaults
        input: {name: "my-project", target: "zig"}
        expected: {created: true, dirs: 6, files: 10}
      - name: init_with_examples
        input: {name: "test-project", target: "zig", examples: true}
        expected: {created: true, examples: 2}

  - name: organize_project
    given: Messy project structure
    when: User runs 'vibee organize'
    then: Project automatically organized
    test_cases:
      - name: organize_with_duplicates
        input: {dirs: 46, duplicates: 4}
        expected: {dirs: 6, archived: 18, merged: 4}
      - name: organize_dry_run
        input: {dry_run: true}
        expected: {changes_shown: true, applied: false}

  - name: generate_code
    given: .vibee specification file
    when: User runs 'vibee gen spec.vibee'
    then: Code generated in storage/
    test_cases:
      - name: gen_single_spec
        input: {spec: "hello.vibee", target: "zig"}
        expected: {generated: "storage/zig/hello.zig"}
      - name: gen_all_specs
        input: {all: true, count: 10}
        expected: {generated: 10}

  - name: watch_mode
    given: Project with specs
    when: User runs 'vibee watch'
    then: Auto-generates on file changes
    test_cases:
      - name: watch_single_change
        input: {changed: "hello.vibee"}
        expected: {generated: true, compiled: true}

types:
  ProjectConfig:
    name: String
    version: String
    target: String
    paths: Paths
    organization: OrgConfig
    
  Paths:
    specs: String
    output: String
    modules: String
    lib: String
    tooling: String
    archive: String
    
  OrgConfig:
    auto_organize: Bool
    merge_duplicates: Bool
    archive_old: Bool
    clean_empty: Bool
    
  InitOptions:
    name: String
    target: String
    examples: Bool
    vscode: Bool
    git: Bool
    
  OrganizeResult:
    dirs_before: Int
    dirs_after: Int
    archived: Int
    merged: Int
    removed: Int

functions:
  - name: init_project
    params: {options: InitOptions}
    returns: Result<ProjectConfig, Error>
    
  - name: organize_project
    params: {dry_run: Bool}
    returns: Result<OrganizeResult, Error>
    
  - name: generate_code
    params: {spec_path: String, target: String}
    returns: Result<String, Error>
    
  - name: watch_mode
    params: {watch_path: String}
    returns: Result<Void, Error>
    
  - name: build_project
    params: {release: Bool}
    returns: Result<Void, Error>
    
  - name: doctor_check
    params: {fix: Bool}
    returns: Result<DiagnosticReport, Error>

imports:
  - std
  - std.fs
  - std.process
  - std.io
