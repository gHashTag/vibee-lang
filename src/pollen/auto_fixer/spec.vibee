name: auto_fixer
version: "1.0.0"
language: zig
module: auto_fixer
target: fixer.zig
description: Automatic violation fixer - converts manual code to specs

behaviors:
  - name: fix_violation
    given: Violation detected
    when: Auto-fix requested
    then: Violation fixed automatically
    test_cases:
      - name: fix_manual_code
        input: {file: "src/modules/test.zig", type: "ManualCode"}
        expected: {fixed: true, spec_created: "src/pollen/test/spec.vibee"}

  - name: create_spec_from_code
    given: Manual code file
    when: Spec generation requested
    then: Specification created
    test_cases:
      - name: generate_spec
        input: {code_file: "test.zig", functions: 3}
        expected: {spec_created: true, behaviors: 3}

  - name: archive_manual_code
    given: Manual code file
    when: Archiving requested
    then: File moved to archive
    test_cases:
      - name: archive_file
        input: {file: "src/modules/test.zig"}
        expected: {archived: true, path: "src/archive/test.zig.bak"}

types:
  FixConfig:
    auto: Bool
    dry_run: Bool
    interactive: Bool
    backup: Bool
    
  FixResult:
    fixed: Int
    manual_review: Int
    errors: Int
    fixes: List<Fix>
    
  Fix:
    violation: Violation
    action: FixAction
    success: Bool
    spec_path: String
    archive_path: String
    
  FixAction:
    - CreateSpec
    - RegenerateCode
    - ArchiveManual
    - ManualReview
    
  CodeAnalysis:
    functions: List<FunctionInfo>
    types: List<TypeInfo>
    imports: List<String>
    
  FunctionInfo:
    name: String
    params: List<Param>
    return_type: String
    
  TypeInfo:
    name: String
    fields: List<Field>
    
  Param:
    name: String
    type: String
    
  Field:
    name: String
    type: String

functions:
  - name: fix_violations
    params: {violations: List<Violation>, config: FixConfig}
    returns: Result<FixResult, Error>
    
  - name: fix_violation
    params: {violation: Violation, config: FixConfig}
    returns: Result<Fix, Error>
    
  - name: create_spec_from_code
    params: {code_file: String}
    returns: Result<String, Error>
    
  - name: analyze_code
    params: {code_file: String}
    returns: Result<CodeAnalysis, Error>
    
  - name: generate_spec
    params: {analysis: CodeAnalysis, module_name: String}
    returns: Result<String, Error>
    
  - name: archive_file
    params: {file: String}
    returns: Result<String, Error>
    
  - name: regenerate_code
    params: {spec_path: String}
    returns: Result<String, Error>
    
  - name: prompt_user
    params: {message: String, options: List<String>}
    returns: Result<String, Error>

imports:
  - std
  - std.fs
  - violation_scanner
  - vibee_guard
