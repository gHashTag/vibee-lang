name: auto_migrate
version: "1.0.0"
language: zig
module: vibee_lang/nurses/auto_migrate
target: auto_migrate.zig
description: |
  ü§ñ AUTOMATIC MIGRATION SYSTEM
  
  –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤ honeycomb/ –≤ bee-—Å—Ç—Ä—É–∫—Ç—É—Ä—É.
  –ü–æ–ª–Ω–∞—è —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è –∏ —Ä–µ–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –∫–æ–¥–∞.

behaviors:
  - name: migrate_all_files
    given: Current honeycomb/ structure with 148 files
    when: Auto migration runs
    then: All files moved to bee directories
    test_cases:
      - name: migrate_complete_honeycomb
        input: {source: "honeycomb/", files: 148}
        expected: {migrated: 148, failed: 0, bee_organized: true}

  - name: resolve_duplicates
    given: 6 duplicate files identified
    when: Duplicate resolution runs
    then: All duplicates merged or renamed
    test_cases:
      - name: resolve_all_duplicates
        input: {duplicates: 6}
        expected: {resolved: 6, merged: 2, renamed: 4}

  - name: update_all_imports
    given: Files moved to new locations
    when: Import update runs
    then: All import statements updated
    test_cases:
      - name: update_imports_after_migration
        input: {files: 148, imports: 500}
        expected: {updated: 500, failed: 0}

  - name: generate_migration_report
    given: Migration completed
    when: Report generation runs
    then: Detailed migration report created
    test_cases:
      - name: generate_complete_report
        input: {migrated: 148}
        expected: {report_generated: true, format: "markdown"}

types:
  MigrationPlan:
    total_files: Int
    bee_categories: List(BeeCategory)
    duplicates: List(Duplicate)
    import_updates: Int

  BeeCategory:
    bee_type: String  # "queen" | "worker" | "scout" | "guard" | "nurse" | "drone" | "pollen"
    file_count: Int
    files: List(FileMapping)

  FileMapping:
    source_path: String
    target_path: String
    bee_type: String
    action: String  # "move" | "merge" | "rename" | "copy"

  Duplicate:
    file_name: String
    locations: List(String)
    resolution: String  # "merge" | "rename"
    target_path: String

  MigrationResult:
    success: Bool
    files_migrated: Int
    files_failed: Int
    duplicates_resolved: Int
    imports_updated: Int
    errors: List(String)
    warnings: List(String)

  MigrationReport:
    timestamp: String
    total_files: Int
    migrated: Int
    failed: Int
    bee_distribution: List(BeeStats)
    duration_seconds: Int

  BeeStats:
    bee_type: String
    file_count: Int
    percentage: Float

functions:
  - name: create_migration_plan
    params: {honeycomb_path: String}
    returns: Result(MigrationPlan, String)
    description: Analyze honeycomb/ and create migration plan

  - name: execute_migration
    params: {plan: MigrationPlan}
    returns: Result(MigrationResult, String)
    description: Execute complete migration

  - name: resolve_duplicate
    params: {duplicate: Duplicate}
    returns: Result(String, String)
    description: Resolve single duplicate file

  - name: move_file
    params: {mapping: FileMapping}
    returns: Result(String, String)
    description: Move file to new location

  - name: update_imports_in_file
    params: {file_path: String, import_map: List(ImportMapping)}
    returns: Result(Int, String)
    description: Update imports in single file

  - name: update_all_imports
    params: {files: List(String), import_map: List(ImportMapping)}
    returns: Result(Int, String)
    description: Update imports in all files

  - name: generate_report
    params: {result: MigrationResult}
    returns: MigrationReport
    description: Generate migration report

  - name: rollback_migration
    params: {backup_path: String}
    returns: Result(String, String)
    description: Rollback migration if needed

imports:
  - gleam/io
  - gleam/list
  - gleam/result
  - gleam/string
  - gleam/option
  - simplifile
  - honeycomb/nurses/spec_generator
  - honeycomb/guards/quality_guard
