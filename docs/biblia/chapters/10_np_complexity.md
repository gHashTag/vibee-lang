# Глава 10: Число 3 и NP-полнота — Порог Сложности

---

*«На распутье стоит камень, а на камне написано:*
*"Два пути — просто, три пути — сложно..."»*

---

## Загадка Порога

В мире алгоритмов есть странная закономерность:

```
┌─────────────────────────────────────────────────────────────────┐
│                                                                 │
│  ПЕРЕХОД ОТ ПРОСТОГО К СЛОЖНОМУ                                │
│                                                                 │
│  k = 2                          k = 3                          │
│  ─────                          ─────                          │
│  ПРОСТО (P)                     СЛОЖНО (NP-полно)              │
│                                                                 │
│  2-SAT ✓                        3-SAT ✗                        │
│  2-раскраска ✓                  3-раскраска ✗                  │
│  2D-matching ✓                  3D-matching ✗                  │
│                                                                 │
│  Почему именно при k = 3?                                      │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## Сказка о Двух и Трёх Дорогах

### Две Дороги: Простой Выбор

```
На распутье две дороги:
  ┌─────┐
  │  ?  │
  └──┬──┘
    ╱ ╲
   ╱   ╲
  A     B

Если A плохо → иди в B
Если B плохо → иди в A

Всегда можно найти путь за линейное время!
Это как 2-SAT: (A ∨ B) означает "если не A, то B"
```

### Три Дороги: Сложный Выбор

```
На распутье три дороги:
      ┌─────┐
      │  ?  │
      └──┬──┘
       ╱ │ ╲
      ╱  │  ╲
     A   B   C

Если A плохо и B плохо → иди в C?
Но что если C тоже плохо?
А что если выбор A влияет на другие распутья?

Нет простого правила!
Нужно проверять ВСЕ комбинации: 3ⁿ вариантов!
```

---

## 2-SAT vs 3-SAT

### 2-SAT: Линейное Время

```
Формула: (x₁ ∨ x₂) ∧ (¬x₁ ∨ x₃) ∧ (¬x₂ ∨ ¬x₃)

Каждый дизъюнкт (a ∨ b) = две импликации:
  ¬a → b
  ¬b → a

Строим граф импликаций:
  ¬x₁ → x₂     x₁ → x₃     x₂ → ¬x₃
  ¬x₂ → x₁     ¬x₃ → ¬x₁   x₃ → ¬x₂

Проверяем: есть ли путь x → ¬x И ¬x → x?
Если да — противоречие, формула невыполнима.
Если нет — находим решение за O(n).

КЛАСС: P ✓
```

### 3-SAT: Экспоненциальное Время

```
Формула: (x₁ ∨ x₂ ∨ x₃) ∧ (¬x₁ ∨ x₂ ∨ ¬x₄) ∧ ...

Дизъюнкт (a ∨ b ∨ c) НЕ даёт простых импликаций!
  ¬a ∧ ¬b → c  (нужны ОБА условия!)

Граф импликаций не работает.
Нужен перебор: 2ⁿ комбинаций.

Лучший известный алгоритм: O(1.307ⁿ)
Всё ещё экспоненциальный!

КЛАСС: NP-complete ✗
```

---

## Три Богатыря Раскраски

### 2-Раскраска: Проверка Двудольности

```
Можно ли раскрасить граф в 2 цвета?

    ●───●
   ╱     ╲
  ●       ●
   ╲     ╱
    ●───●

Алгоритм:
1. Начни с любой вершины, покрась в цвет 1
2. Все соседи — в цвет 2
3. Их соседи — в цвет 1
4. Если конфликт — невозможно

Время: O(V + E) — линейное!

КЛАСС: P ✓
```

### 3-Раскраска: NP-полная!

```
Можно ли раскрасить граф в 3 цвета?

    🔴───🔵
   ╱       ╲
  🟢       🔴
   ╲       ╱
    🔵───🟢

Нет простого локального правила!
Выбор цвета для одной вершины
влияет на далёкие вершины.

Нужен перебор: 3ⁿ комбинаций.

КЛАСС: NP-complete ✗

Даже для ПЛАНАРНЫХ графов!
(Хотя 4 цветов всегда достаточно — теорема о 4 красках)
```

---

## Почему Именно 3?

### Гипотеза 1: Минимальная Нелинейность

```
2 элемента: линейные отношения
  a → b (если не a, то b)
  Цепочка импликаций

3 элемента: нелинейные отношения
  a ∧ b → c (нужны ОБА)
  Дерево решений

3 = минимум для нелинейности!
```

### Гипотеза 2: Комбинаторный Взрыв

```
2 варианта на элемент: 2ⁿ комбинаций
3 варианта на элемент: 3ⁿ комбинаций

Отношение: (3/2)ⁿ = 1.5ⁿ

При n = 100:
  2¹⁰⁰ ≈ 10³⁰
  3¹⁰⁰ ≈ 10⁴⁸

Разница в 10¹⁸ раз!
```

### Гипотеза 3: Структура Решений

```
2-SAT: решения образуют ВЫПУКЛОЕ множество
  Если A и B — решения, то их "смесь" тоже решение
  Можно найти градиентным спуском

3-SAT: решения РАЗБРОСАНЫ
  Между двумя решениями может быть пустота
  Нужен полный перебор
```

---

## Связь с Trinity Sort

### Парадокс?

```
NP-полнота: 3 = сложно
Trinity Sort: 3 = быстро

Как это совместить?
```

### Разгадка: Выбор vs Классификация

```
┌─────────────────────────────────────────────────────────────────┐
│                                                                 │
│  NP-ПОЛНОТА: 3 ВАРИАНТА ВЫБОРА                                 │
│                                                                 │
│  Каждый элемент может быть в 3 состояниях                      │
│  n элементов → 3ⁿ комбинаций                                   │
│  Нужно найти ОДНУ правильную комбинацию                        │
│                                                                 │
│  Пример: 3-раскраска                                           │
│  Каждая вершина: R или G или B                                 │
│  Нужно найти раскраску без конфликтов                          │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────┐
│                                                                 │
│  TRINITY SORT: 3 КАТЕГОРИИ КЛАССИФИКАЦИИ                       │
│                                                                 │
│  Каждый элемент ДЕТЕРМИНИРОВАННО попадает в 1 из 3 категорий  │
│  n элементов → 3n операций (линейно!)                          │
│  Нет выбора — только классификация                             │
│                                                                 │
│  Пример: 3-way partition                                       │
│  Каждый элемент: < pivot ИЛИ = pivot ИЛИ > pivot              │
│  Результат определён однозначно                                │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### Ключевое Различие

```
ВЫБОР (NP):
  "Какой цвет назначить вершине?"
  Много вариантов, нужно найти правильный
  3ⁿ комбинаций

КЛАССИФИКАЦИЯ (P):
  "В какую категорию попадает элемент?"
  Один правильный ответ, определяется сравнением
  3n операций
```

---

## Мудрость Главы

> *И понял Иван-программист глубокую истину:*
>
> *Число 3 — порог между простым и сложным.*
>
> *Когда 3 означает ВЫБОР — это начало NP-полноты.*
> *Три варианта на каждый элемент — 3ⁿ комбинаций.*
> *Экспоненциальный взрыв!*
>
> *Когда 3 означает КЛАССИФИКАЦИЮ — это оптимум.*
> *Три категории для каждого элемента — 3n операций.*
> *Линейное время!*
>
> *Trinity Sort использует 3 для классификации:*
> *меньше, равно, больше.*
> *Нет выбора — есть определённость.*
> *Поэтому он быстр.*
>
> *Древние знали: три дороги на распутье*
> *могут вести к мудрости или к погибели.*
> *Всё зависит от того, как ты их используешь.*

---

[← Глава 9](09_lessons.md) | [Глава 11: Язык Vibee →](11_vibee_language.md)
