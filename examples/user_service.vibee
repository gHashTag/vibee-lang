name: user_service
version: "1.0.0"
language: zig
module: services/user
description: User management service with CRUD operations

behaviors:
  - name: create_new_user
    given: Valid user data with name and email
    when: create_user function is called
    then: New user is created with unique ID and timestamp
    test_cases:
      - name: valid_user
        input: {name: "Alice", email: "alice@example.com"}
        expected: {id: 1, name: "Alice", email: "alice@example.com"}
      - name: empty_name
        input: {name: "", email: "test@example.com"}
        expected: {error: "name_required"}
      - name: invalid_email
        input: {name: "Bob", email: "invalid"}
        expected: {error: "invalid_email"}

  - name: get_user_by_id
    given: User exists in the database
    when: get_user function is called with valid ID
    then: User data is returned
    test_cases:
      - name: existing_user
        input: {id: 1}
        expected: {id: 1, name: "Alice"}

  - name: handle_missing_user
    given: No user with given ID exists
    when: get_user function is called with invalid ID
    then: None is returned
    test_cases:
      - name: non_existent_user
        input: {id: 999}
        expected: {result: null}

  - name: update_user_data
    given: User exists and new data is valid
    when: update_user function is called
    then: User data is updated and returned
    test_cases:
      - name: update_name
        input: {id: 1, name: "Alice Smith"}
        expected: {id: 1, name: "Alice Smith"}

  - name: delete_user
    given: User exists in the database
    when: delete_user function is called
    then: User is removed and true is returned
    test_cases:
      - name: delete_existing
        input: {id: 1}
        expected: {deleted: true}

types:
  User:
    id: int
    name: str
    email: str
    created_at: int
    updated_at: int?

  CreateUserRequest:
    name: str
    email: str

  UpdateUserRequest:
    id: int
    name: str?
    email: str?

  UserResult:
    user: User?
    error: str?

functions:
  - name: create_user
    params: {request: CreateUserRequest}
    returns: UserResult

  - name: get_user
    params: {id: int}
    returns: User?

  - name: update_user
    params: {request: UpdateUserRequest}
    returns: UserResult

  - name: delete_user
    params: {id: int}
    returns: bool

  - name: list_users
    params: {limit: int, offset: int}
    returns: [User]

imports:
  - std
  - std.time
