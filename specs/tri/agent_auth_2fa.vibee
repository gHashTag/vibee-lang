name: agent_auth_2fa
version: "1.0.0"
language: zig
module: agent_auth_2fa

description: |
  Agent Auth 2FA - двухфакторная аутентификация
  Поддержка: TOTP, SMS, Email, Push
  φ² + 1/φ² = 3 | PHOENIX = 999

types:
  TwoFactorMethod:
    fields:
      method_type: String
      destination: Option<String>
      is_default: Bool

  TwoFactorChallenge:
    fields:
      challenge_id: String
      method: String
      expires_at: Timestamp
      attempts_remaining: Int

  TwoFactorCode:
    fields:
      code: String
      method: String
      timestamp: Timestamp

  TwoFactorResult:
    fields:
      success: Bool
      session_token: Option<String>
      error: Option<String>
      retry_allowed: Bool

behaviors:
  - name: detect_2fa_challenge
    given: Текущая страница
    when: Обнаружение 2FA запроса
    then: TwoFactorChallenge или null

  - name: list_2fa_methods
    given: TwoFactorChallenge challenge
    when: Получение доступных методов
    then: Список TwoFactorMethod

  - name: request_code
    given: TwoFactorMethod метод
    when: Запрос кода (SMS/Email)
    then: Код отправлен

  - name: generate_totp
    given: TOTP secret
    when: Генерация TOTP кода
    then: TwoFactorCode

  - name: submit_code
    given: TwoFactorCode код
    when: Отправка кода
    then: TwoFactorResult

  - name: request_user_input
    given: TwoFactorChallenge challenge
    when: Запрос кода у пользователя
    then: TwoFactorCode от пользователя
