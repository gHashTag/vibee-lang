# VIBEE Specification - IGLA AI Selectors
# AI-driven element selection and locators
# Browser Automation v4
# φ² + 1/φ² = 3 | PHOENIX = 999

name: igla_ai_selectors
version: "4.0.0"
language: zig
module: igla_ai_selectors

types:
  AISelector:
    fields:
      id: String
      description: String
      css_selector: String
      xpath: String
      confidence: Float
      strategy: String

  SelectorStrategy:
    fields:
      name: String
      priority: Int
      fallback_enabled: Bool

  ElementFeatures:
    fields:
      tag_name: String
      id: String
      class_names: String
      text_content: String
      aria_label: String
      role: String
      placeholder: String
      name: String
      data_testid: String

  VisualFeatures:
    fields:
      x: Int
      y: Int
      width: Int
      height: Int
      color: String
      font_size: Int
      visible: Bool

  SemanticMatch:
    fields:
      description: String
      element_features: String
      similarity_score: Float
      match_reason: String

  SelectorCandidate:
    fields:
      selector: String
      selector_type: String
      specificity: Int
      stability_score: Float
      uniqueness: Bool

  SelectorHistory:
    fields:
      selector: String
      success_count: Int
      failure_count: Int
      last_used: Int
      avg_find_time_ms: Float

  AIModel:
    fields:
      name: String
      version: String
      embedding_dim: Int
      vocab_size: Int

  EmbeddingVector:
    fields:
      values: String
      dimension: Int
      normalized: Bool

  SelectorConfig:
    fields:
      use_ai: Bool
      fallback_to_css: Bool
      max_candidates: Int
      min_confidence: Float
      cache_enabled: Bool

  SelectorResult:
    fields:
      found: Bool
      selector: String
      confidence: Float
      alternatives: String
      find_time_ms: Float

  SelectorMetrics:
    fields:
      total_queries: Int
      ai_matches: Int
      css_fallbacks: Int
      avg_confidence: Float
      cache_hits: Int

behaviors:
  - name: find_by_description
    given: Natural language description
    when: AI selector search
    then: Best matching element found

  - name: find_by_role
    given: ARIA role
    when: Role-based search
    then: Elements with role found

  - name: find_by_text
    given: Text content
    when: Text-based search
    then: Elements containing text found

  - name: find_by_label
    given: Label text
    when: Label association search
    then: Labeled element found

  - name: find_by_placeholder
    given: Placeholder text
    when: Placeholder search
    then: Input with placeholder found

  - name: find_by_testid
    given: data-testid value
    when: TestID search
    then: Element with testid found

  - name: generate_selector
    given: Element features
    when: Selector generation requested
    then: Optimal selector generated

  - name: rank_selectors
    given: Multiple selector candidates
    when: Ranking requested
    then: Selectors ranked by stability

  - name: compute_embedding
    given: Element description
    when: Embedding requested
    then: Vector embedding returned

  - name: compute_similarity
    given: Two embeddings
    when: Similarity computed
    then: Cosine similarity score

  - name: learn_from_success
    given: Successful selector match
    when: Learning triggered
    then: Selector history updated

  - name: learn_from_failure
    given: Failed selector match
    when: Learning triggered
    then: Alternative strategies explored

  - name: suggest_alternatives
    given: Failed selector
    when: Alternatives requested
    then: Alternative selectors suggested

  - name: validate_selector
    given: CSS or XPath selector
    when: Validation requested
    then: Selector validity checked

  - name: get_metrics
    given: Selector history
    when: Metrics requested
    then: Performance statistics returned

test_cases:
  - name: test_find_by_description
    input: { description: "login button" }
    expected: { found: true, confidence: 0.85 }

  - name: test_find_by_role
    input: { role: "button" }
    expected: { found: true }

  - name: test_find_by_text
    input: { text: "Submit" }
    expected: { found: true }

  - name: test_generate_selector
    input: { tag: "button", id: "submit-btn" }
    expected: { selector: "#submit-btn" }

  - name: test_compute_similarity
    input: { vec1: "[0.1, 0.2]", vec2: "[0.1, 0.3]" }
    expected: { similarity: 0.98 }

  - name: test_rank_selectors
    input: { selectors: ["#id", ".class", "div"] }
    expected: { best: "#id" }

  - name: test_validate_selector
    input: { selector: "#valid-id" }
    expected: { valid: true }

  - name: test_metrics
    input: {}
    expected: { total_queries: 0 }
