# iGLA HNSW Builder
# Efficient HNSW index construction
# Scientific basis: Malkov & Yashunin 2018
# φ² + 1/φ² = 3 | V = n × 3^k × π^m × φ^p

name: igla_hnsw_builder
version: "1.0.0"
language: zig
module: igla_hnsw_builder

sacred_constants:
  phi: 1.618033988749895
  trinity: 3.0
  phoenix: 999

scientific_references:
  - "Malkov & Yashunin 2018: HNSW"
  - "Douze et al. 2024: FAISS library"
  - "Johnson et al. 2019: Billion-scale similarity search"

types:
  BuilderConfig:
    fields:
      M: Int
      ef_construction: Int
      num_threads: Int
      batch_size: Int

  BuildProgress:
    fields:
      total: Int
      completed: Int
      current_level: Int
      elapsed_ms: Float

  BatchInsert:
    fields:
      vectors: String
      ids: String
      count: Int

  BuildStats:
    fields:
      build_time_ms: Float
      nodes_inserted: Int
      edges_created: Int
      memory_bytes: Int

  OptimizationHint:
    fields:
      hint_type: String
      value: Float

  ParallelBatch:
    fields:
      batch_id: Int
      start_idx: Int
      end_idx: Int
      thread_id: Int

behaviors:
  - name: build_index
    given: "Vectors, config"
    when: "Full build"
    then: "Complete HNSW index"

  - name: build_incremental
    given: "New vectors, existing index"
    when: "Incremental build"
    then: "Updated index"

  - name: build_parallel
    given: "Vectors, num_threads"
    when: "Parallel build"
    then: "Index built with parallelism"

  - name: optimize_connections
    given: "Built index"
    when: "Post-build optimization"
    then: "Optimized neighbor lists"

  - name: prune_edges
    given: "Node, max_edges"
    when: "Edge pruning"
    then: "Pruned to max_edges"

  - name: estimate_memory
    given: "Num vectors, dim, M"
    when: "Memory estimation"
    then: "Estimated bytes"

  - name: checkpoint_build
    given: "Partial index, path"
    when: "Checkpointing"
    then: "Progress saved"

  - name: phi_batch_sizing
    given: "Total vectors"
    when: "Sacred batching"
    then: "φ-ratio batch sizes"
