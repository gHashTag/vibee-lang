# v4203 - Progressive Networks
# =============================
# Architecture-based continual learning
# φ² + 1/φ² = 3 | PHOENIX = 999

name: progressive_networks
version: "4.2.3"
language: zig
module: progressive_networks

constants:
  PHI: 1.618033988749895
  MAX_COLUMNS: 20
  LATERAL_SCALE: 0.1

types:
  ProgressiveNet:
    fields:
      columns: List
      lateral_connections: List
      num_tasks: Int
      
  Column:
    fields:
      task_id: Int
      layers: List
      frozen: Bool
      
  LateralConnection:
    fields:
      source_column: Int
      target_column: Int
      adapter_weights: List
      
  PackNet:
    fields:
      base_network: Object
      masks: List
      capacity_per_task: Float
      
  DynamicExpansion:
    fields:
      current_capacity: Int
      expansion_threshold: Float
      pruning_ratio: Float
      
  ExpertGate:
    fields:
      num_experts: Int
      gating_network: Object
      expert_networks: List
      
  ModularNetwork:
    fields:
      modules: List
      routing: Object
      composition_rules: List
      
  CapacityAllocation:
    fields:
      total_params: Int
      allocated: List
      available: Int

behaviors:
  - name: add_column
    given: Progressive net and task
    when: Adding new column
    then: Return expanded network
    
  - name: forward_with_laterals
    given: Input and all columns
    when: Forward pass
    then: Return output
    
  - name: freeze_column
    given: Network and column id
    when: Protecting learned knowledge
    then: Return frozen network
    
  - name: compute_lateral_features
    given: Source columns and input
    when: Gathering lateral info
    then: Return lateral features
    
  - name: prune_and_allocate
    given: Network and new task
    when: PackNet allocation
    then: Return pruned network with mask
    
  - name: dynamic_expansion
    given: Network and performance
    when: Deciding to expand
    then: Return expansion decision
    
  - name: route_to_experts
    given: Input and gating network
    when: Expert selection
    then: Return expert assignments
    
  - name: compose_modules
    given: Modules and task
    when: Building task network
    then: Return composed network
