# sec_rate_limit_v2606.vibee - Rate Limiting
# Ограничение частоты запросов
# φ² + 1/φ² = 3 | PHOENIX = 999

name: sec_rate_limit_v2606
version: "2606.0.0"
language: zig
module: sec_rate_limit_v2606

types:
  RateLimitRule:
    fields:
      name: String
      requests: Int
      window_seconds: Int
      key_type: String
      action: String

  RateLimitState:
    fields:
      key: String
      count: Int
      window_start: Timestamp
      blocked_until: Timestamp

  RateLimitResult:
    fields:
      allowed: Bool
      remaining: Int
      reset_at: Timestamp
      retry_after_seconds: Int

  RateLimitConfig:
    fields:
      enabled: Bool
      default_limit: Int
      default_window: Int
      whitelist: List
      blacklist: List

behaviors:
  - name: check_limit
    given: Request key and rule
    when: Request received
    then: Return RateLimitResult

  - name: increment_counter
    given: Request key
    when: Request processed
    then: Update counter

  - name: reset_counter
    given: Request key
    when: Window expired
    then: Reset to zero

  - name: block_key
    given: Key and duration
    when: Abuse detected
    then: Block temporarily

  - name: get_stats
    given: Key
    when: Stats requested
    then: Return RateLimitState

sacred_constants:
  phi: 1.618033988749895
  phoenix: 999
