name: warp_agent_reflexion
version: "1.0.0"
language: zig
module: warp_agent_reflexion

description: |
  WARP Agent Reflexion - обучение на ошибках
  Научные основы: Reflexion (Shinn et al., 2023)
  Улучшение: +20% на HumanEval, +10% на WebArena
  φ² + 1/φ² = 3 | PHOENIX = 999

types:
  ReflexionMemory:
    fields:
      task: String
      trajectory: List<String>
      outcome: String
      reflection: String
      lessons: List<String>

  ReflexionState:
    fields:
      current_trial: Int
      max_trials: Int
      memories: List<String>
      best_score: Float

  ReflexionConfig:
    fields:
      max_trials: Int
      memory_size: Int
      reflection_depth: Int
      learning_rate: Float

  ReflexionResult:
    fields:
      success: Bool
      trials_used: Int
      final_score: Float
      learned_lessons: List<String>

  FailureAnalysis:
    fields:
      error_type: String
      root_cause: String
      suggested_fix: String
      confidence: Float

behaviors:
  - name: attempt_task
    given: Задача и ReflexionState
    when: Попытка выполнения задачи
    then: Результат попытки

  - name: reflect_on_failure
    given: Неудачная траектория
    when: Анализ ошибки
    then: ReflexionMemory с уроками

  - name: update_memory
    given: Новый ReflexionMemory
    when: Добавление в память
    then: Обновлённый ReflexionState

  - name: retrieve_relevant
    given: Текущая задача
    when: Поиск релевантных воспоминаний
    then: Список похожих ReflexionMemory

  - name: apply_lessons
    given: Задача и уроки из памяти
    when: Применение выученного
    then: Улучшенная стратегия

  - name: run_with_reflexion
    given: Задача и ReflexionConfig
    when: Выполнение с рефлексией
    then: ReflexionResult после всех попыток
