name: error_handler_v22
version: "22.3.0"
language: zig
module: error_handler_v22

types:
  ErrorType:
    fields:
      name: String

  AgentError:
    fields:
      error_type: String
      message: String
      context: String
      timestamp: Timestamp
      recoverable: Bool

  RecoveryStrategy:
    fields:
      name: String
      description: String
      max_retries: Int
      backoff_ms: Int

  RecoveryResult:
    fields:
      success: Bool
      strategy_used: String
      retries: Int
      new_state: Option<String>

  ErrorStats:
    fields:
      total_errors: Int
      recovered: Int
      fatal: Int
      by_type: Object

  ErrorHandler:
    fields:
      strategies: List<String>
      stats: Object
      max_retries: Int

behaviors:
  - name: create_handler
    given: Config
    when: Initialize handler
    then: ErrorHandler instance

  - name: handle_error
    given: ErrorHandler and AgentError
    when: Handle error
    then: RecoveryResult

  - name: classify_error
    given: Error message
    when: Classify error type
    then: ErrorType

  - name: get_strategy
    given: ErrorType
    when: Get recovery strategy
    then: RecoveryStrategy

  - name: retry_action
    given: ErrorHandler and action
    when: Retry with backoff
    then: Retry result

  - name: recover_state
    given: ErrorHandler and state
    when: Recover to safe state
    then: Recovered state

  - name: is_recoverable
    given: AgentError
    when: Check if recoverable
    then: Boolean

  - name: log_error
    given: ErrorHandler and AgentError
    when: Log error
    then: Logged

  - name: get_stats
    given: ErrorHandler
    when: Get error stats
    then: ErrorStats

  - name: reset_stats
    given: ErrorHandler
    when: Reset stats
    then: Reset complete

  - name: should_abort
    given: ErrorHandler
    when: Check abort condition
    then: Boolean
