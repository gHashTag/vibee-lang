name: parallel_codegen_v52400
version: "52400.0.0"
language: zig
module: parallel_codegen

types:
  ParallelConfig:
    fields:
      worker_threads: Int
      chunk_size: Int
      queue_depth: Int
      enable_stealing: Bool

  CodegenTask:
    fields:
      task_id: Int
      spec_path: String
      output_path: String
      priority: Int

  WorkerState:
    fields:
      worker_id: Int
      tasks_completed: Int
      current_task: Int
      is_idle: Bool

  TaskQueue:
    fields:
      pending_count: Int
      in_progress_count: Int
      completed_count: Int
      failed_count: Int

  ParallelResult:
    fields:
      total_tasks: Int
      successful: Int
      failed: Int
      total_time_ms: Int

  WorkStealingStats:
    fields:
      steals_attempted: Int
      steals_successful: Int
      tasks_stolen: Int

behaviors:
  - name: init_thread_pool
    given: Parallel config
    when: Initialization triggered
    then: Worker threads created

  - name: submit_task
    given: Codegen task
    when: Submission triggered
    then: Task added to queue

  - name: process_task
    given: Task from queue
    when: Worker available
    then: Code generated for spec

  - name: steal_work
    given: Idle worker
    when: Own queue empty
    then: Task stolen from busy worker

  - name: merge_results
    given: All worker results
    when: All tasks complete
    then: Combined result returned

  - name: handle_failure
    given: Failed task
    when: Error occurred
    then: Task retried or marked failed

  - name: shutdown_pool
    given: Thread pool
    when: Shutdown triggered
    then: Workers terminated gracefully

  - name: get_progress
    given: Active parallel job
    when: Progress requested
    then: Current completion percentage
