name: incremental_compiler_v52100
version: "52100.0.0"
language: zig
module: incremental_compiler

types:
  FileHash:
    fields:
      path: String
      content_hash: Int
      mtime_ns: Int
      size_bytes: Int

  DependencyGraph:
    fields:
      nodes_count: Int
      edges_count: Int
      root_node: String

  CacheEntry:
    fields:
      key: String
      value_hash: Int
      created_at: Int
      valid: Bool

  IncrementalState:
    fields:
      last_build_time: Int
      files_cached: Int
      files_changed: Int
      rebuild_required: Bool

  ChangeSet:
    fields:
      added_files: Int
      modified_files: Int
      deleted_files: Int
      affected_modules: Int

  CompilationUnit:
    fields:
      source_file: String
      output_file: String
      dependencies: Int
      is_dirty: Bool

behaviors:
  - name: compute_file_hash
    given: File path
    when: Hash computation triggered
    then: Content hash calculated

  - name: check_cache_validity
    given: Cache entry and current file
    when: Validity check triggered
    then: Cache hit or miss determined

  - name: build_dependency_graph
    given: Set of source files
    when: Graph construction triggered
    then: Full dependency graph built

  - name: detect_changes
    given: Previous and current state
    when: Change detection triggered
    then: ChangeSet with all modifications

  - name: invalidate_dependents
    given: Changed file and dependency graph
    when: Invalidation triggered
    then: All dependent modules marked dirty

  - name: incremental_compile
    given: ChangeSet and cache
    when: Compilation triggered
    then: Only dirty modules recompiled

  - name: update_cache
    given: Compilation results
    when: Cache update triggered
    then: Cache entries updated

  - name: persist_state
    given: Incremental state
    when: Persistence triggered
    then: State saved to disk
