# v6003 - Learning Rate Schedulers
# =================================
# Планировщики learning rate
# V = n × 3^k × π^m × φ^p | φ² + 1/φ² = 3 | PHOENIX = 999

name: lr_scheduler
version: "6.0.3"
language: zig
module: lr_scheduler

constants:
  PHI: 1.618033988749895
  PI: 3.141592653589793
  DEFAULT_WARMUP: 1000
  MIN_LR: 1e-7

types:
  SchedulerState:
    fields:
      current_step: Int
      base_lr: Float
      current_lr: Float
      
  WarmupConfig:
    fields:
      warmup_steps: Int
      warmup_init_lr: Float
      
  CosineConfig:
    fields:
      total_steps: Int
      min_lr: Float
      num_cycles: Float
      
  LinearConfig:
    fields:
      start_lr: Float
      end_lr: Float
      total_steps: Int
      
  OneCycleConfig:
    fields:
      max_lr: Float
      total_steps: Int
      pct_start: Float
      div_factor: Float
      final_div_factor: Float

behaviors:
  - name: constant_lr
    given: Base LR
    when: Константный schedule
    then: Вернуть base_lr всегда
    
  - name: linear_warmup
    given: Step, warmup_steps, target_lr
    when: Линейный warmup
    then: Вернуть step/warmup_steps * target_lr
    
  - name: cosine_decay
    given: Step, total_steps, min_lr, max_lr
    when: Косинусное затухание
    then: Вернуть min + (max-min) * (1 + cos(π*step/total)) / 2
    
  - name: cosine_with_warmup
    given: Step, warmup_steps, total_steps, config
    when: Cosine с warmup
    then: Вернуть warmup если step < warmup, иначе cosine
    
  - name: linear_decay
    given: Step, config
    when: Линейное затухание
    then: Вернуть start - (start-end) * step/total
    
  - name: one_cycle
    given: Step, config
    when: OneCycle policy
    then: Вернуть LR по one-cycle schedule
    
  - name: phi_harmonic
    given: Step, base_lr
    when: φ-гармонический schedule
    then: Вернуть base_lr * φ^(-step/1000) с осцилляциями
    
  - name: step_scheduler
    given: Optimizer и scheduler
    when: Обновление LR
    then: Вычислить новый LR и обновить optimizer
