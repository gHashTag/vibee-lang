name: warp_navigation
version: "1.0.0"
language: zig
module: warp_navigation

description: |
  WARP Navigation - умная навигация < 500ms
  Научные основы: Speculation Rules API, HTTP/3 QUIC
  Предзагрузка и кэширование для ускорения
  φ² + 1/φ² = 3 | PHOENIX = 999

types:
  NavigationConfig:
    fields:
      url: String
      wait_until: String
      timeout_ms: Int
      prefetch_enabled: Bool
      cache_enabled: Bool

  NavigationResult:
    fields:
      url: String
      status_code: Int
      load_time_ms: Float
      dom_ready_ms: Float
      fully_loaded_ms: Float
      from_cache: Bool

  PrefetchHint:
    fields:
      url: String
      priority: Int
      probability: Float

  CacheEntry:
    fields:
      url: String
      content_hash: String
      size_bytes: Int
      ttl_seconds: Int
      hit_count: Int

  NavigationMetrics:
    fields:
      total_navigations: Int
      avg_load_time_ms: Float
      cache_hit_rate: Float
      prefetch_hit_rate: Float

behaviors:
  - name: navigate
    given: NavigationConfig конфигурация
    when: Переход на URL
    then: NavigationResult за < 500ms (с кэшем < 100ms)

  - name: prefetch
    given: Список PrefetchHint URL для предзагрузки
    when: Фоновая предзагрузка
    then: Страницы в кэше для быстрого доступа

  - name: predict_next_urls
    given: Текущий URL и история
    when: Предсказание следующих URL
    then: Список PrefetchHint с вероятностями

  - name: wait_for_selector
    given: CSS селектор и timeout
    when: Ожидание появления элемента
    then: Элемент найден или timeout

  - name: wait_for_navigation
    given: Текущая страница
    when: Ожидание завершения навигации
    then: NavigationResult после загрузки

  - name: get_cache_stats
    given: Текущее состояние кэша
    when: Запрос статистики кэша
    then: NavigationMetrics со статистикой
