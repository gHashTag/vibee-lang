# FFI Nim v56440 - Nim importc/exportc
# VIBEE → Nim Native Bindings
# φ² + 1/φ² = 3 | PHOENIX = 999

name: ffi_nim_v56440
version: "56.4.40"
language: zig
module: ffi_nim

creation_pattern:
  source: VibeeSpec
  transformer: NimBindingsGenerator
  result: NimModule

types:
  NimType:
    fields:
      name: String
      nim_type: String
      c_type: String
      is_ptr: Bool

  NimProc:
    fields:
      name: String
      params: List<String>
      return_type: Option<String>
      pragmas: List<String>
      importc: Option<String>

  NimObject:
    fields:
      name: String
      fields: List<String>
      is_ref: Bool
      is_ptr: Bool
      pragmas: List<String>

  NimEnum:
    fields:
      name: String
      values: List<String>
      size: Option<Int>

  NimModule:
    fields:
      name: String
      imports: List<String>
      exports: List<String>
      types: List<NimType>
      procs: List<NimProc>

  NimPragma:
    fields:
      name: String
      args: List<String>

  NimCallback:
    fields:
      name: String
      signature: String
      cdecl_pragma: Bool

  NimConfig:
    fields:
      backend: String
      cc: String
      passL: List<String>
      passC: List<String>

behaviors:
  - name: generate_nim_module
    given: VibeeSpec
    when: Nim module needed
    then: Nim module file

  - name: generate_importc
    given: C function
    when: importc needed
    then: proc with importc pragma

  - name: map_vibee_to_nim_type
    given: Vibee type
    when: Type mapping needed
    then: Nim type

  - name: generate_object
    given: C struct
    when: Nim object needed
    then: NimObject definition

  - name: generate_exportc
    given: Nim proc
    when: C export needed
    then: proc with exportc pragma

  - name: generate_nim_cfg
    given: Build config
    when: nim.cfg needed
    then: NimConfig file

  - name: wrap_cstring
    given: C string
    when: cstring wrapper needed
    then: cstring type

  - name: handle_nim_gc
    given: Foreign memory
    when: GC interaction needed
    then: GC_ref/GC_unref
