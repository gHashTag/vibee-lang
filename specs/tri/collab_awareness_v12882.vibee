# collab_awareness_v12882.vibee - Awareness протокол
# Осведомленность о других пользователях
# φ² + 1/φ² = 3 | PHOENIX = 999

name: collab_awareness_v12882
version: "12882.0.0"
language: zig
module: collab_awareness_v12882

types:
  AwarenessState:
    fields:
      user_id: String
      cursor: Object
      selection: Object
      name: String
      color: String
      last_update: Timestamp

  AwarenessUpdate:
    fields:
      update_id: String
      user_id: String
      changes: Object
      timestamp: Timestamp

  AwarenessRoom:
    fields:
      room_id: String
      users: List
      state_map: Object

  AwarenessConfig:
    fields:
      update_interval_ms: Int
      timeout_ms: Int
      broadcast_cursor: Bool

  AwarenessMetrics:
    fields:
      active_users: Int
      updates_per_sec: Float
      avg_latency_ms: Float

behaviors:
  - name: join_awareness
    given: Room ID and user
    when: Join
    then: Return AwarenessRoom

  - name: update_awareness
    given: AwarenessUpdate
    when: Update
    then: Return success

  - name: get_awareness
    given: Room ID
    when: State request
    then: Return AwarenessState list

  - name: broadcast_state
    given: AwarenessState
    when: Broadcast
    then: Return success

  - name: handle_timeout
    given: User ID
    when: Timeout
    then: Return removed user

sacred_constants:
  phi: 1.618033988749895
  phoenix: 999
