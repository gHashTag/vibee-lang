name: agent_navigation_iframe
version: "1.0.0"
language: zig
module: agent_navigation_iframe

description: |
  Agent Navigation Iframe - работа с iframe и Shadow DOM
  Сложность: вложенные контексты, cross-origin
  φ² + 1/φ² = 3 | PHOENIX = 999

types:
  IframeInfo:
    fields:
      frame_id: String
      src: String
      name: Option<String>
      is_cross_origin: Bool
      depth: Int

  IframeContext:
    fields:
      current_frame: String
      parent_frame: Option<String>
      child_frames: List<String>

  ShadowRootInfo:
    fields:
      host_selector: String
      mode: String
      elements_count: Int

  FrameSwitchResult:
    fields:
      success: Bool
      new_context: String
      available_elements: Int
      error: Option<String>

behaviors:
  - name: list_iframes
    given: Текущая страница
    when: Получение списка iframe
    then: Список IframeInfo

  - name: switch_to_iframe
    given: IframeInfo или селектор
    when: Переключение контекста в iframe
    then: FrameSwitchResult

  - name: switch_to_parent
    given: Текущий iframe контекст
    when: Возврат в родительский фрейм
    then: FrameSwitchResult

  - name: switch_to_main
    given: Любой вложенный контекст
    when: Возврат в главный документ
    then: FrameSwitchResult

  - name: pierce_shadow_dom
    given: ShadowRootInfo shadow root
    when: Доступ к элементам в Shadow DOM
    then: Список доступных элементов

  - name: execute_in_frame
    given: IframeInfo и действие
    when: Выполнение действия в контексте iframe
    then: Результат действия
