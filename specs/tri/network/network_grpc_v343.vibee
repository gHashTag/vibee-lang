name: network_grpc_v343
version: "1.0.0"
language: zig
module: network_grpc_v343

types:
  GRPCCall:
    fields:
      service: String
      method: String
      request: Object
      metadata: Object

  GRPCResponse:
    fields:
      message: Object
      status: Int
      status_message: String
      trailers: Object

  GRPCStream:
    fields:
      call: GRPCCall
      messages: List<Object>
      direction: String
      completed: Bool

  GRPCMock:
    fields:
      service: String
      method: String
      response: GRPCResponse
      stream_responses: List<Object>

  GRPCConfig:
    fields:
      endpoint: String
      use_tls: Bool
      metadata: Object

behaviors:
  - name: intercept_grpc
    given: gRPC endpoint
    When: Call made
    then: gRPC call intercepted

  - name: mock_unary
    given: Service and method
    When: Unary call made
    then: Mock response returned

  - name: mock_stream
    given: Stream config
    When: Stream opened
    then: Mock messages streamed

  - name: capture_calls
    given: Capture enabled
    When: Calls made
    then: All calls captured

  - name: wait_for_call
    given: Expected call
    When: Wait runs
    then: Resolves when call made

  - name: assert_request
    given: Expected request
    When: Assertion runs
    then: Passes if request matches

  - name: simulate_error
    given: Error status
    When: Call made
    then: gRPC error returned

  - name: handle_bidirectional
    given: Bidi stream
    When: Stream active
    then: Both directions handled
