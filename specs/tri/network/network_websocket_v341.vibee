name: network_websocket_v341
version: "1.0.0"
language: zig
module: network_websocket_v341

types:
  WebSocketConnection:
    fields:
      url: String
      ready_state: Int
      protocol: String
      extensions: String

  WebSocketMessage:
    fields:
      type: String
      data: String
      timestamp: Timestamp
      direction: String

  WebSocketFrame:
    fields:
      opcode: Int
      payload: String
      fin: Bool
      masked: Bool

  WebSocketMock:
    fields:
      url_pattern: String
      responses: List<WebSocketMessage>
      delay_ms: Int

  WebSocketCapture:
    fields:
      messages: List<WebSocketMessage>
      connection: WebSocketConnection
      duration_ms: Int

behaviors:
  - name: intercept_websocket
    given: WS URL pattern
    When: Connection made
    then: WebSocket intercepted

  - name: capture_messages
    given: WS connection
    When: Messages sent/received
    then: Messages captured

  - name: send_ws_message
    given: WS connection
    When: Send called
    then: Message sent to server

  - name: mock_ws_server
    given: Mock config
    When: Connection made
    then: Mock responses sent

  - name: wait_for_message
    given: Expected message
    When: Wait runs
    then: Resolves when message received

  - name: close_websocket
    given: WS connection
    When: Close called
    then: Connection closed

  - name: assert_message
    given: Expected message
    When: Assertion runs
    then: Passes if message received

  - name: replay_ws_session
    given: Captured session
    When: Replay runs
    then: Messages replayed
