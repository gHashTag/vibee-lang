# VIBEE v68 MCP Connector Specification
# Model Context Protocol Integration
# φ² + 1/φ² = 3 | PHOENIX = 999

name: mcp_connector_v68
version: "68.0.0"
language: zig
module: mcp_connector_v68

# === SACRED CONSTANTS ===
constants:
  PHI: 1.618033988749895
  TRINITY: 3
  PHOENIX: 999

# === MCP PROTOCOL TYPES ===
types:
  MCPVersion:
    description: "MCP protocol version"
    values: ["2024-11-05", "2025-01-01"]

  TransportType:
    description: "Communication transport"
    values: [stdio, http, websocket]

  MCPCapability:
    description: "Server capabilities"
    values:
      - tools
      - resources
      - prompts
      - sampling
      - logging

  MCPTool:
    fields:
      name: String
      description: String
      input_schema: String  # JSON Schema
      
  MCPResource:
    fields:
      uri: String
      name: String
      mime_type: String
      description: String

  MCPPrompt:
    fields:
      name: String
      description: String
      arguments: List<String>

  MCPServer:
    fields:
      name: String
      version: String
      transport: String
      capabilities: List<String>
      tools: List<MCPTool>
      resources: List<MCPResource>

  MCPMessage:
    fields:
      jsonrpc: String  # "2.0"
      id: Int
      method: String
      params: String  # JSON

  MCPResponse:
    fields:
      jsonrpc: String
      id: Int
      result: String  # JSON
      error: Option<String>

  MCPConnector:
    fields:
      servers: List<MCPServer>
      active_server: Option<String>
      protocol_version: String
      transport: String

# === BUILT-IN MCP SERVERS ===
builtin_servers:
  - name: filesystem
    description: "File system operations"
    tools:
      - read_file
      - write_file
      - list_directory
      - search_files

  - name: git
    description: "Git operations"
    tools:
      - git_status
      - git_diff
      - git_log
      - git_commit

  - name: terminal
    description: "Terminal execution"
    tools:
      - run_command
      - get_output
      - kill_process

  - name: browser
    description: "Web browser control"
    tools:
      - navigate
      - screenshot
      - click
      - type_text

  - name: database
    description: "Database operations"
    tools:
      - query
      - execute
      - list_tables

# === MCP LIFECYCLE ===
lifecycle:
  states:
    - disconnected
    - connecting
    - initializing
    - ready
    - executing
    - error

  transitions:
    - from: disconnected
      to: connecting
      trigger: connect
    - from: connecting
      to: initializing
      trigger: handshake_complete
    - from: initializing
      to: ready
      trigger: capabilities_received
    - from: ready
      to: executing
      trigger: tool_call
    - from: executing
      to: ready
      trigger: tool_complete
    - from: any
      to: error
      trigger: error_occurred
    - from: error
      to: disconnected
      trigger: reset

# === BEHAVIORS ===
behaviors:
  - name: connect_server
    given: "Server configuration"
    when: "Connection requested"
    then: "Establish transport and handshake"
    
  - name: discover_tools
    given: "Connected server"
    when: "Initialization complete"
    then: "Return list of available tools"
    
  - name: call_tool
    given: "Tool name and arguments"
    when: "Tool execution requested"
    then: "Execute tool and return result"
    
  - name: list_resources
    given: "Connected server with resources capability"
    when: "Resource listing requested"
    then: "Return available resources"
    
  - name: read_resource
    given: "Resource URI"
    when: "Resource read requested"
    then: "Return resource content"

# === TEST CASES ===
test_cases:
  - name: connect_filesystem
    input: {server: "filesystem", transport: "stdio"}
    expected: {state: "ready", tools_count: 4}
    
  - name: call_read_file
    input: {tool: "read_file", args: {path: "test.txt"}}
    expected: {success: true}
    
  - name: discover_git_tools
    input: {server: "git"}
    expected: {tools: ["git_status", "git_diff", "git_log", "git_commit"]}

# === INTEGRATION WITH AGENTIC MODE ===
agentic_integration:
  tool_selection:
    description: "Agent selects appropriate MCP tool"
    flow:
      - agent_receives_task
      - agent_analyzes_requirements
      - agent_selects_mcp_server
      - agent_calls_tool
      - agent_processes_result
      
  context_sharing:
    description: "Share context between agent and MCP"
    data:
      - current_file
      - project_root
      - git_branch
      - environment_vars
