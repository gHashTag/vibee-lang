# Motion Control Service
# Replicate model: kwaivgi/kling-v2.6-motion-control
# Cost: $0.40 per 5 seconds

name: motion_control
version: "1.0.0"
language: zig
module: motion_control

description: |
  –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–≤–∏–∂–µ–Ω–∏—è–º–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –≤ –≤–∏–¥–µ–æ.
  –ú–æ–¥–µ–ª—å: kwaivgi/kling-v2.6-motion-control
  –ü–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–¥–∞–≤–∞—Ç—å –ø–æ–∑—ã, –∂–µ—Å—Ç—ã –∏ –≤—ã—Ä–∞–∂–µ–Ω–∏—è –ª–∏—Ü–∞.

imports:
  - replicate_client
  - pricing_system

constants:
  MODEL_ID: "kwaivgi/kling-v2.6-motion-control"
  BASE_COST_USD_5S: 0.40
  # stars = (0.40 / 0.016) * 1.5 = 37.5 -> 38 stars per 5s
  COST_STARS_5S: 38
  DEFAULT_DURATION: 5
  MAX_DURATION: 10

types:
  MotionType:
    description: "–¢–∏–ø –¥–≤–∏–∂–µ–Ω–∏—è"
    variants:
      - Pose          # –ü–æ–∑–∞ —Ç–µ–ª–∞
      - Gesture       # –ñ–µ—Å—Ç —Ä—É–∫–∞–º–∏
      - Expression    # –í—ã—Ä–∞–∂–µ–Ω–∏–µ –ª–∏—Ü–∞
      - Walk          # –•–æ–¥—å–±–∞
      - Dance         # –¢–∞–Ω–µ—Ü
      - Custom        # –ü—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ

  ControlMode:
    description: "–†–µ–∂–∏–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è"
    variants:
      - Skeleton      # –°–∫–µ–ª–µ—Ç–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è
      - Reference     # –ü–æ —Ä–µ—Ñ–µ—Ä–µ–Ω—Å–Ω–æ–º—É –≤–∏–¥–µ–æ
      - Text          # –ü–æ —Ç–µ–∫—Å—Ç–æ–≤–æ–º—É –æ–ø–∏—Å–∞–Ω–∏—é

  MotionControlRequest:
    description: "–ó–∞–ø—Ä–æ—Å –Ω–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–≤–∏–∂–µ–Ω–∏–µ–º"
    fields:
      image_url: String           # –ò—Å—Ö–æ–¥–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
      motion_prompt: String       # –û–ø–∏—Å–∞–Ω–∏–µ –¥–≤–∏–∂–µ–Ω–∏—è
      motion_type: MotionType
      control_mode: ControlMode
      reference_video: Option<String>  # –†–µ—Ñ–µ—Ä–µ–Ω—Å–Ω–æ–µ –≤–∏–¥–µ–æ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
      duration_seconds: Int
      telegram_id: String
      username: String

  MotionControlResponse:
    description: "–†–µ–∑—É–ª—å—Ç–∞—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏"
    fields:
      success: Bool
      video_url: Option<String>
      error: Option<String>
      duration_seconds: Int
      processing_time_ms: Int
      cost_stars: Int

  PosePreset:
    description: "–ü—Ä–µ—Å–µ—Ç –ø–æ–∑—ã"
    fields:
      name: String
      description: String
      prompt: String

behaviors:
  - name: generate_motion
    given: –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏ –æ–ø–∏—Å–∞–Ω–∏–µ –¥–≤–∏–∂–µ–Ω–∏—è
    when: –ó–∞–ø—Ä–æ—Å –Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é
    then: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤–∏–¥–µ–æ —Å –∞–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–º
    api_call: |
      replicate.run("kwaivgi/kling-v2.6-motion-control", {
        input: {
          image: image_url,
          prompt: motion_prompt,
          duration: duration_seconds
        }
      })

  - name: generate_from_reference
    given: –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏ —Ä–µ—Ñ–µ—Ä–µ–Ω—Å–Ω–æ–µ –≤–∏–¥–µ–æ
    when: –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–≤–∏–∂–µ–Ω–∏–π –∏–∑ —Ä–µ—Ñ–µ—Ä–µ–Ω—Å–∞
    then: –ü–µ—Ä—Å–æ–Ω–∞–∂ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç –¥–≤–∏–∂–µ–Ω–∏—è –∏–∑ —Ä–µ—Ñ–µ—Ä–µ–Ω—Å–∞

  - name: calculate_cost
    given: –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
    when: –†–∞—Å—á—ë—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏
    then: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤ –∑–≤—ë–∑–¥–∞—Ö
    formula: ceil(duration_seconds / 5) * COST_STARS_5S

  - name: get_pose_presets
    given: –Ø–∑—ã–∫
    when: –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø—Ä–µ—Å–µ—Ç–æ–≤
    then: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ø—Ä–µ—Å–µ—Ç–æ–≤ –ø–æ–∑

# UI Integration
menu_item:
  group: video
  position: 6
  icon: "üï∫"
  name:
    ru: "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–≤–∏–∂–µ–Ω–∏–µ–º"
    en: "Motion Control"
  description:
    ru: "–ê–Ω–∏–º–∞—Ü–∏—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ —Å –∫–æ–Ω—Ç—Ä–æ–ª–µ–º –ø–æ–∑"
    en: "Character animation with pose control"
  cost_stars: "38‚≠ê/5—Å–µ–∫"

# Wizard flow
wizard:
  steps:
    - name: upload_image
      prompt:
        ru: |
          üï∫ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–≤–∏–∂–µ–Ω–∏–µ–º
          
          –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ñ–æ—Ç–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏.
          
          –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
          ‚Ä¢ –ü–µ—Ä—Å–æ–Ω–∞–∂ –≤ –ø–æ–ª–Ω—ã–π —Ä–æ—Å—Ç
          ‚Ä¢ –•–æ—Ä–æ—à–µ–µ –æ—Å–≤–µ—â–µ–Ω–∏–µ
          ‚Ä¢ –ß—ë—Ç–∫–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
          
          üíé –°—Ç–æ–∏–º–æ—Å—Ç—å: 38 ‚≠ê –∑–∞ 5 —Å–µ–∫
        en: |
          üï∫ Motion Control
          
          Send a character photo for animation.
          
          Requirements:
          ‚Ä¢ Full body character
          ‚Ä¢ Good lighting
          ‚Ä¢ Clear image
          
          üíé Cost: 38 ‚≠ê per 5 sec

    - name: select_motion
      prompt:
        ru: "–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –¥–≤–∏–∂–µ–Ω–∏—è:"
        en: "Select motion type:"
      buttons:
        - text: "üö∂ –•–æ–¥—å–±–∞"
          callback: "motion_walk"
        - text: "üíÉ –¢–∞–Ω–µ—Ü"
          callback: "motion_dance"
        - text: "üëã –ñ–µ—Å—Ç"
          callback: "motion_gesture"
        - text: "üòä –í—ã—Ä–∞–∂–µ–Ω–∏–µ –ª–∏—Ü–∞"
          callback: "motion_expression"
        - text: "‚úçÔ∏è –°–≤–æ—ë –æ–ø–∏—Å–∞–Ω–∏–µ"
          callback: "motion_custom"

    - name: enter_prompt
      prompt:
        ru: "–û–ø–∏—à–∏—Ç–µ –∂–µ–ª–∞–µ–º–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ:"
        en: "Describe the desired motion:"
      condition: "motion_type == Custom"

    - name: select_duration
      prompt:
        ru: "–í—ã–±–µ—Ä–∏—Ç–µ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:"
        en: "Select duration:"
      buttons:
        - text: "5 —Å–µ–∫ (38‚≠ê)"
          callback: "motion_5s"
        - text: "10 —Å–µ–∫ (76‚≠ê)"
          callback: "motion_10s"

    - name: processing
      message:
        ru: "üé¨ –ì–µ–Ω–µ—Ä–∏—Ä—É—é –∞–Ω–∏–º–∞—Ü–∏—é... –≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å 2-3 –º–∏–Ω—É—Ç—ã"
        en: "üé¨ Generating animation... This may take 2-3 minutes"

    - name: result
      message:
        ru: "‚úÖ –ê–Ω–∏–º–∞—Ü–∏—è –≥–æ—Ç–æ–≤–∞!\n\n‚è± –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: {duration} —Å–µ–∫\nüíé –°—Ç–æ–∏–º–æ—Å—Ç—å: {cost} ‚≠ê"
        en: "‚úÖ Animation ready!\n\n‚è± Duration: {duration} sec\nüíé Cost: {cost} ‚≠ê"

# Motion presets
presets:
  walk_forward:
    ru: "–ü–µ—Ä—Å–æ–Ω–∞–∂ –∏–¥—ë—Ç –≤–ø–µ—Ä—ë–¥ —É–≤–µ—Ä–µ–Ω–Ω–æ–π –ø–æ—Ö–æ–¥–∫–æ–π"
    en: "Character walks forward confidently"
  wave_hello:
    ru: "–ü–µ—Ä—Å–æ–Ω–∞–∂ –º–∞—à–µ—Ç —Ä—É–∫–æ–π –≤ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–∏"
    en: "Character waves hello"
  dance_happy:
    ru: "–ü–µ—Ä—Å–æ–Ω–∞–∂ —Ç–∞–Ω—Ü—É–µ—Ç —Ä–∞–¥–æ—Å—Ç–Ω–æ"
    en: "Character dances happily"
  turn_around:
    ru: "–ü–µ—Ä—Å–æ–Ω–∞–∂ –ø–æ–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç—Å—è –Ω–∞ 360 –≥—Ä–∞–¥—É—Å–æ–≤"
    en: "Character turns 360 degrees"
  sit_down:
    ru: "–ü–µ—Ä—Å–æ–Ω–∞–∂ —Å–∞–¥–∏—Ç—Å—è –Ω–∞ —Å—Ç—É–ª"
    en: "Character sits down on a chair"
