name: lip_sync
version: "1.0.0"
language: zig
module: lip_sync

description: |
  Lip sync service for VIBEE Telegram bot.
  Synchronizes audio with video for realistic talking avatars.

imports:
  - replicate_client
  - user
  - telegram

types:
  LipSyncRequest:
    description: "Lip sync request"
    fields:
      video_url: String
      audio_url: String
      telegram_id: String
      model: Option<String>

  LipSyncResponse:
    description: "Lip sync response"
    fields:
      success: Bool
      video_url: Option<String>
      job_id: Option<String>
      error: Option<String>

  LipSyncModel:
    description: "Lip sync model options"
    variants:
      - Wav2Lip
      - SadTalker
      - SyncLabs

  LipSyncStatus:
    description: "Lip sync job status"
    variants:
      - Queued
      - Processing
      - Completed
      - Failed

behaviors:
  - name: generate_lip_sync
    given: LipSyncRequest
    when: Starting lip sync
    then: Returns LipSyncResponse

  - name: check_lip_sync_status
    given: Job ID
    when: Checking status
    then: Returns status info

  - name: validate_video_for_lip_sync
    given: Video URL
    when: Validating video
    then: Returns validation result

  - name: validate_audio_for_lip_sync
    given: Audio URL
    when: Validating audio
    then: Returns validation result

  - name: get_available_models
    given: No parameters
    when: Listing models
    then: Returns list of LipSyncModel

constants:
  DEFAULT_MODEL: "Wav2Lip"
  MAX_VIDEO_DURATION_SEC: 60
  MAX_AUDIO_DURATION_SEC: 60
  PROCESSING_TIMEOUT_MS: 300000
