# Video Upscaler Service
# Replicate model: philz1337x/crystal-video-upscaler
# Cost: $0.10 per second of video

name: video_upscaler
version: "1.0.0"
language: zig
module: video_upscaler

description: |
  –ê–ø—Å–∫–µ–π–ª –≤–∏–¥–µ–æ —Å –ø–æ–º–æ—â—å—é AI.
  –ú–æ–¥–µ–ª—å: philz1337x/crystal-video-upscaler
  –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–ª—è –ø–æ—Ä—Ç—Ä–µ—Ç–æ–≤, –ª–∏—Ü –∏ –ø—Ä–æ–¥—É–∫—Ç–æ–≤.
  –£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –¥–æ 4K.

imports:
  - replicate_client
  - pricing_system

constants:
  MODEL_ID: "philz1337x/crystal-video-upscaler"
  BASE_COST_USD_PER_SECOND: 0.10
  # stars = (0.10 / 0.016) * 1.5 = 9.375 -> 9 stars per second
  COST_STARS_PER_SECOND: 9
  MAX_VIDEO_DURATION: 60  # 60 seconds max
  MAX_FILE_SIZE_MB: 100
  SUPPORTED_FORMATS: ["mp4", "mov", "webm"]

types:
  UpscaleMode:
    description: "–†–µ–∂–∏–º –∞–ø—Å–∫–µ–π–ª–∞"
    variants:
      - Portrait    # –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–ª—è –ª–∏—Ü
      - Product     # –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–ª—è –ø—Ä–æ–¥—É–∫—Ç–æ–≤
      - General     # –û–±—â–∏–π —Ä–µ–∂–∏–º
      - Cinematic   # –ö–∏–Ω–µ–º–∞—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π

  UpscaleScale:
    description: "–ú–∞—Å—à—Ç–∞–± —É–≤–µ–ª–∏—á–µ–Ω–∏—è"
    variants:
      - X2   # 2x —É–≤–µ–ª–∏—á–µ–Ω–∏–µ
      - X4   # 4x —É–≤–µ–ª–∏—á–µ–Ω–∏–µ

  VideoUpscaleRequest:
    description: "–ó–∞–ø—Ä–æ—Å –Ω–∞ –∞–ø—Å–∫–µ–π–ª –≤–∏–¥–µ–æ"
    fields:
      video_url: String
      mode: UpscaleMode
      scale: UpscaleScale
      telegram_id: String
      username: String

  VideoUpscaleResponse:
    description: "–†–µ–∑—É–ª—å—Ç–∞—Ç –∞–ø—Å–∫–µ–π–ª–∞"
    fields:
      success: Bool
      result_url: Option<String>
      error: Option<String>
      original_duration: Float
      output_resolution: String
      processing_time_ms: Int
      cost_stars: Int

behaviors:
  - name: upscale_video
    given: URL –≤–∏–¥–µ–æ
    when: –ó–∞–ø—Ä–æ—Å –Ω–∞ –∞–ø—Å–∫–µ–π–ª
    then: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç URL –≤–∏–¥–µ–æ –≤ –≤—ã—Å–æ–∫–æ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–∏
    api_call: |
      replicate.run("philz1337x/crystal-video-upscaler", {
        input: {
          video: video_url,
          mode: mode,
          scale: scale
        }
      })

  - name: get_video_duration
    given: URL –≤–∏–¥–µ–æ
    when: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
    then: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤ —Å–µ–∫—É–Ω–¥–∞—Ö

  - name: calculate_cost
    given: –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤–∏–¥–µ–æ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
    when: –†–∞—Å—á—ë—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏
    then: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤ –∑–≤—ë–∑–¥–∞—Ö
    formula: ceil(duration_seconds) * COST_STARS_PER_SECOND

  - name: validate_video
    given: URL –≤–∏–¥–µ–æ
    when: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π
    then: –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ñ–æ—Ä–º–∞—Ç, —Ä–∞–∑–º–µ—Ä –∏ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

# UI Integration
menu_item:
  group: video
  position: 5
  icon: "üìπ"
  name:
    ru: "–ê–ø—Å–∫–µ–π–ª –≤–∏–¥–µ–æ"
    en: "Video Upscaler"
  description:
    ru: "–£–≤–µ–ª–∏—á–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞ –≤–∏–¥–µ–æ –¥–æ 4K"
    en: "Upscale video quality to 4K"
  cost_stars: "9‚≠ê/—Å–µ–∫"

# Wizard flow
wizard:
  steps:
    - name: upload_video
      prompt:
        ru: |
          üìπ –ê–ø—Å–∫–µ–π–ª –≤–∏–¥–µ–æ
          
          –û—Ç–ø—Ä–∞–≤—å—Ç–µ –≤–∏–¥–µ–æ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞.
          
          –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:
          ‚Ä¢ –ú–∞–∫—Å. –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: 60 —Å–µ–∫
          ‚Ä¢ –ú–∞–∫—Å. —Ä–∞–∑–º–µ—Ä: 100 –ú–ë
          ‚Ä¢ –§–æ—Ä–º–∞—Ç—ã: MP4, MOV, WebM
          
          üíé –°—Ç–æ–∏–º–æ—Å—Ç—å: 9 ‚≠ê –∑–∞ —Å–µ–∫—É–Ω–¥—É
        en: |
          üìπ Video Upscaler
          
          Send a video to enhance quality.
          
          Limits:
          ‚Ä¢ Max duration: 60 sec
          ‚Ä¢ Max size: 100 MB
          ‚Ä¢ Formats: MP4, MOV, WebM
          
          üíé Cost: 9 ‚≠ê per second

    - name: select_mode
      prompt:
        ru: "–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º –∞–ø—Å–∫–µ–π–ª–∞:"
        en: "Select upscale mode:"
      buttons:
        - text: "üë§ –ü–æ—Ä—Ç—Ä–µ—Ç (–ª–∏—Ü–∞)"
          callback: "upscale_portrait"
        - text: "üì¶ –ü—Ä–æ–¥—É–∫—Ç"
          callback: "upscale_product"
        - text: "üé¨ –ö–∏–Ω–µ–º–∞—Ç–æ–≥—Ä–∞—Ñ"
          callback: "upscale_cinematic"
        - text: "üîÑ –û–±—â–∏–π"
          callback: "upscale_general"

    - name: confirm_cost
      prompt:
        ru: |
          üìä –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–∏–¥–µ–æ:
          ‚Ä¢ –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: {duration} —Å–µ–∫
          ‚Ä¢ –°—Ç–æ–∏–º–æ—Å—Ç—å: {cost} ‚≠ê
          
          –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?
        en: |
          üìä Video info:
          ‚Ä¢ Duration: {duration} sec
          ‚Ä¢ Cost: {cost} ‚≠ê
          
          Continue?

    - name: processing
      message:
        ru: "‚è≥ –£–ª—É—á—à–∞—é –∫–∞—á–µ—Å—Ç–≤–æ –≤–∏–¥–µ–æ... –≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç"
        en: "‚è≥ Enhancing video quality... This may take several minutes"

    - name: result
      message:
        ru: "‚úÖ –í–∏–¥–µ–æ —É–ª—É—á—à–µ–Ω–æ!\n\nüìê –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ: {resolution}\nüíé –°—Ç–æ–∏–º–æ—Å—Ç—å: {cost} ‚≠ê"
        en: "‚úÖ Video enhanced!\n\nüìê Resolution: {resolution}\nüíé Cost: {cost} ‚≠ê"
