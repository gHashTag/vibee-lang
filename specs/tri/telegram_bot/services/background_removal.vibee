# Background Removal Service
# Replicate model: lucataco/remove-bg
# Cost: $0.01 per image

name: background_removal
version: "1.0.0"
language: zig
module: background_removal

description: |
  –£–¥–∞–ª–µ–Ω–∏–µ —Ñ–æ–Ω–∞ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Å –ø–æ–º–æ—â—å—é AI.
  –ú–æ–¥–µ–ª—å: lucataco/remove-bg
  –ò—Å–ø–æ–ª—å–∑—É–µ—Ç U2-Net –¥–ª—è —Ç–æ—á–Ω–æ–π —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏.

imports:
  - replicate_client
  - pricing_system

constants:
  MODEL_ID: "lucataco/remove-bg"
  MODEL_VERSION: "95fcc2a26d3899cd6c2691c900465aaeff466285a65c14638cc5f36f34befaf1"
  # Real price from Replicate: $0.00052 per run (~1923 runs per $1)
  BASE_COST_USD: 0.00052
  # stars = (0.00052 / 0.016) * 1.5 = 0.049 -> 1 star (minimum)
  COST_STARS: 1

types:
  BackgroundRemovalRequest:
    description: "–ó–∞–ø—Ä–æ—Å –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ —Ñ–æ–Ω–∞"
    fields:
      image_url: String
      telegram_id: String
      username: String

  BackgroundRemovalResponse:
    description: "–†–µ–∑—É–ª—å—Ç–∞—Ç —É–¥–∞–ª–µ–Ω–∏—è —Ñ–æ–Ω–∞"
    fields:
      success: Bool
      result_url: Option<String>
      error: Option<String>
      processing_time_ms: Int
      cost_stars: Int

  OutputFormat:
    description: "–§–æ—Ä–º–∞—Ç –≤—ã—Ö–æ–¥–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è"
    variants:
      - PNG   # –° –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å—é
      - WEBP  # –° –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å—é, –º–µ–Ω—å—à–µ —Ä–∞–∑–º–µ—Ä

behaviors:
  - name: remove_background
    given: URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    when: –ó–∞–ø—Ä–æ—Å –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ —Ñ–æ–Ω–∞
    then: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –±–µ–∑ —Ñ–æ–Ω–∞ (PNG —Å –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å—é)
    api_call: |
      replicate.run("lucataco/remove-bg", {
        input: { image: image_url }
      })

  - name: remove_background_with_options
    given: URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏ –æ–ø—Ü–∏–∏
    when: –ó–∞–ø—Ä–æ—Å —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
    then: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å —É—á—ë—Ç–æ–º –æ–ø—Ü–∏–π

  - name: validate_image
    given: URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    when: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π
    then: –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∏ —Ñ–æ—Ä–º–∞—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

  - name: get_cost
    given: –ù–∏—á–µ–≥–æ
    when: –ó–∞–ø—Ä–æ—Å —Å—Ç–æ–∏–º–æ—Å—Ç–∏
    then: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç 1 star (–º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞)

# UI Integration
menu_item:
  group: photo
  position: 5
  icon: "üñºÔ∏è"
  name:
    ru: "–£–¥–∞–ª–∏—Ç—å —Ñ–æ–Ω"
    en: "Remove Background"
  description:
    ru: "–£–¥–∞–ª–µ–Ω–∏–µ —Ñ–æ–Ω–∞ —Å —Ñ–æ—Ç–æ (PNG —Å –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å—é)"
    en: "Remove background from photo (PNG with transparency)"
  cost_stars: 1

# Wizard flow
wizard:
  steps:
    - name: upload_image
      prompt:
        ru: "üñºÔ∏è –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ñ–æ—Ç–æ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —Ñ–æ–Ω–∞\n\nüíé –°—Ç–æ–∏–º–æ—Å—Ç—å: 1 ‚≠ê"
        en: "üñºÔ∏è Send a photo to remove background\n\nüíé Cost: 1 ‚≠ê"
    - name: processing
      message:
        ru: "‚è≥ –£–¥–∞–ª—è—é —Ñ–æ–Ω..."
        en: "‚è≥ Removing background..."
    - name: result
      message:
        ru: "‚úÖ –§–æ–Ω —É–¥–∞–ª—ë–Ω!\n\nüì• –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ PNG —Å –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å—é"
        en: "‚úÖ Background removed!\n\nüì• Image in PNG format with transparency"
