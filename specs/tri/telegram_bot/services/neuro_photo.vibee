name: neuro_photo
version: "1.0.0"
language: zig
module: neuro_photo

description: |
  Neuro photo generation service for VIBEE Telegram bot.
  Handles AI image generation using trained user models.

imports:
  - replicate_client
  - user
  - telegram

types:
  NeuroPhotoRequest:
    description: "Neuro photo generation request"
    fields:
      prompt: String
      model_url: String
      num_images: Int
      telegram_id: String
      bot_name: String
      aspect_ratio: Option<String>

  NeuroPhotoResponse:
    description: "Neuro photo generation response"
    fields:
      success: Bool
      data: Option<String>
      urls: Option<List<String>>
      error: Option<String>

  AspectRatio:
    description: "Image aspect ratio"
    variants:
      - Square_1_1
      - Portrait_9_16
      - Landscape_16_9
      - Portrait_3_4
      - Landscape_4_3

  GenerationStatus:
    description: "Generation status"
    variants:
      - Pending
      - Processing
      - Completed
      - Failed

  GenerationRecord:
    description: "Generation record in database"
    fields:
      id: String
      user_id: String
      prompt: String
      model_url: String
      status: GenerationStatus
      result_urls: Option<List<String>>
      created_at: Timestamp
      completed_at: Option<Timestamp>

behaviors:
  - name: generate_neuro_photo
    given: NeuroPhotoRequest
    when: Generating image
    then: Returns NeuroPhotoResponse

  - name: generate_neuro_photo_hybrid
    given: NeuroPhotoRequest with fallback
    when: Generating with fallback providers
    then: Returns NeuroPhotoResponse

  - name: generate_neuro_photo_direct
    given: NeuroPhotoRequest
    when: Direct generation without server
    then: Returns NeuroPhotoResponse

  - name: validate_prompt
    given: Prompt string
    when: Validating input
    then: Returns validation result

  - name: get_aspect_ratio_dimensions
    given: AspectRatio
    when: Getting dimensions
    then: Returns width and height

  - name: save_generation_record
    given: Generation data
    when: Saving to database
    then: Returns GenerationRecord

  - name: get_user_generations
    given: User ID
    when: Fetching history
    then: Returns list of GenerationRecord

  - name: increment_generation_count
    given: User ID
    when: Updating stats
    then: Returns new count

constants:
  DEFAULT_NUM_IMAGES: 1
  MAX_NUM_IMAGES: 4
  DEFAULT_ASPECT_RATIO: "1:1"
  GENERATION_TIMEOUT_MS: 120000
