name: text_to_video
version: "1.0.0"
language: zig
module: text_to_video

description: |
  Text-to-video generation service for VIBEE Telegram bot.
  Handles video generation from text prompts using various AI models.

imports:
  - replicate_client
  - user
  - telegram

types:
  VideoModelId:
    description: "Video model identifiers"
    variants:
      - KlingV1_6Pro
      - RayV2
      - Veo3
      - Veo3Fast
      - RunwayAleph
      - MinimaxVideo
      - HaiperVideo

  TextToVideoRequest:
    description: "Text-to-video request"
    fields:
      prompt: String
      video_model: VideoModelId
      aspect_ratio: Option<String>
      duration: Option<Int>
      telegram_id: String
      username: String
      is_ru: Bool
      bot_name: String

  TextToVideoResponse:
    description: "Text-to-video response"
    fields:
      success: Bool
      video_url: Option<String>
      job_id: Option<String>
      message: Option<String>
      error: Option<String>

  VideoGenerationStatus:
    description: "Video generation status"
    variants:
      - Queued
      - Processing
      - Completed
      - Failed

  VideoJobInfo:
    description: "Video job information"
    fields:
      job_id: String
      status: VideoGenerationStatus
      progress: Option<Int>
      video_url: Option<String>
      error: Option<String>

  VideoModelConfig:
    description: "Video model configuration"
    fields:
      id: VideoModelId
      name: String
      provider: String
      max_duration: Int
      supported_ratios: List<String>
      cost_per_second: Float

behaviors:
  - name: generate_text_to_video
    given: TextToVideoRequest
    when: Starting video generation
    then: Returns TextToVideoResponse

  - name: check_video_status
    given: Job ID
    when: Checking generation status
    then: Returns VideoJobInfo

  - name: get_video_model_config
    given: VideoModelId
    when: Getting model info
    then: Returns VideoModelConfig

  - name: validate_video_request
    given: TextToVideoRequest
    when: Validating request
    then: Returns validation result

  - name: estimate_video_cost
    given: Model ID and duration
    when: Estimating cost
    then: Returns cost in stars

  - name: cancel_video_generation
    given: Job ID
    when: Canceling generation
    then: Returns success status

  - name: save_video_to_storage
    given: Video URL and user ID
    when: Storing video
    then: Returns storage URL

constants:
  DEFAULT_DURATION: 5
  MAX_DURATION: 60
  DEFAULT_ASPECT_RATIO: "16:9"
  GENERATION_TIMEOUT_MS: 600000
