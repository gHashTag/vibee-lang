name: model_registry
version: "1.0.0"
language: zig
module: model_registry

description: |
  AI model registry for VIBEE Telegram bot.
  Centralized catalog of all AI models with metadata, pricing, capabilities.
  Supports model selection, versioning, A/B testing.

# ═══════════════════════════════════════════════════════════════════════════════
# TYPES
# ═══════════════════════════════════════════════════════════════════════════════

types:
  ModelInfo:
    description: "Complete model information"
    fields:
      model_id: String
      name: String
      display_name: String
      description: String
      provider: AIProvider
      category: ModelCategory
      capabilities: List<Capability>
      input_types: List<InputType>
      output_types: List<OutputType>
      pricing: ModelPricing
      limits: ModelLimits
      quality: QualityTier
      speed: SpeedTier
      status: ModelStatus
      version: String
      created_at: Timestamp
      updated_at: Timestamp
      metadata: Object

  AIProvider:
    description: "AI service provider"
    values:
      - replicate
      - openai
      - stability
      - runway
      - elevenlabs
      - anthropic
      - google
      - local

  ModelCategory:
    description: "Model category"
    values:
      - image_generation
      - image_editing
      - image_upscaling
      - video_generation
      - video_editing
      - audio_generation
      - audio_transcription
      - text_generation
      - embedding
      - moderation
      - vision
      - multimodal

  Capability:
    description: "Model capability"
    values:
      - text_to_image
      - image_to_image
      - inpainting
      - outpainting
      - upscaling
      - style_transfer
      - face_swap
      - face_restore
      - background_removal
      - image_to_video
      - text_to_video
      - video_upscaling
      - lip_sync
      - motion_transfer
      - text_to_speech
      - speech_to_text
      - voice_cloning
      - music_generation
      - chat
      - completion
      - function_calling
      - vision_analysis
      - embedding_generation

  InputType:
    description: "Supported input types"
    values:
      - text
      - image
      - video
      - audio
      - file

  OutputType:
    description: "Output types"
    values:
      - image
      - video
      - audio
      - text
      - json
      - embedding

  ModelPricing:
    description: "Model pricing"
    fields:
      cost_per_generation: Int
      cost_per_second: Option<Int>
      cost_per_token: Option<Float>
      cost_per_image: Option<Int>
      minimum_cost: Int
      currency: String

  ModelLimits:
    description: "Model limits"
    fields:
      max_prompt_length: Int
      max_output_length: Option<Int>
      max_image_size: Option<Int>
      max_video_duration: Option<Int>
      max_audio_duration: Option<Int>
      supported_resolutions: List<String>
      supported_aspect_ratios: List<String>
      max_batch_size: Int

  QualityTier:
    description: "Quality tier"
    values:
      - draft
      - standard
      - high
      - ultra

  SpeedTier:
    description: "Speed tier"
    values:
      - instant
      - fast
      - normal
      - slow

  ModelStatus:
    description: "Model status"
    values:
      - active
      - deprecated
      - beta
      - maintenance
      - disabled

  ModelVersion:
    description: "Model version info"
    fields:
      version_id: String
      model_id: String
      version: String
      replicate_version: Option<String>
      is_default: Bool
      is_stable: Bool
      release_date: Timestamp
      changelog: Option<String>

  ModelFilter:
    description: "Filter for querying models"
    fields:
      provider: Option<AIProvider>
      category: Option<ModelCategory>
      capability: Option<Capability>
      quality: Option<QualityTier>
      speed: Option<SpeedTier>
      status: Option<ModelStatus>
      max_cost: Option<Int>
      search: Option<String>

  ModelComparison:
    description: "Model comparison result"
    fields:
      models: List<ModelInfo>
      comparison_criteria: List<String>
      scores: Object
      recommendation: String

  ModelUsageStats:
    description: "Model usage statistics"
    fields:
      model_id: String
      total_generations: Int
      success_rate: Float
      avg_generation_time_ms: Int
      total_cost_stars: Int
      popularity_rank: Int
      user_rating: Float

  ABTestConfig:
    description: "A/B test configuration"
    fields:
      test_id: String
      name: String
      models: List<String>
      weights: List<Int>
      start_date: Timestamp
      end_date: Option<Timestamp>
      is_active: Bool

  ABTestResult:
    description: "A/B test result"
    fields:
      test_id: String
      model_id: String
      impressions: Int
      conversions: Int
      avg_rating: Float
      avg_time_ms: Int

  ModelRecommendation:
    description: "Model recommendation"
    fields:
      model_id: String
      score: Float
      reason: String
      alternatives: List<String>

# ═══════════════════════════════════════════════════════════════════════════════
# BEHAVIORS
# ═══════════════════════════════════════════════════════════════════════════════

behaviors:
  # ─────────────────────────────────────────────────────────────────────────────
  # MODEL REGISTRY
  # ─────────────────────────────────────────────────────────────────────────────

  - name: register_model
    given: ModelInfo
    when: Adding new model
    then: Store in registry

  - name: update_model
    given: Model ID and updates
    when: Updating model info
    then: Update registry

  - name: deprecate_model
    given: Model ID
    when: Deprecating model
    then: Mark as deprecated

  - name: disable_model
    given: Model ID
    when: Disabling model
    then: Mark as disabled

  - name: enable_model
    given: Model ID
    when: Enabling model
    then: Mark as active

  - name: delete_model
    given: Model ID
    when: Removing model
    then: Remove from registry

  # ─────────────────────────────────────────────────────────────────────────────
  # MODEL QUERIES
  # ─────────────────────────────────────────────────────────────────────────────

  - name: get_model
    given: Model ID
    when: Getting model info
    then: Return ModelInfo or null

  - name: get_model_by_name
    given: Model name
    when: Finding by name
    then: Return ModelInfo or null

  - name: list_models
    given: Optional filter
    when: Listing models
    then: Return list of models

  - name: find_models
    given: ModelFilter
    when: Searching models
    then: Return filtered list

  - name: count_models
    given: ModelFilter
    when: Counting models
    then: Return count

  - name: get_models_by_category
    given: ModelCategory
    when: Getting by category
    then: Return list of models

  - name: get_models_by_provider
    given: AIProvider
    when: Getting by provider
    then: Return list of models

  - name: get_models_by_capability
    given: Capability
    when: Getting by capability
    then: Return list of models

  # ─────────────────────────────────────────────────────────────────────────────
  # MODEL SELECTION
  # ─────────────────────────────────────────────────────────────────────────────

  - name: select_model
    given: Category and requirements
    when: Selecting best model
    then: Return ModelRecommendation

  - name: select_fastest_model
    given: Category
    when: Selecting fastest
    then: Return model ID

  - name: select_cheapest_model
    given: Category
    when: Selecting cheapest
    then: Return model ID

  - name: select_best_quality_model
    given: Category
    when: Selecting best quality
    then: Return model ID

  - name: select_balanced_model
    given: Category
    when: Selecting balanced
    then: Return model ID

  - name: get_default_model
    given: Category
    when: Getting default
    then: Return model ID

  - name: set_default_model
    given: Category and model ID
    when: Setting default
    then: Update default

  # ─────────────────────────────────────────────────────────────────────────────
  # MODEL VERSIONS
  # ─────────────────────────────────────────────────────────────────────────────

  - name: add_version
    given: ModelVersion
    when: Adding version
    then: Store version

  - name: get_versions
    given: Model ID
    when: Getting versions
    then: Return list of versions

  - name: get_latest_version
    given: Model ID
    when: Getting latest
    then: Return version string

  - name: get_stable_version
    given: Model ID
    when: Getting stable
    then: Return stable version

  - name: set_default_version
    given: Model ID and version
    when: Setting default version
    then: Update default

  - name: get_replicate_version
    given: Model ID
    when: Getting Replicate version
    then: Return version hash

  # ─────────────────────────────────────────────────────────────────────────────
  # PRICING
  # ─────────────────────────────────────────────────────────────────────────────

  - name: get_pricing
    given: Model ID
    when: Getting pricing
    then: Return ModelPricing

  - name: update_pricing
    given: Model ID and pricing
    when: Updating pricing
    then: Update pricing

  - name: calculate_cost
    given: Model ID and parameters
    when: Calculating cost
    then: Return cost in stars

  - name: compare_pricing
    given: List of model IDs
    when: Comparing prices
    then: Return comparison

  - name: get_cheapest_for_task
    given: Task type and quality
    when: Finding cheapest
    then: Return model ID and cost

  # ─────────────────────────────────────────────────────────────────────────────
  # USAGE STATISTICS
  # ─────────────────────────────────────────────────────────────────────────────

  - name: record_usage
    given: Model ID and result
    when: Recording usage
    then: Update statistics

  - name: get_usage_stats
    given: Model ID
    when: Getting stats
    then: Return ModelUsageStats

  - name: get_popular_models
    given: Category and limit
    when: Getting popular
    then: Return ranked list

  - name: get_trending_models
    given: Time period
    when: Getting trending
    then: Return trending list

  - name: get_model_rating
    given: Model ID
    when: Getting rating
    then: Return average rating

  - name: rate_model
    given: Model ID, user, rating
    when: Rating model
    then: Update rating

  # ─────────────────────────────────────────────────────────────────────────────
  # A/B TESTING
  # ─────────────────────────────────────────────────────────────────────────────

  - name: create_ab_test
    given: ABTestConfig
    when: Creating test
    then: Store test config

  - name: get_ab_test_model
    given: Test ID
    when: Getting test model
    then: Return selected model ID

  - name: record_ab_impression
    given: Test ID and model ID
    when: Recording impression
    then: Update stats

  - name: record_ab_conversion
    given: Test ID, model ID, rating
    when: Recording conversion
    then: Update stats

  - name: get_ab_results
    given: Test ID
    when: Getting results
    then: Return ABTestResult list

  - name: end_ab_test
    given: Test ID
    when: Ending test
    then: Mark as inactive

  # ─────────────────────────────────────────────────────────────────────────────
  # MODEL COMPARISON
  # ─────────────────────────────────────────────────────────────────────────────

  - name: compare_models
    given: List of model IDs
    when: Comparing models
    then: Return ModelComparison

  - name: get_alternatives
    given: Model ID
    when: Finding alternatives
    then: Return similar models

  - name: get_upgrade_path
    given: Model ID
    when: Finding upgrade
    then: Return better model

  - name: get_downgrade_path
    given: Model ID
    when: Finding cheaper
    then: Return cheaper model

  # ─────────────────────────────────────────────────────────────────────────────
  # CAPABILITIES
  # ─────────────────────────────────────────────────────────────────────────────

  - name: has_capability
    given: Model ID and capability
    when: Checking capability
    then: Return true if supported

  - name: get_capabilities
    given: Model ID
    when: Getting capabilities
    then: Return list of capabilities

  - name: supports_input_type
    given: Model ID and input type
    when: Checking input
    then: Return true if supported

  - name: supports_output_type
    given: Model ID and output type
    when: Checking output
    then: Return true if supported

  - name: get_supported_resolutions
    given: Model ID
    when: Getting resolutions
    then: Return list of resolutions

  - name: get_supported_aspect_ratios
    given: Model ID
    when: Getting ratios
    then: Return list of ratios

# ═══════════════════════════════════════════════════════════════════════════════
# CONSTANTS
# ═══════════════════════════════════════════════════════════════════════════════

constants:
  # Image Generation Models
  MODEL_FLUX_PRO: "flux-pro"
  MODEL_FLUX_DEV: "flux-dev"
  MODEL_FLUX_SCHNELL: "flux-schnell"
  MODEL_SDXL: "sdxl"
  MODEL_SD3: "stable-diffusion-3"
  MODEL_DALL_E_3: "dall-e-3"
  MODEL_MIDJOURNEY: "midjourney"

  # Video Generation Models
  MODEL_KLING: "kling"
  MODEL_RUNWAY_GEN3: "runway-gen3"
  MODEL_LUMA: "luma-dream-machine"
  MODEL_SVD: "stable-video-diffusion"
  MODEL_PIKA: "pika"

  # Audio Models
  MODEL_WHISPER: "whisper"
  MODEL_TTS_1: "tts-1"
  MODEL_TTS_1_HD: "tts-1-hd"
  MODEL_ELEVENLABS: "elevenlabs"

  # Chat Models
  MODEL_GPT_4O: "gpt-4o"
  MODEL_GPT_4O_MINI: "gpt-4o-mini"
  MODEL_CLAUDE_3_5: "claude-3.5-sonnet"

  # Default costs (stars)
  COST_IMAGE_STANDARD: 5
  COST_IMAGE_HD: 10
  COST_VIDEO_SHORT: 20
  COST_VIDEO_LONG: 50
  COST_AUDIO_TTS: 2
  COST_AUDIO_STT: 3

  # Quality multipliers
  QUALITY_DRAFT_MULT: 0.5
  QUALITY_STANDARD_MULT: 1.0
  QUALITY_HIGH_MULT: 1.5
  QUALITY_ULTRA_MULT: 2.0
