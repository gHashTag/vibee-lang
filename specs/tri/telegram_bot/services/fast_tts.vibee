# Fast Text-to-Speech Service
# Replicate model: resemble-ai/chatterbox-turbo
# Cost: $0.02 per 1000 characters

name: fast_tts
version: "1.0.0"
language: zig
module: fast_tts

description: |
  –ë—ã—Å—Ç—Ä—ã–π Text-to-Speech —Å –ø–æ–º–æ—â—å—é AI.
  –ú–æ–¥–µ–ª—å: resemble-ai/chatterbox-turbo
  –°–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π open source TTS –±–µ–∑ –ø–æ—Ç–µ—Ä–∏ –∫–∞—á–µ—Å—Ç–≤–∞.
  –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≥–æ–ª–æ—Å–∞.

imports:
  - replicate_client
  - pricing_system

constants:
  MODEL_ID: "resemble-ai/chatterbox-turbo"
  BASE_COST_USD_1000_CHARS: 0.02
  # stars = (0.02 / 0.016) * 1.5 = 1.875 -> 2 stars per 1000 chars
  COST_STARS_1000_CHARS: 2
  MAX_TEXT_LENGTH: 5000
  MIN_TEXT_LENGTH: 10

types:
  VoiceStyle:
    description: "–°—Ç–∏–ª—å –≥–æ–ª–æ—Å–∞"
    variants:
      - Neutral       # –ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π
      - Happy         # –†–∞–¥–æ—Å—Ç–Ω—ã–π
      - Sad           # –ì—Ä—É—Å—Ç–Ω—ã–π
      - Angry         # –ó–ª–æ–π
      - Whisper       # –®—ë–ø–æ—Ç
      - Excited       # –í–æ–∑–±—É–∂–¥—ë–Ω–Ω—ã–π

  VoiceGender:
    description: "–ü–æ–ª –≥–æ–ª–æ—Å–∞"
    variants:
      - Male
      - Female

  FastTTSRequest:
    description: "–ó–∞–ø—Ä–æ—Å –Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é —Ä–µ—á–∏"
    fields:
      text: String
      voice_style: VoiceStyle
      voice_gender: VoiceGender
      speed: Float              # 0.5 - 2.0
      reference_audio: Option<String>  # –î–ª—è –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
      telegram_id: String
      username: String

  FastTTSResponse:
    description: "–†–µ–∑—É–ª—å—Ç–∞—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏"
    fields:
      success: Bool
      audio_url: Option<String>
      error: Option<String>
      duration_seconds: Float
      characters_count: Int
      processing_time_ms: Int
      cost_stars: Int

behaviors:
  - name: generate_speech
    given: –¢–µ–∫—Å—Ç –¥–ª—è –æ–∑–≤—É—á–∫–∏
    when: –ó–∞–ø—Ä–æ—Å –Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é
    then: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç URL –∞—É–¥–∏–æ—Ñ–∞–π–ª–∞
    api_call: |
      replicate.run("resemble-ai/chatterbox-turbo", {
        input: {
          text: text,
          voice_style: voice_style,
          speed: speed
        }
      })

  - name: clone_voice
    given: –¢–µ–∫—Å—Ç –∏ —Ä–µ—Ñ–µ—Ä–µ–Ω—Å–Ω–æ–µ –∞—É–¥–∏–æ
    when: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –≥–æ–ª–æ—Å–æ–º
    then: –û–∑–≤—É—á–∏–≤–∞–µ—Ç —Ç–µ–∫—Å—Ç –≥–æ–ª–æ—Å–æ–º –∏–∑ —Ä–µ—Ñ–µ—Ä–µ–Ω—Å–∞

  - name: calculate_cost
    given: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–∏–º–≤–æ–ª–æ–≤
    when: –†–∞—Å—á—ë—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏
    then: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤ –∑–≤—ë–∑–¥–∞—Ö
    formula: ceil(char_count / 1000) * COST_STARS_1000_CHARS

  - name: validate_text
    given: –¢–µ–∫—Å—Ç
    when: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π
    then: –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–ª–∏–Ω—É –∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ç–µ–∫—Å—Ç–∞

# UI Integration
menu_item:
  group: audio
  position: 2
  icon: "üó£Ô∏è"
  name:
    ru: "–ë—ã—Å—Ç—Ä—ã–π TTS"
    en: "Fast TTS"
  description:
    ru: "–û–∑–≤—É—á–∫–∞ —Ç–µ–∫—Å—Ç–∞ (–±—ã—Å—Ç—Ä–µ–µ ElevenLabs)"
    en: "Text to speech (faster than ElevenLabs)"
  cost_stars: "2‚≠ê/1000 —Å–∏–º–≤–æ–ª–æ–≤"

# Wizard flow
wizard:
  steps:
    - name: enter_text
      prompt:
        ru: |
          üó£Ô∏è –ë—ã—Å—Ç—Ä—ã–π Text-to-Speech
          
          –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è –æ–∑–≤—É—á–∫–∏.
          
          –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:
          ‚Ä¢ –ú–∞–∫—Å. 5000 —Å–∏–º–≤–æ–ª–æ–≤
          ‚Ä¢ –ú–∏–Ω. 10 —Å–∏–º–≤–æ–ª–æ–≤
          
          üíé –°—Ç–æ–∏–º–æ—Å—Ç—å: 2 ‚≠ê –∑–∞ 1000 —Å–∏–º–≤–æ–ª–æ–≤
        en: |
          üó£Ô∏è Fast Text-to-Speech
          
          Send text to convert to speech.
          
          Limits:
          ‚Ä¢ Max 5000 characters
          ‚Ä¢ Min 10 characters
          
          üíé Cost: 2 ‚≠ê per 1000 characters

    - name: select_voice
      prompt:
        ru: "–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ–ª–æ—Å:"
        en: "Select voice:"
      buttons:
        - text: "üë® –ú—É–∂—Å–∫–æ–π"
          callback: "tts_male"
        - text: "üë© –ñ–µ–Ω—Å–∫–∏–π"
          callback: "tts_female"

    - name: select_style
      prompt:
        ru: "–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç–∏–ª—å:"
        en: "Select style:"
      buttons:
        - text: "üòê –ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π"
          callback: "tts_neutral"
        - text: "üòä –†–∞–¥–æ—Å—Ç–Ω—ã–π"
          callback: "tts_happy"
        - text: "üò¢ –ì—Ä—É—Å—Ç–Ω—ã–π"
          callback: "tts_sad"
        - text: "ü§´ –®—ë–ø–æ—Ç"
          callback: "tts_whisper"

    - name: processing
      message:
        ru: "üéôÔ∏è –ì–µ–Ω–µ—Ä–∏—Ä—É—é –∞—É–¥–∏–æ..."
        en: "üéôÔ∏è Generating audio..."

    - name: result
      message:
        ru: "‚úÖ –ê—É–¥–∏–æ –≥–æ—Ç–æ–≤–æ!\n\nüìù –°–∏–º–≤–æ–ª–æ–≤: {chars}\n‚è± –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: {duration} —Å–µ–∫\nüíé –°—Ç–æ–∏–º–æ—Å—Ç—å: {cost} ‚≠ê"
        en: "‚úÖ Audio ready!\n\nüìù Characters: {chars}\n‚è± Duration: {duration} sec\nüíé Cost: {cost} ‚≠ê"

# Voice clone feature
voice_clone:
  enabled: true
  min_reference_duration: 10  # seconds
  max_reference_duration: 60  # seconds
  prompt:
    ru: |
      üé§ –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≥–æ–ª–æ—Å–∞
      
      –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∞—É–¥–∏–æ —Å –≥–æ–ª–æ—Å–æ–º –¥–ª—è –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è.
      
      –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
      ‚Ä¢ –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: 10-60 —Å–µ–∫
      ‚Ä¢ –ß–∏—Å—Ç–∞—è –∑–∞–ø–∏—Å—å –±–µ–∑ —à—É–º–∞
      ‚Ä¢ –û–¥–∏–Ω –≥–æ–ª–æ—Å
    en: |
      üé§ Voice Cloning
      
      Send audio with voice to clone.
      
      Requirements:
      ‚Ä¢ Duration: 10-60 sec
      ‚Ä¢ Clean recording without noise
      ‚Ä¢ Single voice
