name: text_to_speech
version: "1.0.0"
language: zig
module: text_to_speech

description: |
  Text-to-speech service for VIBEE Telegram bot.
  Handles voice synthesis using ElevenLabs API.

imports:
  - elevenlabs_client
  - user
  - telegram

types:
  TextToSpeechRequest:
    description: "TTS request"
    fields:
      text: String
      voice_id: String
      telegram_id: Int
      username: String
      is_ru: Bool
      bot_name: String

  TextToSpeechResponse:
    description: "TTS response"
    fields:
      success: Bool
      audio_url: Option<String>
      message: Option<String>
      error: Option<String>

  VoiceOption:
    description: "Available voice option"
    fields:
      id: String
      name: String
      language: String
      gender: String
      preview_url: Option<String>

  VoiceSettings:
    description: "Voice generation settings"
    fields:
      stability: Float
      similarity_boost: Float
      style: Float
      use_speaker_boost: Bool

behaviors:
  - name: generate_text_to_speech
    given: TextToSpeechRequest
    when: Generating speech
    then: Returns TextToSpeechResponse

  - name: get_available_voices
    given: Language filter
    when: Listing voices
    then: Returns list of VoiceOption

  - name: get_user_voice
    given: User ID
    when: Fetching user's selected voice
    then: Returns voice ID

  - name: set_user_voice
    given: User ID and voice ID
    when: Setting user's voice
    then: Returns success status

  - name: validate_text_length
    given: Text string
    when: Validating input
    then: Returns validation result

  - name: estimate_audio_duration
    given: Text string
    when: Estimating duration
    then: Returns estimated seconds

  - name: upload_audio_to_storage
    given: Audio data
    when: Storing audio
    then: Returns storage URL

constants:
  MAX_TEXT_LENGTH: 5000
  MIN_TEXT_LENGTH: 1
  DEFAULT_VOICE_ID: "21m00Tcm4TlvDq8ikWAM"
  DEFAULT_STABILITY: 0.5
  DEFAULT_SIMILARITY_BOOST: 0.75
