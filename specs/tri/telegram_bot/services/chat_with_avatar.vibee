name: chat_with_avatar
version: "1.0.0"
language: zig
module: chat_with_avatar

description: |
  Chat with avatar service for VIBEE Telegram bot.
  Handles AI-powered conversations with user's digital avatar.

imports:
  - openai_client
  - user
  - telegram

types:
  ChatMessage:
    description: "Chat message"
    fields:
      role: String
      content: String
      timestamp: Timestamp

  AvatarPersonality:
    description: "Avatar personality configuration"
    fields:
      name: String
      company: Option<String>
      position: Option<String>
      skills: List<String>
      tone: String
      language: String

  ChatSession:
    description: "Chat session with avatar"
    fields:
      id: String
      user_id: String
      avatar_id: String
      messages: List<ChatMessage>
      personality: AvatarPersonality
      created_at: Timestamp
      updated_at: Timestamp

  ChatRequest:
    description: "Chat request"
    fields:
      user_id: String
      avatar_id: String
      message: String
      session_id: Option<String>

  ChatResponse:
    description: "Chat response"
    fields:
      success: Bool
      response: Option<String>
      session_id: String
      error: Option<String>

behaviors:
  - name: send_message
    given: ChatRequest
    when: Sending message to avatar
    then: Returns ChatResponse

  - name: create_chat_session
    given: User ID and avatar ID
    when: Starting new chat
    then: Returns ChatSession

  - name: get_chat_history
    given: Session ID
    when: Fetching history
    then: Returns list of ChatMessage

  - name: clear_chat_history
    given: Session ID
    when: Clearing history
    then: Returns success status

  - name: update_avatar_personality
    given: Avatar ID and personality
    when: Updating personality
    then: Returns success status

  - name: generate_system_prompt
    given: AvatarPersonality
    when: Creating system prompt
    then: Returns prompt string

constants:
  MAX_HISTORY_MESSAGES: 20
  MAX_MESSAGE_LENGTH: 4000
  DEFAULT_MODEL: "gpt-4o-mini"
  DEFAULT_TEMPERATURE: 0.7
