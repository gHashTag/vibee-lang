# Music Generation Service
# Replicate model: minimax/music-1.5
# Cost: $0.03 per 30 seconds

name: music_generation
version: "1.0.0"
language: zig
module: music_generation

description: |
  –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º—É–∑—ã–∫–∏ —Å –ø–æ–º–æ—â—å—é AI.
  –ú–æ–¥–µ–ª—å: minimax/music-1.5
  –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–∞–∑–ª–∏—á–Ω—ã–µ –∂–∞–Ω—Ä—ã –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è.

imports:
  - replicate_client
  - pricing_system

constants:
  MODEL_ID: "minimax/music-1.5"
  # Real test: 10 sec music took 75.3 sec to generate
  # Pricing: ~$0.05 per 10 sec based on Replicate billing
  BASE_COST_USD_10S: 0.05
  # stars = (0.05 / 0.016) * 1.5 = 4.7 -> 5 stars per 10s
  COST_STARS_10S: 5
  MAX_DURATION_SECONDS: 240  # 4 minutes max (full songs)
  DEFAULT_DURATION: 30
  # Generation time: ~7.5 sec per 1 sec of music
  GENERATION_TIME_RATIO: 7.5

types:
  MusicGenre:
    description: "–ñ–∞–Ω—Ä –º—É–∑—ã–∫–∏"
    variants:
      - Pop
      - Rock
      - Electronic
      - Classical
      - Jazz
      - HipHop
      - Ambient
      - Cinematic
      - LoFi
      - Custom

  MusicMood:
    description: "–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –º—É–∑—ã–∫–∏"
    variants:
      - Happy
      - Sad
      - Energetic
      - Calm
      - Epic
      - Mysterious
      - Romantic
      - Dark

  MusicGenerationRequest:
    description: "–ó–∞–ø—Ä–æ—Å –Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –º—É–∑—ã–∫–∏"
    fields:
      prompt: String
      lyrics: String              # Required! Use "[instrumental]" for no vocals
      duration_seconds: Int
      genre: Option<MusicGenre>
      mood: Option<MusicMood>
      telegram_id: String
      username: String

  MusicGenerationResponse:
    description: "–†–µ–∑—É–ª—å—Ç–∞—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –º—É–∑—ã–∫–∏"
    fields:
      success: Bool
      audio_url: Option<String>
      error: Option<String>
      duration_seconds: Int
      processing_time_ms: Int
      cost_stars: Int

behaviors:
  - name: generate_music
    given: –¢–µ–∫—Å—Ç–æ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –º—É–∑—ã–∫–∏
    when: –ó–∞–ø—Ä–æ—Å –Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é
    then: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç URL –∞—É–¥–∏–æ—Ñ–∞–π–ª–∞
    api_call: |
      replicate.run("minimax/music-1.5", {
        input: {
          prompt: prompt,
          duration: duration_seconds
        }
      })

  - name: generate_music_with_reference
    given: –û–ø–∏—Å–∞–Ω–∏–µ –∏ —Ä–µ—Ñ–µ—Ä–µ–Ω—Å–Ω—ã–π —Ç—Ä–µ–∫
    when: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤ —Å—Ç–∏–ª–µ —Ä–µ—Ñ–µ—Ä–µ–Ω—Å–∞
    then: –°–æ–∑–¥–∞—ë—Ç –º—É–∑—ã–∫—É –ø–æ—Ö–æ–∂—É—é –Ω–∞ —Ä–µ—Ñ–µ—Ä–µ–Ω—Å

  - name: calculate_cost
    given: –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
    when: –†–∞—Å—á—ë—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏
    then: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤ –∑–≤—ë–∑–¥–∞—Ö
    formula: ceil(duration_seconds / 30) * COST_STARS_30S

  - name: get_genre_prompt
    given: –ñ–∞–Ω—Ä –º—É–∑—ã–∫–∏
    when: –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞
    then: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è –∂–∞–Ω—Ä–∞

# UI Integration
menu_item:
  group: audio
  position: 4
  icon: "üéµ"
  name:
    ru: "–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º—É–∑—ã–∫–∏"
    en: "Music Generation"
  description:
    ru: "–°–æ–∑–¥–∞–Ω–∏–µ –º—É–∑—ã–∫–∏ –ø–æ –æ–ø–∏—Å–∞–Ω–∏—é"
    en: "Create music from description"
  cost_stars: "–æ—Ç 3‚≠ê/30—Å–µ–∫"

# Wizard flow
wizard:
  steps:
    - name: select_duration
      prompt:
        ru: |
          üéµ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º—É–∑—ã–∫–∏
          
          –í—ã–±–µ—Ä–∏—Ç–µ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
          ‚Ä¢ 30 —Å–µ–∫ - 3 ‚≠ê
          ‚Ä¢ 60 —Å–µ–∫ - 6 ‚≠ê
          ‚Ä¢ 120 —Å–µ–∫ - 12 ‚≠ê
        en: |
          üéµ Music Generation
          
          Select duration:
          ‚Ä¢ 30 sec - 3 ‚≠ê
          ‚Ä¢ 60 sec - 6 ‚≠ê
          ‚Ä¢ 120 sec - 12 ‚≠ê
      buttons:
        - text: "30 —Å–µ–∫ (3‚≠ê)"
          callback: "music_dur_30"
        - text: "60 —Å–µ–∫ (6‚≠ê)"
          callback: "music_dur_60"
        - text: "120 —Å–µ–∫ (12‚≠ê)"
          callback: "music_dur_120"

    - name: enter_prompt
      prompt:
        ru: |
          üéº –û–ø–∏—à–∏—Ç–µ –∂–µ–ª–∞–µ–º—É—é –º—É–∑—ã–∫—É
          
          –ü—Ä–∏–º–µ—Ä—ã:
          ‚Ä¢ "–≠–Ω–µ—Ä–≥–∏—á–Ω—ã–π —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–π –±–∏—Ç –¥–ª—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏"
          ‚Ä¢ "–°–ø–æ–∫–æ–π–Ω–∞—è —Ñ–æ—Ä—Ç–µ–ø–∏–∞–Ω–Ω–∞—è –º–µ–ª–æ–¥–∏—è –¥–ª—è —Ä–µ–ª–∞–∫—Å–∞"
          ‚Ä¢ "–≠–ø–∏—á–µ—Å–∫–∞—è –æ—Ä–∫–µ—Å—Ç—Ä–æ–≤–∞—è –º—É–∑—ã–∫–∞ –¥–ª—è —Ç—Ä–µ–π–ª–µ—Ä–∞"
        en: |
          üéº Describe the desired music
          
          Examples:
          ‚Ä¢ "Energetic electronic beat for workout"
          ‚Ä¢ "Calm piano melody for relaxation"
          ‚Ä¢ "Epic orchestral music for trailer"

    - name: processing
      message:
        ru: "üéµ –ì–µ–Ω–µ—Ä–∏—Ä—É—é –º—É–∑—ã–∫—É... –≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å 1-2 –º–∏–Ω—É—Ç—ã"
        en: "üéµ Generating music... This may take 1-2 minutes"

    - name: result
      message:
        ru: "‚úÖ –ú—É–∑—ã–∫–∞ –≥–æ—Ç–æ–≤–∞!\n\nüéß –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: {duration} —Å–µ–∫\nüíé –°—Ç–æ–∏–º–æ—Å—Ç—å: {cost} ‚≠ê"
        en: "‚úÖ Music ready!\n\nüéß Duration: {duration} sec\nüíé Cost: {cost} ‚≠ê"

# Preset prompts for quick generation
presets:
  workout:
    ru: "–≠–Ω–µ—Ä–≥–∏—á–Ω—ã–π —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–π –±–∏—Ç 128 BPM –¥–ª—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏"
    en: "Energetic electronic beat 128 BPM for workout"
  relax:
    ru: "–°–ø–æ–∫–æ–π–Ω–∞—è ambient –º—É–∑—ã–∫–∞ –¥–ª—è –º–µ–¥–∏—Ç–∞—Ü–∏–∏"
    en: "Calm ambient music for meditation"
  cinematic:
    ru: "–≠–ø–∏—á–µ—Å–∫–∞—è –æ—Ä–∫–µ—Å—Ç—Ä–æ–≤–∞—è –º—É–∑—ã–∫–∞ —Å –Ω–∞—Ä–∞—Å—Ç–∞—é—â–∏–º –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ–º"
    en: "Epic orchestral music with building tension"
  lofi:
    ru: "Lo-fi —Ö–∏–ø-—Ö–æ–ø –±–∏—Ç –¥–ª—è —É—á—ë–±—ã"
    en: "Lo-fi hip-hop beat for studying"
