name: e2e_test_suite
version: "1.0.0"
language: zig
module: e2e_test_suite

description: |
  E2E Test Suite for VIBEE Telegram Bot
  
  Comprehensive end-to-end testing for all AI generation services.
  Requires API keys for real generation tests.
  
  Test Categories:
  1. Unit Tests - Pure function testing (no API)
  2. Integration Tests - Module interaction testing
  3. E2E Tests - Real API calls with actual generation
  4. Performance Tests - Latency and throughput
  5. Stress Tests - Load and concurrency

types:
  # ═══════════════════════════════════════════════════════════════
  # TEST CONFIGURATION
  # ═══════════════════════════════════════════════════════════════

  TestConfig:
    description: "Test suite configuration"
    fields:
      run_unit_tests: Bool
      run_integration_tests: Bool
      run_e2e_tests: Bool
      run_performance_tests: Bool
      run_stress_tests: Bool
      api_keys_available: Bool
      timeout_ms: Int
      retry_count: Int

  TestEnvironment:
    description: "Test environment setup"
    fields:
      replicate_api_key: Option<String>
      openai_api_key: Option<String>
      elevenlabs_api_key: Option<String>
      supabase_url: Option<String>
      supabase_key: Option<String>
      test_telegram_id: String
      test_bot_name: String

  # ═══════════════════════════════════════════════════════════════
  # TEST RESULTS
  # ═══════════════════════════════════════════════════════════════

  TestResult:
    description: "Individual test result"
    fields:
      test_name: String
      category: String
      passed: Bool
      duration_ms: Int
      error_message: Option<String>
      output: Option<String>

  TestSuiteResult:
    description: "Complete test suite result"
    fields:
      total_tests: Int
      passed: Int
      failed: Int
      skipped: Int
      duration_ms: Int
      results: List<TestResult>

  # ═══════════════════════════════════════════════════════════════
  # E2E TEST CASES
  # ═══════════════════════════════════════════════════════════════

  PhotoGenerationTest:
    description: "Photo generation E2E test"
    fields:
      prompt: String
      model_url: Option<String>
      expected_format: String
      max_duration_ms: Int

  VideoGenerationTest:
    description: "Video generation E2E test"
    fields:
      prompt: String
      model: String
      duration_seconds: Int
      expected_format: String
      max_duration_ms: Int

  AudioGenerationTest:
    description: "Audio generation E2E test"
    fields:
      text: String
      voice_id: String
      expected_format: String
      max_duration_ms: Int

  ChatTest:
    description: "Chat completion E2E test"
    fields:
      messages: List<String>
      expected_response_contains: Option<String>
      max_tokens: Int

behaviors:
  # ═══════════════════════════════════════════════════════════════
  # TEST SUITE EXECUTION
  # ═══════════════════════════════════════════════════════════════

  - name: run_all_tests
    given: TestConfig and TestEnvironment
    when: Running full test suite
    then: Returns TestSuiteResult

  - name: run_unit_tests
    given: No parameters
    when: Running unit tests
    then: Returns TestSuiteResult for unit tests

  - name: run_integration_tests
    given: No parameters
    when: Running integration tests
    then: Returns TestSuiteResult for integration tests

  - name: run_e2e_tests
    given: TestEnvironment
    when: Running E2E tests with real APIs
    then: Returns TestSuiteResult for E2E tests

  # ═══════════════════════════════════════════════════════════════
  # PHOTO GENERATION TESTS
  # ═══════════════════════════════════════════════════════════════

  - name: test_neuro_photo_generation
    given: Prompt and model URL
    when: Generating neuro photo
    then: Returns image URL or error

  - name: test_text_to_image
    given: Prompt
    when: Generating image from text
    then: Returns image URL or error

  - name: test_image_to_prompt
    given: Image URL
    when: Analyzing image
    then: Returns prompt text or error

  - name: test_face_swap
    given: Source and target images
    when: Swapping faces
    then: Returns result image or error

  - name: test_image_upscale
    given: Image URL
    when: Upscaling image
    then: Returns upscaled image or error

  # ═══════════════════════════════════════════════════════════════
  # VIDEO GENERATION TESTS
  # ═══════════════════════════════════════════════════════════════

  - name: test_text_to_video
    given: Prompt and model
    when: Generating video from text
    then: Returns video URL or error

  - name: test_image_to_video
    given: Image URL and prompt
    when: Animating image
    then: Returns video URL or error

  - name: test_lip_sync
    given: Video URL and audio URL
    when: Syncing lips
    then: Returns synced video or error

  # ═══════════════════════════════════════════════════════════════
  # AUDIO GENERATION TESTS
  # ═══════════════════════════════════════════════════════════════

  - name: test_text_to_speech
    given: Text and voice ID
    when: Generating speech
    then: Returns audio URL or error

  - name: test_speech_to_text
    given: Audio URL
    when: Transcribing audio
    then: Returns text or error

  - name: test_voice_clone
    given: Audio samples
    when: Cloning voice
    then: Returns voice ID or error

  # ═══════════════════════════════════════════════════════════════
  # CHAT TESTS
  # ═══════════════════════════════════════════════════════════════

  - name: test_chat_completion
    given: Messages
    when: Getting chat response
    then: Returns response or error

  - name: test_prompt_improvement
    given: Original prompt
    when: Improving prompt
    then: Returns improved prompt or error

  # ═══════════════════════════════════════════════════════════════
  # PERFORMANCE TESTS
  # ═══════════════════════════════════════════════════════════════

  - name: test_response_latency
    given: Service name
    when: Measuring latency
    then: Returns latency in ms

  - name: test_throughput
    given: Service name and request count
    when: Measuring throughput
    then: Returns requests per second

  # ═══════════════════════════════════════════════════════════════
  # REPORTING
  # ═══════════════════════════════════════════════════════════════

  - name: generate_test_report
    given: TestSuiteResult
    when: Creating report
    then: Returns formatted report string

  - name: save_test_results
    given: TestSuiteResult and path
    when: Saving results
    then: Writes JSON results to file

constants:
  # ═══════════════════════════════════════════════════════════════
  # TEST PROMPTS
  # ═══════════════════════════════════════════════════════════════

  TEST_PROMPTS:
    PHOTO_SIMPLE: "A beautiful sunset over the ocean"
    PHOTO_COMPLEX: "A cyberpunk city at night with neon lights, rain, and flying cars"
    VIDEO_SIMPLE: "A cat playing with a ball"
    VIDEO_COMPLEX: "A timelapse of a flower blooming in a garden"
    TTS_SIMPLE: "Hello, this is a test of text to speech."
    TTS_COMPLEX: "The quick brown fox jumps over the lazy dog. This sentence contains every letter of the alphabet."

  # ═══════════════════════════════════════════════════════════════
  # TIMEOUTS
  # ═══════════════════════════════════════════════════════════════

  TIMEOUT_PHOTO_MS: 60000
  TIMEOUT_VIDEO_MS: 300000
  TIMEOUT_AUDIO_MS: 30000
  TIMEOUT_CHAT_MS: 30000
  TIMEOUT_TRAINING_MS: 1800000

  # ═══════════════════════════════════════════════════════════════
  # EXPECTED FORMATS
  # ═══════════════════════════════════════════════════════════════

  FORMAT_IMAGE: "image/png"
  FORMAT_VIDEO: "video/mp4"
  FORMAT_AUDIO: "audio/mpeg"

  # ═══════════════════════════════════════════════════════════════
  # TEST USER
  # ═══════════════════════════════════════════════════════════════

  TEST_TELEGRAM_ID: "test_user_12345"
  TEST_BOT_NAME: "test_vibee_bot"
