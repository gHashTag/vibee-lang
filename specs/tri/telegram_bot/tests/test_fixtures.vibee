name: test_fixtures
version: "1.0.0"
language: zig
module: test_fixtures

description: |
  Test fixtures and data factories for VIBEE Telegram bot.
  Provides consistent test data, factories, and builders.
  Supports deterministic and random data generation.

# ═══════════════════════════════════════════════════════════════════════════════
# TYPES
# ═══════════════════════════════════════════════════════════════════════════════

types:
  FixtureManager:
    description: "Fixture manager"
    fields:
      seed: Int
      fixtures: Object
      cleanup_handlers: List<String>

  FixtureConfig:
    description: "Fixture configuration"
    fields:
      seed: Option<Int>
      locale: String
      timezone: String
      deterministic: Bool

  # ─────────────────────────────────────────────────────────────────────────────
  # USER FIXTURES
  # ─────────────────────────────────────────────────────────────────────────────

  UserFixture:
    description: "User fixture"
    fields:
      telegram_id: Int
      username: String
      first_name: String
      last_name: Option<String>
      language_code: String
      is_premium: Bool
      balance: Int
      subscription_tier: Option<String>
      created_at: Timestamp

  UserBuilder:
    description: "User builder"
    fields:
      telegram_id: Option<Int>
      username: Option<String>
      first_name: Option<String>
      is_premium: Option<Bool>
      balance: Option<Int>

  # ─────────────────────────────────────────────────────────────────────────────
  # PAYMENT FIXTURES
  # ─────────────────────────────────────────────────────────────────────────────

  PaymentFixture:
    description: "Payment fixture"
    fields:
      transaction_id: String
      telegram_id: Int
      amount: Int
      currency: String
      status: String
      provider: String
      created_at: Timestamp

  SubscriptionFixture:
    description: "Subscription fixture"
    fields:
      subscription_id: String
      telegram_id: Int
      plan_id: String
      tier: String
      status: String
      current_period_start: Timestamp
      current_period_end: Timestamp

  InvoiceFixture:
    description: "Invoice fixture"
    fields:
      invoice_id: String
      telegram_id: Int
      amount: Int
      status: String
      items: List<Object>

  # ─────────────────────────────────────────────────────────────────────────────
  # GENERATION FIXTURES
  # ─────────────────────────────────────────────────────────────────────────────

  GenerationFixture:
    description: "Generation fixture"
    fields:
      generation_id: String
      telegram_id: Int
      type: String
      model: String
      prompt: String
      status: String
      result_url: Option<String>
      cost_stars: Int
      created_at: Timestamp

  PromptFixture:
    description: "Prompt fixture"
    fields:
      prompt: String
      negative_prompt: Option<String>
      style: Option<String>
      language: String

  # ─────────────────────────────────────────────────────────────────────────────
  # MESSAGE FIXTURES
  # ─────────────────────────────────────────────────────────────────────────────

  MessageFixture:
    description: "Telegram message fixture"
    fields:
      message_id: Int
      chat_id: Int
      from_id: Int
      text: Option<String>
      photo: Option<List<Object>>
      video: Option<Object>
      audio: Option<Object>
      date: Timestamp

  CallbackFixture:
    description: "Callback query fixture"
    fields:
      callback_id: String
      from_id: Int
      chat_id: Int
      message_id: Int
      data: String

  UpdateFixture:
    description: "Telegram update fixture"
    fields:
      update_id: Int
      message: Option<MessageFixture>
      callback_query: Option<CallbackFixture>

  # ─────────────────────────────────────────────────────────────────────────────
  # NOTIFICATION FIXTURES
  # ─────────────────────────────────────────────────────────────────────────────

  NotificationFixture:
    description: "Notification fixture"
    fields:
      notification_id: String
      telegram_id: Int
      type: String
      title: String
      message: String
      status: String

  BroadcastFixture:
    description: "Broadcast fixture"
    fields:
      campaign_id: String
      name: String
      content: String
      audience_size: Int
      status: String

  # ─────────────────────────────────────────────────────────────────────────────
  # ADMIN FIXTURES
  # ─────────────────────────────────────────────────────────────────────────────

  AdminFixture:
    description: "Admin fixture"
    fields:
      admin_id: String
      telegram_id: Int
      username: String
      role: String
      permissions: List<String>

  AuditLogFixture:
    description: "Audit log fixture"
    fields:
      entry_id: String
      event_type: String
      actor_id: String
      action: String
      timestamp: Timestamp

  # ─────────────────────────────────────────────────────────────────────────────
  # MEDIA FIXTURES
  # ─────────────────────────────────────────────────────────────────────────────

  ImageFixture:
    description: "Image fixture"
    fields:
      file_id: String
      file_unique_id: String
      width: Int
      height: Int
      file_size: Int
      url: String

  VideoFixture:
    description: "Video fixture"
    fields:
      file_id: String
      file_unique_id: String
      width: Int
      height: Int
      duration: Int
      file_size: Int
      url: String

  AudioFixture:
    description: "Audio fixture"
    fields:
      file_id: String
      file_unique_id: String
      duration: Int
      file_size: Int
      url: String

# ═══════════════════════════════════════════════════════════════════════════════
# BEHAVIORS
# ═══════════════════════════════════════════════════════════════════════════════

behaviors:
  # ─────────────────────────────────────────────────────────────────────────────
  # MANAGER
  # ─────────────────────────────────────────────────────────────────────────────

  - name: init_manager
    given: FixtureConfig
    when: Initializing manager
    then: Return FixtureManager

  - name: reset_fixtures
    given: No parameters
    when: Resetting fixtures
    then: Clear all fixtures

  - name: cleanup
    given: No parameters
    when: Cleaning up
    then: Run cleanup handlers

  # ─────────────────────────────────────────────────────────────────────────────
  # USER FACTORIES
  # ─────────────────────────────────────────────────────────────────────────────

  - name: create_user
    given: Optional overrides
    when: Creating user
    then: Return UserFixture

  - name: create_premium_user
    given: Optional overrides
    when: Creating premium user
    then: Return premium UserFixture

  - name: create_user_with_balance
    given: Balance amount
    when: Creating user
    then: Return UserFixture with balance

  - name: create_user_with_subscription
    given: Subscription tier
    when: Creating user
    then: Return UserFixture with subscription

  - name: create_users
    given: Count
    when: Creating multiple users
    then: Return list of UserFixtures

  - name: user_builder
    given: No parameters
    when: Starting builder
    then: Return UserBuilder

  # ─────────────────────────────────────────────────────────────────────────────
  # PAYMENT FACTORIES
  # ─────────────────────────────────────────────────────────────────────────────

  - name: create_payment
    given: User and amount
    when: Creating payment
    then: Return PaymentFixture

  - name: create_successful_payment
    given: User and amount
    when: Creating successful payment
    then: Return completed PaymentFixture

  - name: create_failed_payment
    given: User and amount
    when: Creating failed payment
    then: Return failed PaymentFixture

  - name: create_subscription
    given: User and tier
    when: Creating subscription
    then: Return SubscriptionFixture

  - name: create_expired_subscription
    given: User and tier
    when: Creating expired
    then: Return expired SubscriptionFixture

  - name: create_invoice
    given: User and items
    when: Creating invoice
    then: Return InvoiceFixture

  # ─────────────────────────────────────────────────────────────────────────────
  # GENERATION FACTORIES
  # ─────────────────────────────────────────────────────────────────────────────

  - name: create_generation
    given: User and type
    when: Creating generation
    then: Return GenerationFixture

  - name: create_completed_generation
    given: User and type
    when: Creating completed
    then: Return completed GenerationFixture

  - name: create_failed_generation
    given: User and type
    when: Creating failed
    then: Return failed GenerationFixture

  - name: create_prompt
    given: Optional style
    when: Creating prompt
    then: Return PromptFixture

  - name: create_random_prompt
    given: Language
    when: Creating random
    then: Return random PromptFixture

  # ─────────────────────────────────────────────────────────────────────────────
  # MESSAGE FACTORIES
  # ─────────────────────────────────────────────────────────────────────────────

  - name: create_message
    given: User and text
    when: Creating message
    then: Return MessageFixture

  - name: create_photo_message
    given: User and photo
    when: Creating photo message
    then: Return MessageFixture with photo

  - name: create_video_message
    given: User and video
    when: Creating video message
    then: Return MessageFixture with video

  - name: create_callback
    given: User and data
    when: Creating callback
    then: Return CallbackFixture

  - name: create_update
    given: Message or callback
    when: Creating update
    then: Return UpdateFixture

  # ─────────────────────────────────────────────────────────────────────────────
  # NOTIFICATION FACTORIES
  # ─────────────────────────────────────────────────────────────────────────────

  - name: create_notification
    given: User and type
    when: Creating notification
    then: Return NotificationFixture

  - name: create_broadcast
    given: Audience size
    when: Creating broadcast
    then: Return BroadcastFixture

  # ─────────────────────────────────────────────────────────────────────────────
  # ADMIN FACTORIES
  # ─────────────────────────────────────────────────────────────────────────────

  - name: create_admin
    given: Role
    when: Creating admin
    then: Return AdminFixture

  - name: create_super_admin
    given: No parameters
    when: Creating super admin
    then: Return super AdminFixture

  - name: create_audit_log
    given: Event type
    when: Creating audit log
    then: Return AuditLogFixture

  # ─────────────────────────────────────────────────────────────────────────────
  # MEDIA FACTORIES
  # ─────────────────────────────────────────────────────────────────────────────

  - name: create_image
    given: Dimensions
    when: Creating image
    then: Return ImageFixture

  - name: create_video
    given: Duration
    when: Creating video
    then: Return VideoFixture

  - name: create_audio
    given: Duration
    when: Creating audio
    then: Return AudioFixture

  # ─────────────────────────────────────────────────────────────────────────────
  # RANDOM DATA
  # ─────────────────────────────────────────────────────────────────────────────

  - name: random_telegram_id
    given: No parameters
    when: Generating ID
    then: Return random telegram ID

  - name: random_username
    given: No parameters
    when: Generating username
    then: Return random username

  - name: random_name
    given: Locale
    when: Generating name
    then: Return random name

  - name: random_email
    given: No parameters
    when: Generating email
    then: Return random email

  - name: random_string
    given: Length
    when: Generating string
    then: Return random string

  - name: random_int
    given: Min and max
    when: Generating int
    then: Return random int

  - name: random_timestamp
    given: Range
    when: Generating timestamp
    then: Return random timestamp

# ═══════════════════════════════════════════════════════════════════════════════
# CONSTANTS
# ═══════════════════════════════════════════════════════════════════════════════

constants:
  DEFAULT_SEED: 42
  DEFAULT_LOCALE: "ru"
  DEFAULT_TIMEZONE: "Europe/Moscow"

  TEST_USER_ID_START: 700000000
  TEST_CHAT_ID_START: 700000000
  TEST_MESSAGE_ID_START: 1

  DEFAULT_BALANCE: 100
  DEFAULT_PREMIUM_BALANCE: 1000

  SAMPLE_PROMPTS_RU: ["красивый закат", "портрет девушки", "футуристический город"]
  SAMPLE_PROMPTS_EN: ["beautiful sunset", "girl portrait", "futuristic city"]

  SAMPLE_IMAGE_URL: "https://example.com/test.jpg"
  SAMPLE_VIDEO_URL: "https://example.com/test.mp4"
  SAMPLE_AUDIO_URL: "https://example.com/test.mp3"
