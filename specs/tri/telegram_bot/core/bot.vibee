name: bot
version: "1.0.0"
language: zig
module: bot

description: |
  Core bot module for VIBEE Telegram bot.
  Handles bot initialization, configuration, and lifecycle.

imports:
  - telegram
  - user

types:
  BotConfig:
    description: "Bot configuration"
    fields:
      token: String
      name: String
      webhook_url: Option<String>
      webhook_port: Int
      is_dev: Bool
      admin_ids: List<String>

  BotInstance:
    description: "Bot instance"
    fields:
      config: BotConfig
      telegram: TelegramClient
      is_running: Bool
      started_at: Option<Timestamp>

  BotResult:
    description: "Result of bot operation"
    fields:
      bot: Option<BotInstance>
      error: Option<String>

  TelegramClient:
    description: "Telegram API client"
    fields:
      token: String
      api_url: String

  WebhookInfo:
    description: "Webhook configuration info"
    fields:
      url: String
      has_custom_certificate: Bool
      pending_update_count: Int
      last_error_date: Option<Timestamp>
      last_error_message: Option<String>

behaviors:
  - name: create_bot
    given: Bot configuration
    when: Initializing bot
    then: Returns BotInstance

  - name: start_bot
    given: BotInstance
    when: Starting bot
    then: Bot begins processing updates

  - name: stop_bot
    given: BotInstance
    when: Stopping bot
    then: Bot stops processing updates

  - name: get_bot_by_name
    given: Bot name string
    when: Looking up bot
    then: Returns BotResult

  - name: get_bot_token_by_name
    given: Bot name string
    when: Looking up token
    then: Returns token or error

  - name: setup_webhook
    given: BotInstance and webhook URL
    when: Configuring webhook
    then: Returns success status

  - name: delete_webhook
    given: BotInstance
    when: Removing webhook
    then: Returns success status

  - name: get_webhook_info
    given: BotInstance
    when: Checking webhook status
    then: Returns WebhookInfo

  - name: register_middleware
    given: BotInstance and middleware function
    when: Adding middleware
    then: Middleware is registered

  - name: register_scene
    given: BotInstance and scene
    when: Adding scene
    then: Scene is registered

  - name: register_command
    given: BotInstance, command name, and handler
    when: Adding command
    then: Command is registered

constants:
  DEFAULT_WEBHOOK_PORT: 3000
  API_BASE_URL: "https://api.telegram.org"
  MAX_RETRIES: 3
  RETRY_DELAY_MS: 1000
