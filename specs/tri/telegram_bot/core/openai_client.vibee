name: openai_client
version: "1.0.0"
language: zig
module: openai_client

description: |
  OpenAI client module for VIBEE Telegram bot.
  Handles chat completions, embeddings, and image generation.

types:
  OpenAIConfig:
    description: "OpenAI configuration"
    fields:
      api_key: String
      organization: Option<String>
      base_url: Option<String>

  OpenAIClient:
    description: "OpenAI client instance"
    fields:
      config: OpenAIConfig

  ChatMessage:
    description: "Chat message"
    fields:
      role: String
      content: String
      name: Option<String>

  ChatCompletionRequest:
    description: "Chat completion request"
    fields:
      model: String
      messages: List<ChatMessage>
      temperature: Option<Float>
      max_tokens: Option<Int>
      top_p: Option<Float>
      frequency_penalty: Option<Float>
      presence_penalty: Option<Float>
      stop: Option<List<String>>

  ChatCompletionResponse:
    description: "Chat completion response"
    fields:
      id: String
      object: String
      created: Timestamp
      model: String
      choices: List<ChatChoice>
      usage: TokenUsage

  ChatChoice:
    description: "Chat completion choice"
    fields:
      index: Int
      message: ChatMessage
      finish_reason: String

  TokenUsage:
    description: "Token usage information"
    fields:
      prompt_tokens: Int
      completion_tokens: Int
      total_tokens: Int

  EmbeddingRequest:
    description: "Embedding request"
    fields:
      model: String
      input: String

  EmbeddingResponse:
    description: "Embedding response"
    fields:
      object: String
      data: List<EmbeddingData>
      model: String
      usage: TokenUsage

  EmbeddingData:
    description: "Embedding data"
    fields:
      object: String
      embedding: List<Float>
      index: Int

behaviors:
  - name: create_client
    given: OpenAI configuration
    when: Initializing client
    then: Returns OpenAIClient

  - name: chat_completion
    given: Chat completion request
    when: Generating response
    then: Returns ChatCompletionResponse

  - name: create_embedding
    given: Embedding request
    when: Creating embedding
    then: Returns EmbeddingResponse

  - name: improve_prompt
    given: Original prompt and language
    when: Improving prompt
    then: Returns improved prompt string

  - name: translate_prompt
    given: Prompt and target language
    when: Translating prompt
    then: Returns translated prompt

  - name: analyze_image
    given: Image URL and question
    when: Analyzing image
    then: Returns analysis text

constants:
  DEFAULT_MODEL: "gpt-4o-mini"
  DEFAULT_TEMPERATURE: 0.7
  DEFAULT_MAX_TOKENS: 1000
  EMBEDDING_MODEL: "text-embedding-3-small"
