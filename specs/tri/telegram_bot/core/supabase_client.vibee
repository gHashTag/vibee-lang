name: supabase_client
version: "1.0.0"
language: zig
module: supabase_client

description: |
  Supabase client module for VIBEE Telegram bot.
  Handles database operations, authentication, and storage.

types:
  SupabaseConfig:
    description: "Supabase configuration"
    fields:
      url: String
      anon_key: String
      service_key: String

  SupabaseClient:
    description: "Supabase client instance"
    fields:
      config: SupabaseConfig
      is_connected: Bool

  QueryResult:
    description: "Database query result"
    fields:
      data: Option<Object>
      error: Option<String>
      count: Option<Int>

  InsertResult:
    description: "Insert operation result"
    fields:
      data: Option<Object>
      error: Option<String>

  UpdateResult:
    description: "Update operation result"
    fields:
      data: Option<Object>
      error: Option<String>
      count: Int

  DeleteResult:
    description: "Delete operation result"
    fields:
      error: Option<String>
      count: Int

  StorageUploadResult:
    description: "Storage upload result"
    fields:
      path: Option<String>
      error: Option<String>

  StorageDownloadResult:
    description: "Storage download result"
    fields:
      data: Option<Object>
      error: Option<String>

behaviors:
  - name: create_client
    given: Supabase configuration
    when: Initializing client
    then: Returns SupabaseClient

  - name: select
    given: Table name and query options
    when: Fetching data
    then: Returns QueryResult

  - name: insert
    given: Table name and data
    when: Inserting record
    then: Returns InsertResult

  - name: update
    given: Table name, data, and filter
    when: Updating records
    then: Returns UpdateResult

  - name: delete
    given: Table name and filter
    when: Deleting records
    then: Returns DeleteResult

  - name: upsert
    given: Table name and data
    when: Upserting record
    then: Returns InsertResult

  - name: rpc
    given: Function name and parameters
    when: Calling stored procedure
    then: Returns QueryResult

  - name: upload_file
    given: Bucket name, path, and file data
    when: Uploading to storage
    then: Returns StorageUploadResult

  - name: download_file
    given: Bucket name and path
    when: Downloading from storage
    then: Returns StorageDownloadResult

  - name: delete_file
    given: Bucket name and path
    when: Deleting from storage
    then: Returns success status

  - name: get_public_url
    given: Bucket name and path
    when: Getting public URL
    then: Returns URL string

constants:
  DEFAULT_TIMEOUT_MS: 30000
  MAX_RETRIES: 3
