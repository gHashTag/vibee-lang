name: model_repository
version: "1.0.0"
language: zig
module: model_repository

description: |
  Model repository for VIBEE Telegram bot.
  Handles trained AI model database operations.

imports:
  - supabase_client
  - user

types:
  CreateModelInput:
    description: "Input for creating model record"
    fields:
      user_id: String
      telegram_id: String
      model_url: String
      model_type: String
      trigger_word: String
      training_id: Option<String>

  UpdateModelInput:
    description: "Input for updating model"
    fields:
      model_url: Option<String>
      status: Option<String>
      trigger_word: Option<String>

  ModelFilter:
    description: "Filter for querying models"
    fields:
      user_id: Option<String>
      telegram_id: Option<String>
      model_type: Option<String>
      status: Option<String>
      is_active: Option<Bool>

  ModelRecord:
    description: "Model record in database"
    fields:
      id: String
      user_id: String
      telegram_id: String
      model_url: String
      model_type: String
      trigger_word: String
      status: String
      is_active: Bool
      created_at: Timestamp
      updated_at: Timestamp

behaviors:
  - name: create_model
    given: CreateModelInput
    when: Creating model record
    then: Returns ModelRecord

  - name: get_model_by_id
    given: Model ID
    when: Fetching model
    then: Returns ModelRecord or null

  - name: get_user_models
    given: User ID
    when: Fetching user's models
    then: Returns list of ModelRecord

  - name: get_active_user_models
    given: User ID and model type
    when: Fetching active models
    then: Returns list of ModelRecord

  - name: get_latest_user_model
    given: User ID
    when: Fetching latest model
    then: Returns ModelRecord or null

  - name: update_model
    given: Model ID and UpdateModelInput
    when: Updating model
    then: Returns updated ModelRecord

  - name: delete_model
    given: Model ID
    when: Deleting model
    then: Returns success status

  - name: set_model_active
    given: Model ID and is_active
    when: Toggling active status
    then: Returns success status

  - name: find_models
    given: ModelFilter
    when: Searching models
    then: Returns list of ModelRecord

  - name: count_user_models
    given: User ID
    when: Counting models
    then: Returns count

  - name: get_model_by_training_id
    given: Training ID
    when: Fetching by training
    then: Returns ModelRecord or null
