name: wizard_ux
version: "2.0.0"
language: zig
module: wizard_ux

description: |
  Improved Wizard UX Patterns
  
  Key improvements:
  1. Clear step progress indicator
  2. Inline validation with helpful errors
  3. Smart defaults to reduce input
  4. Preview before confirmation
  5. Easy cancel/back at any step
  6. Contextual help per step
  7. Cost transparency throughout

imports:
  - ux_design_system
  - telegram
  - user

types:
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # WIZARD FRAMEWORK
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  WizardConfig:
    description: "Wizard configuration"
    fields:
      id: String
      name_ru: String
      name_en: String
      steps: List<WizardStepConfig>
      allow_skip: Bool
      show_progress: Bool
      show_cost: Bool

  WizardStepConfig:
    description: "Step configuration"
    fields:
      id: String
      type: StepType
      title_ru: String
      title_en: String
      description_ru: String
      description_en: String
      tip_ru: Option<String>
      tip_en: Option<String>
      is_optional: Bool
      default_value: Option<String>
      validation: Option<ValidationRule>

  StepType:
    description: "Type of wizard step"
    variants:
      - TextInput       # Free text entry
      - SingleSelect    # Select one option
      - MultiSelect     # Select multiple
      - PhotoUpload     # Upload photo(s)
      - Confirmation    # Review and confirm
      - Processing      # Show progress
      - Result          # Show result

  ValidationRule:
    description: "Input validation rule"
    fields:
      type: String
      min_length: Option<Int>
      max_length: Option<Int>
      pattern: Option<String>
      error_ru: String
      error_en: String

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # WIZARD STATE
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  WizardState:
    description: "Current wizard state"
    fields:
      wizard_id: String
      current_step: Int
      total_steps: Int
      data: Object
      errors: List<String>
      started_at: Timestamp
      last_activity: Timestamp

  StepTransition:
    description: "Step transition result"
    fields:
      success: Bool
      next_step: Option<Int>
      message: Option<String>
      should_edit: Bool

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # UI COMPONENTS
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  ProgressHeader:
    description: "Progress header display"
    fields:
      step_number: Int
      total_steps: Int
      step_name: String
      progress_bar: String

  StepMessage:
    description: "Step message content"
    fields:
      header: ProgressHeader
      title: String
      description: String
      tip: Option<String>
      input_placeholder: Option<String>
      keyboard: Object

  ConfirmationSummary:
    description: "Confirmation step summary"
    fields:
      items: List<SummaryItem>
      total_cost: Int
      warnings: List<String>

  SummaryItem:
    description: "Summary item"
    fields:
      label: String
      value: String
      can_edit: Bool
      edit_step: Option<Int>

behaviors:
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # WIZARD LIFECYCLE
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  - name: start_wizard
    given: Context and wizard config
    when: Starting wizard
    then: Initializes state and shows first step

  - name: process_input
    given: Context and user input
    when: User provides input
    then: Validates and transitions to next step

  - name: go_back
    given: Context
    when: User presses back
    then: Returns to previous step

  - name: cancel_wizard
    given: Context
    when: User cancels
    then: Clears state and returns to menu

  - name: skip_step
    given: Context
    when: User skips optional step
    then: Uses default and proceeds

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # STEP RENDERING
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  - name: render_step
    given: Wizard state and step config
    when: Displaying step
    then: Returns formatted step message

  - name: render_progress_header
    given: Current step and total steps
    when: Building header
    then: Returns progress indicator string

  - name: render_step_keyboard
    given: Step config and state
    when: Building keyboard
    then: Returns appropriate keyboard for step type

  - name: render_confirmation
    given: Wizard state
    when: Showing confirmation
    then: Returns summary with edit options

  - name: render_processing
    given: Progress percentage
    when: Showing processing
    then: Returns animated progress message

  - name: render_result
    given: Result data
    when: Showing result
    then: Returns result with action buttons

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # VALIDATION
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  - name: validate_input
    given: Input and validation rule
    when: Validating user input
    then: Returns validation result

  - name: format_validation_error
    given: Error type and language
    when: Showing error
    then: Returns user-friendly error message

  - name: suggest_correction
    given: Invalid input
    when: Input is close to valid
    then: Returns suggestion

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # COST DISPLAY
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  - name: calculate_step_cost
    given: Wizard state
    when: Calculating cost
    then: Returns current estimated cost

  - name: format_cost_display
    given: Cost in stars and language
    when: Showing cost
    then: Returns formatted cost string

  - name: check_balance_sufficient
    given: User balance and required cost
    when: Checking balance
    then: Returns true if sufficient

constants:
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # PROGRESS BAR
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  PROGRESS_FILLED: "â–“"
  PROGRESS_EMPTY: "â–‘"
  PROGRESS_LENGTH: 10

  # Step indicators
  STEP_CURRENT: "â—"
  STEP_DONE: "âœ“"
  STEP_PENDING: "â—‹"

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # KEYBOARD BUTTONS
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  BTN_BACK_RU: "â—€ï¸ ĞĞ°Ğ·Ğ°Ğ´"
  BTN_BACK_EN: "â—€ï¸ Back"
  BTN_CANCEL_RU: "âœ–ï¸ ĞÑ‚Ğ¼ĞµĞ½Ğ°"
  BTN_CANCEL_EN: "âœ–ï¸ Cancel"
  BTN_SKIP_RU: "â­ï¸ ĞŸÑ€Ğ¾Ğ¿ÑƒÑÑ‚Ğ¸Ñ‚ÑŒ"
  BTN_SKIP_EN: "â­ï¸ Skip"
  BTN_CONFIRM_RU: "âœ… ĞŸĞ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ´Ğ¸Ñ‚ÑŒ"
  BTN_CONFIRM_EN: "âœ… Confirm"
  BTN_EDIT_RU: "âœï¸ Ğ˜Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ"
  BTN_EDIT_EN: "âœï¸ Edit"
  BTN_RETRY_RU: "ğŸ”„ ĞŸĞ¾Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ñ‚ÑŒ"
  BTN_RETRY_EN: "ğŸ”„ Retry"
  BTN_DONE_RU: "âœ”ï¸ Ğ“Ğ¾Ñ‚Ğ¾Ğ²Ğ¾"
  BTN_DONE_EN: "âœ”ï¸ Done"
  BTN_SHARE_RU: "ğŸ“¤ ĞŸĞ¾Ğ´ĞµĞ»Ğ¸Ñ‚ÑŒÑÑ"
  BTN_SHARE_EN: "ğŸ“¤ Share"
  BTN_SAVE_RU: "ğŸ’¾ Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ"
  BTN_SAVE_EN: "ğŸ’¾ Save"

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # MESSAGES
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  MSG_PROCESSING_RU: "â³ ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ°..."
  MSG_PROCESSING_EN: "â³ Processing..."
  MSG_ALMOST_DONE_RU: "ğŸš€ ĞŸĞ¾Ñ‡Ñ‚Ğ¸ Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ¾!"
  MSG_ALMOST_DONE_EN: "ğŸš€ Almost done!"
  MSG_SUCCESS_RU: "âœ… Ğ“Ğ¾Ñ‚Ğ¾Ğ²Ğ¾!"
  MSG_SUCCESS_EN: "âœ… Done!"
  MSG_ERROR_RU: "âŒ ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ¾ÑˆĞ»Ğ° Ğ¾ÑˆĞ¸Ğ±ĞºĞ°"
  MSG_ERROR_EN: "âŒ An error occurred"

  # Timeouts
  WIZARD_TIMEOUT_MINUTES: 30
  STEP_TIMEOUT_MINUTES: 10
