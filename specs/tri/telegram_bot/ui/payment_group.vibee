name: payment_group
version: "3.0.0"
language: zig
module: payment_group

description: |
  ğŸ’° PAYMENT GROUP - All Payment Options
  
  Trinity Formula: V = n Ã— 3^k where k=2 (Secondary Level)
  Golden Layout: 3 columns, Ï†-based spacing
  
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  ğŸ’° ĞĞŸĞ›ĞĞ¢Ğ / PAYMENT                                        â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                                                             â”‚
  â”‚  ğŸ’ ĞœĞ¾Ğ¹ Ğ±Ğ°Ğ»Ğ°Ğ½Ñ     â­ ĞšÑƒĞ¿Ğ¸Ñ‚ÑŒ Ğ·Ğ²Ñ‘Ğ·Ğ´Ñ‹  ğŸ’³ ĞĞ¿Ğ»Ğ°Ñ‚Ğ° Ñ€ÑƒĞ±Ğ»ÑĞ¼Ğ¸      â”‚
  â”‚     {balance}â­                                              â”‚
  â”‚                                                             â”‚
  â”‚  ğŸ‘‘ ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑĞºĞ°       ğŸ ĞŸĞ¾Ğ´Ğ°Ñ€Ğ¸Ñ‚ÑŒ       ğŸ“‹ Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ             â”‚
  â”‚     ğŸ†•                                                       â”‚
  â”‚                                                             â”‚
  â”‚  ğŸ’¸ Ğ’Ñ‹Ğ²Ğ¾Ğ´ ÑÑ€ĞµĞ´ÑÑ‚Ğ²  ğŸ§¾ Ğ§ĞµĞºĞ¸           â“ ĞŸĞ¾Ğ¼Ğ¾Ñ‰ÑŒ              â”‚
  â”‚                                                             â”‚
  â”‚                                                             â”‚
  â”‚  â—€ï¸ ĞĞ°Ğ·Ğ°Ğ´                              ğŸ  ĞœĞµĞ½Ñ              â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

imports:
  - trinity_menu_system
  - ux_design_system

types:
  PaymentFunction:
    description: "Payment function type"
    variants:
      - Balance            # View balance
      - BuyStars           # Buy with Telegram Stars
      - BuyRubles          # Buy with Rubles
      - Subscription       # Manage subscription
      - GiftStars          # Gift stars to user
      - PaymentHistory     # View history
      - Withdrawal         # Withdraw earnings
      - Receipts           # View receipts
      - PaymentHelp        # Payment help

  PaymentMethod:
    description: "Payment method"
    variants:
      - TelegramStars      # Telegram Stars
      - Robokassa          # Robokassa (Rubles)
      - Crypto             # Cryptocurrency

  SubscriptionPlan:
    description: "Subscription plan"
    fields:
      id: String
      name_ru: String
      name_en: String
      price_stars: Int
      price_rubles: Int
      duration_days: Int
      features: List<String>
      bonus_stars: Int

  StarPackage:
    description: "Star purchase package"
    fields:
      id: String
      stars: Int
      price_rubles: Int
      bonus_percent: Int
      is_popular: Bool

  PaymentRecord:
    description: "Payment history record"
    fields:
      id: String
      type: String
      amount: Int
      currency: String
      status: String
      created_at: Timestamp
      description: String

behaviors:
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # GROUP MENU
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  - name: show_payment_menu
    given: Context and user balance
    when: User enters payment group
    then: Shows all payment options with balance

  - name: handle_payment_selection
    given: Context and function ID
    when: User selects function
    then: Starts appropriate flow

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # PAYMENT FUNCTIONS
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  - name: show_balance
    given: Context
    when: User selects Balance
    then: Shows detailed balance info

  - name: show_buy_stars
    given: Context
    when: User selects Buy Stars
    then: Shows star packages with Telegram payment

  - name: show_buy_rubles
    given: Context
    when: User selects Buy Rubles
    then: Shows ruble payment options

  - name: show_subscription
    given: Context
    when: User selects Subscription
    then: Shows subscription plans

  - name: show_gift_stars
    given: Context
    when: User selects Gift
    then: Starts gift wizard

  - name: show_payment_history
    given: Context
    when: User selects History
    then: Shows payment history

  - name: show_withdrawal
    given: Context
    when: User selects Withdrawal
    then: Shows withdrawal options

  - name: show_receipts
    given: Context
    when: User selects Receipts
    then: Shows payment receipts

  - name: show_payment_help
    given: Context
    when: User selects Help
    then: Shows payment FAQ

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # PAYMENT PROCESSING
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  - name: create_star_invoice
    given: Package ID
    when: Creating Telegram Stars invoice
    then: Returns invoice for payment

  - name: create_ruble_payment
    given: Amount and method
    when: Creating ruble payment
    then: Returns payment URL

  - name: process_subscription
    given: Plan ID and payment method
    when: Subscribing
    then: Activates subscription

  - name: send_gift
    given: Recipient ID and amount
    when: Gifting stars
    then: Transfers stars

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # KEYBOARD BUILDER
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  - name: build_payment_keyboard
    given: Language and balance
    when: Building menu keyboard
    then: Returns 3-column payment functions grid

  - name: build_packages_keyboard
    given: Packages and language
    when: Building package selection
    then: Returns packages with prices

  - name: build_subscription_keyboard
    given: Plans and language
    when: Building subscription selection
    then: Returns plans with features

constants:
  GROUP_ID: "payment"
  GROUP_EMOJI: "ğŸ’°"
  GROUP_NAME_RU: "ĞĞŸĞ›ĞĞ¢Ğ"
  GROUP_NAME_EN: "PAYMENT"
  GROUP_COLOR: "#27AE60"

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # PAYMENT FUNCTIONS (9 items = 3Â² for Trinity)
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  FUNCTIONS:
    BALANCE:
      id: "balance"
      emoji: "ğŸ’"
      name_ru: "ĞœĞ¾Ğ¹ Ğ±Ğ°Ğ»Ğ°Ğ½Ñ"
      name_en: "My Balance"
      desc_ru: "ĞŸÑ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ Ñ‚ĞµĞºÑƒÑ‰ĞµĞ³Ğ¾ Ğ±Ğ°Ğ»Ğ°Ğ½ÑĞ°"
      desc_en: "View current balance"
      callback: "payment_balance"

    BUY_STARS:
      id: "buy_stars"
      emoji: "â­"
      name_ru: "ĞšÑƒĞ¿Ğ¸Ñ‚ÑŒ Ğ·Ğ²Ñ‘Ğ·Ğ´Ñ‹"
      name_en: "Buy Stars"
      desc_ru: "ĞŸĞ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ÑŒ Ñ‡ĞµÑ€ĞµĞ· Telegram"
      desc_en: "Top up via Telegram"
      callback: "payment_buy_stars"

    BUY_RUBLES:
      id: "buy_rubles"
      emoji: "ğŸ’³"
      name_ru: "ĞĞ¿Ğ»Ğ°Ñ‚Ğ° Ñ€ÑƒĞ±Ğ»ÑĞ¼Ğ¸"
      name_en: "Pay with Rubles"
      desc_ru: "ĞĞ¿Ğ»Ğ°Ñ‚Ğ° ĞºĞ°Ñ€Ñ‚Ğ¾Ğ¹ Ğ¸Ğ»Ğ¸ Ğ¡Ğ‘ĞŸ"
      desc_en: "Pay with card or SBP"
      callback: "payment_buy_rubles"

    SUBSCRIPTION:
      id: "subscription"
      emoji: "ğŸ‘‘"
      name_ru: "ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑĞºĞ°"
      name_en: "Subscription"
      desc_ru: "ĞŸÑ€ĞµĞ¼Ğ¸ÑƒĞ¼ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞºĞ°"
      desc_en: "Premium subscription"
      callback: "payment_subscription"
      is_new: true

    GIFT_STARS:
      id: "gift_stars"
      emoji: "ğŸ"
      name_ru: "ĞŸĞ¾Ğ´Ğ°Ñ€Ğ¸Ñ‚ÑŒ Ğ·Ğ²Ñ‘Ğ·Ğ´Ñ‹"
      name_en: "Gift Stars"
      desc_ru: "ĞŸĞ¾Ğ´Ğ°Ñ€Ğ¸Ñ‚Ğµ Ğ·Ğ²Ñ‘Ğ·Ğ´Ñ‹ Ğ´Ñ€ÑƒĞ³Ñƒ"
      desc_en: "Gift stars to a friend"
      callback: "payment_gift"

    PAYMENT_HISTORY:
      id: "payment_history"
      emoji: "ğŸ“‹"
      name_ru: "Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ¿Ğ»Ğ°Ñ‚ĞµĞ¶ĞµĞ¹"
      name_en: "Payment History"
      desc_ru: "Ğ’ÑĞµ Ğ²Ğ°ÑˆĞ¸ Ñ‚Ñ€Ğ°Ğ½Ğ·Ğ°ĞºÑ†Ğ¸Ğ¸"
      desc_en: "All your transactions"
      callback: "payment_history"

    WITHDRAWAL:
      id: "withdrawal"
      emoji: "ğŸ’¸"
      name_ru: "Ğ’Ñ‹Ğ²Ğ¾Ğ´ ÑÑ€ĞµĞ´ÑÑ‚Ğ²"
      name_en: "Withdrawal"
      desc_ru: "Ğ’Ñ‹Ğ²Ğ¾Ğ´ Ğ·Ğ°Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ·Ğ²Ñ‘Ğ·Ğ´"
      desc_en: "Withdraw earned stars"
      callback: "payment_withdrawal"

    RECEIPTS:
      id: "receipts"
      emoji: "ğŸ§¾"
      name_ru: "Ğ§ĞµĞºĞ¸"
      name_en: "Receipts"
      desc_ru: "Ğ§ĞµĞºĞ¸ Ğ¸ ĞºĞ²Ğ¸Ñ‚Ğ°Ğ½Ñ†Ğ¸Ğ¸"
      desc_en: "Receipts and invoices"
      callback: "payment_receipts"

    PAYMENT_HELP:
      id: "payment_help"
      emoji: "â“"
      name_ru: "ĞŸĞ¾Ğ¼Ğ¾Ñ‰ÑŒ"
      name_en: "Help"
      desc_ru: "FAQ Ğ¿Ğ¾ Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ğµ"
      desc_en: "Payment FAQ"
      callback: "payment_help"

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # STAR PACKAGES
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  STAR_PACKAGES:
    - id: "pack_50"
      stars: 50
      price_rubles: 75
      bonus_percent: 0

    - id: "pack_100"
      stars: 100
      price_rubles: 150
      bonus_percent: 0

    - id: "pack_250"
      stars: 250
      price_rubles: 350
      bonus_percent: 7
      is_popular: true

    - id: "pack_500"
      stars: 500
      price_rubles: 650
      bonus_percent: 13

    - id: "pack_1000"
      stars: 1000
      price_rubles: 1200
      bonus_percent: 20

    - id: "pack_2500"
      stars: 2500
      price_rubles: 2750
      bonus_percent: 27

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # SUBSCRIPTION PLANS
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  SUBSCRIPTION_PLANS:
    BASIC:
      id: "basic"
      name_ru: "Ğ‘Ğ°Ğ·Ğ¾Ğ²Ñ‹Ğ¹"
      name_en: "Basic"
      price_stars: 100
      price_rubles: 150
      duration_days: 30
      bonus_stars: 50
      features:
        - "50 Ğ±Ğ¾Ğ½ÑƒÑĞ½Ñ‹Ñ… Ğ·Ğ²Ñ‘Ğ·Ğ´"
        - "Ğ¡ĞºĞ¸Ğ´ĞºĞ° 10% Ğ½Ğ° Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸"
        - "ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚Ğ½Ğ°Ñ Ğ¾Ñ‡ĞµÑ€ĞµĞ´ÑŒ"

    PRO:
      id: "pro"
      name_ru: "ĞŸÑ€Ğ¾"
      name_en: "Pro"
      price_stars: 300
      price_rubles: 400
      duration_days: 30
      bonus_stars: 200
      features:
        - "200 Ğ±Ğ¾Ğ½ÑƒÑĞ½Ñ‹Ñ… Ğ·Ğ²Ñ‘Ğ·Ğ´"
        - "Ğ¡ĞºĞ¸Ğ´ĞºĞ° 20% Ğ½Ğ° Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸"
        - "ĞŸÑ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚Ğ½Ğ°Ñ Ğ¾Ñ‡ĞµÑ€ĞµĞ´ÑŒ"
        - "Ğ­ĞºÑĞºĞ»ÑĞ·Ğ¸Ğ²Ğ½Ñ‹Ğµ Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸"

    PREMIUM:
      id: "premium"
      name_ru: "ĞŸÑ€ĞµĞ¼Ğ¸ÑƒĞ¼"
      name_en: "Premium"
      price_stars: 500
      price_rubles: 650
      duration_days: 30
      bonus_stars: 500
      features:
        - "500 Ğ±Ğ¾Ğ½ÑƒÑĞ½Ñ‹Ñ… Ğ·Ğ²Ñ‘Ğ·Ğ´"
        - "Ğ¡ĞºĞ¸Ğ´ĞºĞ° 30% Ğ½Ğ° Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸"
        - "ĞœĞ°ĞºÑĞ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¿Ñ€Ğ¸Ğ¾Ñ€Ğ¸Ñ‚ĞµÑ‚"
        - "Ğ’ÑĞµ Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸"
        - "ĞŸĞµÑ€ÑĞ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ°"

  # Currency
  STAR_TO_RUB: 1.5
  MIN_PURCHASE: 50
  MAX_PURCHASE: 10000

  # Layout
  COLUMNS: 3
  ROWS: 3
