name: digital_identity
version: "1.0.0"
language: zig
module: digital_identity

description: |
  Digital identity for VIBEE Telegram bot avatars.
  Persistent avatar profile with appearance, voice, style.
  Foundation for AI-powered digital twins.

# ═══════════════════════════════════════════════════════════════════════════════
# TYPES
# ═══════════════════════════════════════════════════════════════════════════════

types:
  IdentityService:
    description: "Digital identity service"
    fields:
      config: ServiceConfig
      database: Object
      storage: Object
      replicate_client: Object
      stats: ServiceStats
      is_initialized: Bool

  ServiceConfig:
    description: "Service configuration"
    fields:
      storage_bucket: String
      max_avatars_per_user: Int
      default_style: String
      enable_nsfw_filter: Bool
      cache_ttl_seconds: Int

  ServiceStats:
    description: "Service statistics"
    fields:
      avatars_created: Int
      avatars_updated: Int
      faces_generated: Int
      voices_cloned: Int
      total_storage_bytes: Int

  # ─────────────────────────────────────────────────────────────────────────────
  # AVATAR IDENTITY
  # ─────────────────────────────────────────────────────────────────────────────

  Avatar:
    description: "Digital avatar"
    fields:
      avatar_id: String
      telegram_id: Int
      name: String
      display_name: String
      bio: Option<String>
      appearance: AvatarAppearance
      voice: Option<AvatarVoice>
      style: AvatarStyle
      status: AvatarStatus
      is_primary: Bool
      created_at: Timestamp
      updated_at: Timestamp
      metadata: Object

  AvatarStatus:
    description: "Avatar status"
    values:
      - creating
      - active
      - inactive
      - suspended
      - deleted

  AvatarSummary:
    description: "Avatar summary for lists"
    fields:
      avatar_id: String
      name: String
      thumbnail_url: Option<String>
      is_primary: Bool
      status: AvatarStatus

  # ─────────────────────────────────────────────────────────────────────────────
  # APPEARANCE
  # ─────────────────────────────────────────────────────────────────────────────

  AvatarAppearance:
    description: "Avatar appearance"
    fields:
      face: FaceData
      body: Option<BodyData>
      style_preset: StylePreset
      custom_attributes: Object

  FaceData:
    description: "Face data"
    fields:
      source_type: FaceSourceType
      source_image_url: Option<String>
      generated_image_url: Option<String>
      face_embedding: Option<String>
      face_landmarks: Option<Object>
      age_estimate: Option<Int>
      gender: Option<Gender>
      ethnicity: Option<String>
      expressions: List<Expression>

  FaceSourceType:
    description: "Face source type"
    values:
      - uploaded_photo
      - generated
      - ai_enhanced
      - composite

  Gender:
    description: "Gender"
    values:
      - male
      - female
      - non_binary
      - unspecified

  Expression:
    description: "Facial expression"
    fields:
      expression_id: String
      name: String
      image_url: String
      is_default: Bool

  BodyData:
    description: "Body data"
    fields:
      body_type: BodyType
      height_cm: Option<Int>
      build: Option<Build>
      skin_tone: Option<String>
      full_body_image_url: Option<String>

  BodyType:
    description: "Body type"
    values:
      - realistic
      - stylized
      - anime
      - cartoon

  Build:
    description: "Body build"
    values:
      - slim
      - average
      - athletic
      - muscular
      - plus_size

  StylePreset:
    description: "Style preset"
    values:
      - photorealistic
      - artistic
      - anime
      - cartoon
      - pixar
      - comic
      - oil_painting
      - watercolor
      - sketch

  # ─────────────────────────────────────────────────────────────────────────────
  # VOICE
  # ─────────────────────────────────────────────────────────────────────────────

  AvatarVoice:
    description: "Avatar voice"
    fields:
      voice_id: String
      voice_type: VoiceType
      provider: VoiceProvider
      name: String
      language: String
      accent: Option<String>
      gender: Gender
      age_range: AgeRange
      characteristics: VoiceCharacteristics
      sample_url: Option<String>
      is_cloned: Bool
      clone_status: Option<CloneStatus>

  VoiceType:
    description: "Voice type"
    values:
      - preset
      - cloned
      - generated

  VoiceProvider:
    description: "Voice provider"
    values:
      - elevenlabs
      - openai
      - azure
      - google
      - local

  AgeRange:
    description: "Age range"
    values:
      - child
      - teen
      - young_adult
      - adult
      - middle_aged
      - senior

  VoiceCharacteristics:
    description: "Voice characteristics"
    fields:
      pitch: VoicePitch
      speed: VoiceSpeed
      tone: VoiceTone
      stability: Float
      similarity_boost: Float
      style_exaggeration: Float

  VoicePitch:
    description: "Voice pitch"
    values:
      - very_low
      - low
      - medium
      - high
      - very_high

  VoiceSpeed:
    description: "Voice speed"
    values:
      - very_slow
      - slow
      - normal
      - fast
      - very_fast

  VoiceTone:
    description: "Voice tone"
    values:
      - warm
      - neutral
      - professional
      - friendly
      - authoritative
      - playful
      - serious

  CloneStatus:
    description: "Voice clone status"
    values:
      - pending
      - processing
      - ready
      - failed

  # ─────────────────────────────────────────────────────────────────────────────
  # STYLE
  # ─────────────────────────────────────────────────────────────────────────────

  AvatarStyle:
    description: "Avatar style"
    fields:
      visual_style: VisualStyle
      color_palette: ColorPalette
      clothing_style: Option<ClothingStyle>
      background_style: Option<BackgroundStyle>
      effects: List<VisualEffect>

  VisualStyle:
    description: "Visual style"
    fields:
      preset: StylePreset
      custom_prompt: Option<String>
      negative_prompt: Option<String>
      guidance_scale: Float
      style_strength: Float

  ColorPalette:
    description: "Color palette"
    fields:
      primary_color: String
      secondary_color: Option<String>
      accent_color: Option<String>
      background_color: Option<String>

  ClothingStyle:
    description: "Clothing style"
    values:
      - casual
      - formal
      - business
      - sporty
      - creative
      - fantasy
      - futuristic

  BackgroundStyle:
    description: "Background style"
    values:
      - transparent
      - solid_color
      - gradient
      - studio
      - outdoor
      - office
      - abstract
      - custom

  VisualEffect:
    description: "Visual effect"
    values:
      - none
      - soft_glow
      - dramatic_lighting
      - vintage
      - cyberpunk
      - neon
      - film_grain

  # ─────────────────────────────────────────────────────────────────────────────
  # GENERATION
  # ─────────────────────────────────────────────────────────────────────────────

  GenerateFaceInput:
    description: "Generate face input"
    fields:
      prompt: String
      negative_prompt: Option<String>
      style_preset: StylePreset
      gender: Option<Gender>
      age_range: Option<AgeRange>
      ethnicity: Option<String>
      seed: Option<Int>

  GenerateFaceOutput:
    description: "Generate face output"
    fields:
      image_url: String
      face_embedding: String
      seed_used: Int
      generation_time_ms: Int

  EnhanceFaceInput:
    description: "Enhance face input"
    fields:
      image_url: String
      enhancement_type: EnhancementType
      strength: Float

  EnhancementType:
    description: "Enhancement type"
    values:
      - upscale
      - restore
      - beautify
      - age_progression
      - age_regression
      - style_transfer

  CloneVoiceInput:
    description: "Clone voice input"
    fields:
      telegram_id: Int
      name: String
      audio_samples: List<String>
      description: Option<String>

  CloneVoiceOutput:
    description: "Clone voice output"
    fields:
      voice_id: String
      status: CloneStatus
      sample_url: Option<String>
      estimated_time_seconds: Option<Int>

  # ─────────────────────────────────────────────────────────────────────────────
  # ASSETS
  # ─────────────────────────────────────────────────────────────────────────────

  AvatarAsset:
    description: "Avatar asset"
    fields:
      asset_id: String
      avatar_id: String
      asset_type: AssetType
      url: String
      thumbnail_url: Option<String>
      file_size: Int
      content_type: String
      metadata: Object
      created_at: Timestamp

  AssetType:
    description: "Asset type"
    values:
      - profile_image
      - face_image
      - body_image
      - expression
      - voice_sample
      - video_clip
      - background

  # ─────────────────────────────────────────────────────────────────────────────
  # ERRORS
  # ─────────────────────────────────────────────────────────────────────────────

  IdentityError:
    description: "Identity error"
    fields:
      code: ErrorCode
      message: String
      details: Option<String>

  ErrorCode:
    description: "Error code"
    values:
      - avatar_not_found
      - avatar_limit_reached
      - invalid_image
      - face_not_detected
      - voice_clone_failed
      - nsfw_detected
      - storage_error
      - generation_failed

# ═══════════════════════════════════════════════════════════════════════════════
# BEHAVIORS
# ═══════════════════════════════════════════════════════════════════════════════

behaviors:
  # ─────────────────────────────────────────────────────────────────────────────
  # LIFECYCLE
  # ─────────────────────────────────────────────────────────────────────────────

  - name: create_service
    given: ServiceConfig
    when: Creating service
    then: Return IdentityService

  - name: initialize
    given: No parameters
    when: Initializing service
    then: Setup connections

  - name: get_stats
    given: No parameters
    when: Getting statistics
    then: Return ServiceStats

  # ─────────────────────────────────────────────────────────────────────────────
  # AVATAR CRUD
  # ─────────────────────────────────────────────────────────────────────────────

  - name: create_avatar
    given: Telegram ID and name
    when: Creating avatar
    then: Return Avatar

  - name: get_avatar
    given: Avatar ID
    when: Getting avatar
    then: Return Avatar

  - name: get_user_avatars
    given: Telegram ID
    when: Getting user avatars
    then: Return avatar list

  - name: get_primary_avatar
    given: Telegram ID
    when: Getting primary avatar
    then: Return Avatar

  - name: update_avatar
    given: Avatar ID and updates
    when: Updating avatar
    then: Return Avatar

  - name: delete_avatar
    given: Avatar ID
    when: Deleting avatar
    then: Return success

  - name: set_primary_avatar
    given: Avatar ID
    when: Setting primary
    then: Return success

  # ─────────────────────────────────────────────────────────────────────────────
  # APPEARANCE
  # ─────────────────────────────────────────────────────────────────────────────

  - name: set_face_from_photo
    given: Avatar ID and image URL
    when: Setting face from photo
    then: Return FaceData

  - name: generate_face
    given: Avatar ID and GenerateFaceInput
    when: Generating face
    then: Return GenerateFaceOutput

  - name: enhance_face
    given: Avatar ID and EnhanceFaceInput
    when: Enhancing face
    then: Return enhanced image URL

  - name: add_expression
    given: Avatar ID and expression name
    when: Adding expression
    then: Return Expression

  - name: set_style_preset
    given: Avatar ID and StylePreset
    when: Setting style
    then: Return success

  - name: update_appearance
    given: Avatar ID and AvatarAppearance
    when: Updating appearance
    then: Return Avatar

  # ─────────────────────────────────────────────────────────────────────────────
  # VOICE
  # ─────────────────────────────────────────────────────────────────────────────

  - name: set_preset_voice
    given: Avatar ID and voice ID
    when: Setting preset voice
    then: Return AvatarVoice

  - name: clone_voice
    given: Avatar ID and CloneVoiceInput
    when: Cloning voice
    then: Return CloneVoiceOutput

  - name: get_clone_status
    given: Voice ID
    when: Getting clone status
    then: Return CloneStatus

  - name: update_voice_settings
    given: Avatar ID and VoiceCharacteristics
    when: Updating voice settings
    then: Return AvatarVoice

  - name: get_available_voices
    given: Language and gender
    when: Getting available voices
    then: Return voice list

  - name: preview_voice
    given: Voice ID and text
    when: Previewing voice
    then: Return audio URL

  # ─────────────────────────────────────────────────────────────────────────────
  # STYLE
  # ─────────────────────────────────────────────────────────────────────────────

  - name: update_style
    given: Avatar ID and AvatarStyle
    when: Updating style
    then: Return Avatar

  - name: set_color_palette
    given: Avatar ID and ColorPalette
    when: Setting colors
    then: Return success

  - name: apply_visual_effect
    given: Avatar ID and VisualEffect
    when: Applying effect
    then: Return image URL

  - name: get_style_presets
    given: No parameters
    when: Getting presets
    then: Return preset list

  # ─────────────────────────────────────────────────────────────────────────────
  # ASSETS
  # ─────────────────────────────────────────────────────────────────────────────

  - name: upload_asset
    given: Avatar ID, type, and data
    when: Uploading asset
    then: Return AvatarAsset

  - name: get_assets
    given: Avatar ID and type
    when: Getting assets
    then: Return asset list

  - name: delete_asset
    given: Asset ID
    when: Deleting asset
    then: Return success

  - name: get_storage_usage
    given: Telegram ID
    when: Getting storage usage
    then: Return bytes used

  # ─────────────────────────────────────────────────────────────────────────────
  # EXPORT/IMPORT
  # ─────────────────────────────────────────────────────────────────────────────

  - name: export_avatar
    given: Avatar ID
    when: Exporting avatar
    then: Return export data

  - name: import_avatar
    given: Telegram ID and export data
    when: Importing avatar
    then: Return Avatar

  - name: duplicate_avatar
    given: Avatar ID and new name
    when: Duplicating avatar
    then: Return Avatar

# ═══════════════════════════════════════════════════════════════════════════════
# CONSTANTS
# ═══════════════════════════════════════════════════════════════════════════════

constants:
  DEFAULT_MAX_AVATARS: 5
  DEFAULT_CACHE_TTL: 3600
  DEFAULT_STORAGE_BUCKET: "avatars"

  # Face generation
  DEFAULT_FACE_SIZE: 1024
  MIN_FACE_SIZE: 256
  MAX_FACE_SIZE: 2048
  DEFAULT_GUIDANCE_SCALE: 7.5

  # Voice cloning
  MIN_VOICE_SAMPLES: 1
  MAX_VOICE_SAMPLES: 25
  MIN_SAMPLE_DURATION_SECONDS: 30
  MAX_SAMPLE_SIZE_MB: 10

  # Storage limits
  MAX_ASSET_SIZE_MB: 50
  MAX_STORAGE_PER_USER_GB: 5

  # Style defaults
  DEFAULT_STYLE_STRENGTH: 0.8
  DEFAULT_STABILITY: 0.5
  DEFAULT_SIMILARITY_BOOST: 0.75
