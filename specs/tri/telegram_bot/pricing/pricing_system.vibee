# Централизованная система ценообразования
# Реальные цены из 999-multibots-telegraf/src/interfaces/paidServices.ts
# и unified-video-models.config.ts

name: pricing_system
version: "2.0.0"
language: zig
module: pricing_system

# Формула: stars = (baseCostUSD / STAR_COST_USD) * MARKUP_MULTIPLIER
# Где: STAR_COST_USD = 0.016, MARKUP_MULTIPLIER = 1.5 (150% наценка)

constants:
  # Стоимость 1 звезды Telegram в USD
  STAR_COST_USD: 0.016
  
  # Наценка 150% (покупаем за 100, продаём за 150)
  MARKUP_MULTIPLIER: 1.5
  
  # ═══════════════════════════════════════════════════════════════
  # ИЗОБРАЖЕНИЯ - РЕАЛЬНЫЕ ЦЕНЫ ИЗ paidServices.ts
  # ═══════════════════════════════════════════════════════════════
  
  # NeuroPhoto: baseCostUSD = 0.08
  # stars = (0.08 / 0.016) * 1.5 = 5 * 1.5 = 7.5 -> 7 stars
  NEURO_PHOTO_BASE_USD: 0.08
  NEURO_PHOTO_STARS: 7
  
  # NeuroPhoto V2: baseCostUSD = 0.14
  # stars = (0.14 / 0.016) * 1.5 = 8.75 * 1.5 = 13.125 -> 13 stars
  NEURO_PHOTO_V2_BASE_USD: 0.14
  NEURO_PHOTO_V2_STARS: 13
  
  # ImageToPrompt: baseCostUSD = 0.03
  # stars = (0.03 / 0.016) * 1.5 = 1.875 * 1.5 = 2.8 -> 2 stars
  IMAGE_TO_PROMPT_BASE_USD: 0.03
  IMAGE_TO_PROMPT_STARS: 2
  
  # ImageUpscaler: baseCostUSD = 0.04
  # stars = (0.04 / 0.016) * 1.5 = 2.5 * 1.5 = 3.75 -> 3 stars
  IMAGE_UPSCALER_BASE_USD: 0.04
  IMAGE_UPSCALER_STARS: 3
  
  # ═══════════════════════════════════════════════════════════════
  # АУДИО - РЕАЛЬНЫЕ ЦЕНЫ ИЗ paidServices.ts
  # ═══════════════════════════════════════════════════════════════
  
  # TextToSpeech: baseCostUSD = 0.12
  # stars = (0.12 / 0.016) * 1.5 = 7.5 * 1.5 = 11.25 -> 11 stars
  TEXT_TO_SPEECH_BASE_USD: 0.12
  TEXT_TO_SPEECH_STARS: 11
  
  # Voice (голосовой аватар): baseCostUSD = 0.90
  # stars = (0.90 / 0.016) * 1.5 = 56.25 * 1.5 = 84.375 -> 84 stars
  VOICE_CLONE_BASE_USD: 0.90
  VOICE_CLONE_STARS: 84
  
  # VoiceToText: baseCostUSD = 0.08
  # stars = (0.08 / 0.016) * 1.5 = 5 * 1.5 = 7.5 -> 7 stars
  VOICE_TO_TEXT_BASE_USD: 0.08
  VOICE_TO_TEXT_STARS: 7
  
  # LipSync: baseCostUSD = 0.90
  # stars = (0.90 / 0.016) * 1.5 = 56.25 * 1.5 = 84.375 -> 84 stars
  LIP_SYNC_BASE_USD: 0.90
  LIP_SYNC_STARS: 84
  
  # VideoTranscription: baseCostUSD = 0.03
  # stars = (0.03 / 0.016) * 1.5 = 1.875 * 1.5 = 2.8 -> 2 stars
  VIDEO_TRANSCRIPTION_BASE_USD: 0.03
  VIDEO_TRANSCRIPTION_STARS: 2
  
  # ═══════════════════════════════════════════════════════════════
  # ВИДЕО - РЕАЛЬНЫЕ ЦЕНЫ ИЗ unified-video-models.config.ts
  # Kie.ai модели (активные)
  # ═══════════════════════════════════════════════════════════════
  
  # Veo 3 Fast: $0.40 фиксированная (8 сек)
  # stars = 25 (уже с наценкой в конфиге)
  VEO3_FAST_STARS: 25
  VEO3_FAST_DURATION: 8
  
  # Veo 3: $2.00 фиксированная (8 сек)
  # stars = 125 (уже с наценкой в конфиге)
  VEO3_STARS: 125
  VEO3_DURATION: 8
  
  # Sora 2: $0.15 фиксированная (10 сек)
  # stars = 9 (уже с наценкой в конфиге)
  SORA2_STARS: 9
  SORA2_DURATION: 10
  
  # Sora 2 Pro: $0.30 фиксированная (10 сек)
  # stars = 19 (уже с наценкой в конфиге)
  SORA2_PRO_STARS: 19
  SORA2_PRO_DURATION: 10
  
  # Sora 2 I2V: $0.15 фиксированная (10 сек)
  SORA2_I2V_STARS: 9
  
  # Sora 2 Pro I2V: $0.30 фиксированная (10 сек)
  SORA2_PRO_I2V_STARS: 19
  
  # Runway Aleph: $0.485/сек
  # 6 сек x $0.485 x 1.5 / $0.016 = 182 stars
  RUNWAY_ALEPH_PER_SECOND_USD: 0.485
  RUNWAY_ALEPH_6SEC_STARS: 182
  
  # WAN 2.5 T2V/I2V: матрица цен
  WAN_5SEC_720P_STARS: 19
  WAN_5SEC_1080P_STARS: 31
  WAN_10SEC_720P_STARS: 38
  WAN_10SEC_1080P_STARS: 62
  
  # ═══════════════════════════════════════════════════════════════
  # ВИДЕО - Replicate модели (deprecated, но для справки)
  # ═══════════════════════════════════════════════════════════════
  
  # Kling v1.6 Pro: 9 stars фиксированная
  KLING_V16_PRO_STARS: 9
  
  # Ray v2: 16 stars фиксированная
  RAY_V2_STARS: 16
  
  # Haiper Video 2: $0.05 x 1.5 / $0.016 = 5 stars
  HAIPER_V2_STARS: 5
  
  # Kling v1.6 Standard: $0.056/сек
  KLING_V16_STD_PER_SECOND_USD: 0.056
  
  # Kling v2.0: $0.28/сек
  KLING_V20_PER_SECOND_USD: 0.28
  
  # Kling v2.1 Standard: $0.05/сек
  KLING_V21_STD_PER_SECOND_USD: 0.05
  
  # Kling v2.1 Pro: $0.09/сек
  KLING_V21_PRO_PER_SECOND_USD: 0.09
  
  # Kling v2.5 Turbo Pro: $0.098/сек
  KLING_V25_TURBO_PRO_PER_SECOND_USD: 0.098
  
  # Seedance Pro: по разрешению
  SEEDANCE_480P_STARS: 3
  SEEDANCE_1080P_STARS: 14
  
  # ═══════════════════════════════════════════════════════════════
  # АВАТАРЫ - СЛОЖНЫЙ РАСЧЁТ (зависит от шагов обучения)
  # ═══════════════════════════════════════════════════════════════
  
  # Digital Avatar Body: сложный расчёт
  # Базовая цена зависит от количества шагов обучения
  AVATAR_TRAINING_BASE_STARS: 100
  AVATAR_TRAINING_PER_STEP_USD: 0.001

types:
  # Тип расчёта стоимости
  PricingType:
    enum:
      - SIMPLE
      - PER_SECOND
      - PER_RESOLUTION
      - PER_DURATION
      - MATRIX
      - COMPLEX
  
  # Категория сервиса
  ServiceCategory:
    enum:
      - IMAGE
      - VIDEO
      - AUDIO
      - AVATAR
  
  # Конфигурация платного сервиса
  PaidServiceConfig:
    fields:
      name: String
      name_ru: String
      pricing_type: PricingType
      base_cost_usd: Float
      stars_price: Int
      category: ServiceCategory
      description: String
  
  # Результат расчёта цены
  PriceCalculation:
    fields:
      base_cost_usd: Float
      stars_without_markup: Int
      stars_with_markup: Int
      markup_percent: Int

behaviors:
  - name: usd_to_stars
    given: Сумма в USD
    when: Конвертация в звёзды с наценкой
    then: Возвращает количество звёзд (floor)
    formula: floor((usd / STAR_COST_USD) * MARKUP_MULTIPLIER)
  
  - name: usd_to_stars_no_markup
    given: Сумма в USD
    when: Конвертация в звёзды без наценки
    then: Возвращает количество звёзд (floor)
    formula: floor(usd / STAR_COST_USD)
  
  - name: stars_to_usd
    given: Количество звёзд
    when: Конвертация в USD
    then: Возвращает сумму в USD
    formula: stars * STAR_COST_USD
  
  - name: calculate_video_price
    given: Модель видео, длительность, разрешение
    when: Расчёт цены видео
    then: Возвращает цену в звёздах по матрице или формуле
  
  - name: calculate_avatar_price
    given: Количество шагов обучения
    when: Расчёт цены аватара
    then: Возвращает цену в звёздах
    formula: AVATAR_TRAINING_BASE_STARS + floor((steps * AVATAR_TRAINING_PER_STEP_USD / STAR_COST_USD) * MARKUP_MULTIPLIER)
  
  - name: get_service_price
    given: Идентификатор сервиса
    when: Запрос цены
    then: Возвращает PriceCalculation с полной информацией

# Таблица соответствия сервисов и цен
service_prices:
  # Изображения
  neuro_photo:
    base_usd: 0.08
    stars: 7
  neuro_photo_v2:
    base_usd: 0.14
    stars: 13
  image_to_prompt:
    base_usd: 0.03
    stars: 2
  image_upscaler:
    base_usd: 0.04
    stars: 3
  
  # Аудио
  text_to_speech:
    base_usd: 0.12
    stars: 11
  voice_clone:
    base_usd: 0.90
    stars: 84
  voice_to_text:
    base_usd: 0.08
    stars: 7
  lip_sync:
    base_usd: 0.90
    stars: 84
  video_transcription:
    base_usd: 0.03
    stars: 2
  
  # Видео (Kie.ai - активные)
  veo3_fast:
    type: fixed
    stars: 25
    duration: 8
  veo3:
    type: fixed
    stars: 125
    duration: 8
  sora2:
    type: fixed
    stars: 9
    duration: 10
  sora2_pro:
    type: fixed
    stars: 19
    duration: 10
  runway_aleph:
    type: per_second
    per_second_usd: 0.485
  wan_2_5:
    type: matrix
    matrix:
      5_720p: 19
      5_1080p: 31
      10_720p: 38
      10_1080p: 62
