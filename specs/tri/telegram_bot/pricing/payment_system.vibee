name: payment_system
version: "4.0.0"
language: zig
module: payment_system

description: |
  ĞŸĞ›ĞĞ¢Ğ•Ğ–ĞĞĞ¯ Ğ¡Ğ˜Ğ¡Ğ¢Ğ•ĞœĞ VIBEE
  
  ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµĞ¼Ñ‹Ğµ Ğ¼ĞµÑ‚Ğ¾Ğ´Ñ‹ Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ñ‹:
  1. Telegram Stars (XTR) - Ğ²ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ½Ñ‹Ğµ Ğ¿Ğ»Ğ°Ñ‚ĞµĞ¶Ğ¸ Telegram
  2. Ğ ÑƒĞ±Ğ»Ğ¸ Ñ‡ĞµÑ€ĞµĞ· Robokassa - ĞºĞ°Ñ€Ñ‚Ñ‹, Ğ¡Ğ‘ĞŸ
  3. CryptoBot (USDT) - ĞºÑ€Ğ¸Ğ¿Ñ‚Ğ¾Ğ²Ğ°Ğ»ÑÑ‚Ğ° Ñ‡ĞµÑ€ĞµĞ· @CryptoBot
  
  Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ñ 999-multibots-telegraf/src/handlers/paymentHandlers/handleTopUp.ts

imports:
  - pricing_system

types:
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # ĞœĞ•Ğ¢ĞĞ”Ğ« ĞĞŸĞ›ĞĞ¢Ğ«
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  PaymentMethod:
    description: "ĞœĞµÑ‚Ğ¾Ğ´ Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ñ‹"
    variants:
      - TelegramStars    # Telegram Stars (XTR)
      - Robokassa        # Ğ ÑƒĞ±Ğ»Ğ¸ Ñ‡ĞµÑ€ĞµĞ· Robokassa
      - YooKassa         # Ğ ÑƒĞ±Ğ»Ğ¸ Ñ‡ĞµÑ€ĞµĞ· YooKassa
      - CryptoBot        # USDT Ñ‡ĞµÑ€ĞµĞ· @CryptoBot
      - TON              # TON Ñ‡ĞµÑ€ĞµĞ· TON Connect (Ğ¿Ğ»Ğ°Ğ½Ğ¸Ñ€ÑƒĞµÑ‚ÑÑ)

  PaymentStatus:
    description: "Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ Ğ¿Ğ»Ğ°Ñ‚ĞµĞ¶Ğ°"
    variants:
      - Pending          # ĞĞ¶Ğ¸Ğ´Ğ°ĞµÑ‚ Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ñ‹
      - Processing       # ĞĞ±Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ
      - Completed        # Ğ—Ğ°Ğ²ĞµÑ€ÑˆÑ‘Ğ½ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾
      - Failed           # ĞÑˆĞ¸Ğ±ĞºĞ°
      - Refunded         # Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚
      - Cancelled        # ĞÑ‚Ğ¼ĞµĞ½Ñ‘Ğ½

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # TELEGRAM STARS
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  StarInvoice:
    description: "Ğ¡Ñ‡Ñ‘Ñ‚ Ğ½Ğ° Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ñƒ Ğ² Telegram Stars"
    fields:
      title: String
      description: String
      payload: String
      currency: String           # "XTR"
      prices: List<LabeledPrice>
      provider_token: Option<String>

  LabeledPrice:
    description: "ĞŸĞ¾Ğ·Ğ¸Ñ†Ğ¸Ñ Ğ² ÑÑ‡Ñ‘Ñ‚Ğµ"
    fields:
      label: String
      amount: Int                # Ğ’ Ğ¼Ğ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ñ… ĞµĞ´Ğ¸Ğ½Ğ¸Ñ†Ğ°Ñ… (1 star = 1)

  PreCheckoutQuery:
    description: "Ğ—Ğ°Ğ¿Ñ€Ğ¾Ñ Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ñ Ğ¿ĞµÑ€ĞµĞ´ Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ğ¾Ğ¹"
    fields:
      id: String
      from_id: Int
      currency: String
      total_amount: Int
      invoice_payload: String

  SuccessfulPayment:
    description: "Ğ£ÑĞ¿ĞµÑˆĞ½Ñ‹Ğ¹ Ğ¿Ğ»Ğ°Ñ‚Ñ‘Ğ¶"
    fields:
      currency: String
      total_amount: Int
      invoice_payload: String
      telegram_payment_charge_id: String
      provider_payment_charge_id: String

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # ROBOKASSA
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  RobokassaConfig:
    description: "ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ Robokassa"
    fields:
      merchant_login: String
      password1: String          # Ğ”Ğ»Ñ Ñ„Ğ¾Ñ€Ğ¼Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ¸
      password2: String          # Ğ”Ğ»Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ¸
      test_mode: Bool
      result_url: String
      success_url: String
      fail_url: String

  RobokassaInvoice:
    description: "Ğ¡Ñ‡Ñ‘Ñ‚ Robokassa"
    fields:
      inv_id: Int
      out_sum: Float
      description: String
      signature: String
      is_test: Bool

  RobokassaCallback:
    description: "Callback Ğ¾Ñ‚ Robokassa"
    fields:
      out_sum: Float
      inv_id: Int
      signature: String
      is_valid: Bool

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # CRYPTOBOT (USDT)
  # Ğ˜Ğ· 999-multibots-telegraf/src/handlers/paymentHandlers/handleTopUp.ts
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  CryptoBotConfig:
    description: "ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ CryptoBot"
    fields:
      api_token: String          # Ğ¢Ğ¾ĞºĞµĞ½ Ğ¾Ñ‚ @CryptoBot
      api_url: String            # https://pay.crypt.bot/api
      webhook_url: String        # URL Ğ´Ğ»Ñ webhook
      test_mode: Bool

  CryptoBotAsset:
    description: "ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµĞ¼Ñ‹Ğµ ĞºÑ€Ğ¸Ğ¿Ñ‚Ğ¾Ğ²Ğ°Ğ»ÑÑ‚Ñ‹"
    variants:
      - USDT                     # Tether USD
      - TON                      # Toncoin
      - BTC                      # Bitcoin
      - ETH                      # Ethereum
      - USDC                     # USD Coin

  CryptoBotInvoice:
    description: "Ğ¡Ñ‡Ñ‘Ñ‚ CryptoBot"
    fields:
      invoice_id: Int
      bot_invoice_url: String    # URL Ğ´Ğ»Ñ Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ñ‹
      mini_app_invoice_url: String
      web_app_invoice_url: String
      asset: CryptoBotAsset
      amount: String             # Ğ¡ÑƒĞ¼Ğ¼Ğ° Ğ² ĞºÑ€Ğ¸Ğ¿Ñ‚Ğ¾Ğ²Ğ°Ğ»ÑÑ‚Ğµ
      description: String
      status: String             # active, paid, expired
      created_at: Timestamp
      paid_at: Option<Timestamp>
      expiration_date: Option<Timestamp>

  CryptoBotPayment:
    description: "ĞŸĞ»Ğ°Ñ‚Ñ‘Ğ¶ CryptoBot"
    fields:
      payment_id: Int
      invoice_id: Int
      user_id: String            # Telegram ID Ğ¿Ğ»Ğ°Ñ‚ĞµĞ»ÑŒÑ‰Ğ¸ĞºĞ°
      asset: CryptoBotAsset
      amount: String
      paid_at: Timestamp
      fee: Option<String>

  CryptoBotWebhook:
    description: "Webhook Ğ¾Ñ‚ CryptoBot"
    fields:
      update_id: Int
      update_type: String        # invoice_paid
      request_date: Timestamp
      payload: CryptoBotPayment

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # Ğ—ĞĞŸĞ˜Ğ¡Ğ˜ ĞŸĞ›ĞĞ¢Ğ•Ğ–Ğ•Ğ™
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  PaymentRecord:
    description: "Ğ—Ğ°Ğ¿Ğ¸ÑÑŒ Ğ¾ Ğ¿Ğ»Ğ°Ñ‚ĞµĞ¶Ğµ Ğ² Ğ‘Ğ”"
    fields:
      id: String
      user_id: String
      telegram_id: String
      method: PaymentMethod
      status: PaymentStatus
      amount_stars: Int
      amount_rubles: Option<Float>
      amount_usd: Option<Float>
      service: Option<String>
      description: String
      external_id: Option<String>
      created_at: Timestamp
      completed_at: Option<Timestamp>
      metadata: Option<Object>

  PaymentIntent:
    description: "ĞĞ°Ğ¼ĞµÑ€ĞµĞ½Ğ¸Ğµ Ğ¿Ğ»Ğ°Ñ‚ĞµĞ¶Ğ°"
    fields:
      user_id: String
      telegram_id: String
      amount_stars: Int
      service: Option<String>
      description: String
      method: PaymentMethod

behaviors:
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # TELEGRAM STARS
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  - name: create_star_invoice
    given: ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ·Ğ²Ñ‘Ğ·Ğ´ Ğ¸ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ
    when: Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ ÑÑ‡Ñ‘Ñ‚Ğ°
    then: Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ StarInvoice

  - name: send_invoice
    given: Context Ğ¸ StarInvoice
    when: ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° ÑÑ‡Ñ‘Ñ‚Ğ° Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
    then: ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ invoice message

  - name: handle_pre_checkout
    given: PreCheckoutQuery
    when: ĞŸĞ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ğµ Ğ¿ĞµÑ€ĞµĞ´ Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ğ¾Ğ¹
    then: Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ ok Ğ¸Ğ»Ğ¸ error

  - name: handle_successful_payment
    given: SuccessfulPayment
    when: ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾Ğ³Ğ¾ Ğ¿Ğ»Ğ°Ñ‚ĞµĞ¶Ğ°
    then: ĞĞ°Ñ‡Ğ¸ÑĞ»ÑĞµÑ‚ Ğ·Ğ²Ñ‘Ğ·Ğ´Ñ‹ Ğ¸ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑĞµÑ‚ Ğ·Ğ°Ğ¿Ğ¸ÑÑŒ

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # ROBOKASSA
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  - name: create_robokassa_invoice
    given: Ğ¡ÑƒĞ¼Ğ¼Ğ° Ğ² Ñ€ÑƒĞ±Ğ»ÑÑ… Ğ¸ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ
    when: Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ ÑÑ‡Ñ‘Ñ‚Ğ°
    then: Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ RobokassaInvoice Ñ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑÑŒÑ

  - name: get_robokassa_payment_url
    given: RobokassaInvoice
    when: ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ URL Ğ´Ğ»Ñ Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ñ‹
    then: Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ URL

  - name: verify_robokassa_callback
    given: RobokassaCallback
    when: ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ¸
    then: Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ true ĞµÑĞ»Ğ¸ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑÑŒ Ğ²ĞµÑ€Ğ½Ğ°

  - name: handle_robokassa_result
    given: RobokassaCallback
    when: ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ°
    then: ĞĞ°Ñ‡Ğ¸ÑĞ»ÑĞµÑ‚ Ğ·Ğ²Ñ‘Ğ·Ğ´Ñ‹ ĞµÑĞ»Ğ¸ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑÑŒ Ğ²ĞµÑ€Ğ½Ğ°

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # CRYPTOBOT (USDT)
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  - name: create_cryptobot_invoice
    given: Ğ¡ÑƒĞ¼Ğ¼Ğ° Ğ² USDT Ğ¸ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ
    when: Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ ÑÑ‡Ñ‘Ñ‚Ğ° Ñ‡ĞµÑ€ĞµĞ· CryptoBot API
    then: Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ CryptoBotInvoice Ñ URL Ğ´Ğ»Ñ Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ñ‹

  - name: get_cryptobot_invoice_status
    given: Invoice ID
    when: ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑÑ‚Ğ°Ñ‚ÑƒÑĞ° ÑÑ‡Ñ‘Ñ‚Ğ°
    then: Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğ¹ ÑÑ‚Ğ°Ñ‚ÑƒÑ (active/paid/expired)

  - name: handle_cryptobot_webhook
    given: CryptoBotWebhook
    when: ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ webhook Ğ¾ Ğ¿Ğ»Ğ°Ñ‚ĞµĞ¶Ğµ
    then: ĞĞ°Ñ‡Ğ¸ÑĞ»ÑĞµÑ‚ Ğ·Ğ²Ñ‘Ğ·Ğ´Ñ‹ Ğ¸ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑĞµÑ‚ ÑÑ‚Ğ°Ñ‚ÑƒÑ

  - name: verify_cryptobot_signature
    given: Webhook body Ğ¸ signature header
    when: ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞ¸ webhook
    then: Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ true ĞµÑĞ»Ğ¸ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑÑŒ Ğ²ĞµÑ€Ğ½Ğ°

  - name: convert_usdt_to_stars
    given: Ğ¡ÑƒĞ¼Ğ¼Ğ° Ğ² USDT
    when: ĞšĞ¾Ğ½Ğ²ĞµÑ€Ñ‚Ğ°Ñ†Ğ¸Ñ Ğ² Ğ·Ğ²Ñ‘Ğ·Ğ´Ñ‹
    then: Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ·Ğ²Ñ‘Ğ·Ğ´ (1 USDT = 62.5 stars)
    formula: floor(usdt_amount / STAR_COST_USD)

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # ĞĞ‘Ğ©Ğ˜Ğ• Ğ¤Ğ£ĞĞšĞ¦Ğ˜Ğ˜
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  - name: create_payment_intent
    given: PaymentIntent
    when: Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ½Ğ°Ğ¼ĞµÑ€ĞµĞ½Ğ¸Ñ Ğ¿Ğ»Ğ°Ñ‚ĞµĞ¶Ğ°
    then: Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµÑ‚ Ğ² Ğ‘Ğ” Ğ¸ Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ ID

  - name: complete_payment
    given: Payment ID Ğ¸ external ID
    when: Ğ—Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¸Ğµ Ğ¿Ğ»Ğ°Ñ‚ĞµĞ¶Ğ°
    then: ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµÑ‚ ÑÑ‚Ğ°Ñ‚ÑƒÑ Ğ¸ Ğ½Ğ°Ñ‡Ğ¸ÑĞ»ÑĞµÑ‚ Ğ·Ğ²Ñ‘Ğ·Ğ´Ñ‹

  - name: refund_payment
    given: Payment ID
    when: Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚ Ğ¿Ğ»Ğ°Ñ‚ĞµĞ¶Ğ°
    then: Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ Ğ·Ğ²Ñ‘Ğ·Ğ´Ñ‹ Ğ¸ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ÑĞµÑ‚ ÑÑ‚Ğ°Ñ‚ÑƒÑ

  - name: get_payment_history
    given: User ID Ğ¸ Ğ¿Ğ°Ğ³Ğ¸Ğ½Ğ°Ñ†Ğ¸Ñ
    when: ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ Ğ¸ÑÑ‚Ğ¾Ñ€Ğ¸Ğ¸
    then: Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ ÑĞ¿Ğ¸ÑĞ¾Ğº PaymentRecord

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # Ğ‘ĞĞ›ĞĞĞ¡
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  - name: get_user_balance
    given: Telegram ID
    when: ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ Ğ±Ğ°Ğ»Ğ°Ğ½ÑĞ°
    then: Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ·Ğ²Ñ‘Ğ·Ğ´

  - name: add_stars
    given: Telegram ID Ğ¸ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾
    when: ĞĞ°Ñ‡Ğ¸ÑĞ»ĞµĞ½Ğ¸Ğµ Ğ·Ğ²Ñ‘Ğ·Ğ´
    then: ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµÑ‚ Ğ±Ğ°Ğ»Ğ°Ğ½Ñ

  - name: deduct_stars
    given: Telegram ID Ğ¸ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾
    when: Ğ¡Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ğ·Ğ²Ñ‘Ğ·Ğ´
    then: ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµÑ‚ Ğ±Ğ°Ğ»Ğ°Ğ½Ñ Ğ¸Ğ»Ğ¸ Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ Ğ¾ÑˆĞ¸Ğ±ĞºÑƒ

  - name: check_balance
    given: Telegram ID Ğ¸ Ñ‚Ñ€ĞµĞ±ÑƒĞµĞ¼Ğ°Ñ ÑÑƒĞ¼Ğ¼Ğ°
    when: ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ±Ğ°Ğ»Ğ°Ğ½ÑĞ°
    then: Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ true ĞµÑĞ»Ğ¸ Ğ´Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ñ‡Ğ½Ğ¾

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # UI Ğ¤Ğ£ĞĞšĞ¦Ğ˜Ğ˜
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  - name: show_payment_menu
    given: Context
    when: ĞŸĞ¾ĞºĞ°Ğ· Ğ¼ĞµĞ½Ñ Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ñ‹
    then: ĞÑ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶Ğ°ĞµÑ‚ Ğ²Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚Ñ‹ Ğ¿Ğ¾Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ

  - name: show_star_packages
    given: Context Ğ¸ ÑĞ·Ñ‹Ğº
    when: ĞŸĞ¾ĞºĞ°Ğ· Ğ¿Ğ°ĞºĞµÑ‚Ğ¾Ğ² Ğ·Ğ²Ñ‘Ğ·Ğ´
    then: ĞÑ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶Ğ°ĞµÑ‚ Ğ¿Ğ°ĞºĞµÑ‚Ñ‹ Ñ Ñ†ĞµĞ½Ğ°Ğ¼Ğ¸

  - name: show_balance
    given: Context
    when: ĞŸĞ¾ĞºĞ°Ğ· Ğ±Ğ°Ğ»Ğ°Ğ½ÑĞ°
    then: ĞÑ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶Ğ°ĞµÑ‚ Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğ¹ Ğ±Ğ°Ğ»Ğ°Ğ½Ñ

  - name: show_insufficient_balance
    given: Context Ğ¸ Ñ‚Ñ€ĞµĞ±ÑƒĞµĞ¼Ğ°Ñ ÑÑƒĞ¼Ğ¼Ğ°
    when: ĞĞµĞ´Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ ÑÑ€ĞµĞ´ÑÑ‚Ğ²
    then: ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ñ ĞºĞ½Ğ¾Ğ¿ĞºĞ¾Ğ¹ Ğ¿Ğ¾Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ

constants:
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # TELEGRAM STARS
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  CURRENCY_XTR: "XTR"
  MIN_STARS_INVOICE: 1
  MAX_STARS_INVOICE: 10000
  STAR_COST_USD: 0.016

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # ROBOKASSA
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  ROBOKASSA_URL: "https://auth.robokassa.ru/Merchant/Index.aspx"
  ROBOKASSA_TEST_URL: "https://auth.robokassa.ru/Merchant/Index.aspx"

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # CRYPTOBOT
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  CRYPTOBOT_API_URL: "https://pay.crypt.bot/api"
  CRYPTOBOT_DEFAULT_ASSET: "USDT"
  CRYPTOBOT_INVOICE_LIFETIME: 3600  # 1 Ñ‡Ğ°Ñ Ğ² ÑĞµĞºÑƒĞ½Ğ´Ğ°Ñ…
  
  # ĞšĞ¾Ğ½Ğ²ĞµÑ€Ñ‚Ğ°Ñ†Ğ¸Ñ: 1 USDT = 1 USD = 62.5 stars (1 / 0.016)
  USDT_TO_STARS_RATE: 62.5

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # Ğ¡ĞĞĞ‘Ğ©Ğ•ĞĞ˜Ğ¯
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  MESSAGES:
    BALANCE:
      ru: "ğŸ’ Ğ’Ğ°Ñˆ Ğ±Ğ°Ğ»Ğ°Ğ½Ñ: {balance}â­"
      en: "ğŸ’ Your balance: {balance}â­"

    INSUFFICIENT:
      ru: "âŒ ĞĞµĞ´Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ Ğ·Ğ²Ñ‘Ğ·Ğ´!\n\nĞÑƒĞ¶Ğ½Ğ¾: {required}â­\nĞ£ Ğ²Ğ°Ñ: {current}â­\nĞĞµ Ñ…Ğ²Ğ°Ñ‚Ğ°ĞµÑ‚: {shortfall}â­"
      en: "âŒ Not enough stars!\n\nNeed: {required}â­\nYou have: {current}â­\nShortfall: {shortfall}â­"

    PAYMENT_SUCCESS:
      ru: "âœ… ĞĞ¿Ğ»Ğ°Ñ‚Ğ° Ğ¿Ñ€Ğ¾ÑˆĞ»Ğ° ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾!\n\nĞ—Ğ°Ñ‡Ğ¸ÑĞ»ĞµĞ½Ğ¾: {amount}â­\nĞĞ¾Ğ²Ñ‹Ğ¹ Ğ±Ğ°Ğ»Ğ°Ğ½Ñ: {balance}â­"
      en: "âœ… Payment successful!\n\nAdded: {amount}â­\nNew balance: {balance}â­"

    PAYMENT_FAILED:
      ru: "âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ñ‹. ĞŸĞ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹Ñ‚Ğµ ĞµÑ‰Ñ‘ Ñ€Ğ°Ğ·."
      en: "âŒ Payment failed. Please try again."

    SELECT_PACKAGE:
      ru: "ğŸ’° Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ¿Ğ°ĞºĞµÑ‚ Ğ·Ğ²Ñ‘Ğ·Ğ´ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ:"
      en: "ğŸ’° Select a star package to top up:"

    SELECT_METHOD:
      ru: "ğŸ’³ Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ ÑĞ¿Ğ¾ÑĞ¾Ğ± Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ñ‹:"
      en: "ğŸ’³ Select payment method:"

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # ĞšĞĞĞŸĞšĞ˜
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  BUTTONS:
    PAY_STARS:
      ru: "ĞĞ¿Ğ»Ğ°Ñ‚Ğ¸Ñ‚ÑŒ Ğ·Ğ²Ñ‘Ğ·Ğ´Ğ°Ğ¼Ğ¸"
      en: "Pay with Stars"

    PAY_RUBLES:
      ru: "ĞĞ¿Ğ»Ğ°Ñ‚Ğ¸Ñ‚ÑŒ Ñ€ÑƒĞ±Ğ»ÑĞ¼Ğ¸"
      en: "Pay with Rubles"

    PAY_CRYPTO:
      ru: "ĞĞ¿Ğ»Ğ°Ñ‚Ğ¸Ñ‚ÑŒ USDT"
      en: "Pay with USDT"

    TOP_UP:
      ru: "ĞŸĞ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ÑŒ Ğ±Ğ°Ğ»Ğ°Ğ½Ñ"
      en: "Top Up Balance"

    HISTORY:
      ru: "Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ¿Ğ»Ğ°Ñ‚ĞµĞ¶ĞµĞ¹"
      en: "Payment History"

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # CRYPTOBOT Ğ¡ĞĞĞ‘Ğ©Ğ•ĞĞ˜Ğ¯
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  CRYPTO_MESSAGES:
    INVOICE_CREATED:
      ru: "Ğ¡Ñ‡ĞµÑ‚ Ğ´Ğ»Ñ Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ñ‹ ÑĞ¾Ğ·Ğ´Ğ°Ğ½!\n\nĞ¡ÑƒĞ¼Ğ¼Ğ°: {amount} USDT\nID Ğ¿Ğ»Ğ°Ñ‚ĞµĞ¶Ğ°: {payment_id}"
      en: "Invoice created!\n\nAmount: {amount} USDT\nPayment ID: {payment_id}"

    PAYMENT_RECEIVED:
      ru: "ĞĞ¿Ğ»Ğ°Ñ‚Ğ° Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ°!\n\nĞ—Ğ°Ñ‡Ğ¸ÑĞ»ĞµĞ½Ğ¾: {stars} Ğ·Ğ²Ñ‘Ğ·Ğ´\nĞĞ¾Ğ²Ñ‹Ğ¹ Ğ±Ğ°Ğ»Ğ°Ğ½Ñ: {balance}"
      en: "Payment received!\n\nAdded: {stars} stars\nNew balance: {balance}"

    INVOICE_EXPIRED:
      ru: "Ğ¡Ñ€Ğ¾Ğº Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ ÑÑ‡Ñ‘Ñ‚Ğ° Ğ¸ÑÑ‚Ñ‘Ğº. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ¹Ñ‚Ğµ Ğ½Ğ¾Ğ²Ñ‹Ğ¹."
      en: "Invoice expired. Please create a new one."

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # ĞŸĞĞšĞ•Ğ¢Ğ« ĞŸĞĞŸĞĞ›ĞĞ•ĞĞ˜Ğ¯
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  TOP_UP_PACKAGES:
    - stars: 100
      usd: 1.60
      usdt: 1.60
      rubles: 160
    - stars: 500
      usd: 8.00
      usdt: 8.00
      rubles: 800
    - stars: 1000
      usd: 16.00
      usdt: 16.00
      rubles: 1600
    - stars: 5000
      usd: 80.00
      usdt: 80.00
      rubles: 8000
