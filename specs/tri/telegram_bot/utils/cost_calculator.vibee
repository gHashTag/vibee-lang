name: cost_calculator
version: "1.0.0"
language: zig
module: cost_calculator

description: |
  Cost calculator utility for VIBEE Telegram bot.
  Handles pricing calculations for all services.

imports:
  - paid_services
  - modes

types:
  CostInput:
    description: "Input for cost calculation"
    fields:
      mode: String
      steps: Option<Int>
      num_images: Option<Int>
      duration: Option<Int>
      model_id: Option<String>

  CostOutput:
    description: "Calculated cost"
    fields:
      stars: Int
      rubles: Float
      dollars: Float
      breakdown: Option<Object>

  PricingTier:
    description: "Pricing tier"
    fields:
      name: String
      min_amount: Int
      discount_percent: Float

behaviors:
  - name: calculate_cost
    given: CostInput
    when: Calculating service cost
    then: Returns CostOutput

  - name: calculate_neuro_photo_cost
    given: Num images
    when: Calculating neuro photo cost
    then: Returns CostOutput

  - name: calculate_video_cost
    given: Model ID and duration
    when: Calculating video cost
    then: Returns CostOutput

  - name: calculate_training_cost
    given: Steps count
    when: Calculating training cost
    then: Returns CostOutput

  - name: calculate_tts_cost
    given: Text length
    when: Calculating TTS cost
    then: Returns CostOutput

  - name: stars_to_rubles
    given: Stars amount
    when: Converting currency
    then: Returns rubles

  - name: rubles_to_stars
    given: Rubles amount
    when: Converting currency
    then: Returns stars

  - name: stars_to_dollars
    given: Stars amount
    when: Converting currency
    then: Returns dollars

  - name: apply_discount
    given: Cost and discount percent
    when: Applying discount
    then: Returns discounted cost

  - name: get_pricing_tier
    given: Total spent
    when: Getting user tier
    then: Returns PricingTier

constants:
  STAR_COST_USD: 0.016
  STAR_COST_RUB: 1.5
  DEFAULT_MARKUP: 1.5
  
  # Base costs per service
  NEURO_PHOTO_BASE: 5
  IMAGE_TO_PROMPT_BASE: 2
  TTS_BASE: 8
  VOICE_CLONE_BASE: 56
  LIP_SYNC_BASE: 56
  VIDEO_TRANSCRIPTION_BASE: 2
