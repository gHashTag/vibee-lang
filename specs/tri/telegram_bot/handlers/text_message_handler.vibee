name: text_message_handler
version: "1.0.0"
language: zig
module: text_message_handler

description: |
  Text message handler for VIBEE Telegram bot.
  Handles user text input in various scenes.

imports:
  - telegram
  - user
  - modes

types:
  TextMessageResult:
    description: "Text message handling result"
    fields:
      success: Bool
      response: Option<String>
      next_action: Option<String>

  PromptValidation:
    description: "Prompt validation result"
    fields:
      is_valid: Bool
      error_message: Option<String>
      sanitized_prompt: Option<String>

behaviors:
  - name: handle_text_message
    given: Context with text message
    when: User sends text
    then: Returns TextMessageResult

  - name: validate_prompt
    given: User prompt text
    when: Validating input
    then: Returns PromptValidation

  - name: sanitize_prompt
    given: Raw prompt text
    when: Cleaning input
    then: Returns sanitized prompt

  - name: detect_language
    given: Text string
    when: Detecting language
    then: Returns language code

  - name: handle_prompt_input
    given: Context and prompt
    when: User enters prompt for generation
    then: Saves prompt and proceeds

  - name: handle_email_input
    given: Context and email
    when: User enters email
    then: Validates and saves email

  - name: handle_company_input
    given: Context and company name
    when: User enters company for avatar
    then: Saves company info

  - name: handle_skills_input
    given: Context and skills
    when: User enters skills for avatar
    then: Saves skills info

  - name: is_command
    given: Text string
    when: Checking if text is command
    then: Returns true if starts with /

  - name: extract_command
    given: Text string
    when: Extracting command
    then: Returns command name and args

constants:
  MAX_PROMPT_LENGTH: 2000
  MIN_PROMPT_LENGTH: 3
