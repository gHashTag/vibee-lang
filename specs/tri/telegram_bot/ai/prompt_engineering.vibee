name: prompt_engineering
version: "1.0.0"
language: zig
module: prompt_engineering

description: |
  Prompt engineering for VIBEE Telegram bot.
  Prompt enhancement, translation, style injection, safety filtering.
  Supports multiple languages and generation types.

# ═══════════════════════════════════════════════════════════════════════════════
# TYPES
# ═══════════════════════════════════════════════════════════════════════════════

types:
  PromptEngine:
    description: "Prompt engineering engine"
    fields:
      config: EngineConfig
      style_library: StyleLibrary
      safety_filter: SafetyFilter
      translator: Option<Object>
      stats: EngineStats
      is_initialized: Bool

  EngineConfig:
    description: "Engine configuration"
    fields:
      default_language: String
      enable_translation: Bool
      enable_enhancement: Bool
      enable_safety_filter: Bool
      max_prompt_length: Int
      max_negative_prompt_length: Int
      style_injection_mode: StyleInjectionMode

  EngineStats:
    description: "Engine statistics"
    fields:
      prompts_processed: Int
      prompts_enhanced: Int
      prompts_translated: Int
      prompts_filtered: Int
      average_enhancement_time_ms: Int

  StyleInjectionMode:
    description: "Style injection mode"
    values:
      - prepend
      - append
      - replace
      - merge

  # ─────────────────────────────────────────────────────────────────────────────
  # PROMPT TYPES
  # ─────────────────────────────────────────────────────────────────────────────

  Prompt:
    description: "Processed prompt"
    fields:
      original: String
      processed: String
      negative: Option<String>
      language: String
      style: Option<String>
      tokens_estimated: Int
      is_safe: Bool
      warnings: List<String>

  PromptInput:
    description: "Prompt input"
    fields:
      text: String
      negative_text: Option<String>
      language: Option<String>
      style: Option<String>
      generation_type: GenerationType
      enhance: Bool
      translate_to: Option<String>

  GenerationType:
    description: "Generation type"
    values:
      - text_to_image
      - image_to_image
      - text_to_video
      - image_to_video
      - text_to_audio
      - text_to_speech

  PromptResult:
    description: "Prompt processing result"
    fields:
      prompt: Prompt
      enhancements_applied: List<String>
      translation_applied: Bool
      safety_checks_passed: Bool
      processing_time_ms: Int

  # ─────────────────────────────────────────────────────────────────────────────
  # STYLES
  # ─────────────────────────────────────────────────────────────────────────────

  StyleLibrary:
    description: "Style library"
    fields:
      styles: List<Style>
      categories: List<StyleCategory>

  Style:
    description: "Style definition"
    fields:
      style_id: String
      name: String
      display_name: String
      description: String
      category: StyleCategory
      prompt_prefix: Option<String>
      prompt_suffix: Option<String>
      negative_prompt: Option<String>
      keywords: List<String>
      examples: List<String>
      compatible_types: List<GenerationType>
      is_active: Bool

  StyleCategory:
    description: "Style category"
    values:
      - photorealistic
      - artistic
      - anime
      - cartoon
      - cinematic
      - abstract
      - vintage
      - futuristic
      - minimalist
      - fantasy
      - horror
      - portrait
      - landscape
      - product
      - architecture

  StylePreset:
    description: "Style preset"
    fields:
      preset_id: String
      name: String
      styles: List<String>
      weight_distribution: List<Float>

  # ─────────────────────────────────────────────────────────────────────────────
  # ENHANCEMENT
  # ─────────────────────────────────────────────────────────────────────────────

  EnhancementOptions:
    description: "Enhancement options"
    fields:
      add_quality_tags: Bool
      add_lighting_tags: Bool
      add_composition_tags: Bool
      add_detail_tags: Bool
      expand_short_prompts: Bool
      fix_grammar: Bool
      remove_duplicates: Bool
      optimize_for_model: Option<String>

  EnhancementResult:
    description: "Enhancement result"
    fields:
      original: String
      enhanced: String
      tags_added: List<String>
      changes_made: List<String>
      confidence: Float

  QualityTag:
    description: "Quality tag"
    values:
      - masterpiece
      - best_quality
      - high_quality
      - ultra_detailed
      - sharp_focus
      - professional
      - award_winning
      - 8k_uhd
      - raw_photo
      - photorealistic

  LightingTag:
    description: "Lighting tag"
    values:
      - natural_lighting
      - studio_lighting
      - dramatic_lighting
      - soft_lighting
      - golden_hour
      - blue_hour
      - backlit
      - rim_lighting
      - volumetric_lighting
      - neon_lighting

  # ─────────────────────────────────────────────────────────────────────────────
  # SAFETY
  # ─────────────────────────────────────────────────────────────────────────────

  SafetyFilter:
    description: "Safety filter"
    fields:
      blocked_words: List<String>
      blocked_patterns: List<String>
      sensitivity_level: SensitivityLevel
      allow_artistic_nudity: Bool
      allow_violence_context: Bool

  SensitivityLevel:
    description: "Sensitivity level"
    values:
      - strict
      - moderate
      - permissive

  SafetyCheckResult:
    description: "Safety check result"
    fields:
      is_safe: Bool
      violations: List<SafetyViolation>
      filtered_prompt: Option<String>
      confidence: Float

  SafetyViolation:
    description: "Safety violation"
    fields:
      category: ViolationCategory
      severity: ViolationSeverity
      matched_text: String
      suggestion: Option<String>

  ViolationCategory:
    description: "Violation category"
    values:
      - explicit_content
      - violence
      - hate_speech
      - illegal_content
      - personal_info
      - copyright
      - spam

  ViolationSeverity:
    description: "Violation severity"
    values:
      - low
      - medium
      - high
      - critical

  # ─────────────────────────────────────────────────────────────────────────────
  # TRANSLATION
  # ─────────────────────────────────────────────────────────────────────────────

  TranslationResult:
    description: "Translation result"
    fields:
      original: String
      translated: String
      source_language: String
      target_language: String
      confidence: Float
      alternatives: List<String>

  SupportedLanguage:
    description: "Supported language"
    values:
      - en
      - ru
      - es
      - fr
      - de
      - it
      - pt
      - zh
      - ja
      - ko
      - ar
      - hi
      - tr
      - pl
      - uk

  # ─────────────────────────────────────────────────────────────────────────────
  # TEMPLATES
  # ─────────────────────────────────────────────────────────────────────────────

  PromptTemplate:
    description: "Prompt template"
    fields:
      template_id: String
      name: String
      description: String
      template: String
      variables: List<TemplateVariable>
      category: StyleCategory
      generation_type: GenerationType
      examples: List<TemplateExample>

  TemplateVariable:
    description: "Template variable"
    fields:
      name: String
      description: String
      var_type: VariableType
      required: Bool
      default_value: Option<String>
      options: Option<List<String>>

  VariableType:
    description: "Variable type"
    values:
      - text
      - select
      - number
      - color
      - boolean

  TemplateExample:
    description: "Template example"
    fields:
      variables: Object
      result: String
      image_url: Option<String>

  # ─────────────────────────────────────────────────────────────────────────────
  # ERRORS
  # ─────────────────────────────────────────────────────────────────────────────

  PromptError:
    description: "Prompt error"
    fields:
      code: ErrorCode
      message: String
      details: Option<String>

  ErrorCode:
    description: "Error code"
    values:
      - empty_prompt
      - prompt_too_long
      - invalid_language
      - translation_failed
      - safety_violation
      - invalid_style
      - template_error

# ═══════════════════════════════════════════════════════════════════════════════
# BEHAVIORS
# ═══════════════════════════════════════════════════════════════════════════════

behaviors:
  # ─────────────────────────────────────────────────────────────────────────────
  # LIFECYCLE
  # ─────────────────────────────────────────────────────────────────────────────

  - name: create_engine
    given: EngineConfig
    when: Creating engine
    then: Return PromptEngine

  - name: initialize
    given: No parameters
    when: Initializing engine
    then: Load styles and filters

  - name: get_stats
    given: No parameters
    when: Getting statistics
    then: Return EngineStats

  # ─────────────────────────────────────────────────────────────────────────────
  # PROMPT PROCESSING
  # ─────────────────────────────────────────────────────────────────────────────

  - name: process_prompt
    given: PromptInput
    when: Processing prompt
    then: Return PromptResult

  - name: validate_prompt
    given: Prompt text
    when: Validating prompt
    then: Return validation result

  - name: normalize_prompt
    given: Prompt text
    when: Normalizing prompt
    then: Return normalized text

  - name: tokenize_prompt
    given: Prompt text
    when: Tokenizing prompt
    then: Return token count

  # ─────────────────────────────────────────────────────────────────────────────
  # ENHANCEMENT
  # ─────────────────────────────────────────────────────────────────────────────

  - name: enhance_prompt
    given: Prompt and EnhancementOptions
    when: Enhancing prompt
    then: Return EnhancementResult

  - name: add_quality_tags
    given: Prompt and generation type
    when: Adding quality tags
    then: Return enhanced prompt

  - name: add_style_tags
    given: Prompt and style
    when: Adding style tags
    then: Return enhanced prompt

  - name: expand_prompt
    given: Short prompt
    when: Expanding prompt
    then: Return expanded prompt

  - name: optimize_for_model
    given: Prompt and model ID
    when: Optimizing for model
    then: Return optimized prompt

  # ─────────────────────────────────────────────────────────────────────────────
  # STYLES
  # ─────────────────────────────────────────────────────────────────────────────

  - name: get_styles
    given: Optional category
    when: Getting styles
    then: Return style list

  - name: get_style
    given: Style ID
    when: Getting style
    then: Return Style

  - name: apply_style
    given: Prompt and style ID
    when: Applying style
    then: Return styled prompt

  - name: combine_styles
    given: Prompt and style IDs
    when: Combining styles
    then: Return combined prompt

  - name: get_style_presets
    given: Generation type
    when: Getting presets
    then: Return preset list

  # ─────────────────────────────────────────────────────────────────────────────
  # SAFETY
  # ─────────────────────────────────────────────────────────────────────────────

  - name: check_safety
    given: Prompt text
    when: Checking safety
    then: Return SafetyCheckResult

  - name: filter_prompt
    given: Prompt text
    when: Filtering prompt
    then: Return filtered prompt

  - name: get_blocked_words
    given: No parameters
    when: Getting blocked words
    then: Return word list

  - name: add_blocked_word
    given: Word
    when: Adding blocked word
    then: Return success

  - name: remove_blocked_word
    given: Word
    when: Removing blocked word
    then: Return success

  # ─────────────────────────────────────────────────────────────────────────────
  # TRANSLATION
  # ─────────────────────────────────────────────────────────────────────────────

  - name: translate_prompt
    given: Prompt and target language
    when: Translating prompt
    then: Return TranslationResult

  - name: detect_language
    given: Prompt text
    when: Detecting language
    then: Return language code

  - name: get_supported_languages
    given: No parameters
    when: Getting languages
    then: Return language list

  # ─────────────────────────────────────────────────────────────────────────────
  # TEMPLATES
  # ─────────────────────────────────────────────────────────────────────────────

  - name: get_templates
    given: Optional category
    when: Getting templates
    then: Return template list

  - name: get_template
    given: Template ID
    when: Getting template
    then: Return PromptTemplate

  - name: apply_template
    given: Template ID and variables
    when: Applying template
    then: Return generated prompt

  - name: validate_template_variables
    given: Template and variables
    when: Validating variables
    then: Return validation result

  # ─────────────────────────────────────────────────────────────────────────────
  # NEGATIVE PROMPTS
  # ─────────────────────────────────────────────────────────────────────────────

  - name: generate_negative_prompt
    given: Prompt and generation type
    when: Generating negative
    then: Return negative prompt

  - name: get_default_negative
    given: Generation type
    when: Getting default negative
    then: Return negative prompt

  - name: merge_negative_prompts
    given: Negative prompts list
    when: Merging negatives
    then: Return merged prompt

# ═══════════════════════════════════════════════════════════════════════════════
# CONSTANTS
# ═══════════════════════════════════════════════════════════════════════════════

constants:
  DEFAULT_MAX_PROMPT_LENGTH: 4000
  DEFAULT_MAX_NEGATIVE_LENGTH: 2000
  DEFAULT_LANGUAGE: "en"

  # Quality tags
  QUALITY_TAGS_PHOTO: "masterpiece, best quality, ultra detailed, sharp focus, professional photography, 8k uhd"
  QUALITY_TAGS_ART: "masterpiece, best quality, highly detailed, intricate details, award winning"
  QUALITY_TAGS_ANIME: "masterpiece, best quality, highly detailed, beautiful, anime style"

  # Default negative prompts
  NEGATIVE_PHOTO: "blurry, low quality, distorted, deformed, ugly, bad anatomy, watermark, signature, text"
  NEGATIVE_ART: "low quality, blurry, distorted, deformed, ugly, amateur, watermark, signature"
  NEGATIVE_ANIME: "low quality, blurry, bad anatomy, extra limbs, missing limbs, deformed, ugly"

  # Lighting presets
  LIGHTING_NATURAL: "natural lighting, soft shadows, ambient light"
  LIGHTING_STUDIO: "studio lighting, professional lighting, softbox"
  LIGHTING_DRAMATIC: "dramatic lighting, high contrast, chiaroscuro"
  LIGHTING_GOLDEN: "golden hour, warm sunlight, soft glow"

  # Style keywords
  STYLE_CINEMATIC: "cinematic, movie still, film grain, anamorphic"
  STYLE_PORTRAIT: "portrait photography, shallow depth of field, bokeh"
  STYLE_LANDSCAPE: "landscape photography, wide angle, scenic view"
  STYLE_PRODUCT: "product photography, clean background, commercial"
