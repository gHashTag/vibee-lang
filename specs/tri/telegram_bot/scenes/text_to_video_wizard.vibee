name: text_to_video_wizard
version: "1.0.0"
language: zig
module: text_to_video_wizard

description: |
  Text-to-video wizard scene for VIBEE Telegram bot.
  Handles the multi-step flow for generating videos from text.

imports:
  - telegram
  - user
  - text_to_video
  - cost_calculator

types:
  VideoWizardStep:
    description: "Video wizard step enum"
    variants:
      - SelectModel
      - EnterPrompt
      - SelectAspectRatio
      - SelectDuration
      - ConfirmGeneration
      - Processing
      - Complete

  VideoWizardState:
    description: "Video wizard state"
    fields:
      step: VideoWizardStep
      selected_model: Option<String>
      prompt: Option<String>
      aspect_ratio: Option<String>
      duration: Option<Int>
      cost: Option<Int>
      job_id: Option<String>

  VideoStepResult:
    description: "Step processing result"
    fields:
      success: Bool
      next_step: Option<VideoWizardStep>
      message: Option<String>
      error: Option<String>

behaviors:
  - name: enter_wizard
    given: Context
    when: Entering wizard
    then: Initializes state and shows first step

  - name: handle_step
    given: Context and input
    when: Processing step
    then: Returns VideoStepResult

  - name: handle_select_model
    given: Context and model ID
    when: Model selected
    then: Saves model and proceeds

  - name: handle_enter_prompt
    given: Context and prompt text
    when: Prompt entered
    then: Validates and saves prompt

  - name: handle_select_aspect_ratio
    given: Context and ratio
    when: Ratio selected
    then: Saves aspect ratio

  - name: handle_select_duration
    given: Context and duration
    when: Duration selected
    then: Saves duration

  - name: handle_confirm
    given: Context
    when: User confirms
    then: Starts generation

  - name: handle_cancel
    given: Context
    when: User cancels
    then: Exits wizard

  - name: show_step
    given: Context and step
    when: Displaying step
    then: Sends appropriate message

  - name: get_available_models
    given: No parameters
    when: Fetching models
    then: Returns list of video models

  - name: start_generation
    given: Context and state
    when: Starting generation
    then: Initiates video generation

  - name: check_generation_status
    given: Job ID
    when: Checking status
    then: Returns status info

  - name: send_result
    given: Context and video URL
    when: Generation complete
    then: Sends generated video

constants:
  WIZARD_ID: "text_to_video_wizard"
  DEFAULT_DURATION: 5
  MAX_DURATION: 60
  ASPECT_RATIOS: ["16:9", "9:16", "1:1"]
  DURATION_OPTIONS: [5, 10, 15, 30]
