name: neuro_photo_wizard
version: "1.0.0"
language: zig
module: neuro_photo_wizard

description: |
  Neuro photo wizard scene for VIBEE Telegram bot.
  Handles the multi-step flow for generating AI photos.

imports:
  - telegram
  - user
  - neuro_photo
  - cost_calculator

types:
  WizardStep:
    description: "Wizard step enum"
    variants:
      - SelectModel
      - EnterPrompt
      - SelectSize
      - ConfirmGeneration
      - Processing
      - Complete

  WizardState:
    description: "Wizard state"
    fields:
      step: WizardStep
      selected_model: Option<String>
      prompt: Option<String>
      aspect_ratio: Option<String>
      num_images: Int
      cost: Option<Int>

  StepResult:
    description: "Step processing result"
    fields:
      success: Bool
      next_step: Option<WizardStep>
      message: Option<String>
      error: Option<String>

behaviors:
  - name: enter_wizard
    given: Context
    when: Entering wizard
    then: Initializes state and shows first step

  - name: handle_step
    given: Context and input
    when: Processing step
    then: Returns StepResult

  - name: handle_select_model
    given: Context and model ID
    when: Model selected
    then: Saves model and proceeds

  - name: handle_enter_prompt
    given: Context and prompt text
    when: Prompt entered
    then: Validates and saves prompt

  - name: handle_select_size
    given: Context and size
    when: Size selected
    then: Saves aspect ratio

  - name: handle_confirm
    given: Context
    when: User confirms
    then: Starts generation

  - name: handle_cancel
    given: Context
    when: User cancels
    then: Exits wizard

  - name: show_step
    given: Context and step
    when: Displaying step
    then: Sends appropriate message

  - name: get_available_models
    given: User ID
    when: Fetching models
    then: Returns list of user models

  - name: validate_prompt
    given: Prompt text
    when: Validating input
    then: Returns validation result

  - name: start_generation
    given: Context and state
    when: Starting generation
    then: Initiates AI generation

  - name: send_result
    given: Context and result URLs
    when: Generation complete
    then: Sends generated images

constants:
  WIZARD_ID: "neuro_photo_wizard"
  DEFAULT_NUM_IMAGES: 1
  MAX_PROMPT_LENGTH: 2000
