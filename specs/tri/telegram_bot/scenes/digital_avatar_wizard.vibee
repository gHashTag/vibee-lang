name: digital_avatar_wizard
version: "1.0.0"
language: zig
module: digital_avatar_wizard

description: |
  Digital avatar creation wizard for VIBEE Telegram bot.
  Handles the multi-step flow for creating user avatars.

imports:
  - telegram
  - user
  - model_training

types:
  AvatarWizardStep:
    description: "Avatar wizard step enum"
    variants:
      - EnterCompany
      - EnterPosition
      - EnterSkills
      - UploadPhotos
      - SelectSteps
      - ConfirmTraining
      - Processing
      - Complete

  AvatarWizardState:
    description: "Avatar wizard state"
    fields:
      step: AvatarWizardStep
      company: Option<String>
      position: Option<String>
      skills: Option<List<String>>
      photos: List<String>
      training_steps: Int
      cost: Option<Int>

  AvatarStepResult:
    description: "Step processing result"
    fields:
      success: Bool
      next_step: Option<AvatarWizardStep>
      message: Option<String>
      error: Option<String>

behaviors:
  - name: enter_wizard
    given: Context
    when: Entering wizard
    then: Initializes state and shows first step

  - name: handle_step
    given: Context and input
    when: Processing step
    then: Returns AvatarStepResult

  - name: handle_enter_company
    given: Context and company name
    when: Company entered
    then: Saves company and proceeds

  - name: handle_enter_position
    given: Context and position
    when: Position entered
    then: Saves position and proceeds

  - name: handle_enter_skills
    given: Context and skills text
    when: Skills entered
    then: Parses and saves skills

  - name: handle_photo_upload
    given: Context and photo
    when: Photo uploaded
    then: Adds to collection

  - name: handle_select_steps
    given: Context and steps count
    when: Steps selected
    then: Saves training steps

  - name: handle_confirm
    given: Context
    when: User confirms
    then: Starts training

  - name: handle_cancel
    given: Context
    when: User cancels
    then: Exits wizard

  - name: show_step
    given: Context and step
    when: Displaying step
    then: Sends appropriate message

  - name: validate_photos
    given: List of photos
    when: Validating uploads
    then: Returns validation result

  - name: start_training
    given: Context and state
    when: Starting training
    then: Initiates model training

  - name: check_training_progress
    given: Training ID
    when: Checking progress
    then: Returns progress info

  - name: send_training_complete
    given: Context and model URL
    when: Training complete
    then: Notifies user

constants:
  WIZARD_ID: "digital_avatar_wizard"
  MIN_PHOTOS: 10
  MAX_PHOTOS: 50
  DEFAULT_STEPS: 1000
  STEP_OPTIONS: [500, 1000, 1500, 2000, 3000, 4000]
