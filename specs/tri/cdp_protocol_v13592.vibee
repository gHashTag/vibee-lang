# VIBEE Specification v13592
# CDP Protocol Messages
# Chrome DevTools Protocol Message Types
# φ² + 1/φ² = 3 | PHOENIX = 999

name: cdp_protocol
version: "13592"
language: zig
module: cdp_protocol

types:
  TargetInfo:
    fields:
      target_id: String
      target_type: String
      title: String
      url: String
      attached: Bool
      browser_context_id: String

  SessionInfo:
    fields:
      session_id: String
      target_info: Object
      attached: Bool

  FrameInfo:
    fields:
      frame_id: String
      parent_frame_id: String
      name: String
      url: String
      security_origin: String

  ExecutionContext:
    fields:
      context_id: Int
      origin: String
      name: String
      aux_data: Object

  RemoteObject:
    fields:
      object_type: String
      subtype: String
      class_name: String
      value: Object
      object_id: String
      description: String

  ExceptionDetails:
    fields:
      exception_id: Int
      text: String
      line_number: Int
      column_number: Int
      script_id: String
      exception: Object

  StackTrace:
    fields:
      description: String
      call_frames: List<Object>
      parent: Object

  CallFrame:
    fields:
      function_name: String
      script_id: String
      url: String
      line_number: Int
      column_number: Int

behaviors:
  - name: create_target_message
    given: Target method and params
    when: Target command needed
    then: Properly formatted message created

  - name: create_page_message
    given: Page method and params
    when: Page command needed
    then: Properly formatted message created

  - name: create_runtime_message
    given: Runtime method and params
    when: Runtime command needed
    then: Properly formatted message created

  - name: parse_response
    given: Raw CDP response
    when: Response received
    then: Response parsed into typed structure

  - name: parse_event
    given: Raw CDP event
    when: Event received
    then: Event parsed into typed structure

  - name: serialize_params
    given: Command parameters
    when: Serialization needed
    then: JSON params created

creation_pattern:
  source: CDPMethod
  transformer: ProtocolEncoder
  result: CDPMessage
