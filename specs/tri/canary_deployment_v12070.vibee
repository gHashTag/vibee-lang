name: canary_deployment_v12070
version: "12070"
language: zig
module: canary_deployment
types:
  CanaryConfig:
    fields:
      initial_percentage: Float
      increment_step: Float
      success_threshold: Float
      rollback_threshold: Float
  CanaryDeployment:
    fields:
      deployment_id: String
      version: String
      percentage: Float
      status: DeploymentStatus
      metrics: List<Float>
  DeploymentStatus:
    variants:
      - pending
      - in_progress
      - promoted
      - rolled_back
      - failed
  CanaryMetrics:
    fields:
      error_rate: Float
      latency_p99: Float
      success_rate: Float
behaviors:
  - name: start_canary
    given: New version
    when: Starting canary
    then: Returns deployment
  - name: increase_traffic
    given: Deployment
    when: Increasing
    then: Returns updated deployment
  - name: collect_metrics
    given: Deployment
    when: Collecting
    then: Returns metrics
  - name: evaluate_health
    given: Metrics
    when: Evaluating
    then: Returns health status
  - name: promote_canary
    given: Healthy deployment
    when: Promoting
    then: Returns promoted deployment
  - name: rollback_canary
    given: Unhealthy deployment
    when: Rolling back
    then: Returns rollback status
  - name: pause_canary
    given: Deployment
    when: Pausing
    then: Returns paused deployment
  - name: resume_canary
    given: Paused deployment
    when: Resuming
    then: Returns resumed deployment
creation_pattern:
  source: NewVersion
  transformer: CanaryManager
  result: CanaryDeployment
