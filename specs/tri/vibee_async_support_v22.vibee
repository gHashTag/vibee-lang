name: vibee_async_support_v22
version: "22.4.0"
language: zig
module: vibee_async_support_v22

types:
  AsyncConfig:
    fields:
      max_concurrent: Int
      timeout_ms: Int
      retry_count: Int

  AsyncTask:
    fields:
      id: String
      name: String
      status: String
      result: Option<String>
      error: Option<String>

  TaskStatus:
    fields:
      name: String

  AsyncResult:
    fields:
      success: Bool
      value: Option<String>
      error: Option<String>
      duration_ms: Int

  TaskQueue:
    fields:
      pending: List<String>
      running: List<String>
      completed: List<String>

  AsyncRuntime:
    fields:
      config: Object
      queue: Object
      executor: Object

behaviors:
  - name: create_runtime
    given: AsyncConfig
    when: Initialize runtime
    then: AsyncRuntime instance

  - name: spawn_task
    given: AsyncRuntime and task function
    when: Spawn async task
    then: AsyncTask

  - name: await_task
    given: AsyncRuntime and task id
    When: Wait for task
    then: AsyncResult

  - name: await_all
    given: AsyncRuntime and task ids
    When: Wait for all tasks
    then: Result list

  - name: await_any
    given: AsyncRuntime and task ids
    When: Wait for first task
    then: AsyncResult

  - name: cancel_task
    given: AsyncRuntime and task id
    When: Cancel task
    then: Cancel result

  - name: get_task_status
    given: AsyncRuntime and task id
    When: Get task status
    then: TaskStatus

  - name: get_queue_status
    given: AsyncRuntime
    When: Get queue status
    then: TaskQueue

  - name: set_timeout
    given: AsyncRuntime and task id and timeout
    When: Set task timeout
    then: Timeout set

  - name: retry_task
    given: AsyncRuntime and task id
    When: Retry failed task
    then: Retry result

  - name: shutdown
    given: AsyncRuntime
    When: Shutdown runtime
    then: Shutdown complete
