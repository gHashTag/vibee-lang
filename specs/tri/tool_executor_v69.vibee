# VIBEE v69 Tool Executor Specification
# Unified Tool Execution Engine
# φ² + 1/φ² = 3 | PHOENIX = 999

name: tool_executor_v69
version: "69.0.0"
language: zig
module: tool_executor_v69

constants:
  PHI: 1.618033988749895
  TRINITY: 3
  PHOENIX: 999
  MAX_TIMEOUT_MS: 300000
  MAX_RETRIES: 3

types:
  ToolCategory:
    values:
      - filesystem
      - terminal
      - git
      - browser
      - database
      - network
      - ai_model
      - custom

  ExecutionStatus:
    values:
      - pending
      - running
      - success
      - failed
      - timeout
      - cancelled

  ToolResult:
    fields:
      tool_name: String
      status: String
      output: String
      error: Option<String>
      duration_ms: Int
      exit_code: Int
      retries: Int

  ToolCall:
    fields:
      id: String
      tool_name: String
      category: String
      params: String  # JSON
      timeout_ms: Int
      retry_count: Int
      created_at: Int
      started_at: Option<Int>
      completed_at: Option<Int>

  ExecutionContext:
    fields:
      working_dir: String
      env_vars: Map<String, String>
      user_id: String
      session_id: String
      dry_run: Bool

  ToolDefinition:
    fields:
      name: String
      category: String
      description: String
      input_schema: String
      output_schema: String
      timeout_default_ms: Int
      requires_confirmation: Bool
      is_destructive: Bool

# === BUILT-IN TOOLS ===
builtin_tools:
  # Filesystem
  - name: read_file
    category: filesystem
    description: "Read file contents"
    timeout_default_ms: 5000
    requires_confirmation: false
    is_destructive: false

  - name: write_file
    category: filesystem
    description: "Write content to file"
    timeout_default_ms: 5000
    requires_confirmation: true
    is_destructive: true

  - name: list_dir
    category: filesystem
    description: "List directory contents"
    timeout_default_ms: 5000
    requires_confirmation: false
    is_destructive: false

  - name: delete_file
    category: filesystem
    description: "Delete a file"
    timeout_default_ms: 5000
    requires_confirmation: true
    is_destructive: true

  # Terminal
  - name: run_command
    category: terminal
    description: "Execute shell command"
    timeout_default_ms: 60000
    requires_confirmation: true
    is_destructive: true

  - name: run_script
    category: terminal
    description: "Execute script file"
    timeout_default_ms: 120000
    requires_confirmation: true
    is_destructive: true

  # Git
  - name: git_status
    category: git
    description: "Get git status"
    timeout_default_ms: 10000
    requires_confirmation: false
    is_destructive: false

  - name: git_diff
    category: git
    description: "Get git diff"
    timeout_default_ms: 10000
    requires_confirmation: false
    is_destructive: false

  - name: git_commit
    category: git
    description: "Create git commit"
    timeout_default_ms: 30000
    requires_confirmation: true
    is_destructive: true

  - name: git_push
    category: git
    description: "Push to remote"
    timeout_default_ms: 60000
    requires_confirmation: true
    is_destructive: true

  # AI Model
  - name: ai_complete
    category: ai_model
    description: "Get AI completion"
    timeout_default_ms: 120000
    requires_confirmation: false
    is_destructive: false

  - name: ai_embed
    category: ai_model
    description: "Generate embeddings"
    timeout_default_ms: 30000
    requires_confirmation: false
    is_destructive: false

# === EXECUTION POLICIES ===
policies:
  confirmation:
    description: "Require user confirmation for destructive ops"
    enabled: true
    
  sandbox:
    description: "Run in sandboxed environment"
    enabled: false
    
  audit:
    description: "Log all tool executions"
    enabled: true
    
  rate_limit:
    description: "Limit tool calls per minute"
    enabled: true
    max_per_minute: 60

# === BEHAVIORS ===
behaviors:
  - name: execute_tool
    given: "Tool call with params"
    when: "Execution requested"
    then: "Execute and return result"

  - name: validate_params
    given: "Tool call params"
    when: "Before execution"
    then: "Validate against schema"

  - name: handle_timeout
    given: "Tool execution exceeds timeout"
    when: "Timeout reached"
    then: "Cancel and return timeout error"

  - name: retry_on_failure
    given: "Tool execution failed"
    when: "Retries remaining"
    then: "Retry with backoff"

test_cases:
  - name: execute_read_file
    input: {tool: "read_file", params: {path: "test.txt"}}
    expected: {status: "success"}

  - name: timeout_handling
    input: {tool: "run_command", timeout_ms: 100, command: "sleep 10"}
    expected: {status: "timeout"}

  - name: destructive_confirmation
    input: {tool: "delete_file", dry_run: true}
    expected: {requires_confirmation: true}
