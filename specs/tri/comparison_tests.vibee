# VIBEE BitNet Comparison Tests Specification
# Священная Формула: V = n × 3^k × π^m × φ^p × e^q
# Золотое Тождество: φ² + 1/φ² = 3 | PHOENIX = 999

name: comparison_tests
version: "1.0.0"
language: python
module: tests

description: |
  Unit тесты для модуля сравнения бенчмарков BitNet.

# ═══════════════════════════════════════════════════════════════════════════════
# Поведения
# ═══════════════════════════════════════════════════════════════════════════════

behaviors:
  # --- compare_metric ---
  - name: test_compare_metric_regression
    given: baseline=10, current=12, threshold=5%
    when: compare_metric (latency, higher_is_better=False)
    then: status=REGRESSION, percent_diff=+20%

  - name: test_compare_metric_improvement
    given: baseline=10, current=8, threshold=5%
    when: compare_metric (latency, higher_is_better=False)
    then: status=IMPROVED, percent_diff=-20%

  - name: test_compare_metric_unchanged
    given: baseline=10, current=10.2, threshold=5%
    when: compare_metric
    then: status=UNCHANGED

  - name: test_compare_metric_throughput_improvement
    given: baseline=1000, current=1200, threshold=5%
    when: compare_metric (throughput, higher_is_better=True)
    then: status=IMPROVED

  - name: test_compare_metric_throughput_regression
    given: baseline=1000, current=800, threshold=5%
    when: compare_metric (throughput, higher_is_better=True)
    then: status=REGRESSION

  # --- BenchmarkComparator ---
  - name: test_comparator_load_baseline
    given: JSON файл с baseline
    when: load_baseline(path)
    then: _baseline загружен

  - name: test_comparator_compare
    given: baseline и current загружены
    when: compare()
    then: RegressionReport создан

  - name: test_comparator_has_regressions
    given: current хуже baseline
    when: compare()
    then: report.has_regressions=True

  # --- Reports ---
  - name: test_generate_text_report
    given: RegressionReport
    when: generate_text_report()
    then: Текст содержит статистику

  - name: test_generate_markdown_report
    given: RegressionReport
    when: generate_markdown_report()
    then: Markdown с таблицами

# ═══════════════════════════════════════════════════════════════════════════════
# Тестовые данные
# ═══════════════════════════════════════════════════════════════════════════════

test_data:
  baseline_suite:
    timestamp: "2025-01-01T00:00:00"
    model_path: "model_v1.bin"
    results:
      - name: latency
        metrics:
          mean: 10.0
          p95: 15.0
          p99: 20.0
      - name: throughput
        metrics:
          tokens_per_second: 1000
      - name: memory
        metrics:
          bandwidth_gbps: 50.0

  current_suite_regression:
    timestamp: "2025-01-25T00:00:00"
    model_path: "model_v2.bin"
    results:
      - name: latency
        metrics:
          mean: 12.0
          p95: 18.0
          p99: 25.0
      - name: throughput
        metrics:
          tokens_per_second: 900
      - name: memory
        metrics:
          bandwidth_gbps: 45.0

  current_suite_improved:
    timestamp: "2025-01-25T00:00:00"
    model_path: "model_v2.bin"
    results:
      - name: latency
        metrics:
          mean: 8.0
          p95: 12.0
          p99: 16.0
      - name: throughput
        metrics:
          tokens_per_second: 1200
      - name: memory
        metrics:
          bandwidth_gbps: 55.0

# ═══════════════════════════════════════════════════════════════════════════════
# Метаданные
# ═══════════════════════════════════════════════════════════════════════════════

metadata:
  author: "VIBEE Project"
  created: "2025-01-25"
  test_framework: "pytest"
