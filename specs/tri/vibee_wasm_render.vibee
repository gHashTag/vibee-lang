# vibee_wasm_render.vibee - WASM DOM Rendering
# Render commands for JS bridge
# V = n × 3^k × π^m × φ^p × e^q

name: vibee_wasm_render
version: "1.0.0"
language: zig
module: vibee_wasm_render

creation_pattern:
  source: RenderSpec
  transformer: RenderEngine
  result: RenderCommands

constants:
  CMD_NONE: 0
  CMD_SET_RECT: 1
  CMD_SET_COLOR: 2
  CMD_SET_TEXT: 3
  CMD_SET_VISIBLE: 4
  CMD_SET_CURSOR: 5
  CMD_CREATE_ELEMENT: 6
  CMD_REMOVE_ELEMENT: 7
  MAX_COMMANDS: 256

types:
  RenderCommand:
    fields:
      cmd_type: Int
      element_id: Int
      param1: Float
      param2: Float
      param3: Float
      param4: Float

  RenderQueue:
    fields:
      head: Int
      tail: Int
      count: Int

  ElementStyle:
    fields:
      x: Float
      y: Float
      width: Float
      height: Float
      bg_color: Int
      cursor: Int

behaviors:
  - name: init_render
    given: Nothing
    when: Initialize
    then: Render queue ready

  - name: push_set_rect
    given: Element id and rect
    when: Position change
    then: Command queued

  - name: push_set_color
    given: Element id and color
    when: Color change
    then: Command queued

  - name: push_set_visible
    given: Element id and visible
    when: Visibility change
    then: Command queued

  - name: push_set_cursor
    given: Cursor type
    when: Cursor change
    then: Command queued

  - name: push_create_element
    given: Element id and type
    when: Create
    then: Command queued

  - name: push_remove_element
    given: Element id
    when: Remove
    then: Command queued

  - name: pop_command
    given: Nothing
    when: Process
    then: Next command or none

  - name: get_command_count
    given: Nothing
    when: Query
    then: Number of pending commands

  - name: flush_commands
    given: Nothing
    when: Render frame
    then: All commands processed
