# together_client_v999.vibee - Together.ai API Client
# KOSCHEI PATTERN - Native Zig HTTP client for Together.ai
# φ² + 1/φ² = 3 | PHOENIX = 999

name: together_client_v999
version: "999.0.0"
language: zig
module: together_client_v999

types:
  TogetherConfig:
    fields:
      api_key: String
      base_url: String
      timeout_ms: Int
      max_retries: Int

  TogetherModel:
    fields:
      id: String
      name: String
      context_length: Int
      pricing_input: Float
      pricing_output: Float

  CompletionRequest:
    fields:
      model: String
      messages: List<String>
      max_tokens: Int
      temperature: Float
      top_p: Float
      stop: List<String>

  CompletionResponse:
    fields:
      id: String
      model: String
      content: String
      finish_reason: String
      prompt_tokens: Int
      completion_tokens: Int
      total_tokens: Int
      latency_ms: Int

  TogetherError:
    fields:
      code: Int
      message: String
      error_type: String
      retryable: Bool

  HttpHeaders:
    fields:
      authorization: String
      content_type: String
      user_agent: String
      accept: String

behaviors:
  - name: init_client
    given: TogetherConfig with API key
    when: Initialize Together.ai client
    then: Return configured client instance

  - name: chat_completion
    given: CompletionRequest with messages
    when: Send chat completion request
    then: Return CompletionResponse or TogetherError

  - name: list_models
    given: Client instance
    when: Fetch available models
    then: Return list of TogetherModel

  - name: build_headers
    given: API key
    when: Build HTTP headers for request
    then: Return HttpHeaders with auth and content-type

  - name: serialize_request
    given: CompletionRequest
    when: Convert to JSON bytes
    then: Return JSON string

  - name: deserialize_response
    given: JSON response bytes
    when: Parse response JSON
    then: Return CompletionResponse

  - name: handle_http_error
    given: HTTP status code and body
    when: Parse error response
    then: Return TogetherError with details

  - name: retry_with_backoff
    given: Failed request and attempt count
    when: Calculate exponential backoff
    then: Return delay milliseconds or give up

  - name: validate_model
    given: Model ID string
    when: Check if model is available
    then: Return Bool indicating availability

  - name: calculate_tokens
    given: Message content
    when: Estimate token count
    then: Return approximate token count

sacred_constants:
  phi: 1.618033988749895
  phi_squared_plus_inverse_squared: 3
  phoenix: 999
  together_base_url: "https://api.together.xyz/v1"
  default_model: "Qwen/Qwen2.5-72B-Instruct-Turbo"
  default_max_tokens: 256
  default_temperature: 0.3
