# v5102 - Music Generation
# =========================
# MusicGen, AudioLDM - генерация музыки
# φ² + 1/φ² = 3 | PHOENIX = 999

name: music_generation
version: "5.1.2"
language: zig
module: music_generation

constants:
  PHI: 1.618033988749895
  SAMPLE_RATE: 32000
  NUM_CODEBOOKS: 4
  MAX_DURATION: 30.0

types:
  MusicConfig:
    fields:
      model_type: String
      num_codebooks: Int
      sample_rate: Int
      
  MusicPrompt:
    fields:
      text_description: String
      melody_conditioning: List
      
  MusicTokens:
    fields:
      semantic_tokens: List
      acoustic_tokens: List
      
  MelodyFeatures:
    fields:
      pitch_contour: List
      rhythm: List
      
  MusicGenModel:
    fields:
      text_encoder: Object
      audio_encoder: Object
      decoder: Object
      
  GenerationParams:
    fields:
      temperature: Float
      top_k: Int
      top_p: Float
      cfg_scale: Float
      
  MusicOutput:
    fields:
      waveform: List
      duration: Float
      
  AudioLDMConfig:
    fields:
      unet: Object
      vae: Object
      vocoder: Object

behaviors:
  - name: encode_text_prompt
    given: Text description
    when: Text encoding
    then: Вернуть text embeddings
    
  - name: extract_melody
    given: Reference audio
    when: Melody extraction
    then: Вернуть melody features
    
  - name: generate_semantic_tokens
    given: Text embeddings
    when: Semantic generation
    then: Вернуть semantic tokens
    
  - name: generate_acoustic_tokens
    given: Semantic tokens
    when: Acoustic generation
    then: Вернуть acoustic tokens
    
  - name: decode_to_audio
    given: Music tokens
    when: Token decoding
    then: Вернуть waveform
    
  - name: text_to_music
    given: Prompt и model
    when: Full generation
    then: Вернуть music output
    
  - name: melody_conditioned_generation
    given: Text и melody
    when: Melody-guided generation
    then: Вернуть music following melody
    
  - name: audio_ldm_generate
    given: Text и AudioLDM
    when: Diffusion-based generation
    then: Вернуть generated audio
