# FFI Common Lisp v56680 - CFFI
# VIBEE → Common Lisp Native Bindings
# φ² + 1/φ² = 3 | PHOENIX = 999

name: ffi_commonlisp_v56680
version: "56.6.80"
language: zig
module: ffi_commonlisp

creation_pattern:
  source: VibeeSpec
  transformer: CommonLispBindingsGenerator
  result: CLSystem

types:
  CLType:
    fields:
      name: String
      cffi_type: String
      c_type: String

  CFFIDefcfun:
    fields:
      lisp_name: String
      c_name: String
      return_type: String
      args: List<String>

  CFFIDefcstruct:
    fields:
      name: String
      slots: List<String>

  CFFIDefcenum:
    fields:
      name: String
      values: List<String>
      base_type: String

  CLPackage:
    fields:
      name: String
      nicknames: List<String>
      use_list: List<String>
      exports: List<String>

  CLSystem:
    fields:
      name: String
      packages: List<CLPackage>
      cffi_defs: List<String>
      asd_file: String

  ASDFSystem:
    fields:
      name: String
      version: String
      depends_on: List<String>
      components: List<String>

  CFFICallback:
    fields:
      name: String
      return_type: String
      arg_types: List<String>

behaviors:
  - name: generate_cl_package
    given: VibeeSpec
    when: CL package needed
    then: Lisp source files

  - name: generate_defcfun
    given: C function
    when: defcfun needed
    then: CFFIDefcfun

  - name: map_vibee_to_cffi_type
    given: Vibee type
    when: Type mapping needed
    then: CFFI type

  - name: generate_defcstruct
    given: C struct
    when: defcstruct needed
    then: CFFIDefcstruct

  - name: generate_asd
    given: System config
    when: .asd file needed
    then: ASDFSystem

  - name: handle_callback
    given: C callback
    when: defcallback needed
    then: CFFICallback

  - name: handle_pointer
    given: C pointer
    when: :pointer needed
    then: Pointer type

  - name: handle_string
    given: C string
    when: :string needed
    then: String conversion
