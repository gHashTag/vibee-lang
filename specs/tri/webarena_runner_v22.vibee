name: webarena_runner_v22
version: "22.2.0"
language: zig
module: webarena_runner_v22

types:
  RunnerConfig:
    fields:
      chrome_endpoint: String
      ollama_endpoint: String
      max_steps: Int
      timeout_ms: Int
      screenshot_on_step: Bool

  TaskResult:
    fields:
      task_id: String
      success: Bool
      steps_taken: Int
      final_answer: String
      trajectory: List<String>
      duration_ms: Int

  StepResult:
    fields:
      step_num: Int
      action: String
      observation: String
      reasoning: String
      success: Bool

  RunnerState:
    fields:
      current_task: String
      current_step: Int
      page_url: String
      last_observation: String
      history: List<String>

  RunnerMetrics:
    fields:
      tasks_completed: Int
      tasks_failed: Int
      total_steps: Int
      avg_steps_per_task: Float
      success_rate: Float

behaviors:
  - name: create_runner
    given: RunnerConfig
    when: Initialize runner
    then: Runner instance

  - name: load_task
    given: Task JSON
    when: Parse and load
    then: Loaded task

  - name: run_task
    given: Runner and task
    when: Execute task
    then: TaskResult

  - name: execute_step
    given: Current state
    when: Run one step
    then: StepResult

  - name: observe_page
    given: CDP connection
    when: Get observation
    then: Page observation

  - name: decide_action
    given: Observation and goal
    when: Query LLM
    then: Action to take

  - name: execute_action
    given: Action
    when: Execute via CDP
    then: Action result

  - name: check_completion
    given: State and goal
    when: Check if done
    then: Completion status

  - name: get_metrics
    given: Runner
    when: Get stats
    then: RunnerMetrics

  - name: export_trajectory
    given: TaskResult
    when: Export
    then: JSON trajectory

  - name: shutdown
    given: Runner
    when: Cleanup
    then: Shutdown complete
