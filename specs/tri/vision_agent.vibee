name: vision_agent
version: "2.0.0"
language: zig
module: vision_agent

# ═══════════════════════════════════════════════════════════════════════════════
# Vision Agent - Screenshot → LLM Analysis for WebArena
# ═══════════════════════════════════════════════════════════════════════════════
# Multi-provider vision: GPT-4V, Claude Vision, Gemini Pro Vision
# Target: WebArena 60%+ success rate
# φ² + 1/φ² = 3 | PHOENIX = 999
# ═══════════════════════════════════════════════════════════════════════════════

types:
  VisionProvider:
    fields:
      name: String
      api_key: String
      model: String
      max_tokens: Int
      supports_bounding_box: Bool

  Screenshot:
    fields:
      data_base64: String
      width: Int
      height: Int
      format: String
      timestamp: Timestamp

  BoundingBox:
    fields:
      x: Int
      y: Int
      width: Int
      height: Int
      confidence: Float

  UIElement:
    fields:
      element_type: String
      text: String
      selector: String
      bounding_box: Object
      is_clickable: Bool
      is_visible: Bool

  VisionAnalysis:
    fields:
      elements: List<Object>
      page_description: String
      suggested_action: String
      confidence: Float

  ClickTarget:
    fields:
      x: Int
      y: Int
      element_description: String
      confidence: Float

behaviors:
  - name: capture_screenshot
    given: Browser connected and page loaded
    when: Vision analysis requested
    then: Capture full page screenshot as base64 PNG

  - name: analyze_with_gpt4v
    given: Screenshot captured and OpenAI API key available
    when: GPT-4V provider selected
    then: Send screenshot to GPT-4V and parse UI elements

  - name: analyze_with_claude
    given: Screenshot captured and Anthropic API key available
    when: Claude Vision provider selected
    then: Send screenshot to Claude and parse UI elements

  - name: analyze_with_gemini
    given: Screenshot captured and Google API key available
    when: Gemini Pro Vision provider selected
    then: Send screenshot to Gemini and parse UI elements

  - name: find_element_by_description
    given: Vision analysis completed
    when: User describes target element
    then: Return best matching element with bounding box

  - name: get_click_coordinates
    given: Element found with bounding box
    when: Click action needed
    then: Calculate center coordinates for click

  - name: detect_page_state
    given: Screenshot analyzed
    when: State detection needed
    then: Identify page type and current state

  - name: extract_text_from_region
    given: Bounding box specified
    when: Text extraction needed
    then: OCR or vision-based text extraction

  - name: compare_screenshots
    given: Two screenshots available
    when: Change detection needed
    then: Identify visual differences between screenshots

  - name: fallback_to_dom
    given: Vision analysis fails or low confidence
    when: Reliability needed
    then: Fall back to DOM-based element finding
