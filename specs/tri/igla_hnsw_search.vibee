# iGLA HNSW Search
# Efficient ANN search in HNSW graph
# Scientific basis: Malkov & Yashunin 2018
# φ² + 1/φ² = 3 | V = n × 3^k × π^m × φ^p

name: igla_hnsw_search
version: "1.0.0"
language: zig
module: igla_hnsw_search

sacred_constants:
  phi: 1.618033988749895
  trinity: 3.0
  phoenix: 999
  default_ef: 50

scientific_references:
  - "Malkov & Yashunin 2018: HNSW"
  - "Aumüller et al. 2020: ANN-Benchmarks"
  - "Li et al. 2020: Approximate Nearest Neighbor Search on High Dimensional Data"

types:
  SearchConfig:
    fields:
      ef: Int
      k: Int
      filter: String

  SearchResult:
    fields:
      id: Int
      distance: Float
      vector: String

  SearchBatch:
    fields:
      queries: String
      k: Int
      results: String

  VisitedSet:
    fields:
      bits: String
      size: Int

  CandidateQueue:
    fields:
      candidates: String
      max_size: Int

  SearchStats:
    fields:
      distance_computations: Int
      nodes_visited: Int
      latency_us: Float

behaviors:
  - name: search_knn
    given: "Query vector, k, ef"
    when: "KNN search"
    then: "K nearest neighbors"

  - name: search_layer
    given: "Query, entry_point, ef, layer"
    when: "Layer search"
    then: "Best candidates in layer"

  - name: greedy_search
    given: "Query, entry_point"
    when: "Greedy descent"
    then: "Local minimum found"

  - name: search_batch
    given: "Query batch, k"
    when: "Batch search"
    then: "Results for all queries"

  - name: search_with_filter
    given: "Query, k, filter_fn"
    when: "Filtered search"
    then: "Filtered K nearest"

  - name: range_search
    given: "Query, radius"
    when: "Range search"
    then: "All within radius"

  - name: update_visited
    given: "VisitedSet, node_id"
    when: "Visit tracking"
    then: "Updated visited set"

  - name: phi_ef_tuning
    given: "Recall target"
    when: "Sacred tuning"
    then: "φ-optimal ef value"
