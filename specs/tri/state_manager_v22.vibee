name: state_manager_v22
version: "22.3.0"
language: zig
module: state_manager_v22

types:
  AgentState:
    fields:
      step: Int
      goal: String
      current_url: String
      observation: String
      last_action: String
      is_complete: Bool
      error: Option<String>

  StateSnapshot:
    fields:
      state: Object
      timestamp: Timestamp
      step_num: Int

  StateTransition:
    fields:
      from_state: Object
      to_state: Object
      action: String
      duration_ms: Int

  StateHistory:
    fields:
      snapshots: List<String>
      transitions: List<String>
      max_size: Int

  StateManager:
    fields:
      current: Object
      history: Object
      checkpoints: List<String>

behaviors:
  - name: create_manager
    given: Initial state
    when: Initialize manager
    then: StateManager instance

  - name: get_state
    given: StateManager
    when: Get current state
    then: AgentState

  - name: update_state
    given: StateManager and updates
    when: Apply updates
    then: Updated state

  - name: set_observation
    given: StateManager and observation
    when: Update observation
    then: Updated state

  - name: set_action
    given: StateManager and action
    when: Record action
    then: Updated state

  - name: set_complete
    given: StateManager and status
    when: Mark completion
    then: Updated state

  - name: set_error
    given: StateManager and error
    when: Record error
    then: Updated state

  - name: create_snapshot
    given: StateManager
    when: Save snapshot
    then: StateSnapshot

  - name: restore_snapshot
    given: StateManager and snapshot
    when: Restore state
    then: Restored state

  - name: get_history
    given: StateManager
    when: Get state history
    then: StateHistory

  - name: reset
    given: StateManager
    when: Reset to initial
    then: Reset state
