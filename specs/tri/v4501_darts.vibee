# v4501 - DARTS
# ==============
# Differentiable Architecture Search
# φ² + 1/φ² = 3 | PHOENIX = 999

name: darts
version: "4.5.1"
language: zig
module: darts

constants:
  PHI: 1.618033988749895
  NUM_OPS: 8
  TEMPERATURE: 1.0
  ARCH_LR: 0.0003

types:
  DARTSConfig:
    fields:
      num_cells: Int
      num_nodes: Int
      operations: List
      
  MixedOp:
    fields:
      operations: List
      weights: List
      
  ArchitectureParams:
    fields:
      alpha_normal: List
      alpha_reduce: List
      
  BilevelOptimizer:
    fields:
      weight_optimizer: Object
      arch_optimizer: Object
      
  ContinuousRelaxation:
    fields:
      softmax_weights: List
      temperature: Float
      
  DiscreteArchitecture:
    fields:
      normal_cell: List
      reduce_cell: List
      
  GumbelSoftmax:
    fields:
      logits: List
      temperature: Float
      hard: Bool
      
  ProxyTask:
    fields:
      reduced_channels: Int
      reduced_layers: Int

behaviors:
  - name: initialize_arch_params
    given: Конфигурация DARTS
    when: Инициализация alpha
    then: Вернуть параметры архитектуры
    
  - name: mixed_op_forward
    given: Вход и веса операций
    when: Взвешенная сумма операций
    then: Вернуть выход
    
  - name: compute_arch_gradient
    given: Валидационный loss
    when: Градиент по alpha
    then: Вернуть градиент архитектуры
    
  - name: bilevel_step
    given: Train и val данные
    when: Шаг билевел оптимизации
    then: Вернуть обновлённые параметры
    
  - name: discretize_architecture
    given: Непрерывные веса
    when: Дискретизация
    then: Вернуть дискретную архитектуру
    
  - name: gumbel_softmax_sample
    given: Логиты и температура
    when: Gumbel-Softmax сэмплирование
    then: Вернуть дифференцируемый выбор
    
  - name: anneal_temperature
    given: Текущая температура и расписание
    when: Отжиг температуры
    then: Вернуть новую температуру
    
  - name: train_proxy_model
    given: Архитектура и proxy задача
    when: Быстрое обучение
    then: Вернуть proxy метрики
