# VIBEE v68 Context Engine Specification
# Codebase Understanding & Semantic Search
# φ² + 1/φ² = 3 | PHOENIX = 999

name: context_engine_v68
version: "68.0.0"
language: zig
module: context_engine_v68

# === SACRED CONSTANTS ===
constants:
  PHI: 1.618033988749895
  TRINITY: 3
  PHOENIX: 999
  EMBEDDING_DIM: 1536  # OpenAI ada-002 dimension
  MAX_CONTEXT_TOKENS: 128000  # Claude 3.5 context

# === CONTEXT TYPES ===
types:
  FileType:
    values:
      - source_code
      - config
      - documentation
      - test
      - data
      - binary

  Language:
    values:
      - zig
      - python
      - javascript
      - typescript
      - rust
      - go
      - java
      - cpp
      - ruby
      - unknown

  Symbol:
    fields:
      name: String
      kind: String  # function, struct, enum, const, var
      file_path: String
      line_start: Int
      line_end: Int
      signature: String
      doc_comment: Option<String>

  FileContext:
    fields:
      path: String
      language: String
      size_bytes: Int
      line_count: Int
      symbols: List<Symbol>
      imports: List<String>
      exports: List<String>
      last_modified: Int

  Embedding:
    fields:
      id: String
      vector: List<Float>  # 1536 dimensions
      content: String
      file_path: String
      chunk_index: Int

  SearchResult:
    fields:
      file_path: String
      content: String
      score: Float
      line_start: Int
      line_end: Int

  DependencyNode:
    fields:
      file_path: String
      imports: List<String>
      imported_by: List<String>
      depth: Int

  ProjectContext:
    fields:
      root_path: String
      name: String
      language: String
      file_count: Int
      total_lines: Int
      symbols: List<Symbol>
      dependencies: List<DependencyNode>

# === CONTEXT ENGINE ===
context_engine:
  components:
    - name: FileIndexer
      description: "Index all files in project"
      operations:
        - scan_directory
        - parse_file
        - extract_symbols
        - detect_language

    - name: EmbeddingStore
      description: "Vector embeddings for semantic search"
      operations:
        - generate_embedding
        - store_embedding
        - search_similar
        - update_embedding

    - name: DependencyGraph
      description: "File dependency analysis"
      operations:
        - build_graph
        - find_imports
        - find_dependents
        - calculate_depth

    - name: SymbolResolver
      description: "Symbol lookup and navigation"
      operations:
        - find_definition
        - find_references
        - find_implementations
        - get_signature

    - name: ContextRanker
      description: "Rank context by relevance"
      operations:
        - rank_by_recency
        - rank_by_similarity
        - rank_by_dependency
        - combine_rankings

# === CHUNKING STRATEGY ===
chunking:
  strategies:
    - name: fixed_size
      description: "Fixed token chunks"
      params:
        chunk_size: 512
        overlap: 64

    - name: semantic
      description: "Semantic boundaries"
      params:
        max_size: 1024
        boundaries: [function, class, module]

    - name: hybrid
      description: "Semantic with size limits"
      params:
        max_size: 768
        prefer_semantic: true

# === RETRIEVAL METHODS ===
retrieval:
  methods:
    - name: keyword
      description: "Keyword-based search"
      speed: fast
      accuracy: medium

    - name: semantic
      description: "Embedding similarity"
      speed: medium
      accuracy: high

    - name: hybrid
      description: "Keyword + semantic"
      speed: medium
      accuracy: highest

    - name: graph
      description: "Dependency-aware"
      speed: slow
      accuracy: high

# === BEHAVIORS ===
behaviors:
  - name: index_project
    given: "Project root path"
    when: "Indexing requested"
    then: "Build complete project index"
    
  - name: search_code
    given: "Query string"
    when: "Search requested"
    then: "Return ranked search results"
    
  - name: get_context
    given: "File path and line number"
    when: "Context requested"
    then: "Return relevant context for location"
    
  - name: find_symbol
    given: "Symbol name"
    when: "Symbol lookup"
    then: "Return symbol definition and references"
    
  - name: get_dependencies
    given: "File path"
    when: "Dependency analysis"
    then: "Return import/export graph"

# === TEST CASES ===
test_cases:
  - name: index_zig_project
    input: {root: "/project", language: "zig"}
    expected: {file_count: ">0", symbols: ">0"}
    
  - name: search_function
    input: {query: "parse file"}
    expected: {results: ">0", top_score: ">0.7"}
    
  - name: find_definition
    input: {symbol: "MCPConnector"}
    expected: {found: true, file: "mcp_connector_v68.zig"}

# === PERFORMANCE TARGETS ===
performance:
  indexing:
    files_per_second: 100
    symbols_per_second: 1000
    
  search:
    latency_p50_ms: 50
    latency_p99_ms: 200
    
  memory:
    per_file_kb: 10
    embedding_per_chunk_kb: 6
