# v4803 - Graph Transformers
# ===========================
# Transformers для графов - GPS, Graphormer
# φ² + 1/φ² = 3 | PHOENIX = 999

name: graph_transformers
version: "4.8.3"
language: zig
module: graph_transformers

constants:
  PHI: 1.618033988749895
  NUM_HEADS: 8
  FFN_DIM: 1024
  MAX_NODES: 512

types:
  GraphTransformerConfig:
    fields:
      num_layers: Int
      hidden_dim: Int
      num_heads: Int
      
  PositionalEncoding:
    fields:
      encoding_type: String
      encodings: List
      
  LaplacianPE:
    fields:
      eigenvectors: List
      eigenvalues: List
      k: Int
      
  RandomWalkPE:
    fields:
      landing_probs: List
      walk_length: Int
      
  GraphormerLayer:
    fields:
      attention: Object
      ffn: Object
      spatial_encoding: Object
      
  GPSLayer:
    fields:
      local_mpnn: Object
      global_attention: Object
      ffn: Object
      
  EdgeEncoding:
    fields:
      edge_features: List
      spatial_bias: List
      
  GraphTransformerOutput:
    fields:
      node_embeddings: List
      attention_weights: List

behaviors:
  - name: compute_laplacian_pe
    given: Graph Laplacian и k
    when: Eigenvector PE
    then: Вернуть positional encodings
    
  - name: compute_random_walk_pe
    given: Adjacency и walk length
    when: Random walk PE
    then: Вернуть RWPE
    
  - name: graphormer_attention
    given: Features, spatial bias
    when: Graphormer self-attention
    then: Вернуть attended features
    
  - name: gps_layer_forward
    given: Features, edge_index, layer
    when: GPS layer (local + global)
    then: Вернуть updated features
    
  - name: compute_spatial_encoding
    given: Shortest path distances
    when: Spatial encoding
    then: Вернуть spatial bias
    
  - name: compute_edge_encoding
    given: Edge features и path
    when: Edge encoding
    then: Вернуть edge bias
    
  - name: graph_transformer_forward
    given: Graph и transformer
    when: Full forward pass
    then: Вернуть output
    
  - name: virtual_node_update
    given: Node embeddings
    when: Virtual node aggregation
    then: Вернуть updated with virtual
