# FFI Crystal v56450 - Crystal lib/fun bindings
# VIBEE → Crystal Native Bindings
# φ² + 1/φ² = 3 | PHOENIX = 999

name: ffi_crystal_v56450
version: "56.4.50"
language: zig
module: ffi_crystal

creation_pattern:
  source: VibeeSpec
  transformer: CrystalBindingsGenerator
  result: CrystalShard

types:
  CrystalType:
    fields:
      name: String
      crystal_type: String
      c_type: String
      is_pointer: Bool

  CrystalFun:
    fields:
      name: String
      args: List<String>
      return_type: String
      lib_name: String
      real_name: Option<String>

  CrystalStruct:
    fields:
      name: String
      fields: List<String>
      is_packed: Bool

  CrystalLib:
    fields:
      name: String
      ldflags: List<String>
      funs: List<CrystalFun>
      structs: List<CrystalStruct>
      enums: List<String>

  CrystalClass:
    fields:
      name: String
      methods: List<String>
      properties: List<String>

  CrystalShard:
    fields:
      name: String
      version: String
      libs: List<CrystalLib>
      classes: List<CrystalClass>
      shard_yml: String

  CrystalCallback:
    fields:
      name: String
      signature: String
      closure: Bool

  CrystalPointer:
    fields:
      type_name: String
      is_void: Bool
      is_slice: Bool

behaviors:
  - name: generate_crystal_lib
    given: VibeeSpec
    when: Crystal lib needed
    then: lib block

  - name: generate_fun
    given: C function
    when: fun binding needed
    then: CrystalFun definition

  - name: map_vibee_to_crystal_type
    given: Vibee type
    when: Type mapping needed
    then: Crystal type

  - name: generate_struct
    given: C struct
    when: Crystal struct needed
    then: CrystalStruct definition

  - name: generate_wrapper_class
    given: C type
    when: OOP wrapper needed
    then: CrystalClass

  - name: generate_shard_yml
    given: Shard config
    when: shard.yml needed
    then: YAML file

  - name: handle_pointer
    given: C pointer
    when: Pointer wrapper needed
    then: Pointer(T) type

  - name: handle_callback
    given: C callback
    when: Proc needed
    then: CrystalCallback
