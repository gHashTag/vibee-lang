# iGLA v3 DoRA - Weight-Decomposed LoRA
# +1-2% accuracy over LoRA
# φ² + 1/φ² = 3 | PHOENIX = 999
# Paper: arXiv:2402.09353

name: igla_v3_dora
version: "3.0.0"
language: zig
module: igla_v3_dora

creation_pattern:
  source: PretrainedWeights
  transformer: DoRADecomposition
  result: AdaptedWeights

types:
  DoRAConfig:
    fields:
      rank: Int
      alpha: Float
      decompose_magnitude: Bool
      
behaviors:
  - name: decompose_weight
    given: "Weight matrix W"
    when: "DoRA decomposition"
    then: "Return magnitude m and direction V"
    formula: "W = m * V/||V||"
    
  - name: dora_forward
    given: "Input, m, V, LoRA delta"
    when: "Forward pass"
    then: "Return m' * (V + delta)/||V + delta||"
    
  - name: merge_dora
    given: "Base weights, DoRA params"
    when: "Merge for inference"
    then: "Return merged weights"
