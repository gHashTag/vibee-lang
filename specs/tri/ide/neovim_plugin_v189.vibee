# ═══════════════════════════════════════════════════════════════════════════════
# NEOVIM PLUGIN v189 - VIBEE Language Support for Neovim
# ═══════════════════════════════════════════════════════════════════════════════
# Based on: Neovim Lua API, nvim-lspconfig
# Competitors: coc.nvim, nvim-cmp, copilot.vim
# PAS Pattern: PRE + D&C
# φ² + 1/φ² = 3 | PHOENIX = 999
# ═══════════════════════════════════════════════════════════════════════════════

name: neovim_plugin
version: "1.8.9"
language: zig
module: neovim_plugin

sacred_constants:
  phi: 1.618033988749895
  phi_inv: 0.618033988749895
  phi_sq: 2.618033988749895
  trinity: 3.0
  phoenix: 999

creation_pattern:
  source: NeovimEvent
  transformer: PluginHandler
  result: NeovimAction

# ═══════════════════════════════════════════════════════════════════════════════
# TYPES
# ═══════════════════════════════════════════════════════════════════════════════

types:
  NeovimCommand:
    enum:
      - VibeeGenerate
      - VibeeTest
      - VibeeFormat
      - VibeeValidate
      - VibeePreview
      - VibeeAgent

  NeovimEvent:
    enum:
      - BufEnter
      - BufWritePost
      - InsertLeave
      - CursorHold
      - LspAttach

  PluginConfig:
    fields:
      auto_generate: Bool = false
      auto_test: Bool = true
      lsp_enabled: Bool = true
      keymaps_enabled: Bool = true
      agent_provider: String = "deepseek"

  Keymap:
    fields:
      mode: String
      lhs: String
      rhs: String
      opts: KeymapOpts

  KeymapOpts:
    fields:
      silent: Bool = true
      noremap: Bool = true
      desc: String?

  Highlight:
    fields:
      group: String
      fg: String?
      bg: String?
      bold: Bool?
      italic: Bool?

  Autocmd:
    fields:
      event: String
      pattern: String
      callback: String

# ═══════════════════════════════════════════════════════════════════════════════
# BEHAVIORS
# ═══════════════════════════════════════════════════════════════════════════════

behaviors:
  - name: setup
    given: "User config"
    when: "Plugin loaded"
    then: "Initialize plugin with config"
    pas_pattern: PRE
    complexity: O(1)
    test_cases:
      - name: test_setup
        input: '{"config": {}}'
        expected: '{"initialized": true}'

  - name: setup_lsp
    given: "LSP config"
    when: "Setup called"
    then: "Configure nvim-lspconfig for vibee"
    pas_pattern: PRE
    complexity: O(1)
    test_cases:
      - name: test_lsp
        input: '{"lsp_enabled": true}'
        expected: '{"lsp_attached": true}'

  - name: setup_keymaps
    given: "Keymap config"
    when: "Setup called"
    then: "Register keymaps"
    pas_pattern: PRE
    complexity: O(n)
    test_cases:
      - name: test_keymaps
        input: '{"keymaps_enabled": true}'
        expected: '{"keymaps": 6}'

  - name: handle_generate
    given: "Current buffer"
    when: ":VibeeGenerate called"
    then: "Generate .zig and show result"
    pas_pattern: D&C
    complexity: O(n)
    test_cases:
      - name: test_generate
        input: '{"bufname": "test.vibee"}'
        expected: '{"output": "test.zig"}'

  - name: handle_test
    given: "Generated .zig file"
    when: ":VibeeTest called"
    then: "Run zig test in terminal"
    pas_pattern: D&C
    complexity: O(n)
    test_cases:
      - name: test_run
        input: '{"file": "test.zig"}'
        expected: '{"terminal": "opened"}'

  - name: setup_treesitter
    given: "Treesitter config"
    when: "Setup called"
    then: "Register vibee parser"
    pas_pattern: PRE
    complexity: O(1)
    test_cases:
      - name: test_treesitter
        input: '{"parser": "vibee"}'
        expected: '{"registered": true}'

  - name: setup_completion
    given: "Completion config"
    when: "Setup called"
    then: "Configure nvim-cmp source"
    pas_pattern: PRE
    complexity: O(1)
    test_cases:
      - name: test_completion
        input: '{"cmp_enabled": true}'
        expected: '{"source": "vibee"}'

# ═══════════════════════════════════════════════════════════════════════════════
# LUA CONFIGURATION
# ═══════════════════════════════════════════════════════════════════════════════

lua_config: |
  -- vibee.nvim - VIBEE Language Support for Neovim
  -- φ² + 1/φ² = 3 | PHOENIX = 999
  
  local M = {}
  
  M.config = {
    auto_generate = false,
    auto_test = true,
    lsp_enabled = true,
    keymaps_enabled = true,
    agent_provider = "deepseek",
  }
  
  function M.setup(opts)
    M.config = vim.tbl_deep_extend("force", M.config, opts or {})
    
    if M.config.lsp_enabled then
      M.setup_lsp()
    end
    
    if M.config.keymaps_enabled then
      M.setup_keymaps()
    end
    
    M.setup_commands()
    M.setup_autocmds()
  end
  
  return M

# ═══════════════════════════════════════════════════════════════════════════════
# KEYMAPS
# ═══════════════════════════════════════════════════════════════════════════════

keymaps:
  - mode: "n"
    lhs: "<leader>vg"
    rhs: ":VibeeGenerate<CR>"
    desc: "Generate Zig code"

  - mode: "n"
    lhs: "<leader>vt"
    rhs: ":VibeeTest<CR>"
    desc: "Run tests"

  - mode: "n"
    lhs: "<leader>vf"
    rhs: ":VibeeFormat<CR>"
    desc: "Format document"

  - mode: "n"
    lhs: "<leader>vv"
    rhs: ":VibeeValidate<CR>"
    desc: "Validate specification"

  - mode: "n"
    lhs: "<leader>vp"
    rhs: ":VibeePreview<CR>"
    desc: "Preview generated code"

  - mode: "n"
    lhs: "<leader>va"
    rhs: ":VibeeAgent<CR>"
    desc: "Start agent mode"

# ═══════════════════════════════════════════════════════════════════════════════
# HIGHLIGHTS
# ═══════════════════════════════════════════════════════════════════════════════

highlights:
  - group: "VibeeKeyword"
    fg: "#c678dd"
    bold: true

  - group: "VibeeType"
    fg: "#e5c07b"

  - group: "VibeeConstant"
    fg: "#d19a66"

  - group: "VibeeSacred"
    fg: "#e06c75"
    italic: true

  - group: "VibeeComment"
    fg: "#5c6370"
    italic: true

# ═══════════════════════════════════════════════════════════════════════════════
# φ² + 1/φ² = 3 | PHOENIX = 999
# ═══════════════════════════════════════════════════════════════════════════════
