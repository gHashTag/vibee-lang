# ═══════════════════════════════════════════════════════════════════════════════
# VSCODE EXTENSION v188 - VIBEE Language Support for VSCode
# ═══════════════════════════════════════════════════════════════════════════════
# Based on: VSCode Extension API
# Competitors: Cursor, Copilot, Codeium extensions
# PAS Pattern: PRE + D&C
# φ² + 1/φ² = 3 | PHOENIX = 999
# ═══════════════════════════════════════════════════════════════════════════════

name: vscode_extension
version: "1.8.8"
language: zig
module: vscode_extension

sacred_constants:
  phi: 1.618033988749895
  phi_inv: 0.618033988749895
  phi_sq: 2.618033988749895
  trinity: 3.0
  phoenix: 999

creation_pattern:
  source: VSCodeEvent
  transformer: ExtensionHandler
  result: VSCodeAction

# ═══════════════════════════════════════════════════════════════════════════════
# TYPES
# ═══════════════════════════════════════════════════════════════════════════════

types:
  ExtensionCommand:
    enum:
      - vibee_generate        # Generate .zig from .vibee
      - vibee_test            # Run tests
      - vibee_format          # Format .vibee file
      - vibee_validate        # Validate specification
      - vibee_preview         # Preview generated code
      - vibee_agent           # Start agent mode

  VSCodeEvent:
    enum:
      - onDidOpenTextDocument
      - onDidChangeTextDocument
      - onDidSaveTextDocument
      - onCommand
      - onLanguage

  ExtensionConfig:
    fields:
      autoGenerate: Bool = false
      autoTest: Bool = true
      showPreview: Bool = true
      lspEnabled: Bool = true
      agentProvider: String = "deepseek"

  StatusBarItem:
    fields:
      text: String
      tooltip: String
      command: String?
      color: String?

  TreeViewItem:
    fields:
      label: String
      description: String?
      icon: String?
      children: List<TreeViewItem>?

  CodeLens:
    fields:
      range: Range
      command: String
      title: String

  Decoration:
    fields:
      range: Range
      hoverMessage: String
      backgroundColor: String?

# ═══════════════════════════════════════════════════════════════════════════════
# BEHAVIORS
# ═══════════════════════════════════════════════════════════════════════════════

behaviors:
  - name: activate
    given: "Extension activation event"
    when: ".vibee file opened"
    then: "Initialize extension and LSP client"
    pas_pattern: PRE
    complexity: O(1)
    test_cases:
      - name: test_activate
        input: '{"event": "onLanguage:vibee"}'
        expected: '{"activated": true}'

  - name: register_commands
    given: "Extension context"
    when: "Activation"
    then: "Register all commands"
    pas_pattern: PRE
    complexity: O(n)
    test_cases:
      - name: test_commands
        input: '{"context": {...}}'
        expected: '{"commands": 6}'

  - name: handle_generate
    given: "Active .vibee document"
    when: "Generate command invoked"
    then: "Generate .zig and show preview"
    pas_pattern: D&C
    complexity: O(n)
    test_cases:
      - name: test_generate
        input: '{"file": "test.vibee"}'
        expected: '{"output": "trinity/output/test.zig"}'

  - name: handle_test
    given: "Generated .zig file"
    when: "Test command invoked"
    then: "Run zig test and show results"
    pas_pattern: D&C
    complexity: O(n)
    test_cases:
      - name: test_run
        input: '{"file": "test.zig"}'
        expected: '{"passed": true}'

  - name: update_status_bar
    given: "Current state"
    when: "State changes"
    then: "Update status bar item"
    pas_pattern: PRE
    complexity: O(1)
    test_cases:
      - name: test_status
        input: '{"state": "ready"}'
        expected: '{"text": "VIBEE ✓"}'

  - name: provide_code_lens
    given: ".vibee document"
    when: "Code lens requested"
    then: "Return generate/test lenses"
    pas_pattern: PRE
    complexity: O(n)
    test_cases:
      - name: test_lens
        input: '{"document": {...}}'
        expected: '{"lenses": ["Generate", "Test"]}'

  - name: show_preview
    given: "Generated code"
    when: "Preview requested"
    then: "Show side-by-side preview"
    pas_pattern: PRE
    complexity: O(1)
    test_cases:
      - name: test_preview
        input: '{"code": "pub const..."}'
        expected: '{"panel": "opened"}'

# ═══════════════════════════════════════════════════════════════════════════════
# PACKAGE.JSON MANIFEST
# ═══════════════════════════════════════════════════════════════════════════════

manifest:
  name: "vibee-lang"
  displayName: "VIBEE Language Support"
  description: "Specification-first development with VIBEE"
  version: "1.8.8"
  publisher: "vibee"
  
  engines:
    vscode: "^1.85.0"
  
  categories:
    - "Programming Languages"
    - "Linters"
    - "Formatters"
    - "Other"
  
  activationEvents:
    - "onLanguage:vibee"
    - "onCommand:vibee.generate"
  
  main: "./out/extension.js"
  
  contributes:
    languages:
      - id: "vibee"
        aliases: ["VIBEE", "vibee"]
        extensions: [".vibee"]
        configuration: "./language-configuration.json"
    
    grammars:
      - language: "vibee"
        scopeName: "source.vibee"
        path: "./syntaxes/vibee.tmLanguage.json"
    
    commands:
      - command: "vibee.generate"
        title: "VIBEE: Generate Zig Code"
        icon: "$(play)"
      
      - command: "vibee.test"
        title: "VIBEE: Run Tests"
        icon: "$(beaker)"
      
      - command: "vibee.format"
        title: "VIBEE: Format Document"
        icon: "$(edit)"
      
      - command: "vibee.validate"
        title: "VIBEE: Validate Specification"
        icon: "$(check)"
      
      - command: "vibee.preview"
        title: "VIBEE: Preview Generated Code"
        icon: "$(open-preview)"
      
      - command: "vibee.agent"
        title: "VIBEE: Start Agent Mode"
        icon: "$(robot)"
    
    keybindings:
      - command: "vibee.generate"
        key: "ctrl+shift+g"
        mac: "cmd+shift+g"
        when: "editorLangId == vibee"
      
      - command: "vibee.test"
        key: "ctrl+shift+t"
        mac: "cmd+shift+t"
        when: "editorLangId == vibee"
    
    configuration:
      title: "VIBEE"
      properties:
        vibee.autoGenerate:
          type: "boolean"
          default: false
          description: "Auto-generate on save"
        
        vibee.autoTest:
          type: "boolean"
          default: true
          description: "Auto-run tests after generation"
        
        vibee.agentProvider:
          type: "string"
          default: "deepseek"
          enum: ["deepseek", "anthropic", "openai", "ollama"]
          description: "AI provider for agent mode"

# ═══════════════════════════════════════════════════════════════════════════════
# SYNTAX HIGHLIGHTING
# ═══════════════════════════════════════════════════════════════════════════════

syntax:
  keywords:
    - name
    - version
    - language
    - module
    - types
    - behaviors
    - test_cases
    - sacred_constants
    - creation_pattern

  types:
    - String
    - Int
    - Float
    - Bool
    - List
    - Map
    - Option
    - Timestamp

  constants:
    - phi
    - phi_inv
    - phi_sq
    - trinity
    - phoenix
    - tau

  patterns:
    - given
    - when
    - then
    - pas_pattern
    - complexity

# ═══════════════════════════════════════════════════════════════════════════════
# φ² + 1/φ² = 3 | PHOENIX = 999
# ═══════════════════════════════════════════════════════════════════════════════
