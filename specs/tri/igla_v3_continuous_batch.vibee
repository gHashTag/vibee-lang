# iGLA v3 Continuous Batching
# 15x throughput improvement
# φ² + 1/φ² = 3 | PHOENIX = 999
# Paper: Orca (OSDI 2022)

name: igla_v3_continuous_batch
version: "3.0.0"
language: zig
module: igla_v3_continuous_batch

creation_pattern:
  source: RequestQueue
  transformer: ContinuousScheduler
  result: OptimalBatch

types:
  Request:
    fields:
      id: Int
      prompt_tokens: List<Int>
      generated_tokens: List<Int>
      max_tokens: Int
      finished: Bool
      
  Batch:
    fields:
      requests: List<Request>
      total_tokens: Int
      
behaviors:
  - name: schedule_iteration
    given: "Pending requests, running requests"
    when: "New iteration"
    then: "Return optimal batch"
    
  - name: add_request
    given: "New request, current batch"
    when: "Request arrives"
    then: "Add to batch if capacity"
    
  - name: remove_finished
    given: "Batch after iteration"
    when: "Check completion"
    then: "Remove finished, add pending"
