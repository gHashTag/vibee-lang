# v5003 - Point Cloud Processing
# ================================
# PointNet, PointNet++, Point Transformer
# φ² + 1/φ² = 3 | PHOENIX = 999

name: point_cloud
version: "5.0.3"
language: zig
module: point_cloud

constants:
  PHI: 1.618033988749895
  NUM_POINTS: 4096
  K_NEIGHBORS: 32
  RADIUS: 0.1

types:
  PointCloudData:
    fields:
      xyz: List
      features: List
      normals: List
      
  PointNetConfig:
    fields:
      num_points: Int
      num_classes: Int
      use_tnet: Bool
      
  SetAbstraction:
    fields:
      num_centroids: Int
      radius: Float
      num_samples: Int
      
  PointFeatures:
    fields:
      local_features: List
      global_features: List
      
  FPSResult:
    fields:
      indices: List
      centroids: List
      
  BallQuery:
    fields:
      center: List
      radius: Float
      neighbors: List
      
  PointTransformerBlock:
    fields:
      attention: Object
      ffn: Object
      
  SegmentationOutput:
    fields:
      point_labels: List
      confidences: List

behaviors:
  - name: farthest_point_sampling
    given: Points и num samples
    when: FPS
    then: Вернуть sampled indices
    
  - name: ball_query
    given: Points, centroids, radius
    when: Neighbor search
    then: Вернуть neighbor indices
    
  - name: knn_query
    given: Points и k
    when: KNN search
    then: Вернуть k nearest neighbors
    
  - name: pointnet_forward
    given: Points и model
    when: PointNet forward
    then: Вернуть global features
    
  - name: set_abstraction
    given: Points и SA config
    when: PointNet++ SA layer
    then: Вернуть abstracted features
    
  - name: feature_propagation
    given: Coarse и fine features
    when: PointNet++ FP layer
    then: Вернуть propagated features
    
  - name: point_transformer_attention
    given: Query, key, value points
    when: Point attention
    then: Вернуть attended features
    
  - name: point_cloud_classification
    given: Point cloud и model
    when: Classification
    then: Вернуть class predictions
