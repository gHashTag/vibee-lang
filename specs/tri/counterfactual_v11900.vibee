name: counterfactual_v11900
version: "11900"
language: zig
module: counterfactual

description: |
  TIER 274: Counterfactual Explanations
  Generates minimal changes for different predictions
  Based on: Wachter et al., DiCE, contrastive explanations

types:
  CounterfactualConfig:
    fields:
      method: CFMethod
      num_counterfactuals: Int
      diversity_weight: Float
      proximity_weight: Float

  CFMethod:
    variants:
      - wachter
      - dice
      - growing_spheres
      - prototype

  Counterfactual:
    fields:
      original: List<Float>
      counterfactual: List<Float>
      changes: List<String>
      distance: Float
      new_prediction: Int

  CFExplanation:
    fields:
      counterfactuals: List<String>
      feature_changes: List<String>
      validity_rate: Float
      diversity_score: Float

behaviors:
  - name: generate_counterfactual
    given: Instance and target
    when: Generating CF
    then: Returns counterfactual

  - name: generate_diverse_cfs
    given: Instance and num_cfs
    When: Generating diverse set
    then: Returns diverse counterfactuals

  - name: compute_proximity
    given: Original and CF
    When: Computing distance
    then: Returns proximity score

  - name: check_validity
    given: Counterfactual
    When: Checking validity
    then: Returns validity status

  - name: find_actionable_changes
    given: Counterfactual
    When: Finding actionable features
    then: Returns actionable changes

  - name: optimize_sparsity
    given: Counterfactual
    When: Minimizing changes
    then: Returns sparse CF

  - name: explain_contrast
    given: Original and CF
    When: Explaining difference
    then: Returns contrastive explanation

  - name: validate_plausibility
    given: Counterfactual
    When: Checking plausibility
    then: Returns plausibility score

creation_pattern:
  source: PredictionToExplain
  transformer: CounterfactualGenerator
  result: CFExplanation
