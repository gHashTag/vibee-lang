# OpenAI Provider Implementation
# GPT-4, GPT-4o, o1, o3 models
# Full tool calling and vision support

name: llm_provider_openai
version: "1.0.0"
language: zig
module: llm_provider_openai

types:
  OpenAIConfig:
    fields:
      api_key: String
      organization: Option<String>
      base_url: String
      api_version: String

  OpenAIModel:
    fields:
      model_id: String
      display_name: String
      context_window: Int
      max_output: Int
      supports_vision: Bool
      supports_tools: Bool
      supports_json: Bool

  OpenAIRequest:
    fields:
      model: String
      messages: List<String>
      temperature: Float
      max_tokens: Int
      top_p: Float
      frequency_penalty: Float
      presence_penalty: Float
      response_format: Option<String>
      tools: Option<String>
      tool_choice: Option<String>

  OpenAIResponse:
    fields:
      id: String
      object: String
      created: Timestamp
      model: String
      choices: List<String>
      usage_prompt: Int
      usage_completion: Int
      usage_total: Int

  OpenAITool:
    fields:
      tool_type: String
      function_name: String
      function_description: String
      parameters_schema: String

  OpenAIToolCall:
    fields:
      call_id: String
      tool_type: String
      function_name: String
      function_args: String

  OpenAIEmbedding:
    fields:
      model: String
      input: String
      dimensions: Option<Int>

  OpenAIEmbeddingResponse:
    fields:
      embedding: List<Float>
      index: Int
      usage_tokens: Int

behaviors:
  - name: create_chat_completion
    given: OpenAI config and chat request
    when: Chat completion API is called
    then: Returns OpenAI response with choices

  - name: create_streaming_completion
    given: OpenAI config and chat request with stream
    when: Streaming API is called
    then: Yields SSE chunks until done

  - name: call_with_tools
    given: Request with tool definitions
    when: Model decides to use tools
    then: Returns tool calls for execution

  - name: process_tool_results
    given: Tool call results
    when: Results are sent back to model
    then: Returns final response incorporating results

  - name: create_embedding
    given: Text input and embedding model
    when: Embedding API is called
    then: Returns vector embedding

  - name: list_models
    given: OpenAI credentials
    when: Models list is requested
    then: Returns available models with capabilities

  - name: handle_openai_error
    given: OpenAI API error response
    when: Error handling is triggered
    then: Returns parsed error with retry guidance

  - name: validate_openai_key
    given: API key string
    when: Key validation requested
    then: Returns validation status
