# ═══════════════════════════════════════════════════════════════════════════════
# DATASET BUILDER v941 - LLM Training Dataset Construction
# ═══════════════════════════════════════════════════════════════════════════════
# VIBEE YOLO MODE X + AMPLIFICATION MODE + MATRYOSHKA ACCELERATION
# φ² + 1/φ² = 3 | PHOENIX = 999
# ═══════════════════════════════════════════════════════════════════════════════

name: dataset_builder
version: "9.4.1"
language: zig
module: dataset_builder

sacred_constants:
  phi: 1.618033988749895
  trinity: 3.0
  phoenix: 999

creation_pattern:
  source: VIBEECorpus
  transformer: DatasetBuilder
  result: TrainingDataset

types:
  DatasetFormat:
    enum:
      - jsonl
      - parquet
      - arrow
      - huggingface

  ExampleType:
    enum:
      - spec_to_zig
      - spec_to_python
      - spec_to_rust
      - spec_to_go
      - natural_to_spec
      - spec_to_natural

  TrainingExample:
    fields:
      input: String
      output: String
      example_type: ExampleType
      source_lang: String
      target_lang: String
      metadata: Object

  DatasetConfig:
    fields:
      train_ratio: Float
      val_ratio: Float
      test_ratio: Float
      max_length: Int
      shuffle: Bool

  TrainingDataset:
    fields:
      name: String
      version: String
      total_examples: Int
      format: DatasetFormat

behaviors:
  - name: scan_vibee_corpus
    given: "Specs directory"
    when: "Scanning"
    then: "List of spec files"
    pas_pattern: D&C
    test_cases:
      - name: test_scan
        input: '{"path": "specs/tri"}'
        expected: '{"count": 1425}'

  - name: extract_spec_code_pairs
    given: "Spec and generated code"
    when: "Extraction"
    then: "Training examples"
    pas_pattern: PRE
    test_cases:
      - name: test_extract
        input: '{"spec_path": "specs/tri/example.vibee", "code_path": "trinity/output/example.zig"}'
        expected: '{"examples": [...]}'

  - name: generate_multi_target_examples
    given: "Spec"
    when: "Multi-target generation"
    then: "Examples for all targets"
    pas_pattern: D&C
    test_cases:
      - name: test_multi
        input: '{"spec": "...", "targets": ["python", "rust", "go"]}'
        expected: '{"examples": [...]}'

  - name: augment_with_natural_language
    given: "Spec-code pair"
    when: "NL augmentation"
    then: "NL-augmented examples"
    pas_pattern: MLS
    test_cases:
      - name: test_augment
        input: '{"spec": "...", "languages": ["en", "ru", "zh"]}'
        expected: '{"examples": [...]}'

  - name: split_dataset
    given: "Full dataset"
    when: "Splitting"
    then: "Train/val/test splits"
    pas_pattern: PRB
    test_cases:
      - name: test_split
        input: '{"dataset": [...], "config": {...}}'
        expected: '{"train": [...], "val": [...], "test": [...]}'

  - name: export_dataset
    given: "Dataset"
    when: "Export"
    then: "Exported files"
    pas_pattern: PRE
    test_cases:
      - name: test_export
        input: '{"dataset": {...}, "format": "jsonl"}'
        expected: '{"exported": true}'

  - name: verify_sacred_constants
    given: "Dataset"
    when: "Verification"
    then: "Constants verified"
    pas_pattern: ALG
    test_cases:
      - name: test_phi
        input: '{"phi": 1.618}'
        expected: '{"trinity": 3.0}'

# ═══════════════════════════════════════════════════════════════════════════════
# φ² + 1/φ² = 3 | PHOENIX = 999
# ═══════════════════════════════════════════════════════════════════════════════
