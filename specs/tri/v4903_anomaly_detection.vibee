# v4903 - Anomaly Detection
# ==========================
# Обнаружение аномалий во временных рядах
# φ² + 1/φ² = 3 | PHOENIX = 999

name: anomaly_detection
version: "4.9.3"
language: zig
module: anomaly_detection

constants:
  PHI: 1.618033988749895
  THRESHOLD_PERCENTILE: 99.0
  WINDOW_SIZE: 100
  CONTAMINATION: 0.01

types:
  AnomalyConfig:
    fields:
      method: String
      threshold: Float
      window_size: Int
      
  AnomalyScore:
    fields:
      timestamp: Timestamp
      score: Float
      is_anomaly: Bool
      
  AnomalySegment:
    fields:
      start: Timestamp
      end: Timestamp
      severity: Float
      
  ReconstructionError:
    fields:
      original: List
      reconstructed: List
      error: Float
      
  IsolationForest:
    fields:
      num_trees: Int
      max_samples: Int
      
  AutoencoderAD:
    fields:
      encoder: Object
      decoder: Object
      threshold: Float
      
  StatisticalAD:
    fields:
      mean: Float
      std: Float
      z_threshold: Float
      
  AnomalyReport:
    fields:
      anomalies: List
      total_anomalies: Int
      anomaly_rate: Float

behaviors:
  - name: compute_anomaly_scores
    given: Time series и model
    when: Scoring anomalies
    then: Вернуть anomaly scores
    
  - name: threshold_anomalies
    given: Scores и threshold
    when: Thresholding
    then: Вернуть binary labels
    
  - name: reconstruction_based_ad
    given: Series и autoencoder
    when: Reconstruction AD
    then: Вернуть reconstruction errors
    
  - name: isolation_forest_score
    given: Data и forest
    when: Isolation scoring
    then: Вернуть isolation scores
    
  - name: statistical_ad
    given: Series и params
    when: Z-score AD
    then: Вернуть statistical anomalies
    
  - name: segment_anomalies
    given: Point anomalies
    when: Grouping into segments
    then: Вернуть anomaly segments
    
  - name: adaptive_threshold
    given: Scores и window
    when: Dynamic thresholding
    then: Вернуть adaptive threshold
    
  - name: evaluate_detection
    given: Predictions и labels
    when: Evaluation
    then: Вернуть precision, recall, F1
