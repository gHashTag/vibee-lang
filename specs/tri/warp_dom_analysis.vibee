name: warp_dom_analysis
version: "1.0.0"
language: zig
module: warp_dom_analysis

description: |
  WARP DOM Analysis - AI анализ DOM структуры
  Научные основы: Mind2Web (Deng et al., 2023), SeeAct (Zheng et al., 2024)
  Извлечение интерактивных элементов для агента
  φ² + 1/φ² = 3 | PHOENIX = 999

types:
  DOMElement:
    fields:
      node_id: Int
      tag_name: String
      attributes: String
      text_content: String
      bounding_box: String
      is_visible: Bool
      is_interactive: Bool

  DOMTree:
    fields:
      root: String
      elements_count: Int
      interactive_count: Int
      depth: Int

  InteractiveElement:
    fields:
      element_id: Int
      element_type: String
      label: String
      action_hint: String
      selector: String
      som_mark: Int

  DOMDiff:
    fields:
      added: List<String>
      removed: List<String>
      modified: List<String>
      diff_time_ms: Float

  AccessibilityTree:
    fields:
      nodes: String
      roles_count: Int
      labels_count: Int

behaviors:
  - name: get_dom_tree
    given: Текущая страница
    when: Извлечение DOM дерева
    then: DOMTree со всеми элементами

  - name: find_interactive
    given: DOMTree дерево
    when: Поиск интерактивных элементов
    then: Список InteractiveElement для агента

  - name: get_element_by_selector
    given: CSS или XPath селектор
    when: Поиск элемента
    then: DOMElement или null

  - name: compute_dom_diff
    given: Предыдущий и текущий DOMTree
    when: Вычисление изменений
    then: DOMDiff с изменениями

  - name: get_accessibility_tree
    given: Текущая страница
    when: Извлечение accessibility tree
    then: AccessibilityTree для screen reader

  - name: simplify_for_llm
    given: DOMTree полное дерево
    when: Упрощение для отправки в LLM
    then: Сжатое представление < 4000 токенов
