# iGLA v3 Prefix Caching
# 5x speedup on repeated prefixes
# φ² + 1/φ² = 3 | PHOENIX = 999
# Paper: SGLang

name: igla_v3_prefix_cache
version: "3.0.0"
language: zig
module: igla_v3_prefix_cache

creation_pattern:
  source: TokenSequence
  transformer: PrefixMatcher
  result: CachedKV

types:
  PrefixNode:
    fields:
      token: Int
      children: Map<Int, PrefixNode>
      kv_cache: Option<KVCache>
      
  RadixTree:
    fields:
      root: PrefixNode
      
behaviors:
  - name: match_prefix
    given: "Input tokens, radix tree"
    when: "Check for cached prefix"
    then: "Return longest matching prefix"
    
  - name: insert_prefix
    given: "Tokens, KV cache, tree"
    when: "Cache new prefix"
    then: "Insert into radix tree"
    
  - name: evict_lru
    given: "Tree, memory limit"
    when: "Memory pressure"
    then: "Evict least recently used"
