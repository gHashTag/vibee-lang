# iGLA DiskANN Graph
# Vamana graph for SSD-based ANN search
# Scientific basis: Jayaram Subramanya et al. 2019 (NeurIPS)
# φ² + 1/φ² = 3 | V = n × 3^k × π^m × φ^p

name: igla_diskann_graph
version: "1.0.0"
language: zig
module: igla_diskann_graph

sacred_constants:
  phi: 1.618033988749895
  trinity: 3.0
  phoenix: 999
  R: 64
  L: 100

scientific_references:
  - "Jayaram Subramanya et al. 2019: DiskANN"
  - "Singh et al. 2021: FreshDiskANN"
  - "Chen et al. 2021: SPANN"

types:
  VamanaConfig:
    fields:
      R: Int
      L: Int
      alpha: Float
      dim: Int
      max_points: Int

  VamanaNode:
    fields:
      id: Int
      neighbors: String
      degree: Int
      sector_id: Int

  VamanaGraph:
    fields:
      nodes: String
      medoid: Int
      num_points: Int
      R: Int

  SectorLayout:
    fields:
      sector_size: Int
      vectors_per_sector: Int
      total_sectors: Int

  DiskLayout:
    fields:
      graph_offset: Int
      vectors_offset: Int
      pq_offset: Int
      total_size: Int

  GraphStats:
    fields:
      avg_degree: Float
      max_degree: Int
      diameter: Int

behaviors:
  - name: create_vamana
    given: "VamanaConfig"
    when: "Initialization"
    then: "Empty Vamana graph"

  - name: find_medoid
    given: "Vectors"
    when: "Medoid computation"
    then: "Central point as entry"

  - name: robust_prune
    given: "Node, candidates, alpha, R"
    when: "Pruning"
    then: "Diverse neighbor set"

  - name: greedy_search_vamana
    given: "Query, L"
    when: "Graph traversal"
    then: "L nearest candidates"

  - name: compute_sector_layout
    given: "Num vectors, dim"
    when: "Layout planning"
    then: "Optimal sector layout"

  - name: assign_sectors
    given: "Nodes"
    when: "Sector assignment"
    then: "Nodes assigned to sectors"

  - name: serialize_graph
    given: "Graph"
    when: "Serialization"
    then: "Disk-ready format"

  - name: phi_alpha_tuning
    given: "Dataset stats"
    when: "Sacred tuning"
    then: "φ-optimal alpha"
