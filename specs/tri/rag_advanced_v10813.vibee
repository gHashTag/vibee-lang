# VIBEE RAG ADVANCED FOUNDATION v10813
# φ² + 1/φ² = 3 | PHOENIX = 999

name: rag_advanced_v10813
version: "10813.0.0"
language: zig
module: rag_advanced_v10813

types:
  HybridSearch:
    fields:
      search_id: String
      dense_results: List<SearchResult>
      sparse_results: List<SearchResult>
      fusion_method: String

  SearchResult:
    fields:
      doc_id: String
      content: String
      score: Float
      metadata: String

  Reranker:
    fields:
      reranker_type: String
      model: String
      top_k: Int

  RerankedResults:
    fields:
      original_results: List<SearchResult>
      reranked_results: List<SearchResult>
      rerank_scores: List<Float>

  QueryExpansion:
    fields:
      original_query: String
      expanded_queries: List<String>
      expansion_method: String

  DocumentChunk:
    fields:
      chunk_id: String
      content: String
      start_pos: Int
      end_pos: Int
      overlap: Int

  ChunkingStrategy:
    fields:
      strategy_type: String
      chunk_size: Int
      overlap_size: Int
      separator: String

  RAGPipeline:
    fields:
      pipeline_id: String
      retriever: String
      reranker: String
      generator: String

  ContextWindow:
    fields:
      max_tokens: Int
      current_tokens: Int
      documents: List<String>
      truncation_strategy: String

  RAGMetrics:
    fields:
      retrieval_precision: Float
      retrieval_recall: Float
      answer_relevance: Float
      faithfulness: Float

behaviors:
  - name: hybrid_search
    given: "Query and indices"
    when: "Hybrid search requested"
    then: "Returns hybrid search results"

  - name: rerank_results
    given: "Query and results"
    when: "Reranking requested"
    then: "Returns reranked results"

  - name: expand_query
    given: "Query"
    when: "Query expansion requested"
    then: "Returns expanded queries"

  - name: chunk_document
    given: "Document and strategy"
    when: "Chunking requested"
    then: "Returns document chunks"

  - name: fuse_results
    given: "Multiple result sets"
    when: "Fusion requested"
    then: "Returns fused results"

  - name: build_context
    given: "Results and window"
    when: "Context building requested"
    then: "Returns context window"

  - name: generate_answer
    given: "Query and context"
    when: "Answer generation requested"
    then: "Returns generated answer"

  - name: cite_sources
    given: "Answer and sources"
    when: "Citation requested"
    then: "Returns cited answer"

  - name: evaluate_rag
    given: "Query, answer, ground truth"
    when: "Evaluation requested"
    then: "Returns RAG metrics"

  - name: optimize_pipeline
    given: "Pipeline and metrics"
    when: "Optimization requested"
    then: "Returns optimized pipeline"
