name: agent_multitab_parallel
version: "1.0.0"
language: zig
module: agent_multitab_parallel

description: |
  Agent Multi-Tab Parallel - параллельное выполнение
  Ускорение: N вкладок = N-кратное ускорение
  φ² + 1/φ² = 3 | PHOENIX = 999

types:
  ParallelTask:
    fields:
      task_id: String
      tab_id: String
      action: String
      status: String
      result: Option<String>

  ParallelBatch:
    fields:
      batch_id: String
      tasks: List<String>
      started_at: Timestamp
      completed_count: Int

  ParallelResult:
    fields:
      batch_id: String
      results: List<String>
      total_time_ms: Float
      speedup_factor: Float

  ParallelConfig:
    fields:
      max_parallel: Int
      timeout_per_task_ms: Int
      fail_fast: Bool

behaviors:
  - name: execute_parallel
    given: Список ParallelTask задач
    when: Параллельное выполнение
    then: ParallelResult со всеми результатами

  - name: map_to_tabs
    given: Список URL и действие
    when: Выполнение действия на каждом URL
    then: ParallelResult

  - name: collect_from_tabs
    given: Список tab_id и экстрактор
    when: Сбор данных со всех вкладок
    then: Объединённые данные

  - name: wait_all
    given: ParallelBatch текущий batch
    when: Ожидание завершения всех задач
    then: ParallelResult

  - name: wait_any
    given: ParallelBatch текущий batch
    when: Ожидание первой завершённой задачи
    then: Первый результат

  - name: cancel_batch
    given: ParallelBatch для отмены
    when: Отмена всех задач
    then: Batch отменён
