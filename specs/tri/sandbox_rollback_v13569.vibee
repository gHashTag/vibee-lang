# VIBEE Specification v13569
# State Rollback
# KOSCHEI CYCLE 11 - 1000000x SPEEDUP

name: sandbox_rollback
version: "13569"
language: zig
module: sandbox_rollback

types:
  RollbackManager:
    fields:
      id: String
      checkpoints: List<Object>
      max_checkpoints: Int

  Checkpoint:
    fields:
      checkpoint_id: String
      sandbox_id: String
      state: Object
      created_at: Timestamp

  RollbackConfig:
    fields:
      auto_checkpoint: Bool
      checkpoint_interval_ms: Int
      max_checkpoints: Int

  RollbackResult:
    fields:
      success: Bool
      checkpoint_id: String
      duration_ms: Int

  RollbackMetrics:
    fields:
      checkpoints_created: Int
      rollbacks_performed: Int
      avg_rollback_time_ms: Float

  StateSnapshot:
    fields:
      snapshot_id: String
      memory_state: Object
      fs_state: Object
      process_state: Object

behaviors:
  - name: create_checkpoint
    given: Sandbox state
    When: Checkpoint requested
    then: Checkpoint created

  - name: rollback_to
    given: Checkpoint ID
    When: Rollback requested
    then: State rolled back

  - name: list_checkpoints
    given: Sandbox ID
    When: List requested
    then: Checkpoints listed

  - name: delete_checkpoint
    given: Checkpoint ID
    When: Deletion requested
    then: Checkpoint deleted

  - name: auto_checkpoint
    given: Interval elapsed
    When: Auto-checkpoint enabled
    then: Checkpoint created automatically

  - name: compare_states
    given: Two checkpoints
    When: Comparison requested
    then: State diff returned

creation_pattern:
  source: RollbackConfig
  transformer: RollbackManager
  result: Checkpoint
