# VIBEE AGENT CONSENSUS FOUNDATION v10680
# φ² + 1/φ² = 3 | PHOENIX = 999

name: agent_consensus_v10680
version: "10680.0.0"
language: zig
module: agent_consensus_foundation

types:
  RaftState:
    fields:
      current_term: Int
      voted_for: String
      log: List<LogEntry>
      commit_index: Int
      last_applied: Int

  LogEntry:
    fields:
      index: Int
      term: Int
      command: String
      timestamp: Timestamp

  AppendEntries:
    fields:
      term: Int
      leader_id: String
      prev_log_index: Int
      prev_log_term: Int
      entries: List<LogEntry>
      leader_commit: Int

  RequestVote:
    fields:
      term: Int
      candidate_id: String
      last_log_index: Int
      last_log_term: Int

  VoteResponse:
    fields:
      term: Int
      vote_granted: Bool
      voter_id: String

  PaxosProposal:
    fields:
      proposal_id: Int
      value: String
      proposer: String

  PaxosPromise:
    fields:
      proposal_id: Int
      accepted_id: Int
      accepted_value: String

  BFTMessage:
    fields:
      message_type: String
      view: Int
      sequence: Int
      digest: String
      sender: String

  ConsensusResult:
    fields:
      success: Bool
      value: String
      term: Int
      leader: String

  ConsensusConfig:
    fields:
      algorithm: String
      quorum_size: Int
      timeout_ms: Int
      max_retries: Int

behaviors:
  - name: append_entries
    given: "AppendEntries request"
    when: "Append requested"
    then: "Returns append result"

  - name: request_vote
    given: "RequestVote request"
    when: "Vote requested"
    then: "Returns vote response"

  - name: replicate_log
    given: "Log entry and followers"
    when: "Replication requested"
    then: "Returns replication status"

  - name: commit_entry
    given: "Log entry"
    when: "Commit requested"
    then: "Returns commit result"

  - name: paxos_prepare
    given: "Proposal"
    when: "Prepare requested"
    then: "Returns promise"

  - name: paxos_accept
    given: "Proposal and value"
    when: "Accept requested"
    then: "Returns accept result"

  - name: bft_pre_prepare
    given: "BFT message"
    when: "Pre-prepare requested"
    then: "Returns pre-prepare result"

  - name: bft_prepare
    given: "BFT message"
    when: "Prepare requested"
    then: "Returns prepare result"

  - name: bft_commit
    given: "BFT message"
    when: "Commit requested"
    then: "Returns commit result"

  - name: reach_consensus
    given: "Value and config"
    when: "Consensus requested"
    then: "Returns consensus result"
