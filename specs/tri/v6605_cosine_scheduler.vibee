# v6605 - Cosine LR Scheduler
# =============================
# Cosine annealing learning rate
# lr = min_lr + (max_lr - min_lr) * (1 + cos(π * step/total)) / 2
# φ² + 1/φ² = 3 | PHOENIX = 999

name: cosine_scheduler
version: "6.6.5"
language: zig
module: cosine_scheduler

constants:
  PHI: 1.618033988749895
  PI: 3.141592653589793

types:
  CosineConfig:
    fields:
      base_lr: Float
      min_lr: Float
      total_steps: Int
      warmup_steps: Int
      
  SchedulerState:
    fields:
      current_step: Int
      current_lr: Float

behaviors:
  - name: cosine_lr
    given: Step, total_steps, base_lr, min_lr
    when: LR computation
    then: Вернуть cosine-annealed lr
    
  - name: warmup_lr
    given: Step, warmup_steps, target_lr
    when: Warmup phase
    then: Вернуть linearly increasing lr
    
  - name: cosine_with_warmup
    given: Step, config
    when: Combined schedule
    then: Вернуть warmup then cosine lr
    
  - name: get_lr
    given: State
    when: Current LR query
    then: Вернуть current_lr
    
  - name: step_scheduler
    given: State, config
    when: Scheduler step
    then: Update current_step и current_lr
    
  - name: reset_scheduler
    given: State
    when: Scheduler reset
    then: Reset to step 0
