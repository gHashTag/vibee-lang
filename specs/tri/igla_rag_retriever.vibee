# iGLA RAG Retriever
# Retrieve relevant documents for queries
# φ² + 1/φ² = 3 | V = n × 3^k × π^m × φ^p

name: igla_rag_retriever
version: "1.0.0"
language: zig
module: igla_rag_retriever

sacred_constants:
  phi: 1.618033988749895
  trinity: 3.0
  phoenix: 999

types:
  RetrieverConfig:
    fields:
      top_k: Int
      score_threshold: Float
      rerank: Bool
      hybrid: Bool

  RetrievedDocument:
    fields:
      id: String
      text: String
      score: Float
      source: String
      metadata: String

  RetrievalResult:
    fields:
      documents: String
      count: Int
      query: String
      latency_ms: Float

  HybridConfig:
    fields:
      dense_weight: Float
      sparse_weight: Float
      rerank_model: String

  RetrieverMetrics:
    fields:
      queries_total: Int
      avg_latency_ms: Float
      avg_docs_returned: Float
      cache_hit_rate: Float

  RerankerConfig:
    fields:
      model: String
      top_n: Int
      batch_size: Int

behaviors:
  - name: retrieve
    given: "Query string"
    when: "Retrieval"
    then: "Relevant documents returned"

  - name: retrieve_with_filter
    given: "Query and filter"
    when: "Filtered retrieval"
    then: "Filtered documents returned"

  - name: hybrid_retrieve
    given: "Query"
    when: "Hybrid search"
    then: "Dense + sparse results"

  - name: rerank
    given: "Query and documents"
    when: "Reranking"
    then: "Reranked documents"

  - name: mmr_retrieve
    given: "Query, k, lambda"
    when: "MMR retrieval"
    then: "Diverse documents returned"

  - name: set_threshold
    given: "Score threshold"
    when: "Configuration"
    then: "Threshold updated"

  - name: get_metrics
    given: "Retriever"
    when: "Metrics request"
    then: "Retrieval metrics returned"

  - name: phi_retriever_harmony
    given: "Retriever"
    when: "Harmony"
    then: "φ-optimal retrieval"
