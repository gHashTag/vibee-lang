# ReAct Agent Core - Reasoning + Acting Loop
# Based on arXiv:2210.03629 - Synergizing Reasoning and Acting
# VIBEE Browser target: #1 GAIA + WebArena

name: agent_react_core
version: "1.0.0"
language: zig
module: agent_react_core

types:
  ReactState:
    fields:
      state_id: String
      thought: String
      action: String
      observation: String
      iteration: Int
      is_terminal: Bool

  ReactLoop:
    fields:
      loop_id: String
      task: String
      max_iterations: Int
      current_iteration: Int
      history: List<String>
      kv_cache_hits: Int

  Thought:
    fields:
      thought_id: String
      content: String
      reasoning_type: String
      confidence: Float
      tokens_used: Int

  Action:
    fields:
      action_id: String
      action_type: String
      tool_name: String
      parameters: Map<String,String>
      is_masked: Bool

  Observation:
    fields:
      observation_id: String
      content: String
      source: String
      is_error: Bool
      tokens: Int

  ReactTrace:
    fields:
      trace_id: String
      states: List<String>
      total_tokens: Int
      success: Bool
      final_answer: Option<String>

behaviors:
  - name: initialize_loop
    given: Task description and configuration
    when: ReAct loop starts
    then: Returns initialized loop with stable prefix for KV-cache

  - name: generate_thought
    given: Current state and history
    when: Reasoning step is needed
    then: Returns thought with reasoning trace

  - name: select_action
    given: Thought and available tools
    when: Action selection is needed
    then: Returns action with masked unavailable tools

  - name: execute_action
    given: Selected action and environment
    when: Action execution is triggered
    then: Returns observation from environment

  - name: update_state
    given: Current state, action, and observation
    when: State transition occurs
    then: Returns new state with append-only history

  - name: check_termination
    given: Current state and task goal
    when: Termination check is needed
    then: Returns whether task is complete

  - name: extract_answer
    given: Final state and trace
    when: Task is complete
    then: Returns extracted answer from trace

  - name: handle_error_recovery
    given: Error observation in history
    when: Error recovery is needed
    then: Returns recovery strategy keeping error in context
