# FFI PHP v56410 - PHP FFI Extension / Zend
# VIBEE → PHP Native Extensions
# φ² + 1/φ² = 3 | PHOENIX = 999

name: ffi_php_v56410
version: "56.4.10"
language: zig
module: ffi_php

creation_pattern:
  source: VibeeSpec
  transformer: PHPBindingsGenerator
  result: PHPExtension

types:
  ZvalType:
    fields:
      type_tag: String
      value: String
      refcount: Int

  PHPFunction:
    fields:
      name: String
      args: List<String>
      return_type: String
      is_method: Bool

  PHPClass:
    fields:
      name: String
      parent: Option<String>
      interfaces: List<String>
      methods: List<PHPFunction>
      properties: List<String>

  PHPModule:
    fields:
      name: String
      version: String
      functions: List<PHPFunction>
      classes: List<PHPClass>

  ConfigM4:
    fields:
      extension_name: String
      sources: List<String>
      dependencies: List<String>

  PHPFFIDecl:
    fields:
      header: String
      functions: List<String>
      types: List<String>

  ZendArg:
    fields:
      name: String
      type_hint: Option<String>
      default_value: Option<String>
      is_variadic: Bool

  PHPExtension:
    fields:
      name: String
      module_entry: String
      functions: List<PHPFunction>
      config_m4: ConfigM4

behaviors:
  - name: generate_zend_extension
    given: VibeeSpec
    when: Zend extension needed
    then: PHP extension files

  - name: generate_ffi_header
    given: VibeeSpec
    when: PHP FFI needed
    then: FFI header declaration

  - name: map_vibee_to_zval
    given: Vibee type
    when: Type mapping needed
    then: zval type

  - name: generate_module_entry
    given: Extension config
    when: Module entry needed
    then: zend_module_entry

  - name: generate_config_m4
    given: Build config
    when: config.m4 needed
    then: ConfigM4 file

  - name: generate_arginfo
    given: Function signature
    when: Argument info needed
    then: ZEND_ARG_INFO macros

  - name: wrap_zend_class
    given: Class definition
    when: Class registration needed
    then: zend_class_entry

  - name: handle_php_exception
    given: C code
    when: Exception handling needed
    then: zend_throw_exception
