# rag_generation_v2729.vibee - RAG Generation
# Генерация с контекстом RAG
# φ² + 1/φ² = 3 | PHOENIX = 999

name: rag_generation_v2729
version: "2729.0.0"
language: zig
module: rag_generation_v2729

types:
  RAGRequest:
    fields:
      query: String
      context_chunks: List
      system_prompt: String
      max_tokens: Int

  RAGResponse:
    fields:
      answer: String
      sources: List
      confidence: Float
      tokens_used: Int

  ContextWindow:
    fields:
      chunks: List
      total_tokens: Int
      max_tokens: Int

  CitationInfo:
    fields:
      text: String
      source: String
      chunk_id: String

  GenerationConfig:
    fields:
      model: String
      temperature: Float
      include_citations: Bool
      max_context_tokens: Int

behaviors:
  - name: generate
    given: RAGRequest
    when: Generation
    then: Return RAGResponse

  - name: format_context
    given: Chunks
    when: Context formatting
    then: Return ContextWindow

  - name: extract_citations
    given: Response and chunks
    when: Citation extraction
    then: Return CitationInfo list

  - name: verify_grounding
    given: Response and context
    when: Verification
    then: Return grounding score

  - name: stream_generate
    given: RAGRequest
    when: Streaming
    then: Stream tokens

sacred_constants:
  phi: 1.618033988749895
  phoenix: 999
