# iGLA HNSW Index
# Hierarchical Navigable Small World graph for ANN search
# Scientific basis: Malkov & Yashunin 2018 (IEEE TPAMI)
# φ² + 1/φ² = 3 | V = n × 3^k × π^m × φ^p

name: igla_hnsw_index
version: "1.0.0"
language: zig
module: igla_hnsw_index

sacred_constants:
  phi: 1.618033988749895
  trinity: 3.0
  phoenix: 999
  M: 16
  ef_construction: 200

scientific_references:
  - "Malkov & Yashunin 2018: Efficient and robust ANN using HNSW"
  - "Malkov et al. 2014: Approximate nearest neighbor algorithm"
  - "Aumüller et al. 2020: ANN-Benchmarks"

types:
  HNSWConfig:
    fields:
      M: Int
      ef_construction: Int
      ef_search: Int
      max_elements: Int
      dim: Int

  HNSWNode:
    fields:
      id: Int
      vector: String
      level: Int
      neighbors: String

  HNSWLayer:
    fields:
      level: Int
      nodes: String
      entry_point: Int

  HNSWGraph:
    fields:
      layers: String
      max_level: Int
      entry_point: Int
      element_count: Int

  SearchCandidate:
    fields:
      id: Int
      distance: Float
      visited: Bool

  HNSWStats:
    fields:
      nodes: Int
      edges: Int
      max_level: Int
      avg_degree: Float

behaviors:
  - name: create_graph
    given: "HNSWConfig"
    when: "Initialization"
    then: "Empty HNSW graph created"

  - name: insert_node
    given: "Vector, graph"
    when: "Insertion"
    then: "Node added with connections"

  - name: assign_level
    given: "Random value, mL"
    when: "Level assignment"
    then: "Node level from geometric distribution"

  - name: select_neighbors
    given: "Candidates, M"
    when: "Neighbor selection"
    then: "M nearest neighbors"

  - name: connect_neighbors
    given: "Node, neighbors, level"
    when: "Connection"
    then: "Bidirectional edges created"

  - name: get_entry_point
    given: "Graph"
    when: "Entry lookup"
    then: "Top-level entry point"

  - name: compute_distance
    given: "Vector1, Vector2"
    when: "Distance calculation"
    then: "L2 or cosine distance"

  - name: phi_level_distribution
    given: "mL parameter"
    when: "Sacred distribution"
    then: "φ-aligned level probabilities"
