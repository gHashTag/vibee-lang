name: bottleneck_metrics_collector
version: "1.0.0"
language: zig
module: bottleneck_metrics_collector

# BOTTLENECK: Metrics Collection
# Real-time metrics for agent performance
# Enables Golden Chain link 8: BENCHMARK PREV

types:
  MetricType:
    fields:
      name: String
      metric_type: String
      description: String

  Counter:
    fields:
      name: String
      value: Int
      labels: Map<String,String>

  Gauge:
    fields:
      name: String
      value: Float
      labels: Map<String,String>

  Histogram:
    fields:
      name: String
      count: Int
      sum: Float
      buckets: List<Float>

  MetricsSnapshot:
    fields:
      timestamp: Timestamp
      counters: List<String>
      gauges: List<String>
      histograms: List<String>

  DeltaReport:
    fields:
      metric_name: String
      prev_value: Float
      curr_value: Float
      delta: Float
      delta_percent: Float

behaviors:
  - name: register_counter
    given: Counter name and labels
    when: Creating new counter
    then: Return Counter handle

  - name: increment_counter
    given: Counter and delta
    when: Incrementing counter
    then: Return new value

  - name: register_gauge
    given: Gauge name and labels
    when: Creating new gauge
    then: Return Gauge handle

  - name: set_gauge
    given: Gauge and value
    when: Setting gauge value
    then: Return set status

  - name: register_histogram
    given: Histogram name and buckets
    when: Creating new histogram
    then: Return Histogram handle

  - name: observe_histogram
    given: Histogram and value
    when: Recording observation
    then: Return observe status

  - name: snapshot
    given: Nothing
    when: Capturing current metrics
    then: Return MetricsSnapshot

  - name: compute_delta
    given: Previous and current snapshots
    when: Computing v(n) - v(n-1)
    then: Return list of DeltaReports
