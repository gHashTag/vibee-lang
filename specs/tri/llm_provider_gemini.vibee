# Google Gemini Provider Implementation
# Gemini 2.0, Gemini 2.5 Pro models
# Multimodal and grounding support

name: llm_provider_gemini
version: "1.0.0"
language: zig
module: llm_provider_gemini

types:
  GeminiConfig:
    fields:
      api_key: String
      base_url: String
      api_version: String
      project_id: Option<String>

  GeminiModel:
    fields:
      model_id: String
      display_name: String
      context_window: Int
      max_output: Int
      supports_vision: Bool
      supports_audio: Bool
      supports_video: Bool
      supports_grounding: Bool

  GeminiRequest:
    fields:
      model: String
      contents: List<String>
      system_instruction: Option<String>
      generation_config: String
      safety_settings: Option<String>
      tools: Option<String>

  GeminiGenerationConfig:
    fields:
      temperature: Float
      top_p: Float
      top_k: Int
      max_output_tokens: Int
      response_mime_type: Option<String>
      response_schema: Option<String>

  GeminiResponse:
    fields:
      candidates: List<String>
      usage_metadata: String
      model_version: String

  GeminiCandidate:
    fields:
      content: String
      finish_reason: String
      safety_ratings: List<String>
      citation_metadata: Option<String>

  GeminiPart:
    fields:
      part_type: String
      text: Option<String>
      inline_data: Option<String>
      file_data: Option<String>
      function_call: Option<String>
      function_response: Option<String>

  GeminiGrounding:
    fields:
      grounding_source: String
      search_queries: List<String>
      grounding_chunks: List<String>

behaviors:
  - name: generate_content
    given: Gemini config and content request
    when: Generate content API is called
    then: Returns Gemini response with candidates

  - name: stream_generate_content
    given: Gemini config and request with stream
    when: Streaming API is called
    then: Yields response chunks until completion

  - name: process_multimodal
    given: Request with images, audio, or video
    when: Multimodal content is sent
    then: Returns response understanding all modalities

  - name: enable_grounding
    given: Request with grounding enabled
    when: Factual accuracy needed
    then: Returns response with grounding sources

  - name: use_function_calling
    given: Request with function declarations
    when: Model decides to call function
    then: Returns function call for execution

  - name: count_tokens
    given: Content to count
    when: Token counting requested
    then: Returns token count for content

  - name: handle_gemini_error
    given: Gemini API error
    when: Error handling triggered
    then: Returns parsed error with quota info

  - name: validate_gemini_key
    given: API key string
    when: Key validation requested
    then: Returns validation status
