# pipeline_state_v2664.vibee - Pipeline State Objects
# Объекты состояния конвейера для минимизации переключений
# φ² + 1/φ² = 3 | PHOENIX = 999

name: pipeline_state_v2664
version: "2664.0.0"
language: zig
module: pipeline_state_v2664

types:
  PipelineState:
    fields:
      state_id: String
      vertex_layout: Object
      shader_stages: List
      blend_state: Object
      depth_stencil: Object
      rasterizer: Object

  StateCache:
    fields:
      states: List
      current_state: String
      switches: Int

  BlendState:
    fields:
      enabled: Bool
      src_factor: String
      dst_factor: String
      op: String

  DepthStencilState:
    fields:
      depth_test: Bool
      depth_write: Bool
      compare_func: String
      stencil_enabled: Bool

  PipelineStats:
    fields:
      states_created: Int
      state_switches: Int
      cache_hits: Int
      redundant_sets: Int

behaviors:
  - name: create_state
    given: State config
    when: State creation
    then: Return PipelineState

  - name: bind_state
    given: State ID
    when: State bind
    then: Set pipeline state

  - name: get_or_create
    given: State config
    when: Lookup or create
    then: Return cached or new

  - name: sort_by_state
    given: Draw calls
    when: Optimization
    then: Minimize switches

  - name: get_stats
    given: None
    when: Stats query
    then: Return PipelineStats

sacred_constants:
  phi: 1.618033988749895
  phoenix: 999
