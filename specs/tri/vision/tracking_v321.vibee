# ═══════════════════════════════════════════════════════════════════════════════
# TRACKING v321 - Object Tracking
# ═══════════════════════════════════════════════════════════════════════════════
# Based on: SORT, DeepSORT, ByteTrack
# Scientific: CVPR 2024, ECCV 2024
# PAS Pattern: D&C + PRE
# φ² + 1/φ² = 3 | PHOENIX = 999
# ═══════════════════════════════════════════════════════════════════════════════

name: tracking
version: "3.2.1"
language: zig
module: tracking

sacred_constants:
  phi: 1.618033988749895
  trinity: 3.0
  phoenix: 999

creation_pattern:
  source: DetectionSequence
  transformer: Tracker
  result: Tracks

types:
  TrackerType:
    enum:
      - sort
      - deepsort
      - bytetrack
      - ocsort

  TrackState:
    enum:
      - tentative
      - confirmed
      - deleted

  Track:
    fields:
      track_id: Int
      state: TrackState
      bbox: List<Float>
      velocity: List<Float>
      age: Int
      hits: Int

  KalmanState:
    fields:
      mean: List<Float>
      covariance: List<Float>

  Association:
    fields:
      detection_idx: Int
      track_idx: Int
      cost: Float

  TrackerConfig:
    fields:
      tracker_type: TrackerType
      max_age: Int
      min_hits: Int
      iou_threshold: Float

behaviors:
  - name: update
    given: "Detections"
    when: "Update"
    then: "Update tracks"
    pas_pattern: D&C
    complexity: O(n * m)
    test_cases:
      - name: test_update
        input: '{"detections": [...]}'
        expected: '{"tracks": [...]}'

  - name: predict
    given: "Current tracks"
    when: "Prediction"
    then: "Predict next state"
    pas_pattern: ALG
    complexity: O(n)
    test_cases:
      - name: test_predict
        input: '{"tracks": [...]}'
        expected: '{"predicted": [...]}'

  - name: associate
    given: "Detections and tracks"
    when: "Association"
    then: "Match detections to tracks"
    pas_pattern: D&C
    complexity: O(n * m)
    test_cases:
      - name: test_associate
        input: '{"detections": [...], "tracks": [...]}'
        expected: '{"matches": [...]}'

  - name: create_track
    given: "Detection"
    when: "Track creation"
    then: "Create new track"
    pas_pattern: PRE
    complexity: O(1)
    test_cases:
      - name: test_create
        input: '{"detection": {...}}'
        expected: '{"track": {...}}'

  - name: delete_track
    given: "Track ID"
    when: "Deletion"
    then: "Delete track"
    pas_pattern: PRE
    complexity: O(1)
    test_cases:
      - name: test_delete
        input: '{"track_id": 1}'
        expected: '{"deleted": true}'

  - name: get_active_tracks
    given: "None"
    when: "Query"
    then: "Return active tracks"
    pas_pattern: PRE
    complexity: O(n)
    test_cases:
      - name: test_active
        input: '{}'
        expected: '{"tracks": [...]}'

# ═══════════════════════════════════════════════════════════════════════════════
# φ² + 1/φ² = 3 | PHOENIX = 999
# ═══════════════════════════════════════════════════════════════════════════════
