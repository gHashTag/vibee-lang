# v6009 - Transformer Block
# ==========================
# Полный transformer block
# φ² + 1/φ² = 3 | PHOENIX = 999

name: transformer_block
version: "6.0.9"
language: zig
module: transformer_block

constants:
  PHI: 1.618033988749895
  FF_MULT: 4

types:
  TransformerBlock:
    fields:
      attention: Object
      ff1: Object
      ff2: Object
      ln1: Object
      ln2: Object
      hidden_size: Int
      
  BlockCache:
    fields:
      attn_cache: Object
      ff_cache: Object
      residual1: List
      residual2: List
      
  BlockGrads:
    fields:
      d_attention: Object
      d_ff: Object
      d_input: List

behaviors:
  - name: block_forward
    given: Input и block
    when: Forward pass
    then: Вернуть LN(x + Attn(x)) + FFN
    
  - name: block_backward
    given: Output grad и cache
    when: Backward pass
    then: Вернуть BlockGrads
    
  - name: block_init
    given: hidden_size
    when: Инициализация
    then: Init attention и FFN
