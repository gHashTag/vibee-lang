# zig_agent_core_v22.vibee
# KOSCHEI CYCLE 22 - Native Agent Core in Zig
# Full agent loop without shell scripts
# φ² + 1/φ² = 3 | PHOENIX = 999

name: zig_agent_core_v22
version: "22.0.0"
language: zig
module: zig_agent_core_v22

types:
  AgentConfig:
    fields:
      cdp_url: String
      ollama_url: String
      model: String
      max_steps: Int
      timeout_ms: Int

  AgentState:
    enum:
      - Idle
      - Observing
      - Thinking
      - Acting
      - Done
      - Error

  Task:
    fields:
      description: String
      start_url: String
      success_criteria: String

  Step:
    fields:
      step_number: Int
      state: String
      observation: String
      thought: String
      action: String
      input: String
      result: String
      duration_ms: Int

  AgentResult:
    fields:
      success: Bool
      steps_taken: Int
      total_duration_ms: Int
      final_result: String
      error: Option<String>

  Action:
    fields:
      action_type: String
      input: String

  ActionType:
    enum:
      - Goto
      - Click
      - Type
      - Scroll
      - Extract
      - Done
      - Fail

  Observation:
    fields:
      url: String
      title: String
      dom_summary: String
      interactive_elements: String

  ThinkResult:
    fields:
      thought: String
      action: String
      input: String
      confidence: Float

  AgentHistory:
    fields:
      steps: String
      total_steps: Int
      last_action: String

behaviors:
  - name: create_agent
    given: AgentConfig
    when: Creating agent instance
    then: Return agent handle

  - name: run_task
    given: Task
    when: Running autonomous task
    then: Return AgentResult

  - name: observe
    given: Agent state
    when: Capturing page observation
    then: Return Observation

  - name: think
    given: Task, observation, history
    when: Asking LLM for next action
    then: Return ThinkResult

  - name: act
    given: Action
    when: Executing browser action
    then: Return action result

  - name: parse_action
    given: LLM response
    when: Parsing thought/action/input
    then: Return Action

  - name: check_done
    given: Observation and criteria
    when: Checking task completion
    then: Return done status

  - name: build_prompt
    given: Task, observation, history
    when: Building LLM prompt
    then: Return prompt string

  - name: agent_loop
    given: Agent and task
    when: Running observe-think-act loop
    then: Iterate until done

  - name: get_history
    given: Agent state
    when: Getting step history
    then: Return AgentHistory

test_cases:
  - name: simple_task
    input: get title of example.com
    expected: success=true

  - name: navigation_task
    input: go to google.com
    expected: steps <= 3

  - name: action_parsing
    input: Thought: X Action: goto Input: url
    expected: action=goto

sacred_constants:
  phi: 1.618033988749895
  phi_squared_plus_inverse_squared: 3
  phoenix: 999
