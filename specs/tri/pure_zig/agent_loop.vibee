name: agent_loop
version: "11.0.0"
language: zig
module: agent_loop

# AGENT: Main Loop
# ReAct + CoT + ToT + Reflexion loop
# The heart of the agent

types:
  LoopConfig:
    fields:
      max_steps: Int
      timeout_ms: Int
      reasoning_strategy: String
      enable_reflexion: Bool
      enable_tot: Bool

  LoopState:
    fields:
      step: Int
      phase: String
      thought: Option<String>
      action: Option<String>
      observation: Option<String>

  LoopResult:
    fields:
      success: Bool
      answer: Option<String>
      steps_taken: Int
      total_time_ms: Int
      trajectory: List<String>

  StepResult:
    fields:
      step_number: Int
      thought: String
      action: String
      observation: String
      should_continue: Bool

behaviors:
  - name: run_loop
    given: Task and LoopConfig
    when: Running main agent loop
    then: Return LoopResult

  - name: execute_step
    given: LoopState
    when: Executing single step
    then: Return StepResult

  - name: think
    given: LoopState
    when: Generating thought
    then: Return thought string

  - name: act
    given: LoopState and thought
    when: Deciding action
    then: Return action

  - name: observe
    given: Action result
    when: Processing observation
    then: Return observation

  - name: should_stop
    given: LoopState
    when: Checking termination
    then: Return bool and reason
