name: error_retry
version: "11.0.0"
language: zig
module: error_retry

# ERROR: Retry Logic
# Automatic retry with backoff

types:
  RetryConfig:
    fields:
      max_attempts: Int
      initial_delay_ms: Int
      max_delay_ms: Int
      backoff_multiplier: Float
      jitter: Bool

  RetryState:
    fields:
      attempt: Int
      last_error: Option<String>
      next_delay_ms: Int
      total_time_ms: Int

  RetryResult:
    fields:
      success: Bool
      attempts: Int
      final_result: Option<String>
      final_error: Option<String>

  RetryableError:
    fields:
      error_type: String
      is_retryable: Bool
      suggested_delay_ms: Option<Int>

behaviors:
  - name: should_retry
    given: Error and RetryState
    when: Deciding if retry
    then: Return bool

  - name: get_delay
    given: RetryConfig and attempt
    when: Calculating delay
    then: Return delay_ms

  - name: retry_with_backoff
    given: Operation and RetryConfig
    when: Retrying operation
    then: Return RetryResult

  - name: is_retryable
    given: Error
    when: Checking if retryable
    then: Return RetryableError

  - name: reset_state
    given: RetryState
    when: Resetting retry state
    then: Return fresh RetryState

  - name: get_stats
    given: RetryState
    when: Getting retry statistics
    then: Return stats map
