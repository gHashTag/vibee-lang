name: memory_retrieval
version: "11.0.0"
language: zig
module: memory_retrieval

# MEMORY: Unified Retrieval System
# Combines episodic, semantic, working, long-term
# Intelligent routing and fusion

types:
  RetrievalSource:
    fields:
      source_type: String
      weight: Float
      enabled: Bool

  UnifiedQuery:
    fields:
      query_text: String
      query_embedding: Option<List<Float>>
      sources: List<String>
      k_per_source: Int
      fusion_strategy: String

  UnifiedResult:
    fields:
      results: List<String>
      sources: List<String>
      scores: List<Float>
      fusion_score: Float

  RetrievalConfig:
    fields:
      episodic_weight: Float
      semantic_weight: Float
      working_weight: Float
      longterm_weight: Float
      rerank_enabled: Bool

  RerankResult:
    fields:
      original_order: List<Int>
      reranked_order: List<Int>
      scores: List<Float>

behaviors:
  - name: retrieve_unified
    given: UnifiedQuery
    when: Searching all memory types
    then: Return UnifiedResult

  - name: route_query
    given: Query text
    when: Deciding which memories to search
    then: Return list of RetrievalSources

  - name: fuse_results
    given: Results from multiple sources
    when: Combining search results
    then: Return fused UnifiedResult

  - name: rerank
    given: Results and query
    when: Reranking by relevance
    then: Return RerankResult

  - name: get_context_for_task
    given: Task description
    when: Building task context
    then: Return relevant context string

  - name: update_retrieval_weights
    given: Feedback on retrieval quality
    when: Learning better retrieval
    then: Update RetrievalConfig weights
