name: cdp_protocol
version: "11.0.0"
language: zig
module: cdp_protocol

# INFRA: Chrome DevTools Protocol
# Browser automation protocol

types:
  CDPSession:
    fields:
      session_id: String
      target_id: String
      connected: Bool

  CDPCommand:
    fields:
      id: Int
      method: String
      params: String

  CDPResponse:
    fields:
      id: Int
      result: Option<String>
      error: Option<String>

  CDPEvent:
    fields:
      method: String
      params: String

  CDPTarget:
    fields:
      target_id: String
      target_type: String
      url: String
      title: String

behaviors:
  - name: connect
    given: WebSocket URL
    when: Connecting to browser
    then: Return CDPSession

  - name: send_command
    given: CDPCommand
    when: Sending CDP command
    then: Return CDPResponse

  - name: subscribe_event
    given: Event name
    when: Subscribing to events
    then: Return subscription handle

  - name: get_targets
    given: Nothing
    when: Listing targets
    then: Return list of CDPTargets

  - name: attach_target
    given: Target ID
    when: Attaching to target
    then: Return CDPSession

  - name: detach
    given: CDPSession
    when: Detaching from target
    then: Return detach status
