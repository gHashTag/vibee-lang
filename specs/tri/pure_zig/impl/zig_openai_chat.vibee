name: zig_openai_chat
version: "13.0.0"
language: zig
module: zig_openai_chat

# IMPLEMENTATION: OpenAI Chat Completions
# Message formatting and conversation management
# φ² + 1/φ² = 3

types:
  Conversation:
    fields:
      messages: List<String>
      system_prompt: Option<String>
      total_tokens: Int

  MessageRole:
    fields:
      role: String

  FunctionDef:
    fields:
      name: String
      description: String
      parameters: String

  FunctionCall:
    fields:
      name: String
      arguments: String

  ToolChoice:
    fields:
      choice_type: String
      function_name: Option<String>

behaviors:
  - name: new_conversation
    given: Optional system prompt
    when: Starting new conversation
    then: Return empty Conversation

  - name: add_user_message
    given: Conversation and user text
    when: Adding user message
    then: Return updated Conversation

  - name: add_assistant_message
    given: Conversation and assistant text
    when: Adding assistant response
    then: Return updated Conversation

  - name: format_messages
    given: Conversation
    when: Formatting for API
    then: Return JSON array string

  - name: with_functions
    given: Conversation and function definitions
    when: Adding function calling
    then: Return request with tools

  - name: parse_function_call
    given: Response with function call
    when: Extracting function call
    then: Return FunctionCall
