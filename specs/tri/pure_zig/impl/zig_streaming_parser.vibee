name: zig_streaming_parser
version: "12.0.0"
language: zig
module: zig_streaming_parser

# IMPLEMENTATION: Streaming JSON Parser
# Parse JSON as it arrives (SSE/streaming)
# For OpenAI streaming responses
# φ² + 1/φ² = 3

types:
  StreamState:
    fields:
      buffer: String
      position: Int
      in_string: Bool
      depth: Int

  StreamEvent:
    fields:
      event_type: String
      data: String
      id: Option<String>

  StreamChunk:
    fields:
      content: String
      is_complete: Bool
      index: Int

  SSEParser:
    fields:
      state: String
      pending_data: String

behaviors:
  - name: create_parser
    given: Nothing
    when: Creating streaming parser
    then: Return StreamState

  - name: feed
    given: StreamState and new bytes
    when: Adding data to parser
    then: Return list of complete JSON objects

  - name: parse_sse
    given: SSE data line
    when: Parsing Server-Sent Event
    then: Return StreamEvent

  - name: parse_openai_stream
    given: SSE stream chunk
    when: Parsing OpenAI streaming format
    then: Return content delta

  - name: parse_anthropic_stream
    given: SSE stream chunk
    when: Parsing Anthropic streaming format
    then: Return content block

  - name: is_done
    given: StreamEvent
    when: Checking for [DONE] marker
    then: Return bool
