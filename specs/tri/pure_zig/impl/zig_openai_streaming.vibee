name: zig_openai_streaming
version: "13.0.0"
language: zig
module: zig_openai_streaming

# IMPLEMENTATION: OpenAI Streaming (SSE)
# Server-Sent Events parsing for streaming responses
# φ² + 1/φ² = 3

types:
  SSEEvent:
    fields:
      event_type: Option<String>
      data: String
      id: Option<String>

  StreamDelta:
    fields:
      content: Option<String>
      role: Option<String>
      finish_reason: Option<String>

  StreamState:
    fields:
      buffer: String
      complete: Bool
      total_content: String

  StreamConfig:
    fields:
      on_token: Bool
      buffer_size: Int

behaviors:
  - name: parse_sse_line
    given: SSE data line
    when: Parsing single SSE event
    then: Return SSEEvent

  - name: parse_delta
    given: SSEEvent data
    when: Extracting content delta
    then: Return StreamDelta

  - name: is_done
    given: SSEEvent
    when: Checking for [DONE] marker
    then: Return bool

  - name: accumulate
    given: StreamState and StreamDelta
    when: Building full response
    then: Return updated StreamState

  - name: process_chunk
    given: Raw chunk bytes
    when: Processing streaming chunk
    then: Return list of StreamDeltas
