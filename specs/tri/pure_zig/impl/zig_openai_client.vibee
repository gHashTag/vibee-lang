name: zig_openai_client
version: "13.0.0"
language: zig
module: zig_openai_client

# IMPLEMENTATION: OpenAI API Client
# Pure Zig client for GPT-4, GPT-4o
# Uses http_client.zig and json_parser.zig
# φ² + 1/φ² = 3

types:
  OpenAIConfig:
    fields:
      api_key: String
      model: String
      base_url: String
      timeout_ms: Int

  ChatMessage:
    fields:
      role: String
      content: String

  ChatRequest:
    fields:
      model: String
      messages: List<String>
      temperature: Float
      max_tokens: Int
      stream: Bool

  ChatResponse:
    fields:
      id: String
      content: String
      finish_reason: String
      prompt_tokens: Int
      completion_tokens: Int
      latency_ms: Int

  OpenAIError:
    fields:
      error_type: String
      message: String
      code: Option<String>

behaviors:
  - name: create_client
    given: OpenAIConfig with api_key and model
    when: Initializing OpenAI client
    then: Return client handle

  - name: chat
    given: List of ChatMessages
    when: Making chat completion request
    then: Return ChatResponse with content

  - name: chat_with_system
    given: System prompt and user message
    when: Making chat with system context
    then: Return ChatResponse

  - name: build_request_json
    given: ChatRequest
    when: Building JSON body for API
    then: Return JSON string

  - name: parse_response
    given: API response body
    when: Parsing OpenAI response
    then: Return ChatResponse or error

  - name: extract_content
    given: Parsed response
    when: Getting assistant message
    then: Return content string
