name: process_spawn
version: "11.0.0"
language: zig
module: process_spawn

# INFRA: Process Spawning
# Child process management

types:
  SpawnConfig:
    fields:
      program: String
      args: List<String>
      env: Map<String,String>
      cwd: Option<String>

  ProcessHandle:
    fields:
      pid: Int
      running: Bool
      exit_code: Option<Int>

  ProcessOutput:
    fields:
      stdout: String
      stderr: String
      exit_code: Int

  PipeConfig:
    fields:
      stdin: Bool
      stdout: Bool
      stderr: Bool

behaviors:
  - name: spawn
    given: SpawnConfig
    when: Starting process
    then: Return ProcessHandle

  - name: spawn_with_pipes
    given: SpawnConfig and PipeConfig
    when: Starting with pipes
    then: Return ProcessHandle with pipes

  - name: wait
    given: ProcessHandle
    when: Waiting for exit
    then: Return ProcessOutput

  - name: kill
    given: ProcessHandle and signal
    when: Killing process
    then: Return kill status

  - name: write_stdin
    given: ProcessHandle and data
    when: Writing to stdin
    then: Return bytes written

  - name: read_stdout
    given: ProcessHandle
    when: Reading stdout
    then: Return output data
