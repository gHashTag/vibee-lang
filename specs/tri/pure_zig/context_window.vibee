name: context_window
version: "11.0.0"
language: zig
module: context_window

# CONTEXT: Window Management
# Manus AI style Context Engineering
# Optimal use of limited context window

types:
  ContextSegment:
    fields:
      segment_id: String
      content: String
      token_count: Int
      priority: Float
      segment_type: String

  ContextWindow:
    fields:
      segments: List<String>
      total_tokens: Int
      max_tokens: Int
      reserved_tokens: Int

  ContextAllocation:
    fields:
      system_tokens: Int
      history_tokens: Int
      memory_tokens: Int
      task_tokens: Int
      output_tokens: Int

  WindowConfig:
    fields:
      max_tokens: Int
      system_ratio: Float
      history_ratio: Float
      memory_ratio: Float
      task_ratio: Float

behaviors:
  - name: add_segment
    given: ContextSegment
    when: Adding to context window
    then: Return updated ContextWindow

  - name: remove_segment
    given: Segment ID
    when: Removing from context
    then: Return updated ContextWindow

  - name: allocate
    given: WindowConfig
    when: Planning context allocation
    then: Return ContextAllocation

  - name: fit_to_window
    given: Content and max_tokens
    when: Content exceeds limit
    then: Return truncated content

  - name: get_available
    given: ContextWindow
    when: Checking available space
    then: Return available tokens

  - name: build_prompt
    given: ContextWindow
    when: Building final prompt
    then: Return formatted prompt string
