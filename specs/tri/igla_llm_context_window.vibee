# iGLA LLM Context Window Test
# Long context handling evaluation
# φ² + 1/φ² = 3 | V = n × 3^k × π^m × φ^p

name: igla_llm_context_window
version: "1.0.0"
language: zig
module: igla_llm_context_window

sacred_constants:
  phi: 1.618033988749895
  trinity: 3.0
  phoenix: 999

types:
  ContextConfig:
    fields:
      max_context_tokens: Int
      test_positions: List<Float>
      needle_types: List<String>
      haystack_types: List<String>

  ContextTask:
    fields:
      task_id: String
      context_length: Int
      needle_position: Float
      needle_content: String
      question: String

  ContextResult:
    fields:
      task_id: String
      found_needle: Bool
      retrieved_content: String
      position_accuracy: Float
      latency_ms: Float

  ContextMetrics:
    fields:
      retrieval_accuracy_4k: Float
      retrieval_accuracy_32k: Float
      retrieval_accuracy_128k: Float
      retrieval_accuracy_1m: Float
      position_invariance: Float

behaviors:
  - name: generate_haystack
    given: "Context length"
    when: "Generation"
    then: "Random text haystack"

  - name: insert_needle
    given: "Haystack + position"
    when: "Insertion"
    then: "Needle inserted at position"

  - name: test_retrieval
    given: "Context + question"
    when: "Testing"
    then: "Needle retrieval tested"

  - name: test_position_invariance
    given: "Multiple positions"
    when: "Testing"
    then: "Position independence verified"

  - name: scale_context
    given: "Base test"
    when: "Scaling"
    then: "Test at increasing lengths"

  - name: compute_metrics
    given: "All results"
    when: "Metrics"
    then: "iGLA: 95% at 128k, 90% at 1M target"

  - name: phi_context_harmony
    given: "Metrics"
    when: "Harmony"
    then: "φ-weighted context score"
