# VIBEE Specification v13522
# User Presence
# KOSCHEI CYCLE 11 - 1000000x SPEEDUP

name: collab_presence
version: "13522"
language: zig
module: collab_presence

types:
  PresenceState:
    fields:
      user_id: String
      status: String
      last_active: Timestamp
      location: Object

  PresenceUpdate:
    fields:
      user_id: String
      status: String
      metadata: Object
      timestamp: Timestamp

  UserLocation:
    fields:
      file: String
      line: Int
      column: Int
      selection: Object

  PresenceConfig:
    fields:
      heartbeat_interval_ms: Int
      timeout_ms: Int
      track_location: Bool

  PresenceMetrics:
    fields:
      users_online: Int
      heartbeats_sent: Int
      timeouts: Int

  PresenceList:
    fields:
      users: List<Object>
      updated_at: Timestamp

behaviors:
  - name: update_presence
    given: Presence update
    When: Update triggered
    then: Presence state updated

  - name: get_presence
    given: User ID
    When: Query requested
    then: Presence state returned

  - name: list_online
    given: Session ID
    When: List requested
    then: Online users returned

  - name: handle_timeout
    given: Inactive user
    When: Timeout reached
    then: User marked offline

  - name: track_location
    given: User activity
    When: Location tracking enabled
    then: Location updated

  - name: broadcast_presence
    given: Presence change
    When: Broadcast needed
    then: Change broadcast to others

creation_pattern:
  source: PresenceConfig
  transformer: PresenceManager
  result: PresenceState
