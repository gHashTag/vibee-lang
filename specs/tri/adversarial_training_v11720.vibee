name: adversarial_training_v11720
version: "11720"
language: zig
module: adversarial_training

description: |
  TIER 256: Adversarial Training
  Trains models to be robust against attacks
  Based on: PGD-AT, TRADES, adversarial augmentation

types:
  TrainingConfig:
    fields:
      training_method: TrainingMethod
      attack_strength: Float
      num_attack_steps: Int
      trade_off_param: Float

  TrainingMethod:
    variants:
      - pgd_at
      - trades
      - mart
      - awp
      - free_at

  TrainingState:
    fields:
      epoch: Int
      clean_accuracy: Float
      robust_accuracy: Float
      loss: Float

  TrainingResult:
    fields:
      final_clean_acc: Float
      final_robust_acc: Float
      training_time: Int
      model_checkpoint: String

behaviors:
  - name: train_adversarial
    given: Model and dataset
    When: Running adversarial training
    then: Returns trained model

  - name: generate_training_adversarials
    given: Batch
    When: Generating adversarials
    then: Returns adversarial batch

  - name: compute_robust_loss
    given: Predictions and labels
    When: Computing loss
    then: Returns robust loss

  - name: apply_trades
    given: Clean and adversarial
    When: Applying TRADES
    then: Returns TRADES loss

  - name: evaluate_robustness
    given: Model
    When: Evaluating
    then: Returns robustness metrics

  - name: save_checkpoint
    given: Training state
    When: Saving
    then: Returns checkpoint path

  - name: resume_training
    given: Checkpoint
    When: Resuming
    then: Returns training state

  - name: schedule_attack_strength
    given: Epoch
    When: Scheduling
    then: Returns attack strength

creation_pattern:
  source: CleanModel
  transformer: AdversarialTrainer
  result: RobustModel
