name: py2vibee
version: "1.0.0"
language: python
module: py2vibee

description: |
  Python to VIBEE specification converter.
  Converts Python source code to .vibee specifications for multiple target languages.
  Sacred Formula: φ² + 1/φ² = 3 | PHOENIX = 999

constants:
  PHI: 1.618033988749895
  TRINITY: 3.0
  PHOENIX: 999
  CLOCK_FREQ: 50000000
  MAX_VALUE: 255
  MIN_VALUE: 0

types:
  Py2VibeeConverter:
    description: "Main converter class"
    fields:
      type_map: Map<String, String>
      default_constants: Map<String, Int>
      
  FunctionInfo:
    description: "Extracted function information"
    fields:
      name: String
      args: List<Argument>
      returns: String
      docstring: String
      body_lines: Int
      
  Argument:
    description: "Function argument"
    fields:
      name: String
      type: String
      
  TypeMapping:
    description: "Python to VIBEE type mapping"
    fields:
      python_type: String
      vibee_type: String
      
  HardwareSignal:
    description: "Hardware signal for Verilog targets"
    fields:
      name: String
      width: Int
      direction: String  # input, output
      
  VibeSpec:
    description: "Generated VIBEE specification"
    fields:
      name: String
      version: String
      language: String
      module: String
      description: String
      constants: Map<String, Int>
      types: Map<String, Object>
      behaviors: List<Object>
      signals: List<HardwareSignal>
      fsm: List<Object>

behaviors:
  # Main conversion flow
  - name: convert
    given: "Input Python file and target language"
    when: "Conversion is requested"
    then: "Generates .vibee specification file"
    params:
      - name: input_file
        type: String
      - name: output_file
        type: String
      - name: target_language
        type: String
    returns: Bool
    
  - name: parse_python_file
    given: "Path to Python source file"
    when: "File exists and is readable"
    then: "Returns AST Module object"
    params:
      - name: filepath
        type: String
    returns: Object  # ast.Module
    
  - name: extract_functions
    given: "AST Module node"
    when: "Module contains function definitions"
    then: "Returns list of FunctionInfo objects"
    params:
      - name: ast_node
        type: Object
    returns: List<FunctionInfo>
    
  - name: infer_type_from_name
    given: "Python variable name"
    when: "Type annotation not available"
    then: "Returns inferred VIBEE type"
    params:
      - name: variable_name
        type: String
    returns: String
    
  - name: infer_type_from_arg
    given: "AST argument node"
    when: "Argument may have annotation"
    then: "Returns VIBEE type"
    params:
      - name: arg_node
        type: Object
    returns: String
    
  - name: parse_type_annotation
    given: "Python type annotation AST node"
    when: "Annotation is present"
    then: "Returns VIBEE type"
    params:
      - name: annotation_node
        type: Object
    returns: String
    
  - name: generate_vibee_spec
    given: "List of functions, filename, target language"
    when: "Functions extracted successfully"
    then: "Returns complete VibeSpec object"
    params:
      - name: functions
        type: List<FunctionInfo>
      - name: filename
        type: String
      - name: target_language
        type: String
    returns: VibeSpec
    
  - name: generate_hardware_signals
    given: "List of functions"
    when: "Target language is varlog or verilog"
    then: "Returns list of hardware signals"
    params:
      - name: functions
        type: List<FunctionInfo>
    returns: List<HardwareSignal>
    
  - name: type_to_width
    given: "VIBEE type string"
    when: "Type is valid"
    then: "Returns bit width"
    params:
      - name: type_str
        type: String
    returns: Int
    
  - name: save_yaml
    given: "VibeSpec and output file path"
    when: "Specification is valid"
    then: "Saves YAML file to disk"
    params:
      - name: spec
        type: VibeSpec
      - name: output_path
        type: String
    returns: Bool
    
  - name: main
    given: "Command line arguments"
    when: "Script is executed"
    then: "Processes input and generates output"
    params:
      - name: argv
        type: List<String>
    returns: Int  # exit code

# Example test data
test_data:
  sample_python_code: |
    def adder(a: int, b: int) -> int:
        return a + b
        
    def counter(enable: bool) -> int:
        static count = 0
        if enable:
            count += 1
        return count
        
  sample_functions:
    - name: "adder"
      args:
        - name: "a"
          type: "Int"
        - name: "b"
          type: "Int"
      returns: "Int"
      docstring: "Adds two integers"
      body_lines: 1
      
  type_mappings:
    int: "Int"
    float: "Float"
    str: "String"
    bool: "Bool"
    list: "List"
    dict: "Map"
    tuple: "Tuple"
    None: "Void"

metadata:
  author: "VIBEE Project"
  created: "2026-01-26"
  tool_type: "code_converter"
  supported_targets: ["varlog", "verilog", "zig", "python", "rust", "go"]
  sacred_formula: "φ² + 1/φ² = 3"
  phoenix: 999