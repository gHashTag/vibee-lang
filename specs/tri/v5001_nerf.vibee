# v5001 - NeRF
# =============
# Neural Radiance Fields - революция в 3D
# φ² + 1/φ² = 3 | PHOENIX = 999

name: nerf
version: "5.0.1"
language: zig
module: nerf

constants:
  PHI: 1.618033988749895
  NUM_SAMPLES: 64
  NUM_FINE_SAMPLES: 128
  NEAR: 0.1
  FAR: 10.0

types:
  NeRFConfig:
    fields:
      num_layers: Int
      hidden_dim: Int
      use_viewdirs: Bool
      
  Ray:
    fields:
      origin: List
      direction: List
      near: Float
      far: Float
      
  RaySamples:
    fields:
      points: List
      directions: List
      t_values: List
      
  NeRFOutput:
    fields:
      rgb: List
      density: Float
      
  RenderedPixel:
    fields:
      color: List
      depth: Float
      accumulation: Float
      
  PositionalEncoding:
    fields:
      num_freqs: Int
      include_input: Bool
      
  InstantNGP:
    fields:
      hash_table: List
      resolution_levels: Int
      
  NeRFScene:
    fields:
      model: Object
      bounds: List
      background: List

behaviors:
  - name: generate_rays
    given: Camera и pixel coords
    when: Ray generation
    then: Вернуть rays
    
  - name: sample_along_ray
    given: Ray и num samples
    when: Stratified sampling
    then: Вернуть ray samples
    
  - name: positional_encoding
    given: Coordinates и num_freqs
    when: Fourier features
    then: Вернуть encoded
    
  - name: query_nerf
    given: Points, directions, model
    when: MLP query
    then: Вернуть rgb и density
    
  - name: volume_rendering
    given: Colors, densities, t_values
    when: Alpha compositing
    then: Вернуть rendered pixel
    
  - name: hierarchical_sampling
    given: Coarse weights и ray
    when: Importance sampling
    then: Вернуть fine samples
    
  - name: render_image
    given: Camera и NeRF model
    when: Full image render
    then: Вернуть rendered image
    
  - name: train_step
    given: Batch rays и targets
    when: Training iteration
    then: Вернуть loss
