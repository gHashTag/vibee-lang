name: agent_shopping_checkout
version: "1.0.0"
language: zig
module: agent_shopping_checkout

description: |
  Agent Shopping Checkout - оформление заказа
  ВАЖНО: требует подтверждение пользователя
  φ² + 1/φ² = 3 | PHOENIX = 999

types:
  ShippingAddress:
    fields:
      name: String
      street: String
      city: String
      state: String
      zip: String
      country: String
      phone: String

  PaymentMethod:
    fields:
      method_type: String
      last_four: Option<String>
      is_default: Bool

  CheckoutStep:
    fields:
      step_name: String
      completed: Bool
      requires_input: Bool

  OrderSummary:
    fields:
      items: List<String>
      subtotal: Float
      shipping: Float
      tax: Float
      total: Float
      estimated_delivery: String

  OrderResult:
    fields:
      success: Bool
      order_id: Option<String>
      confirmation_url: Option<String>
      error: Option<String>

behaviors:
  - name: start_checkout
    given: Cart корзина
    when: Начало оформления
    then: Список CheckoutStep

  - name: fill_shipping
    given: ShippingAddress адрес
    when: Заполнение адреса доставки
    then: CheckoutStep completed

  - name: select_payment
    given: PaymentMethod метод оплаты
    when: Выбор способа оплаты
    then: CheckoutStep completed

  - name: review_order
    given: Текущий checkout
    when: Просмотр заказа
    then: OrderSummary для подтверждения

  - name: request_confirmation
    given: OrderSummary для подтверждения
    when: Запрос подтверждения у пользователя
    then: Bool подтверждено

  - name: place_order
    given: Подтверждённый заказ
    when: Размещение заказа
    then: OrderResult
