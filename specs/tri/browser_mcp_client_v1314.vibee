# VIBEE Specification: MCP Client v1314
# YOLO XV - Production Ascension

name: browser_mcp_client
version: "1314"
language: zig
module: browser_mcp_client

types:
  MCPClient:
    fields:
      transport: String
      server_info: Map
      server_capabilities: Map
      pending_requests: Map

  ClientCapabilities:
    fields:
      sampling: Bool
      elicitation: Bool
      roots: Bool
      experimental: Map

  Transport:
    fields:
      transport_type: String
      connected: Bool
      read_stream: String
      write_stream: String

  SamplingRequest:
    fields:
      messages: List
      model_preferences: Map
      system_prompt: String
      max_tokens: Int

  SamplingResponse:
    fields:
      role: String
      content: String
      model: String
      stop_reason: String

  ElicitationRequest:
    fields:
      message: String
      requested_schema: Map

  ElicitationResponse:
    fields:
      content: Map
      action: String

behaviors:
  - name: create_client
    given: "Transport configuration"
    when: "Creating MCP client"
    then: "Returns initialized client"

  - name: connect
    given: "Client"
    when: "Connecting to server"
    then: "Establishes transport connection"

  - name: initialize
    given: "Client, capabilities"
    when: "Initializing session"
    then: "Exchanges capabilities with server"

  - name: list_tools
    given: "Client"
    when: "Listing available tools"
    then: "Returns tool definitions"

  - name: call_tool
    given: "Client, tool name, arguments"
    when: "Calling tool"
    then: "Returns tool result"

  - name: list_resources
    given: "Client"
    when: "Listing resources"
    then: "Returns resource definitions"

  - name: read_resource
    given: "Client, URI"
    when: "Reading resource"
    then: "Returns resource content"

  - name: list_prompts
    given: "Client"
    when: "Listing prompts"
    then: "Returns prompt definitions"

  - name: get_prompt
    given: "Client, name, arguments"
    when: "Getting prompt"
    then: "Returns rendered messages"

  - name: handle_sampling_request
    given: "Client, request"
    when: "Server requests sampling"
    then: "Returns LLM completion"

  - name: handle_elicitation_request
    given: "Client, request"
    when: "Server requests user input"
    then: "Returns user response"

  - name: disconnect
    given: "Client"
    when: "Disconnecting"
    then: "Closes transport"

creation_pattern:
  source: MCPClient
  transformer: MCPClientProtocol
  result: ToolClient

test_cases:
  - name: test_connect_initialize
    input:
      server: "test-server"
    expected:
      connected: true
      initialized: true

  - name: test_list_tools
    input:
      server_tools: 5
    expected:
      tools_count: 5

  - name: test_call_tool
    input:
      tool: "echo"
      arguments: {message: "hello"}
    expected:
      result: "hello"

  - name: test_read_resource
    input:
      uri: "file:///config.json"
    expected:
      content_type: "application/json"

  - name: test_sampling_callback
    input:
      messages: [{role: "user", content: "Hello"}]
    expected:
      completion_returned: true

  - name: test_elicitation_callback
    input:
      message: "Enter your name"
    expected:
      user_input_returned: true

  - name: test_reconnection
    input:
      connection_lost: true
    expected:
      reconnected: true

  - name: test_timeout_handling
    input:
      request_timeout: 5000
    expected:
      timeout_error: true
