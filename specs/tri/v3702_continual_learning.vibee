# v3702 - Continual Learning
# ===========================
# Lifelong learning without forgetting
# φ² + 1/φ² = 3 | PHOENIX = 999

name: continual_learning
version: "3.7.2"
language: zig
module: continual_learning

constants:
  PHI: 1.618033988749895
  EWC_LAMBDA: 1000.0
  REPLAY_BUFFER_SIZE: 10000
  MEMORY_STRENGTH: 0.5

types:
  ContinualConfig:
    fields:
      strategy: String
      memory_size: Int
      regularization_strength: Float
      
  Task:
    fields:
      task_id: Int
      data: List
      num_classes: Int
      
  FisherInfo:
    fields:
      param_importance: List
      old_params: List
      
  ReplayBuffer:
    fields:
      samples: List
      max_size: Int
      strategy: String
      
  ProgressiveNet:
    fields:
      columns: List
      lateral_connections: List
      
  PackNetMask:
    fields:
      masks: List
      capacity_used: Float
      
  GEMConstraint:
    fields:
      gradient_memory: List
      task_count: Int
      
  ContinualMetrics:
    fields:
      accuracy_matrix: List
      forgetting: Float
      forward_transfer: Float
      backward_transfer: Float

behaviors:
  - name: compute_fisher_information
    given: Model and task data
    when: Estimating parameter importance
    then: Return Fisher diagonal
    
  - name: ewc_loss
    given: Current params, old params, Fisher
    when: Computing EWC regularization
    then: Return regularization loss
    
  - name: update_replay_buffer
    given: Buffer and new samples
    when: Adding to memory
    then: Return updated buffer
    
  - name: replay_samples
    given: Buffer and batch size
    when: Sampling from memory
    then: Return replay batch
    
  - name: gem_project_gradient
    given: Gradient and constraints
    when: Projecting to feasible region
    then: Return projected gradient
    
  - name: add_progressive_column
    given: Network and new task
    when: Expanding network
    then: Return network with new column
    
  - name: compute_forgetting
    given: Accuracy matrix
    when: Measuring catastrophic forgetting
    then: Return forgetting metric
    
  - name: train_continual
    given: Model, tasks, and config
    when: Training on task sequence
    then: Return model and metrics
