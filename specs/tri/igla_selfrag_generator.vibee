# iGLA Self-RAG Generator
# Self-reflective generation with critique
# Scientific basis: Asai et al. 2023
# φ² + 1/φ² = 3 | V = n × 3^k × π^m × φ^p

name: igla_selfrag_generator
version: "1.0.0"
language: zig
module: igla_selfrag_generator

sacred_constants:
  phi: 1.618033988749895
  trinity: 3.0
  phoenix: 999

scientific_references:
  - "Asai et al. 2023: Self-RAG"
  - "Shinn et al. 2023: Reflexion"
  - "Madaan et al. 2023: Self-Refine"

types:
  GeneratorConfig:
    fields:
      max_tokens: Int
      temperature: Float
      use_reflection: Bool
      max_iterations: Int

  GenerationState:
    fields:
      current_response: String
      iteration: Int
      scores: String
      is_final: Bool

  ReflectiveOutput:
    fields:
      response: String
      reflection_tokens: String
      confidence: Float

  IterationResult:
    fields:
      response: String
      improved: Bool
      delta_score: Float

  GenerationStats:
    fields:
      iterations: Int
      final_score: Float
      tokens_generated: Int

  SegmentedResponse:
    fields:
      segments: String
      segment_scores: String

behaviors:
  - name: generate_initial
    given: "Query, context"
    when: "Initial generation"
    then: "First response"

  - name: generate_with_reflection
    given: "Query, context"
    when: "Reflective generation"
    then: "Response with tokens"

  - name: refine_response
    given: "Response, critique"
    when: "Refinement"
    then: "Improved response"

  - name: segment_response
    given: "Response"
    when: "Segmentation"
    then: "Response segments"

  - name: score_segment
    given: "Segment, context"
    when: "Segment scoring"
    then: "Segment quality"

  - name: iterative_refine
    given: "Response, max_iter"
    when: "Iterative refinement"
    then: "Best response"

  - name: early_stop
    given: "Scores, threshold"
    when: "Early stopping"
    then: "Stop or continue"

  - name: phi_iteration_schedule
    given: "Max iterations"
    when: "Sacred scheduling"
    then: "φ-ratio iteration weights"
