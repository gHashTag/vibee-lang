# VIBEE Specification: Plan Verification v1323
# YOLO XV - Production Ascension

name: browser_plan_verify
version: "1323"
language: zig
module: browser_plan_verify

types:
  PlanVerifier:
    fields:
      domain: String
      constraints: List
      invariants: List

  VerificationResult:
    fields:
      valid: Bool
      errors: List
      warnings: List
      trace: List

  PlanConstraint:
    fields:
      constraint_type: String
      expression: String
      severity: String

  StateInvariant:
    fields:
      name: String
      condition: String
      message: String

  ExecutionTrace:
    fields:
      steps: List
      final_state: Map

  TraceStep:
    fields:
      action: String
      pre_state: Map
      post_state: Map
      satisfied_preconditions: Bool

behaviors:
  - name: create_verifier
    given: "Domain"
    when: "Creating verifier"
    then: "Returns initialized verifier"

  - name: add_constraint
    given: "Verifier, constraint"
    when: "Adding constraint"
    then: "Registers constraint"

  - name: add_invariant
    given: "Verifier, invariant"
    when: "Adding invariant"
    then: "Registers invariant"

  - name: verify_plan
    given: "Verifier, plan, initial state"
    when: "Verifying plan"
    then: "Returns verification result"

  - name: simulate_execution
    given: "Verifier, plan, initial state"
    when: "Simulating execution"
    then: "Returns execution trace"

  - name: check_preconditions
    given: "Verifier, action, state"
    when: "Checking preconditions"
    then: "Returns satisfaction result"

  - name: check_invariants
    given: "Verifier, state"
    when: "Checking invariants"
    then: "Returns violated invariants"

  - name: check_goal_achievement
    given: "Verifier, final state, goal"
    when: "Checking goal"
    then: "Returns achievement result"

  - name: find_first_error
    given: "Verifier, plan, initial state"
    when: "Finding first error"
    then: "Returns first failing step"

  - name: generate_counterexample
    given: "Verifier, failed constraint"
    when: "Generating counterexample"
    then: "Returns minimal failing case"

creation_pattern:
  source: PlanVerifier
  transformer: PlanVerification
  result: VerifiedPlan

test_cases:
  - name: test_valid_plan
    input:
      plan: ["a", "b", "c"]
      all_preconditions_met: true
    expected:
      valid: true

  - name: test_precondition_failure
    input:
      action: "open_door"
      state: {has_key: false}
      precondition: {has_key: true}
    expected:
      valid: false

  - name: test_invariant_violation
    input:
      invariant: "health > 0"
      state: {health: 0}
    expected:
      violated: true

  - name: test_goal_achievement
    input:
      goal: {at_destination: true}
      final_state: {at_destination: true}
    expected:
      achieved: true

  - name: test_execution_trace
    input:
      plan: ["a", "b"]
    expected:
      trace_length: 2

  - name: test_first_error
    input:
      plan: ["a", "b", "c"]
      error_at: 1
    expected:
      first_error_index: 1

  - name: test_counterexample
    input:
      constraint: "no_cycles"
    expected:
      counterexample_generated: true

  - name: test_temporal_constraints
    input:
      constraint: "a before b"
      plan: ["b", "a"]
    expected:
      violated: true
