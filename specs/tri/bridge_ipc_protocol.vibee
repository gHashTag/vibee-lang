# Bridge IPC Protocol
# JSON-RPC 2.0 based communication
# Zig â†” Node.js bidirectional

name: bridge_ipc_protocol
version: "1.0.0"
language: zig
module: bridge_ipc_protocol

types:
  JsonRpcRequest:
    fields:
      jsonrpc: String
      id: Int
      method: String
      params: Map<String,String>

  JsonRpcResponse:
    fields:
      jsonrpc: String
      id: Int
      result: Option<String>
      error: Option<String>

  JsonRpcError:
    fields:
      code: Int
      message: String
      data: Option<String>

  ProtocolConfig:
    fields:
      version: String
      encoding: String
      max_message_size: Int
      timeout_ms: Int

  MessageFrame:
    fields:
      length: Int
      payload: String
      checksum: Option<String>

  ProtocolState:
    fields:
      state_id: String
      pending_requests: Int
      last_request_id: Int
      is_connected: Bool

behaviors:
  - name: create_request
    given: Method name and parameters
    when: Request creation needed
    then: Returns JSON-RPC request

  - name: parse_response
    given: Raw response bytes
    when: Response parsing needed
    then: Returns parsed JSON-RPC response

  - name: create_error_response
    given: Error code and message
    when: Error response needed
    then: Returns JSON-RPC error response

  - name: frame_message
    given: JSON payload
    when: Message framing needed
    then: Returns framed message with length prefix

  - name: unframe_message
    given: Framed bytes
    when: Message unframing needed
    then: Returns extracted payload

  - name: validate_message
    given: JSON-RPC message
    when: Validation needed
    then: Returns validation result

  - name: generate_request_id
    given: Protocol state
    when: New request ID needed
    then: Returns unique request ID

  - name: match_response
    given: Response and pending requests
    when: Response matching needed
    then: Returns matched request
