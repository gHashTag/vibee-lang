# FFI D v56460 - D Language extern(C)
# VIBEE → D Native Bindings
# φ² + 1/φ² = 3 | PHOENIX = 999

name: ffi_d_v56460
version: "56.4.60"
language: zig
module: ffi_d

creation_pattern:
  source: VibeeSpec
  transformer: DBindingsGenerator
  result: DModule

types:
  DType:
    fields:
      name: String
      d_type: String
      c_type: String
      is_pointer: Bool

  DFunction:
    fields:
      name: String
      params: List<String>
      return_type: String
      linkage: String
      attributes: List<String>

  DStruct:
    fields:
      name: String
      fields: List<String>
      is_extern: Bool
      alignment: Option<Int>

  DEnum:
    fields:
      name: String
      base_type: String
      members: List<String>

  DModule:
    fields:
      name: String
      imports: List<String>
      types: List<DType>
      functions: List<DFunction>
      structs: List<DStruct>

  DubConfig:
    fields:
      name: String
      version: String
      dependencies: List<String>
      libs: List<String>

  DCallback:
    fields:
      name: String
      signature: String
      is_nothrow: Bool

  DSlice:
    fields:
      element_type: String
      ptr: String
      length: String

behaviors:
  - name: generate_d_module
    given: VibeeSpec
    when: D module needed
    then: D module file

  - name: generate_extern_c
    given: C function
    when: extern(C) needed
    then: DFunction with linkage

  - name: map_vibee_to_d_type
    given: Vibee type
    when: Type mapping needed
    then: D type

  - name: generate_struct
    given: C struct
    when: D struct needed
    then: DStruct definition

  - name: generate_dub_json
    given: Package config
    when: dub.json needed
    then: DubConfig file

  - name: handle_string
    given: C string
    when: String conversion needed
    then: fromStringz/toStringz

  - name: handle_callback
    given: C callback
    when: Delegate needed
    then: DCallback

  - name: handle_gc
    given: D memory
    when: GC pinning needed
    then: GC.addRoot/removeRoot
