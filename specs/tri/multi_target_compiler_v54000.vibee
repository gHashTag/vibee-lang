name: multi_target_compiler_v54000
version: "54000.0.0"
language: zig
module: multi_target_compiler

# MULTI-TARGET VIBEE COMPILER
# Генерация кода из .vibee в любой язык:
# - Zig (primary)
# - Rust
# - Python
# - Go
# - TypeScript
# - Gleam
# - WASM
# - C

types:
  # ═══════════════════════════════════════════════════════════════
  # TARGET LANGUAGES
  # ═══════════════════════════════════════════════════════════════

  TargetLanguage:
    fields:
      name: String
      extension: String
      is_compiled: Bool
      supports_generics: Bool
      supports_simd: Bool
      supports_wasm: Bool

  # ═══════════════════════════════════════════════════════════════
  # TYPE MAPPINGS (VIBEE -> Target)
  # ═══════════════════════════════════════════════════════════════

  TypeMapping:
    fields:
      vibee_type: String
      target_type: String
      requires_import: Bool
      import_path: String

  TypeMappingTable:
    fields:
      target: String
      mappings_count: Int

  # ═══════════════════════════════════════════════════════════════
  # AST (Abstract Syntax Tree) - Language Independent
  # ═══════════════════════════════════════════════════════════════

  AstNode:
    fields:
      kind: Int
      value: String
      children_count: Int
      line: Int
      column: Int

  AstModule:
    fields:
      name: String
      imports_count: Int
      types_count: Int
      functions_count: Int

  AstType:
    fields:
      name: String
      is_struct: Bool
      is_enum: Bool
      is_generic: Bool
      fields_count: Int

  AstField:
    fields:
      name: String
      type_name: String
      is_optional: Bool
      is_public: Bool

  AstFunction:
    fields:
      name: String
      params_count: Int
      return_type: String
      is_public: Bool
      is_async: Bool

  # ═══════════════════════════════════════════════════════════════
  # CODE GENERATION
  # ═══════════════════════════════════════════════════════════════

  CodegenConfig:
    fields:
      target: String
      optimization_level: Int
      emit_tests: Bool
      emit_docs: Bool
      minify: Bool

  GeneratedOutput:
    fields:
      code: String
      target: String
      size_bytes: Int
      lines_count: Int

  # ═══════════════════════════════════════════════════════════════
  # BACKEND REGISTRY
  # ═══════════════════════════════════════════════════════════════

  Backend:
    fields:
      name: String
      version: String
      is_stable: Bool

  BackendRegistry:
    fields:
      backends_count: Int
      default_backend: String

behaviors:
  # ═══════════════════════════════════════════════════════════════
  # TARGET MANAGEMENT
  # ═══════════════════════════════════════════════════════════════

  - name: get_supported_targets
    given: Compiler instance
    when: Target list requested
    then: List of all supported languages

  - name: get_target_info
    given: Target name
    when: Info requested
    then: TargetLanguage with capabilities

  - name: validate_target
    given: Target name
    when: Validation triggered
    then: Target exists and is supported

  # ═══════════════════════════════════════════════════════════════
  # TYPE MAPPING
  # ═══════════════════════════════════════════════════════════════

  - name: get_type_mapping
    given: VIBEE type and target language
    when: Mapping requested
    then: Corresponding target type

  - name: map_string_type
    given: Target language
    when: String mapping requested
    then: Target string type returned

  - name: map_int_type
    given: Target language
    when: Int mapping requested
    then: Target integer type returned

  - name: map_float_type
    given: Target language
    when: Float mapping requested
    then: Target float type returned

  - name: map_bool_type
    given: Target language
    when: Bool mapping requested
    then: Target boolean type returned

  - name: map_optional_type
    given: Base type and target language
    when: Optional mapping requested
    then: Target optional type returned

  - name: map_list_type
    given: Element type and target language
    when: List mapping requested
    then: Target list type returned

  # ═══════════════════════════════════════════════════════════════
  # AST OPERATIONS
  # ═══════════════════════════════════════════════════════════════

  - name: parse_to_ast
    given: VIBEE source code
    when: Parsing triggered
    then: Language-independent AST

  - name: validate_ast
    given: AST module
    when: Validation triggered
    then: AST is valid or errors reported

  # ═══════════════════════════════════════════════════════════════
  # CODE GENERATION - ALL TARGETS
  # ═══════════════════════════════════════════════════════════════

  - name: generate_zig
    given: AST module
    when: Zig generation triggered
    then: Zig source code

  - name: generate_rust
    given: AST module
    when: Rust generation triggered
    then: Rust source code

  - name: generate_python
    given: AST module
    when: Python generation triggered
    then: Python source code

  - name: generate_go
    given: AST module
    when: Go generation triggered
    then: Go source code

  - name: generate_typescript
    given: AST module
    when: TypeScript generation triggered
    then: TypeScript source code

  - name: generate_gleam
    given: AST module
    when: Gleam generation triggered
    then: Gleam source code

  - name: generate_wasm
    given: AST module
    when: WASM generation triggered
    then: WASM binary module

  - name: generate_c
    given: AST module
    when: C generation triggered
    then: C source code

  # ═══════════════════════════════════════════════════════════════
  # UNIVERSAL GENERATION
  # ═══════════════════════════════════════════════════════════════

  - name: generate_all
    given: AST module
    when: All targets requested
    then: Code for all supported languages

  - name: generate_for_target
    given: AST module and target name
    when: Specific target requested
    then: Code for specified language
