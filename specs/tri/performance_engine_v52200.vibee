name: performance_engine_v52200
version: "52200.0.0"
language: zig
module: performance_engine

types:
  PerformanceConfig:
    fields:
      enable_profiling: Bool
      sample_rate_hz: Int
      memory_tracking: Bool
      cpu_tracking: Bool

  TimingMetric:
    fields:
      name: String
      start_ns: Int
      end_ns: Int
      duration_ns: Int

  MemoryMetric:
    fields:
      allocated_bytes: Int
      freed_bytes: Int
      peak_bytes: Int
      current_bytes: Int

  CpuMetric:
    fields:
      user_time_ns: Int
      system_time_ns: Int
      idle_time_ns: Int
      utilization_percent: Float

  HotspotInfo:
    fields:
      function_name: String
      call_count: Int
      total_time_ns: Int
      avg_time_ns: Int

  PerformanceReport:
    fields:
      total_time_ms: Int
      memory_peak_mb: Float
      hotspots_count: Int
      recommendations: Int

behaviors:
  - name: start_profiling
    given: Performance config
    when: Profiling start triggered
    then: Profiler initialized and running

  - name: record_timing
    given: Function entry point
    when: Function called
    then: Timing recorded

  - name: track_allocation
    given: Memory allocation request
    when: Allocation performed
    then: Memory metric updated

  - name: identify_hotspots
    given: Collected timing data
    when: Analysis triggered
    then: Top hotspots identified

  - name: generate_report
    given: All collected metrics
    when: Report generation triggered
    then: Performance report created

  - name: suggest_optimizations
    given: Hotspot analysis
    when: Suggestion triggered
    then: Optimization recommendations

  - name: compare_runs
    given: Two performance reports
    when: Comparison triggered
    then: Delta analysis with improvements

  - name: export_flamegraph
    given: Timing data
    when: Export triggered
    then: Flamegraph SVG generated
