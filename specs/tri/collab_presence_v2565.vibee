# collab_presence_v2565.vibee - Real-time Presence
# Присутствие пользователей в реальном времени
# YOLO MODE + AMPLIFICATION + MATRYOSHKA
# φ² + 1/φ² = 3 | PHOENIX = 999

name: collab_presence_v2565
version: "2565.0.0"
language: zig
module: collab_presence_v2565

types:
  UserPresence:
    fields:
      user_id: String
      name: String
      avatar_url: String
      color: String
      cursor_position: Object
      selection: Object
      active_file: String
      status: String
      last_seen: Timestamp

  PresenceRoom:
    fields:
      room_id: String
      users: Object
      max_users: Int
      created_at: Timestamp

  CursorPosition:
    fields:
      line: Int
      column: Int
      file_path: String

  SelectionRange:
    fields:
      start_line: Int
      start_column: Int
      end_line: Int
      end_column: Int

behaviors:
  - name: join_room
    given: Room ID and user info
    when: User joins
    then: Add to room and broadcast presence

  - name: leave_room
    given: Room ID and user ID
    when: User leaves
    then: Remove and broadcast departure

  - name: update_cursor
    given: Room ID, user ID, CursorPosition
    when: Cursor moves
    then: Broadcast cursor update

  - name: update_selection
    given: Room ID, user ID, SelectionRange
    when: Selection changes
    then: Broadcast selection update

  - name: get_room_users
    given: Room ID
    when: User list requested
    then: Return all UserPresence

  - name: set_user_status
    given: User ID and status
    when: Status change
    then: Update and broadcast status

  - name: heartbeat
    given: Room ID and user ID
    when: Periodic ping
    then: Update last_seen timestamp

  - name: get_user_color
    given: User ID
    when: Color requested
    then: Return unique user color

sacred_constants:
  phi: 1.618033988749895
  phi_squared_plus_inverse_squared: 3
  phoenix: 999
