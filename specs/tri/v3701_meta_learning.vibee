# v3701 - Meta-Learning
# ======================
# Learning to learn efficiently
# φ² + 1/φ² = 3 | PHOENIX = 999

name: meta_learning
version: "3.7.1"
language: zig
module: meta_learning

constants:
  PHI: 1.618033988749895
  INNER_LR: 0.01
  OUTER_LR: 0.001
  INNER_STEPS: 5
  META_BATCH_SIZE: 4

types:
  MetaConfig:
    fields:
      inner_lr: Float
      outer_lr: Float
      inner_steps: Int
      first_order: Bool
      
  Task:
    fields:
      task_id: String
      support_set: List
      query_set: List
      
  MAMLState:
    fields:
      meta_params: List
      task_params: List
      
  ProtoNetConfig:
    fields:
      embedding_dim: Int
      distance_metric: String
      
  Prototype:
    fields:
      class_id: Int
      embedding: List
      support_count: Int
      
  FewShotEpisode:
    fields:
      n_way: Int
      k_shot: Int
      q_query: Int
      
  MetaGradient:
    fields:
      outer_grad: List
      inner_grads: List
      
  AdaptationResult:
    fields:
      adapted_params: List
      support_loss: Float
      query_loss: Float

behaviors:
  - name: sample_task
    given: Task distribution
    when: Creating few-shot task
    then: Return task with support and query
    
  - name: inner_loop
    given: Model, task, and config
    when: Adapting to task
    then: Return adapted parameters
    
  - name: outer_loop
    given: Meta-batch of tasks
    when: Computing meta-gradient
    then: Return outer gradient
    
  - name: maml_step
    given: Model and meta-batch
    when: One MAML update
    then: Return updated meta-parameters
    
  - name: compute_prototypes
    given: Support set embeddings
    when: Creating class prototypes
    then: Return prototype per class
    
  - name: prototype_classify
    given: Query and prototypes
    when: Classifying query
    then: Return class probabilities
    
  - name: reptile_step
    given: Model and tasks
    when: Reptile meta-update
    then: Return updated parameters
    
  - name: evaluate_few_shot
    given: Model and test tasks
    when: Evaluating adaptation
    then: Return few-shot accuracy
