# ═══════════════════════════════════════════════════════════════════════════════
# AGENT REASONING - Based on Claude Code Architecture
# ═══════════════════════════════════════════════════════════════════════════════
# Source: github.com/anthropics/claude-code
# Sacred Formula: V = n × 3^k × π^m × φ^p × e^q
# Golden Identity: φ² + 1/φ² = 3
# ═══════════════════════════════════════════════════════════════════════════════

name: agent_reasoning
version: "2.0.0"
language: zig
module: agent

sacred_constants:
  phi: 1.618033988749895
  trinity: 3.0
  phoenix: 999

creation_pattern:
  source: UserRequest
  transformer: AgentWorkflow
  result: CompletedTask

# ═══════════════════════════════════════════════════════════════════════════════
# TYPES
# ═══════════════════════════════════════════════════════════════════════════════

types:
  # 7-Phase Feature Development Workflow (from Claude Code)
  WorkflowPhase:
    enum:
      - discovery
      - exploration
      - clarification
      - architecture
      - implementation
      - review
      - summary

  # Agent types (from Claude Code plugins)
  AgentType:
    enum:
      - code_explorer
      - code_architect
      - code_reviewer
      - conversation_analyzer
      - plugin_validator

  # Tool categories
  ToolType:
    enum:
      - glob
      - grep
      - ls
      - read
      - write
      - bash
      - git
      - web_fetch
      - todo_write

  # Agent configuration
  AgentConfig:
    fields:
      name: String
      description: String
      tools: List<ToolType>
      model: String
      color: String

  # Task state
  TaskState:
    fields:
      phase: WorkflowPhase
      todos: List<String>
      files_read: List<String>
      questions: List<String>
      decisions: List<String>

  # Exploration result
  ExplorationResult:
    fields:
      entry_points: List<String>
      key_files: List<String>
      patterns: List<String>
      dependencies: List<String>

  # Architecture option
  ArchitectureOption:
    fields:
      name: String
      approach: String
      tradeoffs: List<String>
      recommended: Bool

  # Review finding
  ReviewFinding:
    fields:
      severity: String
      file: String
      line: Int
      message: String
      suggestion: String

# ═══════════════════════════════════════════════════════════════════════════════
# BEHAVIORS - 7 Phase Workflow
# ═══════════════════════════════════════════════════════════════════════════════

behaviors:
  # Phase 1: Discovery
  - name: phase_discovery
    given: User request with feature description
    when: Starting new feature development
    then: Understand what needs to be built
    actions:
      - Create todo list with all 7 phases
      - If feature unclear ask clarifying questions
      - Summarize understanding and confirm with user
    test_cases:
      - name: discovery_creates_todos
        input:
          request: "Add authentication"
        expected:
          todos_created: true
          phase: discovery

  # Phase 2: Codebase Exploration
  - name: phase_exploration
    given: Confirmed feature understanding
    when: Need to understand existing code
    then: Launch parallel explorer agents
    actions:
      - Launch 2-3 code_explorer agents in parallel
      - Each agent targets different aspect
      - Collect list of 5-10 key files from each
      - Read all identified files
      - Present comprehensive summary
    test_cases:
      - name: exploration_finds_files
        input:
          feature: "authentication"
        expected:
          agents_launched: 2
          files_identified: 5

  # Phase 3: Clarifying Questions
  - name: phase_clarification
    given: Codebase exploration complete
    when: Ambiguities exist in requirements
    then: Ask all questions before designing
    actions:
      - Review findings and original request
      - Identify edge cases and gaps
      - Present organized question list
      - Wait for user answers
    critical: true
    test_cases:
      - name: clarification_asks_questions
        input:
          gaps: 2
        expected:
          questions_asked: true
          waits_for_answer: true

  # Phase 4: Architecture Design
  - name: phase_architecture
    given: All questions answered
    when: Ready to design solution
    then: Present multiple approaches with tradeoffs
    actions:
      - Launch 2-3 code_architect agents
      - Each with different focus
      - Review all approaches
      - Present comparison with recommendation
      - Ask user which approach they prefer
    test_cases:
      - name: architecture_presents_options
        input:
          feature: "authentication"
        expected:
          options_count: 2
          has_recommendation: true

  # Phase 5: Implementation
  - name: phase_implementation
    given: User approved architecture
    when: Ready to write code
    then: Build the feature following chosen approach
    requires_approval: true
    actions:
      - Wait for explicit user approval
      - Read all relevant files
      - Implement following chosen architecture
      - Follow codebase conventions
      - Update todos as progress
    test_cases:
      - name: implementation_waits_approval
        input:
          approved: false
        expected:
          started: false

  # Phase 6: Quality Review
  - name: phase_review
    given: Implementation complete
    when: Code needs quality check
    then: Launch parallel reviewer agents
    actions:
      - Launch 3 code_reviewer agents
      - Focus areas simplicity correctness conventions
      - Consolidate findings by severity
      - Present to user with fix recommendations
      - Address issues based on user decision
    test_cases:
      - name: review_finds_issues
        input:
          code: "function with bugs"
        expected:
          findings_count: 0
          severity_ranked: true

  # Phase 7: Summary
  - name: phase_summary
    given: Review complete and issues addressed
    when: Feature development finished
    then: Document what was accomplished
    actions:
      - Mark all todos complete
      - Summarize what was built
      - List key decisions made
      - List files modified
      - Suggest next steps
    test_cases:
      - name: summary_completes_todos
        input:
          todos_count: 2
        expected:
          all_complete: true
          summary_provided: true

# ═══════════════════════════════════════════════════════════════════════════════
# φ² + 1/φ² = 3 | PHOENIX = 999
# ═══════════════════════════════════════════════════════════════════════════════
