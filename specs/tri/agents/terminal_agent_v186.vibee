# ═══════════════════════════════════════════════════════════════════════════════
# TERMINAL AGENT v186 - Enhanced VIBEE Terminal Agent
# ═══════════════════════════════════════════════════════════════════════════════
# Improvements based on competitive analysis of 70+ AI coding tools
# PAS Pattern: D&C + PRE + MLS
# φ² + 1/φ² = 3 | PHOENIX = 999
# ═══════════════════════════════════════════════════════════════════════════════

name: terminal_agent
version: "1.8.6"
language: zig
module: terminal_agent

sacred_constants:
  phi: 1.618033988749895
  phi_inv: 0.618033988749895
  phi_sq: 2.618033988749895
  trinity: 3.0
  phoenix: 999

creation_pattern:
  source: UserCommand
  transformer: TerminalAgent
  result: ExecutionResult

# ═══════════════════════════════════════════════════════════════════════════════
# TYPES
# ═══════════════════════════════════════════════════════════════════════════════

types:
  AgentMode:
    enum:
      - interactive     # REPL mode
      - single_task     # One-shot execution
      - autonomous      # Self-directed
      - pair_programming # Collaborative

  ProviderType:
    enum:
      - anthropic
      - openai
      - deepseek
      - ollama
      - local           # Offline mode

  Tool:
    fields:
      name: String
      description: String
      input_schema: String
      requires_permission: Bool

  AgentConfig:
    fields:
      provider: ProviderType
      model: String
      max_tokens: Int = 4096
      streaming: Bool = true
      auto_approve: Bool = false
      workdir: String

  ExecutionResult:
    fields:
      success: Bool
      output: String
      files_modified: List<String>
      tools_used: List<String>
      duration_ms: Int

  AgentState:
    fields:
      mode: AgentMode
      iteration: Int
      context: String
      history: List<Message>
      pending_tools: List<Tool>

  Message:
    fields:
      role: String
      content: String
      timestamp: Timestamp

# ═══════════════════════════════════════════════════════════════════════════════
# BEHAVIORS
# ═══════════════════════════════════════════════════════════════════════════════

behaviors:
  - name: process_command
    given: "User command"
    when: "Command received"
    then: "Parse and execute command"
    pas_pattern: D&C
    complexity: O(n)
    test_cases:
      - name: test_simple_command
        input: '{"command": "create hello.vibee"}'
        expected: '{"action": "create_file"}'

  - name: select_provider
    given: "Environment variables"
    when: "Provider selection needed"
    then: "Return best available provider"
    pas_pattern: PRE
    complexity: O(1)
    test_cases:
      - name: test_deepseek
        input: '{"DEEPSEEK_API_KEY": "sk-xxx"}'
        expected: '{"provider": "deepseek"}'
      - name: test_ollama
        input: '{"OLLAMA_HOST": "localhost:11434"}'
        expected: '{"provider": "ollama"}'

  - name: stream_response
    given: "LLM response stream"
    when: "Streaming enabled"
    then: "Output tokens in real-time"
    pas_pattern: PRE
    complexity: O(n)
    test_cases:
      - name: test_stream
        input: '{"tokens": ["Hello", " ", "World"]}'
        expected: '{"output": "Hello World"}'

  - name: execute_tool
    given: "Tool name and input"
    when: "Tool execution requested"
    then: "Execute and return result"
    pas_pattern: D&C
    complexity: O(1)
    test_cases:
      - name: test_read_file
        input: '{"tool": "read_file", "path": "test.txt"}'
        expected: '{"success": true}'

  - name: auto_extract_zig
    given: ".vibee file with code"
    when: "Auto-extract enabled"
    then: "Extract .zig to trinity/output/"
    pas_pattern: PRE
    complexity: O(n)
    test_cases:
      - name: test_extract
        input: '{"file": "test.vibee"}'
        expected: '{"output": "trinity/output/test.zig"}'

  - name: run_tests
    given: "Generated .zig file"
    when: "Test execution requested"
    then: "Run zig test and return results"
    pas_pattern: D&C
    complexity: O(n)
    test_cases:
      - name: test_run
        input: '{"file": "test.zig"}'
        expected: '{"passed": true}'

  - name: handle_iteration
    given: "Agent state"
    when: "Iteration needed"
    then: "Continue or complete task"
    pas_pattern: MLS
    complexity: O(1)
    test_cases:
      - name: test_continue
        input: '{"iteration": 1, "complete": false}'
        expected: '{"action": "continue"}'

# ═══════════════════════════════════════════════════════════════════════════════
# TOOLS
# ═══════════════════════════════════════════════════════════════════════════════

tools:
  file_operations:
    - name: "read_file"
      description: "Read contents of a file"
      input: '{"path": "string"}'
      permission: false

    - name: "write_file"
      description: "Write content to a file"
      input: '{"path": "string", "content": "string"}'
      permission: true

    - name: "list_files"
      description: "List files in directory"
      input: '{"path": "string"}'
      permission: false

    - name: "search_files"
      description: "Search for text in files"
      input: '{"pattern": "string", "path": "string"}'
      permission: false

  execution:
    - name: "run_command"
      description: "Execute shell command"
      input: '{"command": "string"}'
      permission: true

    - name: "run_tests"
      description: "Run zig tests"
      input: '{"file": "string"}'
      permission: false

  browser:
    - name: "open_browser"
      description: "Open URL in browser"
      input: '{"url": "string"}'
      permission: false

    - name: "fetch_url"
      description: "Fetch URL content"
      input: '{"url": "string"}'
      permission: false

  vibee:
    - name: "vibee_gen"
      description: "Generate .zig from .vibee"
      input: '{"spec": "string"}'
      permission: false

    - name: "vibee_test"
      description: "Test generated code"
      input: '{"file": "string"}'
      permission: false

# ═══════════════════════════════════════════════════════════════════════════════
# IMPROVEMENTS FROM COMPETITIVE ANALYSIS
# ═══════════════════════════════════════════════════════════════════════════════

improvements:
  implemented:
    - name: "Real-time streaming"
      status: "✅ v172"
      description: "Token-by-token output"

    - name: "Browser tools"
      status: "✅ v172"
      description: "open_browser, fetch_url"

    - name: "Multi-provider support"
      status: "✅ v1.0"
      description: "Anthropic, OpenAI, DeepSeek, Ollama"

  planned:
    - name: "LSP Server"
      version: "v187"
      priority: "HIGH"
      description: "Language Server Protocol support"

    - name: "VSCode Extension"
      version: "v188"
      priority: "HIGH"
      description: "IDE integration"

    - name: "Multi-file Edit"
      version: "v190"
      priority: "HIGH"
      description: "Edit multiple files atomically"

    - name: "PR Review"
      version: "v191"
      priority: "MEDIUM"
      description: "Automated code review"

    - name: "Voice Input"
      version: "v192"
      priority: "LOW"
      description: "Speech-to-command"

# ═══════════════════════════════════════════════════════════════════════════════
# COMPETITIVE ADVANTAGES
# ═══════════════════════════════════════════════════════════════════════════════

advantages:
  unique:
    - "Spec-first development (ONLY tool)"
    - "PAS DAEMONS integration"
    - "Offline code generation"
    - "Deterministic output"
    - "Zero cost"

  vs_cursor:
    better:
      - "Offline capable"
      - "Deterministic"
      - "Free"
    worse:
      - "No IDE integration"
      - "No LSP"

  vs_aider:
    better:
      - "Spec-first"
      - "Offline generation"
      - "PAS integration"
    worse:
      - "Less mature"

  vs_copilot:
    better:
      - "Agentic mode"
      - "Offline"
      - "Free"
    worse:
      - "No IDE integration"
      - "Smaller community"

# ═══════════════════════════════════════════════════════════════════════════════
# PERFORMANCE TARGETS
# ═══════════════════════════════════════════════════════════════════════════════

performance:
  targets:
    command_parse_ms: 1
    tool_execution_ms: 100
    streaming_latency_ms: 50
    spec_generation_ms: 2
    test_execution_ms: 2000

  benchmarks:
    - name: "Simple task E2E"
      target_ms: 2000
      actual_ms: 1885

    - name: "Spec → Code"
      target_ms: 10
      actual_ms: 2

# ═══════════════════════════════════════════════════════════════════════════════
# φ² + 1/φ² = 3 | PHOENIX = 999
# ═══════════════════════════════════════════════════════════════════════════════
