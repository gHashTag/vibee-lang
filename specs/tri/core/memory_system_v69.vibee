# VIBEE v69 Memory System Specification
# Long-term Agent Memory & Knowledge Persistence
# φ² + 1/φ² = 3 | PHOENIX = 999

name: memory_system_v69
version: "69.0.0"
language: zig
module: memory_system_v69

constants:
  PHI: 1.618033988749895
  TRINITY: 3
  PHOENIX: 999
  MAX_MEMORY_MB: 512
  EMBEDDING_DIM: 1536

types:
  MemoryType:
    values:
      - episodic      # Conversation history, events
      - semantic      # Facts, knowledge, concepts
      - procedural    # How-to, workflows, patterns
      - working       # Current task context

  MemoryPriority:
    values: [critical, high, medium, low, ephemeral]

  MemoryEntry:
    fields:
      id: String
      type: String
      content: String
      embedding: List<Float>
      timestamp: Int
      priority: String
      access_count: Int
      last_accessed: Int
      ttl_seconds: Int
      tags: List<String>

  ConversationTurn:
    fields:
      role: String        # user, assistant, system
      content: String
      timestamp: Int
      tokens: Int

  ProjectKnowledge:
    fields:
      project_id: String
      root_path: String
      language: String
      framework: String
      conventions: List<String>
      key_files: List<String>
      dependencies: List<String>

  UserPreference:
    fields:
      key: String
      value: String
      learned_from: String
      confidence: Float

  MemoryStats:
    fields:
      total_entries: Int
      episodic_count: Int
      semantic_count: Int
      procedural_count: Int
      working_count: Int
      memory_mb: Float
      oldest_entry: Int
      newest_entry: Int

# === MEMORY OPERATIONS ===
operations:
  store:
    description: "Store new memory entry"
    params: [content, type, priority, tags]
    returns: MemoryEntry

  retrieve:
    description: "Retrieve memories by query"
    params: [query, type, limit]
    returns: List<MemoryEntry>

  forget:
    description: "Remove memory entry"
    params: [id]
    returns: Bool

  consolidate:
    description: "Merge similar memories"
    params: [threshold]
    returns: Int  # Number consolidated

  prune:
    description: "Remove low-priority old memories"
    params: [max_age_days, min_priority]
    returns: Int  # Number pruned

# === MEMORY STRATEGIES ===
strategies:
  recency:
    description: "Prioritize recent memories"
    weight: 0.3

  frequency:
    description: "Prioritize frequently accessed"
    weight: 0.2

  relevance:
    description: "Prioritize semantically similar"
    weight: 0.4

  importance:
    description: "Prioritize by priority level"
    weight: 0.1

# === PERSISTENCE ===
persistence:
  formats:
    - sqlite      # Local database
    - json        # Export/import
    - vector_db   # Embeddings store

  sync:
    auto_save_interval_sec: 60
    max_unsaved_entries: 100

# === BEHAVIORS ===
behaviors:
  - name: remember_conversation
    given: "Conversation turn"
    when: "Turn completed"
    then: "Store in episodic memory"

  - name: learn_preference
    given: "User correction or preference"
    when: "Pattern detected"
    then: "Store in semantic memory"

  - name: recall_context
    given: "Current task description"
    when: "Context needed"
    then: "Retrieve relevant memories"

  - name: forget_ephemeral
    given: "Memory with expired TTL"
    when: "Cleanup triggered"
    then: "Remove from memory"

test_cases:
  - name: store_and_retrieve
    input: {content: "User prefers tabs", type: "semantic"}
    expected: {stored: true, retrievable: true}

  - name: memory_limit
    input: {entries: 10000}
    expected: {memory_mb: "<512"}

  - name: consolidation
    input: {similar_entries: 5, threshold: 0.9}
    expected: {consolidated_to: 1}
output: trinity/output/memory_system_v69.zig
