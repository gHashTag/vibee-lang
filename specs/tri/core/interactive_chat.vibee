# ═══════════════════════════════════════════════════════════════════════════════
# INTERACTIVE CHAT SPECIFICATION
# TRI - TRINITY Terminal Interface
# Sacred Formula: V = n × 3^k × π^m × φ^p × e^q
# Golden Identity: φ² + 1/φ² = 3
# ═══════════════════════════════════════════════════════════════════════════════

name: interactive_chat
version: "1.0.0"
language: tri
module: chat

sacred_constants:
  phi: 1.618033988749895
  trinity: 3.0
  phoenix: 999

creation_pattern:
  source: UserInput
  transformer: ChatEngine
  result: AssistantOutput

# ═══════════════════════════════════════════════════════════════════════════════
# TYPES
# ═══════════════════════════════════════════════════════════════════════════════

types:
  ChatMode:
    enum:
      - interactive  # REPL-style chat
      - pipe         # stdin input
      - single       # Single query
      - agent        # Autonomous agent mode

  Session:
    fields:
      id: String
      messages: List<Message>
      created_at: Timestamp
      updated_at: Timestamp
      context: ChatContext

  ChatContext:
    fields:
      cwd: String
      project_root: String
      git_branch: Option<String>
      files_open: List<String>
      recent_commands: List<String>

  SlashCommand:
    enum:
      - help         # Show help
      - clear        # Clear history
      - save         # Save session
      - load         # Load session
      - exit         # Exit chat
      - model        # Change model
      - provider     # Change provider
      - context      # Show context
      - files        # List files
      - run          # Run command
      - eval         # Evaluate ternary
      - phi          # Show phi constants

  InputSource:
    enum:
      - tty          # Terminal input
      - pipe         # Piped input
      - file         # File input
      - arg          # Command line arg

# ═══════════════════════════════════════════════════════════════════════════════
# BEHAVIORS
# ═══════════════════════════════════════════════════════════════════════════════

behaviors:
  - name: start_interactive
    given: Terminal is TTY
    when: User runs "tri" or "tri chat"
    then: Start interactive REPL
    test_cases:
      - name: show_welcome
        input:
          mode: interactive
        expected:
          output: contains("TRI")
          output: contains("φ² + 1/φ² = 3")

  - name: handle_pipe
    given: Input is piped
    when: User runs "echo 'query' | tri"
    then: Process single query and exit
    test_cases:
      - name: pipe_query
        input:
          stdin: "What is 2+2?"
        expected:
          output: not_empty
          exit_code: 0

  - name: slash_commands
    given: Input starts with /
    when: User enters slash command
    then: Execute command
    test_cases:
      - name: help_command
        input:
          command: "/help"
        expected:
          output: contains("Commands")
      - name: clear_command
        input:
          command: "/clear"
        expected:
          history_cleared: true
      - name: eval_command
        input:
          command: "/eval true AND unknown"
        expected:
          output: contains("○")

  - name: context_awareness
    given: Project directory
    when: Chat starts
    then: Load project context
    test_cases:
      - name: detect_git
        input:
          cwd: "/workspaces/vibee-lang"
        expected:
          git_branch: not_null
      - name: detect_language
        input:
          cwd: "/workspaces/vibee-lang"
        expected:
          languages: contains("zig")

  - name: session_management
    given: Chat session
    when: User saves/loads session
    then: Persist/restore messages
    test_cases:
      - name: save_session
        input:
          command: "/save mysession"
        expected:
          file_created: "~/.tri/sessions/mysession.json"
      - name: load_session
        input:
          command: "/load mysession"
        expected:
          messages_restored: true

# ═══════════════════════════════════════════════════════════════════════════════
# UI ELEMENTS
# ═══════════════════════════════════════════════════════════════════════════════

ui:
  welcome_banner: |
    ╔═══════════════════════════════════════════════════════════════╗
    ║  TRI - TRINITY Terminal Interface                             ║
    ║  Ternary Logic AI Assistant | φ² + 1/φ² = 3                   ║
    ╚═══════════════════════════════════════════════════════════════╝
    
    Type your message or /help for commands.
    Values: △ (true)  ○ (unknown)  ▽ (false)

  prompt:
    user: "you> "
    assistant: "tri> "
    system: "sys> "
    
  colors:
    user: cyan
    assistant: green
    error: red
    warning: yellow
    info: blue
    phi: magenta

  spinner:
    frames: ["◐", "◓", "◑", "◒"]
    interval_ms: 100

# ═══════════════════════════════════════════════════════════════════════════════
# SLASH COMMANDS
# ═══════════════════════════════════════════════════════════════════════════════

slash_commands:
  - command: "/help"
    aliases: ["/h", "/?"]
    description: "Show available commands"
    
  - command: "/clear"
    aliases: ["/c"]
    description: "Clear chat history"
    
  - command: "/exit"
    aliases: ["/quit", "/q"]
    description: "Exit chat"
    
  - command: "/save <name>"
    description: "Save session to file"
    
  - command: "/load <name>"
    description: "Load session from file"
    
  - command: "/model <name>"
    description: "Change AI model"
    examples:
      - "/model claude-sonnet-4-20250514"
      - "/model llama3.2"
      
  - command: "/provider <name>"
    description: "Change AI provider"
    examples:
      - "/provider anthropic"
      - "/provider ollama"
      
  - command: "/context"
    description: "Show current context"
    
  - command: "/files"
    aliases: ["/ls"]
    description: "List files in current directory"
    
  - command: "/run <cmd>"
    aliases: ["/!"]
    description: "Run shell command"
    examples:
      - "/run git status"
      - "/! ls -la"
      
  - command: "/eval <expr>"
    aliases: ["/e"]
    description: "Evaluate ternary expression"
    examples:
      - "/eval true AND unknown"
      - "/e NOT false"
      
  - command: "/phi"
    description: "Show sacred constants"
    
  - command: "/truth <op>"
    description: "Show truth table"
    examples:
      - "/truth and"
      - "/truth all"

# ═══════════════════════════════════════════════════════════════════════════════
# KEYBINDINGS
# ═══════════════════════════════════════════════════════════════════════════════

keybindings:
  - key: "Ctrl+C"
    action: "Cancel current input"
  - key: "Ctrl+D"
    action: "Exit chat"
  - key: "Ctrl+L"
    action: "Clear screen"
  - key: "Up/Down"
    action: "Navigate history"
  - key: "Tab"
    action: "Autocomplete"

# ═══════════════════════════════════════════════════════════════════════════════
# STREAMING
# ═══════════════════════════════════════════════════════════════════════════════

streaming:
  enabled: true
  chunk_size: 16
  render_delay_ms: 10
  
  events:
    - type: "start"
      action: "Show spinner"
    - type: "chunk"
      action: "Append to output"
    - type: "end"
      action: "Hide spinner, show complete"
    - type: "error"
      action: "Show error message"

# ═══════════════════════════════════════════════════════════════════════════════
# PAS PREDICTIONS
# ═══════════════════════════════════════════════════════════════════════════════

pas_predictions:
  - target: "Response Streaming"
    current: "Wait for complete response"
    predicted: "Token-by-token streaming"
    confidence: 0.90
    patterns: [PRE]
    timeline: "2026"

  - target: "Context Compression"
    current: "Full message history"
    predicted: "Semantic compression"
    confidence: 0.65
    patterns: [ALG, MLS]
    timeline: "2027"
output: trinity/output/interactive_chat.zig
