# cdp_runtime_v2543.vibee - CDP Runtime Domain
# JavaScript выполнение
# YOLO MODE + AMPLIFICATION + MATRYOSHKA
# φ² + 1/φ² = 3 | PHOENIX = 999

name: cdp_runtime_v2543
version: "2543.0.0"
language: zig
module: cdp_runtime_v2543

types:
  ExecutionContext:
    fields:
      id: Int
      origin: String
      name: String
      unique_id: String
      aux_data: Object

  RemoteObject:
    fields:
      type: String
      subtype: String
      class_name: String
      value: Object
      unserializable_value: String
      description: String
      object_id: String
      preview: Object

  CallArgument:
    fields:
      value: Object
      unserializable_value: String
      object_id: String

  ExceptionDetails:
    fields:
      exception_id: Int
      text: String
      line_number: Int
      column_number: Int
      script_id: String
      url: String
      stack_trace: Object
      exception: Object

  PropertyDescriptor:
    fields:
      name: String
      value: Object
      writable: Bool
      get: Object
      set: Object
      configurable: Bool
      enumerable: Bool
      was_thrown: Bool
      is_own: Bool
      symbol: Object

behaviors:
  - name: runtime_enable
    given: CDPConnection
    when: Runtime domain enabled
    then: Start receiving execution contexts

  - name: runtime_evaluate
    given: CDPConnection, expression, options
    when: JS evaluation requested
    then: Execute and return RemoteObject

  - name: runtime_call_function_on
    given: CDPConnection, object_id, function_declaration, arguments
    when: Function call requested
    then: Call function on object and return result

  - name: runtime_get_properties
    given: CDPConnection and object_id
    when: Properties requested
    then: Return PropertyDescriptors

  - name: runtime_await_promise
    given: CDPConnection and promise_object_id
    when: Promise await requested
    then: Wait for promise and return result

  - name: runtime_release_object
    given: CDPConnection and object_id
    when: Release requested
    then: Release remote object reference

  - name: runtime_add_binding
    given: CDPConnection and binding_name
    when: Binding requested
    then: Add JS binding callable from page

  - name: runtime_run_script
    given: CDPConnection, script_id, execution_context_id
    when: Script run requested
    then: Run compiled script

sacred_constants:
  phi: 1.618033988749895
  phi_squared_plus_inverse_squared: 3
  phoenix: 999
