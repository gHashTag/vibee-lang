name: warp_screenshot_fast
version: "1.0.0"
language: zig
module: warp_screenshot_fast

description: |
  WARP Screenshot Fast - быстрые скриншоты < 10ms
  Научные основы: Set-of-Mark (SoM) Visual Prompting (Yang et al., 2023)
  Инкрементальные снимки через CDP Layer Tree
  φ² + 1/φ² = 3 | PHOENIX = 999

types:
  ScreenshotConfig:
    fields:
      format: String
      quality: Int
      clip_x: Int
      clip_y: Int
      clip_width: Int
      clip_height: Int
      from_surface: Bool
      capture_beyond_viewport: Bool

  ScreenshotResult:
    fields:
      data: String
      width: Int
      height: Int
      format: String
      capture_time_ms: Float
      size_bytes: Int

  LayerTreeSnapshot:
    fields:
      layer_id: String
      bounds: String
      paint_count: Int
      dirty: Bool

  IncrementalDiff:
    fields:
      changed_regions: List<String>
      unchanged_percent: Float
      diff_time_ms: Float

  SoMAnnotation:
    fields:
      element_id: String
      mark_number: Int
      bounding_box: String
      element_type: String

behaviors:
  - name: capture_full
    given: ScreenshotConfig конфигурация
    when: Захват полного экрана
    then: ScreenshotResult за < 50ms

  - name: capture_viewport
    given: Текущий viewport
    when: Захват видимой области
    then: ScreenshotResult за < 10ms

  - name: capture_element
    given: CSS селектор элемента
    when: Захват конкретного элемента
    then: ScreenshotResult за < 5ms

  - name: capture_incremental
    given: Предыдущий LayerTreeSnapshot
    when: Инкрементальный захват изменений
    then: IncrementalDiff с изменёнными областями

  - name: annotate_som
    given: ScreenshotResult и список элементов
    when: Добавление Set-of-Mark аннотаций
    then: Список SoMAnnotation с номерами элементов

  - name: compress_screenshot
    given: ScreenshotResult и целевой размер
    when: Сжатие для отправки в LLM
    then: Сжатый ScreenshotResult < 100KB
