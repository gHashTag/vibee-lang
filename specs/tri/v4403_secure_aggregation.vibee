# v4403 - Secure Aggregation
# ===========================
# Безопасная агрегация для федеративного обучения
# φ² + 1/φ² = 3 | PHOENIX = 999

name: secure_aggregation
version: "4.4.3"
language: zig
module: secure_aggregation

constants:
  PHI: 1.618033988749895
  THRESHOLD: 0.5
  KEY_SIZE: 256

types:
  SecAggConfig:
    fields:
      num_parties: Int
      threshold: Float
      key_agreement: String
      
  KeyPair:
    fields:
      public_key: List
      private_key: List
      
  MaskedInput:
    fields:
      party_id: Int
      masked_value: List
      
  PairwiseMask:
    fields:
      party_a: Int
      party_b: Int
      mask: List
      
  AggregationRound:
    fields:
      round_id: Int
      participants: List
      dropouts: List
      
  RecoveryShare:
    fields:
      party_id: Int
      share: List
      
  SecureSum:
    fields:
      result: List
      num_contributors: Int
      
  VerificationProof:
    fields:
      commitment: List
      proof: List

behaviors:
  - name: generate_keys
    given: Параметры безопасности
    when: Генерация ключей
    then: Вернуть пару ключей
    
  - name: key_agreement
    given: Свой приватный и чужой публичный ключ
    when: Diffie-Hellman
    then: Вернуть общий секрет
    
  - name: compute_pairwise_masks
    given: Общие секреты и seed
    when: Генерация масок
    then: Вернуть попарные маски
    
  - name: mask_input
    given: Вход и маски
    when: Маскирование
    then: Вернуть замаскированный вход
    
  - name: aggregate_masked
    given: Замаскированные входы
    when: Суммирование
    then: Вернуть сумму (маски взаимоуничтожаются)
    
  - name: handle_dropout
    given: Выбывшие участники и shares
    when: Восстановление масок
    then: Вернуть маски выбывших
    
  - name: verify_contribution
    given: Вклад и доказательство
    when: Проверка корректности
    then: Вернуть результат верификации
    
  - name: finalize_round
    given: Агрегированный результат
    when: Завершение раунда
    then: Вернуть безопасную сумму
