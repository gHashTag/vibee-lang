name: coordinator_agent_v22
version: "22.4.0"
language: zig
module: coordinator_agent_v22

types:
  CoordinatorConfig:
    fields:
      max_workers: Int
      task_timeout_ms: Int
      retry_failed: Bool
      load_balance: String

  WorkerInfo:
    fields:
      id: String
      status: String
      current_task: Option<String>
      completed_count: Int
      error_count: Int

  TaskAssignment:
    fields:
      task_id: String
      worker_id: String
      assigned_at: Timestamp
      deadline: Option<Timestamp>

  CoordinationResult:
    fields:
      task_id: String
      success: Bool
      worker_id: String
      result: Option<String>
      duration_ms: Int

  WorkerPool:
    fields:
      workers: List<String>
      available: List<String>
      busy: List<String>

  Coordinator:
    fields:
      config: Object
      pool: Object
      assignments: Object
      shared_state: Object

behaviors:
  - name: create_coordinator
    given: CoordinatorConfig
    when: Initialize coordinator
    then: Coordinator instance

  - name: register_worker
    given: Coordinator and worker
    when: Add worker to pool
    then: WorkerInfo

  - name: unregister_worker
    given: Coordinator and worker id
    when: Remove worker
    then: Removed

  - name: assign_task
    given: Coordinator and task
    when: Assign to worker
    then: TaskAssignment

  - name: get_worker_status
    given: Coordinator and worker id
    When: Get worker status
    then: WorkerInfo

  - name: get_pool_status
    given: Coordinator
    When: Get pool status
    then: WorkerPool

  - name: collect_result
    given: Coordinator and worker id
    When: Collect task result
    then: CoordinationResult

  - name: redistribute_task
    given: Coordinator and task id
    When: Reassign failed task
    then: TaskAssignment

  - name: broadcast_message
    given: Coordinator and message
    When: Send to all workers
    then: Broadcast result

  - name: sync_state
    given: Coordinator
    When: Sync shared state
    then: Sync result

  - name: shutdown_workers
    given: Coordinator
    When: Shutdown all workers
    then: Shutdown complete
