# v3601 - State Space Models
# ===========================
# Linear-time sequence modeling (Mamba, S4)
# φ² + 1/φ² = 3 | PHOENIX = 999

name: state_space_models
version: "3.6.1"
language: zig
module: state_space_models

constants:
  PHI: 1.618033988749895
  STATE_DIM: 16
  DT_MIN: 0.001
  DT_MAX: 0.1
  D_CONV: 4

types:
  SSMConfig:
    fields:
      d_model: Int
      d_state: Int
      d_conv: Int
      expand: Int
      dt_rank: String
      
  SSMState:
    fields:
      hidden_state: List
      conv_state: List
      
  S4Params:
    fields:
      A: List
      B: List
      C: List
      D: List
      delta: List
      
  MambaBlock:
    fields:
      in_proj: List
      conv1d: List
      x_proj: List
      dt_proj: List
      out_proj: List
      A_log: List
      D: List
      
  SelectiveScanConfig:
    fields:
      d_inner: Int
      dt_rank: Int
      use_fast_path: Bool
      
  ConvState:
    fields:
      buffer: List
      kernel_size: Int
      
  DiscreteParams:
    fields:
      A_bar: List
      B_bar: List

behaviors:
  - name: init_ssm
    given: SSM configuration
    when: Creating state space model
    then: Return initialized SSM parameters
    
  - name: discretize_ssm
    given: Continuous A, B and delta
    when: Converting to discrete form
    then: Return discretized A_bar, B_bar
    
  - name: ssm_forward
    given: Input sequence and SSM params
    when: Computing SSM output
    then: Return output with O(N) complexity
    
  - name: selective_scan
    given: Input, delta, A, B, C, D
    when: Computing Mamba selective scan
    then: Return scanned output
    
  - name: conv1d_forward
    given: Input and conv weights
    when: Applying causal convolution
    then: Return convolved output
    
  - name: mamba_block_forward
    given: Input and Mamba block
    when: Full Mamba block computation
    then: Return block output
    
  - name: init_hidden_state
    given: Batch size and state dim
    when: Creating initial state
    then: Return zero-initialized state
    
  - name: step_ssm
    given: Single token and state
    when: Incremental inference
    then: Return output and updated state
