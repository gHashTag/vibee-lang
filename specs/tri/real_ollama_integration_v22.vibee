name: real_ollama_integration_v22
version: "22.4.0"
language: zig
module: real_ollama_integration_v22

types:
  OllamaConfig:
    fields:
      endpoint: String
      model: String
      timeout_ms: Int
      max_tokens: Int
      temperature: Float

  ChatMessage:
    fields:
      role: String
      content: String

  GenerateRequest:
    fields:
      model: String
      prompt: String
      system: Option<String>
      stream: Bool
      options: Object

  GenerateResponse:
    fields:
      response: String
      done: Bool
      total_duration: Int
      eval_count: Int

  OllamaStatus:
    fields:
      available: Bool
      models: List<String>
      version: String

  OllamaClient:
    fields:
      config: Object
      http_client: Object

behaviors:
  - name: create_client
    given: OllamaConfig
    when: Initialize client
    then: OllamaClient instance

  - name: check_health
    given: OllamaClient
    when: Check Ollama status
    then: OllamaStatus

  - name: list_models
    given: OllamaClient
    when: Get available models
    then: Model list

  - name: generate
    given: OllamaClient and prompt
    when: Generate completion
    then: GenerateResponse

  - name: chat
    given: OllamaClient and messages
    when: Chat completion
    then: GenerateResponse

  - name: generate_action
    given: OllamaClient and observation and goal
    when: Generate browser action
    then: Action string

  - name: parse_action_response
    given: Response text
    when: Parse action from LLM
    then: Parsed action

  - name: build_agent_prompt
    given: Goal and observation and history
    when: Build prompt
    then: Prompt string

  - name: set_model
    given: OllamaClient and model name
    when: Change model
    then: Updated client

  - name: get_model_info
    given: OllamaClient and model name
    when: Get model details
    then: Model info

  - name: abort_generation
    given: OllamaClient
    when: Cancel generation
    then: Aborted
