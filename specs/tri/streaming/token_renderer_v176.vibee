# ═══════════════════════════════════════════════════════════════════════════════
# TOKEN RENDERER v176 - Real-time Token Display
# ═══════════════════════════════════════════════════════════════════════════════
# PAS Pattern: PRE (Precomputation for ANSI codes)
# Performance: <1ms per token render
# φ² + 1/φ² = 3 | PHOENIX = 999
# ═══════════════════════════════════════════════════════════════════════════════

name: token_renderer
version: "1.7.6"
language: zig
module: token_renderer

sacred_constants:
  phi: 1.618033988749895
  phi_inv: 0.618033988749895
  phi_sq: 2.618033988749895
  trinity: 3.0
  phoenix: 999

creation_pattern:
  source: TokenStream
  transformer: TokenRenderer
  result: TerminalOutput

# ═══════════════════════════════════════════════════════════════════════════════
# TYPES
# ═══════════════════════════════════════════════════════════════════════════════

types:
  ANSIColor:
    enum:
      - reset
      - black
      - red
      - green
      - yellow
      - blue
      - magenta
      - cyan
      - white
      - gray

  RenderMode:
    enum:
      - plain
      - colored
      - markdown
      - code_highlight

  RenderConfig:
    fields:
      mode: RenderMode = colored
      show_cursor: Bool = true
      word_wrap: Bool = true
      terminal_width: Int = 80
      buffer_size: Int = 1

  TokenType:
    enum:
      - text
      - code_start
      - code_end
      - code_inline
      - heading
      - list_item
      - link
      - emphasis
      - newline

  RenderStats:
    fields:
      tokens_rendered: Int
      bytes_written: Int
      render_time_us: Int
      avg_token_time_us: Float

# ═══════════════════════════════════════════════════════════════════════════════
# BEHAVIORS
# ═══════════════════════════════════════════════════════════════════════════════

behaviors:
  - name: render_token
    given: "Token string"
    when: "Render requested"
    then: "Output to terminal immediately"
    pas_pattern: PRE
    complexity: O(n)
    test_cases:
      - name: test_simple_token
        input: '{"token": "Hello"}'
        expected: '{"output": "Hello"}'
      - name: test_with_color
        input: '{"token": "Hello", "color": "green"}'
        expected: '{"output": "\\x1b[32mHello\\x1b[0m"}'

  - name: detect_token_type
    given: "Token content"
    when: "Type detection needed"
    then: "Return token type for styling"
    pas_pattern: PRE
    complexity: O(n)
    test_cases:
      - name: test_code_start
        input: '{"token": "```python"}'
        expected: '{"type": "code_start", "language": "python"}'
      - name: test_heading
        input: '{"token": "# Title"}'
        expected: '{"type": "heading", "level": 1}'
      - name: test_plain
        input: '{"token": "normal text"}'
        expected: '{"type": "text"}'

  - name: apply_word_wrap
    given: "Token and current line position"
    when: "Word wrap enabled"
    then: "Insert newlines at word boundaries"
    pas_pattern: PRE
    complexity: O(n)
    test_cases:
      - name: test_wrap
        input: '{"token": "word", "position": 78, "width": 80}'
        expected: '{"output": "\\nword", "position": 4}'
      - name: test_no_wrap
        input: '{"token": "word", "position": 10, "width": 80}'
        expected: '{"output": "word", "position": 14}'

  - name: render_code_block
    given: "Code content and language"
    when: "Code block detected"
    then: "Apply syntax highlighting"
    pas_pattern: PRE
    complexity: O(n)
    test_cases:
      - name: test_zig_code
        input: '{"code": "const x = 1;", "language": "zig"}'
        expected: '{"highlighted": true}'

  - name: flush_buffer
    given: "Buffer with content"
    when: "Flush requested"
    then: "Write all buffered content"
    pas_pattern: PRE
    complexity: O(n)
    test_cases:
      - name: test_flush
        input: '{"buffer": "Hello World"}'
        expected: '{"flushed": true, "bytes": 11}'

  - name: show_spinner
    given: "Waiting state"
    when: "No tokens received"
    then: "Display animated spinner"
    pas_pattern: PRE
    complexity: O(1)
    test_cases:
      - name: test_spinner
        input: '{"frame": 0}'
        expected: '{"output": "◐"}'

  - name: calculate_stats
    given: "Render session complete"
    when: "Stats requested"
    then: "Return performance metrics"
    pas_pattern: ALG
    complexity: O(1)
    test_cases:
      - name: test_stats
        input: '{"tokens": 100, "time_us": 5000}'
        expected: '{"avg_us": 50}'

# ═══════════════════════════════════════════════════════════════════════════════
# ANSI CODES
# ═══════════════════════════════════════════════════════════════════════════════

ansi_codes:
  colors:
    reset: "\x1b[0m"
    black: "\x1b[30m"
    red: "\x1b[31m"
    green: "\x1b[32m"
    yellow: "\x1b[33m"
    blue: "\x1b[34m"
    magenta: "\x1b[35m"
    cyan: "\x1b[36m"
    white: "\x1b[37m"
    gray: "\x1b[90m"

  styles:
    bold: "\x1b[1m"
    dim: "\x1b[2m"
    italic: "\x1b[3m"
    underline: "\x1b[4m"

  cursor:
    hide: "\x1b[?25l"
    show: "\x1b[?25h"
    save: "\x1b[s"
    restore: "\x1b[u"
    clear_line: "\x1b[2K"

  spinner_frames:
    - "◐"
    - "◓"
    - "◑"
    - "◒"

# ═══════════════════════════════════════════════════════════════════════════════
# PERFORMANCE TARGETS
# ═══════════════════════════════════════════════════════════════════════════════

performance:
  targets:
    token_render_us: 100
    buffer_flush_us: 500
    spinner_frame_ms: 100

  benchmarks:
    - name: "1000 tokens"
      target_ms: 100
    - name: "10000 tokens"
      target_ms: 1000

# ═══════════════════════════════════════════════════════════════════════════════
# φ² + 1/φ² = 3 | PHOENIX = 999
# ═══════════════════════════════════════════════════════════════════════════════
