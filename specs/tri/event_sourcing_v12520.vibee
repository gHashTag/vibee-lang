# VIBEE Specification v12520
# Event Sourcing - Event-driven state management
name: event_sourcing_v12520
version: "1.0.0"
language: zig
module: event_sourcing

types:
  EventType:
    fields:
      created: String
      updated: String
      deleted: String
      custom: String

  Event:
    fields:
      id: String
      aggregate_id: String
      type: String
      payload: String
      version: Int
      timestamp: Timestamp

  EventStream:
    fields:
      aggregate_id: String
      events: String
      current_version: Int

  Snapshot:
    fields:
      aggregate_id: String
      state: String
      version: Int
      created_at: Timestamp

  Projection:
    fields:
      id: String
      name: String
      query: String
      last_event_id: String

behaviors:
  - name: append_event
    given: Event data
    When: Event appended
    then: Returns stored event

  - name: get_stream
    given: Aggregate ID
    When: Stream requested
    then: Returns event stream

  - name: create_snapshot
    given: Aggregate state
    When: Snapshot created
    then: Returns snapshot

  - name: project_events
    given: Projection and events
    When: Projection applied
    then: Returns projected state
