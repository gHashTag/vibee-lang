# ═══════════════════════════════════════════════════════════════════════════════
# SPEC TO CODE v184 - VibeeSpec → AutoCodeGenerator → GeneratedZigCode
# ═══════════════════════════════════════════════════════════════════════════════
# Core pipeline: .vibee specification → .zig generated code
# PAS Pattern: D&C (Divide spec into parts) + PRE (Template precomputation)
# φ² + 1/φ² = 3 | PHOENIX = 999
# ═══════════════════════════════════════════════════════════════════════════════

name: spec_to_code
version: "1.8.4"
language: zig
module: spec_to_code

sacred_constants:
  phi: 1.618033988749895
  phi_inv: 0.618033988749895
  phi_sq: 2.618033988749895
  trinity: 3.0
  phoenix: 999

creation_pattern:
  source: VibeeSpec
  transformer: AutoCodeGenerator
  result: GeneratedZigCode

# ═══════════════════════════════════════════════════════════════════════════════
# TYPES
# ═══════════════════════════════════════════════════════════════════════════════

types:
  SpecSection:
    enum:
      - metadata        # name, version, module
      - constants       # sacred_constants
      - types           # type definitions
      - behaviors       # behavior specifications
      - tests           # test cases
      - references      # scientific references

  VibeeSpec:
    fields:
      name: String
      version: String
      language: String
      module: String
      constants: Map<String, Float>
      types: List<TypeDef>
      behaviors: List<Behavior>
      references: List<Reference>

  TypeDef:
    fields:
      name: String
      kind: String  # struct, enum, union
      fields: List<Field>

  Field:
    fields:
      name: String
      type: String
      default: String?

  Behavior:
    fields:
      name: String
      given: String
      when: String
      then: String
      pas_pattern: String?
      complexity: String?
      test_cases: List<TestCase>

  TestCase:
    fields:
      name: String
      input: String
      expected: String

  GeneratedZigCode:
    fields:
      header: String
      constants: String
      types: String
      functions: String
      tests: String
      footer: String

  GenerationStats:
    fields:
      input_bytes: Int
      output_bytes: Int
      types_generated: Int
      tests_generated: Int
      generation_time_ms: Int

# ═══════════════════════════════════════════════════════════════════════════════
# BEHAVIORS
# ═══════════════════════════════════════════════════════════════════════════════

behaviors:
  - name: parse_spec
    given: ".vibee file content"
    when: "Parsing requested"
    then: "Return parsed VibeeSpec structure"
    pas_pattern: D&C
    complexity: O(n)
    test_cases:
      - name: test_parse_simple
        input: '{"content": "name: test\\nversion: 1.0.0"}'
        expected: '{"name": "test", "version": "1.0.0"}'

  - name: generate_header
    given: "VibeeSpec metadata"
    when: "Header generation requested"
    then: "Return Zig file header with comments"
    pas_pattern: PRE
    complexity: O(1)
    test_cases:
      - name: test_header
        input: '{"name": "test", "version": "1.0.0"}'
        expected: '{"contains": "// test v1.0.0"}'

  - name: generate_constants
    given: "Sacred constants map"
    when: "Constants generation requested"
    then: "Return Zig const declarations"
    pas_pattern: PRE
    complexity: O(n)
    test_cases:
      - name: test_phi
        input: '{"phi": 1.618033988749895}'
        expected: '{"contains": "pub const PHI: f64 = 1.618"}'

  - name: generate_types
    given: "List of type definitions"
    when: "Type generation requested"
    then: "Return Zig struct/enum definitions"
    pas_pattern: D&C
    complexity: O(n*m)
    test_cases:
      - name: test_struct
        input: '{"name": "User", "fields": [{"name": "id", "type": "Int"}]}'
        expected: '{"contains": "pub const User = struct"}'

  - name: generate_functions
    given: "List of behaviors"
    when: "Function generation requested"
    then: "Return Zig function stubs"
    pas_pattern: D&C
    complexity: O(n)
    test_cases:
      - name: test_function
        input: '{"name": "calculate", "given": "input"}'
        expected: '{"contains": "pub fn calculate"}'

  - name: generate_tests
    given: "List of test cases"
    when: "Test generation requested"
    then: "Return Zig test blocks"
    pas_pattern: PRE
    complexity: O(n)
    test_cases:
      - name: test_test
        input: '{"name": "test_add", "expected": "3"}'
        expected: '{"contains": "test \\"test_add\\""}'

  - name: assemble_output
    given: "All generated sections"
    when: "Assembly requested"
    then: "Return complete .zig file"
    pas_pattern: PRE
    complexity: O(n)
    test_cases:
      - name: test_assemble
        input: '{"header": "...", "types": "...", "tests": "..."}'
        expected: '{"valid_zig": true}'

# ═══════════════════════════════════════════════════════════════════════════════
# TYPE MAPPING
# ═══════════════════════════════════════════════════════════════════════════════

type_mapping:
  vibee_to_zig:
    String: "[]const u8"
    Int: "i64"
    Float: "f64"
    Bool: "bool"
    "Option<T>": "?T"
    "List<T>": "[]const u8"  # Simplified
    "Map<K,V>": "std.StringHashMap([]const u8)"
    Timestamp: "i64"
    Object: "[]const u8"

  reserved_words:
    - error
    - type
    - return
    - fn
    - const
    - var
    - pub
    - test

  escape_pattern: '@"{name}"'

# ═══════════════════════════════════════════════════════════════════════════════
# TEMPLATES
# ═══════════════════════════════════════════════════════════════════════════════

templates:
  header: |
    // ═══════════════════════════════════════════════════════════════════════════════
    // {name} v{version} - Generated from .vibee specification
    // ═══════════════════════════════════════════════════════════════════════════════
    //
    // Священная формула: V = n × 3^k × π^m × φ^p × e^q
    // Золотая идентичность: φ² + 1/φ² = 3
    //
    // DO NOT EDIT - This file is auto-generated
    //
    // ═══════════════════════════════════════════════════════════════════════════════

    const std = @import("std");
    const math = std.math;

  constants: |
    // ═══════════════════════════════════════════════════════════════════════════════
    // КОНСТАНТЫ
    // ═══════════════════════════════════════════════════════════════════════════════

    pub const PHI: f64 = 1.618033988749895;
    pub const PHI_INV: f64 = 0.618033988749895;
    pub const PHI_SQ: f64 = 2.618033988749895;
    pub const TRINITY: f64 = 3.0;
    pub const TAU: f64 = 6.283185307179586;

  struct: |
    /// {description}
    pub const {name} = struct {
        {fields}
    };

  enum: |
    /// {description}
    pub const {name} = enum {
        {variants}
    };

  test: |
    test "{name}" {
        // Given: {given}
        // When: {when}
        // Then: {then}
    }

  phi_test: |
    test "phi_constants" {
        try std.testing.expectApproxEqAbs(PHI * PHI_INV, 1.0, 1e-10);
        try std.testing.expectApproxEqAbs(PHI_SQ - PHI, 1.0, 1e-10);
    }

# ═══════════════════════════════════════════════════════════════════════════════
# PIPELINE
# ═══════════════════════════════════════════════════════════════════════════════

pipeline:
  steps:
    1: "Read .vibee file"
    2: "Parse YAML structure"
    3: "Extract metadata"
    4: "Process types"
    5: "Process behaviors"
    6: "Generate header"
    7: "Generate constants"
    8: "Generate types"
    9: "Generate functions"
    10: "Generate tests"
    11: "Assemble output"
    12: "Write .zig file"

  performance:
    target_ms: 10
    actual_ms: 2

# ═══════════════════════════════════════════════════════════════════════════════
# φ² + 1/φ² = 3 | PHOENIX = 999
# ═══════════════════════════════════════════════════════════════════════════════
