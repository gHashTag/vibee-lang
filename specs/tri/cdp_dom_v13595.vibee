# VIBEE Specification v13595
# CDP DOM Operations
# DOM Manipulation via CDP
# φ² + 1/φ² = 3 | PHOENIX = 999

name: cdp_dom
version: "13595"
language: zig
module: cdp_dom

types:
  DOMNode:
    fields:
      node_id: Int
      backend_node_id: Int
      node_type: Int
      node_name: String
      node_value: String
      children: List<Object>
      attributes: List<String>

  DOMRect:
    fields:
      x: Float
      y: Float
      width: Float
      height: Float

  BoxModel:
    fields:
      content: List<Float>
      padding: List<Float>
      border: List<Float>
      margin: List<Float>
      width: Int
      height: Int

  DOMQuad:
    fields:
      points: List<Object>

  ElementHandle:
    fields:
      node_id: Int
      object_id: String
      frame_id: String

  Selector:
    fields:
      selector_type: String
      value: String
      index: Int

  DOMMetrics:
    fields:
      nodes_queried: Int
      mutations_observed: Int
      avg_query_time_ms: Float

  MutationRecord:
    fields:
      mutation_type: String
      target_id: Int
      added_nodes: List<Int>
      removed_nodes: List<Int>
      attribute_name: String

behaviors:
  - name: query_selector
    given: CSS selector
    when: Query requested
    then: First matching element returned

  - name: query_selector_all
    given: CSS selector
    when: Query all requested
    then: All matching elements returned

  - name: get_document
    given: Page loaded
    when: Document requested
    then: Document root node returned

  - name: get_outer_html
    given: Node ID
    when: HTML requested
    then: Outer HTML returned

  - name: set_outer_html
    given: Node ID and HTML
    when: Set HTML requested
    then: Node HTML replaced

  - name: get_attributes
    given: Node ID
    when: Attributes requested
    then: Attribute list returned

  - name: set_attribute
    given: Node ID, name, value
    when: Set attribute requested
    then: Attribute set on node

  - name: remove_node
    given: Node ID
    when: Remove requested
    then: Node removed from DOM

  - name: get_box_model
    given: Node ID
    when: Box model requested
    then: Box model dimensions returned

  - name: scroll_into_view
    given: Node ID
    when: Scroll requested
    then: Node scrolled into viewport

creation_pattern:
  source: Selector
  transformer: DOMQueryEngine
  result: ElementHandle
