# iGLA Self-RAG Tokens
# Special reflection tokens for Self-RAG
# Scientific basis: Asai et al. 2023
# φ² + 1/φ² = 3 | V = n × 3^k × π^m × φ^p

name: igla_selfrag_tokens
version: "1.0.0"
language: zig
module: igla_selfrag_tokens

sacred_constants:
  phi: 1.618033988749895
  trinity: 3.0
  phoenix: 999

scientific_references:
  - "Asai et al. 2023: Self-RAG"
  - "Welleck et al. 2023: Generating Sequences by Learning to Self-Correct"

types:
  RetrievalToken:
    fields:
      value: String
      meaning: String

  RelevanceToken:
    fields:
      value: String
      level: String

  SupportToken:
    fields:
      value: String
      level: String

  UtilityToken:
    fields:
      value: String
      level: String

  TokenSequence:
    fields:
      tokens: String
      positions: String

  TokenVocabulary:
    fields:
      retrieval_tokens: String
      relevance_tokens: String
      support_tokens: String
      utility_tokens: String

behaviors:
  - name: get_retrieval_token
    given: "Should retrieve"
    when: "Token selection"
    then: "RETRIEVE or NO_RETRIEVE"

  - name: get_relevance_token
    given: "Relevance score"
    when: "Token selection"
    then: "RELEVANT or IRRELEVANT"

  - name: get_support_token
    given: "Support score"
    when: "Token selection"
    then: "FULLY/PARTIALLY/NO SUPPORT"

  - name: get_utility_token
    given: "Utility score"
    when: "Token selection"
    then: "Utility level 1-5"

  - name: parse_tokens
    given: "Generated text"
    when: "Token parsing"
    then: "Extracted tokens"

  - name: inject_tokens
    given: "Response, tokens"
    when: "Token injection"
    then: "Annotated response"

  - name: validate_sequence
    given: "Token sequence"
    when: "Validation"
    then: "Valid or invalid"

  - name: phi_token_encoding
    given: "Token type"
    when: "Sacred encoding"
    then: "φ-based token ID"
