# FFI Ruby v56400 - Ruby C Extension / FFI Gem
# VIBEE → Ruby Native Extensions
# φ² + 1/φ² = 3 | PHOENIX = 999

name: ffi_ruby_v56400
version: "56.4.0"
language: zig
module: ffi_ruby

creation_pattern:
  source: VibeeSpec
  transformer: RubyBindingsGenerator
  result: RubyExtension

types:
  RubyValue:
    fields:
      type_tag: String
      value: Int
      is_immediate: Bool

  RubyMethod:
    fields:
      name: String
      arity: Int
      c_func: String
      visibility: String

  RubyClass:
    fields:
      name: String
      superclass: Option<String>
      methods: List<RubyMethod>
      constants: List<String>

  RubyModule:
    fields:
      name: String
      classes: List<RubyClass>
      functions: List<RubyMethod>

  ExtConf:
    fields:
      name: String
      sources: List<String>
      libraries: List<String>
      cflags: List<String>

  GemSpec:
    fields:
      name: String
      version: String
      extensions: List<String>
      files: List<String>

  RubyFFI:
    fields:
      library: String
      functions: List<String>
      callbacks: List<String>
      structs: List<String>

  RubyExtension:
    fields:
      name: String
      init_func: String
      methods: List<RubyMethod>
      extconf: ExtConf

behaviors:
  - name: generate_c_extension
    given: VibeeSpec
    when: C extension needed
    then: Ruby C extension files

  - name: generate_ffi_bindings
    given: VibeeSpec
    when: FFI gem bindings needed
    then: Ruby FFI module

  - name: map_vibee_to_ruby_type
    given: Vibee type
    when: Type mapping needed
    then: Ruby VALUE type

  - name: generate_init_function
    given: Extension name
    when: Init_* function needed
    then: Extension initializer

  - name: generate_extconf
    given: Build config
    when: extconf.rb needed
    then: ExtConf file

  - name: generate_gemspec
    given: Gem config
    when: Gem packaging needed
    then: GemSpec file

  - name: wrap_c_struct
    given: C struct
    when: Ruby wrapper needed
    then: TypedData wrapper

  - name: handle_ruby_exception
    given: C code
    when: Exception handling needed
    then: rb_rescue block
