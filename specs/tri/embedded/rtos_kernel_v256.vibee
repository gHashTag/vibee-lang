# ═══════════════════════════════════════════════════════════════════════════════
# RTOS KERNEL v256 - Real-Time Operating System Kernel
# ═══════════════════════════════════════════════════════════════════════════════
# Based on: FreeRTOS, Zephyr, RTEMS
# Scientific: RTAS 2024, EMSOFT 2024
# PAS Pattern: D&C + PRE
# φ² + 1/φ² = 3 | PHOENIX = 999
# ═══════════════════════════════════════════════════════════════════════════════

name: rtos_kernel
version: "2.5.6"
language: zig
module: rtos_kernel

sacred_constants:
  phi: 1.618033988749895
  trinity: 3.0
  phoenix: 999

creation_pattern:
  source: TaskDefinition
  transformer: RTOSScheduler
  result: ScheduledTask

types:
  TaskState:
    enum:
      - ready
      - running
      - blocked
      - suspended
      - terminated

  TaskPriority:
    fields:
      level: Int
      is_realtime: Bool

  Task:
    fields:
      id: Int
      name: String
      priority: TaskPriority
      state: TaskState
      stack_size: Int

  Semaphore:
    fields:
      count: Int
      max_count: Int
      waiting_tasks: List<Int>

  Mutex:
    fields:
      owner: Int?
      priority_ceiling: Int
      recursive_count: Int

  MessageQueue:
    fields:
      capacity: Int
      message_size: Int
      messages: List<List<Int>>

behaviors:
  - name: create_task
    given: "Task definition"
    when: "Task creation"
    then: "Create and schedule task"
    pas_pattern: PRE
    complexity: O(1)
    test_cases:
      - name: test_create
        input: '{"name": "sensor_task", "priority": 5}'
        expected: '{"task_id": 1}'

  - name: schedule_next
    given: "Ready queue"
    when: "Context switch"
    then: "Select highest priority task"
    pas_pattern: D&C
    complexity: O(log n)
    test_cases:
      - name: test_schedule
        input: '{"ready_tasks": [...]}'
        expected: '{"next_task": 3}'

  - name: acquire_mutex
    given: "Mutex and task"
    when: "Lock request"
    then: "Acquire or block"
    pas_pattern: PRE
    complexity: O(1)
    test_cases:
      - name: test_mutex
        input: '{"mutex_id": 1, "task_id": 2}'
        expected: '{"acquired": true}'

  - name: send_message
    given: "Queue and message"
    when: "Message send"
    then: "Enqueue message"
    pas_pattern: PRE
    complexity: O(1)
    test_cases:
      - name: test_send
        input: '{"queue_id": 1, "message": [...]}'
        expected: '{"sent": true}'

  - name: wait_semaphore
    given: "Semaphore and timeout"
    when: "Wait request"
    then: "Decrement or block"
    pas_pattern: D&C
    complexity: O(1)
    test_cases:
      - name: test_wait
        input: '{"sem_id": 1, "timeout_ms": 100}'
        expected: '{"acquired": true}'

  - name: yield_task
    given: "Current task"
    when: "Voluntary yield"
    then: "Reschedule"
    pas_pattern: D&C
    complexity: O(1)
    test_cases:
      - name: test_yield
        input: '{"task_id": 1}'
        expected: '{"yielded": true}'

# ═══════════════════════════════════════════════════════════════════════════════
# φ² + 1/φ² = 3 | PHOENIX = 999
# ═══════════════════════════════════════════════════════════════════════════════
