# iGLA Unified Pipeline
# Unified RAG pipeline integrating all IGLA modules
# φ² + 1/φ² = 3 | V = n × 3^k × π^m × φ^p

name: igla_unified_pipeline
version: "1.0.0"
language: zig
module: igla_unified_pipeline

sacred_constants:
  phi: 1.618033988749895
  trinity: 3.0
  phoenix: 999

types:
  PipelineConfig:
    fields:
      search_mode: String
      use_reranking: Bool
      use_cache: Bool
      chunk_size: Int
      top_k: Int

  SearchMode:
    fields:
      name: String
      description: String

  PipelineStage:
    fields:
      name: String
      enabled: Bool
      latency_ms: Float

  PipelineResult:
    fields:
      answer: String
      sources: String
      latency_ms: Float
      stages_used: String

  IndexConfig:
    fields:
      index_type: String
      use_quantization: Bool
      persist_path: String

  QueryConfig:
    fields:
      search_mode: String
      rerank: Bool
      top_k: Int
      stream: Bool

behaviors:
  - name: create_pipeline
    given: "PipelineConfig"
    when: "Initialization"
    then: "Unified pipeline ready"

  - name: index_documents
    given: "Documents, IndexConfig"
    when: "Indexing"
    then: "Documents indexed"

  - name: query_bm25
    given: "Query"
    when: "BM25 search"
    then: "BM25 results"

  - name: query_dense
    given: "Query"
    when: "Dense search"
    then: "Dense results"

  - name: query_hybrid
    given: "Query"
    when: "Hybrid search"
    then: "Fused results"

  - name: query_colbert
    given: "Query"
    when: "ColBERT search"
    then: "MaxSim results"

  - name: rerank_results
    given: "Results"
    when: "Reranking"
    then: "Reranked results"

  - name: generate_answer
    given: "Query, context"
    when: "Generation"
    then: "Generated answer"

  - name: phi_pipeline_optimization
    given: "Pipeline stats"
    when: "Sacred optimization"
    then: "φ-optimized pipeline"
