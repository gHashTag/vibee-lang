# VIBEE Specification: Plan Execution v1324
# YOLO XV - Production Ascension

name: browser_plan_execute
version: "1324"
language: zig
module: browser_plan_execute

types:
  PlanExecutor:
    fields:
      plan: List
      current_step: Int
      state: Map
      action_handlers: Map

  ExecutionContext:
    fields:
      executor: PlanExecutor
      timeout_ms: Int
      retry_policy: RetryPolicy
      observers: List

  RetryPolicy:
    fields:
      max_retries: Int
      backoff_ms: Int
      backoff_multiplier: Float

  ExecutionResult:
    fields:
      success: Bool
      final_state: Map
      executed_actions: List
      errors: List

  ActionResult:
    fields:
      action: String
      success: Bool
      new_state: Map
      duration_ms: Int
      error: String

  ExecutionObserver:
    fields:
      on_action_start: String
      on_action_complete: String
      on_action_error: String

behaviors:
  - name: create_executor
    given: "Plan, initial state"
    when: "Creating executor"
    then: "Returns initialized executor"

  - name: register_handler
    given: "Executor, action name, handler"
    when: "Registering handler"
    then: "Associates handler with action"

  - name: execute_plan
    given: "Executor, context"
    when: "Executing full plan"
    then: "Returns execution result"

  - name: execute_step
    given: "Executor"
    when: "Executing single step"
    then: "Returns action result"

  - name: pause_execution
    given: "Executor"
    when: "Pausing"
    then: "Pauses at current step"

  - name: resume_execution
    given: "Executor"
    when: "Resuming"
    then: "Continues from current step"

  - name: abort_execution
    given: "Executor"
    when: "Aborting"
    then: "Stops execution"

  - name: retry_action
    given: "Executor, policy"
    when: "Retrying failed action"
    then: "Retries with backoff"

  - name: add_observer
    given: "Executor, observer"
    when: "Adding observer"
    then: "Registers observer"

  - name: get_progress
    given: "Executor"
    when: "Getting progress"
    then: "Returns completion percentage"

creation_pattern:
  source: PlanExecutor
  transformer: PlanExecution
  result: ExecutedPlan

test_cases:
  - name: test_full_execution
    input:
      plan: ["a", "b", "c"]
    expected:
      all_executed: true

  - name: test_step_execution
    input:
      current_step: 0
    expected:
      step_executed: true

  - name: test_pause_resume
    input:
      pause_at: 1
    expected:
      resumed_correctly: true

  - name: test_abort
    input:
      abort_at: 2
    expected:
      execution_stopped: true

  - name: test_retry_policy
    input:
      max_retries: 3
      failures: 2
    expected:
      eventually_succeeded: true

  - name: test_timeout
    input:
      timeout_ms: 1000
      action_duration: 2000
    expected:
      timed_out: true

  - name: test_observer_notification
    input:
      observers: 2
    expected:
      all_notified: true

  - name: test_progress_tracking
    input:
      plan_length: 10
      completed: 5
    expected:
      progress: 50
