name: trajectory_recorder_v22
version: "22.3.0"
language: zig
module: trajectory_recorder_v22

types:
  TrajectoryStep:
    fields:
      step_num: Int
      timestamp: Timestamp
      observation: String
      thought: String
      action: String
      result: String
      duration_ms: Int

  Trajectory:
    fields:
      task_id: String
      goal: String
      steps: List<String>
      success: Bool
      total_duration_ms: Int
      final_answer: Option<String>

  RecorderConfig:
    fields:
      max_steps: Int
      record_observations: Bool
      record_thoughts: Bool
      compress_observations: Bool

  ExportFormat:
    fields:
      name: String

  Recorder:
    fields:
      config: Object
      trajectory: Object
      start_time: Timestamp

behaviors:
  - name: create_recorder
    given: RecorderConfig and task_id
    when: Initialize recorder
    then: Recorder instance

  - name: start_recording
    given: Recorder and goal
    when: Start new trajectory
    then: Started recorder

  - name: record_step
    given: Recorder and TrajectoryStep
    when: Add step
    then: Updated recorder

  - name: record_observation
    given: Recorder and observation
    when: Record observation
    then: Updated recorder

  - name: record_thought
    given: Recorder and thought
    when: Record thought
    then: Updated recorder

  - name: record_action
    given: Recorder and action
    when: Record action
    then: Updated recorder

  - name: record_result
    given: Recorder and result
    when: Record result
    then: Updated recorder

  - name: finish_recording
    given: Recorder and success status
    when: Complete trajectory
    then: Trajectory

  - name: export_json
    given: Trajectory
    when: Export as JSON
    then: JSON string

  - name: export_csv
    given: Trajectory
    when: Export as CSV
    then: CSV string

  - name: get_trajectory
    given: Recorder
    when: Get current trajectory
    then: Trajectory
