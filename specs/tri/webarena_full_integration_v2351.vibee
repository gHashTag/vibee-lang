# webarena_full_integration_v2351.vibee - Full WebArena Benchmark Integration
# Интеграция с 812 задачами WebArena для победы в бенчмарке
# φ² + 1/φ² = 3 | PHOENIX = 999

name: webarena_full_integration_v2351
version: "23.51.0"
language: zig
module: webarena_full_integration_v2351

types:
  WebArenaConfig:
    fields:
      shopping_url: String
      shopping_admin_url: String
      reddit_url: String
      gitlab_url: String
      wikipedia_url: String
      map_url: String
      homepage_url: String

  TaskConfig:
    fields:
      task_id: Int
      sites: List
      intent: String
      start_url: String
      require_login: Bool
      require_reset: Bool
      storage_state: Option
      eval_types: List
      reference_answers: Object

  TaskResult:
    fields:
      task_id: Int
      success: Bool
      score: Float
      trajectory: List
      execution_time_ms: Float
      error_message: Option

  BenchmarkRun:
    fields:
      run_id: String
      total_tasks: Int
      completed_tasks: Int
      successful_tasks: Int
      failed_tasks: Int
      success_rate: Float
      avg_time_ms: Float
      started_at: Timestamp
      completed_at: Option

  EvaluationResult:
    fields:
      task_id: Int
      eval_type: String
      score: Float
      details: Object

  AgentAction:
    fields:
      action_type: String
      selector: Option
      text: Option
      url: Option
      answer: Option
      timestamp: Timestamp

  Trajectory:
    fields:
      task_id: Int
      actions: List
      states: List
      final_answer: Option

  SiteCredentials:
    fields:
      site: String
      username: String
      password: String
      auth_state_path: String

behaviors:
  - name: load_config
    given: Config file path
    when: Initialization
    then: Return WebArenaConfig

  - name: load_tasks
    given: Tasks JSON path
    when: Loading benchmark
    then: Return List of TaskConfig (812 tasks)

  - name: execute_task
    given: TaskConfig and WebArenaConfig
    when: Task execution
    then: Return TaskResult with trajectory

  - name: evaluate_task
    given: TaskResult and TaskConfig
    when: Evaluation
    then: Return EvaluationResult with score

  - name: run_benchmark
    given: WebArenaConfig and task range
    when: Full benchmark run
    then: Return BenchmarkRun with all results

  - name: login_site
    given: SiteCredentials
    when: Authentication required
    then: Return auth state for reuse

  - name: reset_environment
    given: WebArenaConfig
    when: After 812 tasks
    then: Reset all Docker containers

  - name: save_trajectory
    given: Trajectory and output path
    when: Saving results
    then: Write JSON trajectory file

  - name: calculate_metrics
    given: List of TaskResult
    when: Metrics calculation
    then: Return success rate, avg time, per-site breakdown

  - name: submit_to_leaderboard
    given: BenchmarkRun and contact email
    when: Submission
    then: Generate submission format

sacred_constants:
  phi: 1.618033988749895
  phoenix: 999
  total_tasks: 812
  target_success_rate: 72.0
