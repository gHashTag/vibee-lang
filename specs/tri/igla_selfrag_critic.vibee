# iGLA Self-RAG Critic
# Self-reflective critic for RAG generation
# Scientific basis: Asai et al. 2023 (Self-RAG)
# φ² + 1/φ² = 3 | V = n × 3^k × π^m × φ^p

name: igla_selfrag_critic
version: "1.0.0"
language: zig
module: igla_selfrag_critic

sacred_constants:
  phi: 1.618033988749895
  trinity: 3.0
  phoenix: 999

scientific_references:
  - "Asai et al. 2023: Self-RAG"
  - "Yao et al. 2023: ReAct"
  - "Shinn et al. 2023: Reflexion"

types:
  CriticConfig:
    fields:
      relevance_threshold: Float
      support_threshold: Float
      utility_threshold: Float

  RelevanceScore:
    fields:
      score: Float
      reasoning: String
      is_relevant: Bool

  SupportScore:
    fields:
      score: Float
      grounded_spans: String
      is_supported: Bool

  UtilityScore:
    fields:
      score: Float
      is_useful: Bool

  CriticOutput:
    fields:
      relevance: Float
      support: Float
      utility: Float
      should_retrieve: Bool
      should_regenerate: Bool

  ReflectionToken:
    fields:
      token_type: String
      value: String
      confidence: Float

behaviors:
  - name: assess_relevance
    given: "Query, passage"
    when: "Relevance check"
    then: "Relevance score"

  - name: assess_support
    given: "Response, context"
    when: "Support check"
    then: "Grounding score"

  - name: assess_utility
    given: "Response, query"
    when: "Utility check"
    then: "Usefulness score"

  - name: should_retrieve
    given: "Query, current_context"
    when: "Retrieval decision"
    then: "Retrieve or not"

  - name: should_regenerate
    given: "Response, scores"
    when: "Regeneration decision"
    then: "Regenerate or accept"

  - name: generate_reflection
    given: "Response, scores"
    when: "Reflection"
    then: "Reflection tokens"

  - name: aggregate_scores
    given: "All scores"
    when: "Aggregation"
    then: "Final critic output"

  - name: phi_threshold_calibration
    given: "Score distribution"
    when: "Sacred calibration"
    then: "φ-optimal thresholds"
