name: traffic_light_sim
version: "1.0.0"
language: verilog
module: traffic_light_sim

# Generated from Python by py2vibee
# Sacred Formula: φ² + 1/φ² = 3

constants:
  CLOCK_FREQ: 50000000
  GREEN_TIME: 300
  YELLOW_TIME: 100
  RED_TIME: 400

signals:
  - name: clk
    width: 1
    direction: input
  - name: rst_n
    width: 1
    direction: input
  - name: pedestrian_button
    width: 1
    direction: input
  - name: red_light
    width: 1
    direction: output
  - name: yellow_light
    width: 1
    direction: output
  - name: green_light
    width: 1
    direction: output
  - name: timer_count
    width: 32
    direction: reg
  - name: timer_expired
    width: 1
    direction: reg

fsm:
  - name: TrafficLightFSM
    initial: RED
    encoding: onehot
    states:
      - RED
      - RED_YELLOW
      - GREEN
      - YELLOW
    transitions:
      - from: RED
        to: RED_YELLOW
        when: "timer_expired"
      - from: RED_YELLOW
        to: GREEN
        when: "timer_expired"
      - from: GREEN
        to: YELLOW
        when: "(timer_expired) || (pedestrian_button)"
      - from: YELLOW
        to: RED
        when: "timer_expired"
    outputs:
      - state: RED
        red_light: 1'b1
        yellow_light: 1'b0
        green_light: 1'b0
      - state: RED_YELLOW
        red_light: 1'b1
        yellow_light: 1'b1
        green_light: 1'b0
      - state: GREEN
        red_light: 1'b0
        yellow_light: 1'b0
        green_light: 1'b1
      - state: YELLOW
        red_light: 1'b0
        yellow_light: 1'b1
        green_light: 1'b0
    timers:
      - state: RED
        timeout_constant: RED_TIME
        timeout_value: 400
      - state: RED_YELLOW
        timeout_constant: YELLOW_TIME
        timeout_value: 100
      - state: GREEN
        timeout_constant: GREEN_TIME
        timeout_value: 300
      - state: YELLOW
        timeout_constant: YELLOW_TIME
        timeout_value: 100

behaviors:
  - name: transition
    given: "Function transition with parameters (current_state: String, timer_expired: Bool, pedestrian_button: Bool)"
    when: "Function is called"
    then: "Returns String"
    params:
      - name: current_state
        type: String
      - name: timer_expired
        type: Bool
      - name: pedestrian_button
        type: Bool
    returns: String
  - name: output
    given: "Function output with parameters (current_state: String)"
    when: "Function is called"
    then: "Returns tuple"
    params:
      - name: current_state
        type: String
    returns: tuple
  - name: clk
    given: "Function clk with parameters ()"
    when: "Function is called"
    then: "Returns Bool"
    returns: Bool
  - name: rst_n
    given: "Function rst_n with parameters ()"
    when: "Function is called"
    then: "Returns Bool"
    returns: Bool
  - name: pedestrian_button
    given: "Function pedestrian_button with parameters ()"
    when: "Function is called"
    then: "Returns Bool"
    returns: Bool
  - name: red_light
    given: "Function red_light with parameters ()"
    when: "Function is called"
    then: "Returns Bool"
    returns: Bool
  - name: yellow_light
    given: "Function yellow_light with parameters ()"
    when: "Function is called"
    then: "Returns Bool"
    returns: Bool
  - name: green_light
    given: "Function green_light with parameters ()"
    when: "Function is called"
    then: "Returns Bool"
    returns: Bool
  - name: timer_count
    given: "Function timer_count with parameters ()"
    when: "Function is called"
    then: "Returns Int"
    returns: Int
  - name: timer_expired
    given: "Function timer_expired with parameters ()"
    when: "Function is called"
    then: "Returns Bool"
    returns: Bool
  - name: timer_process
    given: "Function timer_process with parameters (state: String, timer_count: Int)"
    when: "Function is called"
    then: "Returns tuple"
    hdl_type: sequential
    clock: clk
    reset: rst_n
    params:
      - name: state
        type: String
      - name: timer_count
        type: Int
    returns: tuple
