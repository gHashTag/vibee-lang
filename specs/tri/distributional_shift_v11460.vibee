name: distributional_shift_v11460
version: "11460"
language: zig
module: distributional_shift

description: |
  TIER 230: Distributional Shift Detection
  Detects when deployment distribution differs from training
  Based on: Rabanser et al., Shimodaira covariate shift

types:
  ShiftConfig:
    fields:
      test_type: ShiftTestType
      significance_level: Float
      window_size: Int
      drift_threshold: Float
      multivariate: Bool

  ShiftTestType:
    variants:
      - kolmogorov_smirnov
      - maximum_mean_discrepancy
      - chi_squared
      - wasserstein
      - classifier_two_sample

  ShiftResult:
    fields:
      shift_detected: Bool
      p_value: Float
      test_statistic: Float
      shift_magnitude: Float
      affected_features: List<Int>

  DriftMonitor:
    fields:
      reference_distribution: List<Float>
      current_window: List<Float>
      drift_history: List<Float>
      alert_count: Int

behaviors:
  - name: detect_covariate_shift
    given: Reference and test distributions
    when: Testing for covariate shift
    then: Returns shift detection result

  - name: compute_mmd
    given: Two sample sets and kernel
    when: Computing Maximum Mean Discrepancy
    then: Returns MMD statistic and p-value

  - name: kolmogorov_smirnov_test
    given: Two univariate distributions
    when: Running KS test
    then: Returns KS statistic and significance

  - name: wasserstein_distance
    given: Two distributions
    when: Computing Earth Mover distance
    then: Returns Wasserstein-1 distance

  - name: train_drift_classifier
    given: Reference and current samples
    when: Training two-sample classifier
    then: Returns classifier accuracy as drift measure

  - name: monitor_streaming_drift
    given: New data point
    when: Updating drift monitor
    then: Returns current drift status

  - name: identify_shifted_features
    given: Multivariate shift result
    when: Localizing shift
    then: Returns list of shifted feature indices

  - name: compute_importance_weights
    given: Shifted distribution
    when: Adapting to shift
    then: Returns importance weights for reweighting

creation_pattern:
  source: DistributionPair
  transformer: ShiftDetector
  result: ShiftResult

test_cases:
  - name: test_ks_detection
    input: { test_type: kolmogorov_smirnov }
    expected: { detects_shift: true }

  - name: test_mmd_kernel
    input: { kernel: rbf, bandwidth: 1.0 }
    expected: { mmd_computed: true }

  - name: test_streaming_monitor
    input: { window_size: 100 }
    expected: { monitors_drift: true }
