# v3803 - Cross-modal Retrieval
# ==============================
# Multi-modal search and matching
# φ² + 1/φ² = 3 | PHOENIX = 999

name: crossmodal_retrieval
version: "3.8.3"
language: zig
module: crossmodal_retrieval

constants:
  PHI: 1.618033988749895
  EMBEDDING_DIM: 512
  TOP_K: 10
  TEMPERATURE: 0.07

types:
  RetrievalConfig:
    fields:
      embedding_dim: Int
      index_type: String
      metric: String
      top_k: Int
      
  ModalityEmbedding:
    fields:
      embedding: List
      modality: String
      item_id: String
      
  CrossModalIndex:
    fields:
      image_embeddings: List
      text_embeddings: List
      audio_embeddings: List
      video_embeddings: List
      
  RetrievalQuery:
    fields:
      query_embedding: List
      source_modality: String
      target_modality: String
      
  RetrievalResult:
    fields:
      items: List
      scores: List
      modalities: List
      
  ModalityAlignment:
    fields:
      similarity_matrix: List
      alignment_score: Float
      
  HardNegative:
    fields:
      anchor: List
      positive: List
      negative: List

behaviors:
  - name: encode_for_retrieval
    given: Input and modality
    when: Computing retrieval embedding
    then: Return normalized embedding
    
  - name: build_crossmodal_index
    given: Multi-modal dataset
    when: Indexing all modalities
    then: Return searchable index
    
  - name: text_to_image_search
    given: Text query and image index
    when: Finding matching images
    then: Return ranked images
    
  - name: image_to_text_search
    given: Image query and text index
    when: Finding matching texts
    then: Return ranked texts
    
  - name: audio_to_video_search
    given: Audio query and video index
    when: Finding matching videos
    then: Return ranked videos
    
  - name: any_to_any_search
    given: Query and target modality
    when: Cross-modal retrieval
    then: Return ranked results
    
  - name: compute_alignment_score
    given: Two modality embeddings
    when: Measuring alignment
    then: Return alignment metric
    
  - name: mine_hard_negatives
    given: Anchor and candidates
    when: Finding hard negatives
    then: Return triplets for training
