# v4300 - Meta-Learning
# ======================
# Learning to learn
# φ² + 1/φ² = 3 | PHOENIX = 999

name: meta_learning
version: "4.3.0"
language: zig
module: meta_learning

constants:
  PHI: 1.618033988749895
  N_WAY: 5
  K_SHOT: 5
  META_LR: 0.001

types:
  MetaLearner:
    fields:
      base_learner: Object
      meta_optimizer: Object
      inner_steps: Int
      
  Episode:
    fields:
      support_set: List
      query_set: List
      n_way: Int
      k_shot: Int
      
  TaskDistribution:
    fields:
      task_family: String
      sampling_params: Map
      
  MetaBatch:
    fields:
      episodes: List
      batch_size: Int
      
  Adaptation:
    fields:
      initial_params: List
      adapted_params: List
      num_steps: Int
      
  MetaGradient:
    fields:
      outer_gradient: List
      inner_gradients: List
      
  LearningCurve:
    fields:
      steps: List
      losses: List
      accuracies: List
      
  MetaTestResult:
    fields:
      accuracy: Float
      confidence_interval: List
      adaptation_speed: Float

behaviors:
  - name: sample_episode
    given: Task distribution
    when: Creating episode
    then: Return episode
    
  - name: inner_loop
    given: Model and support set
    when: Task adaptation
    then: Return adapted model
    
  - name: outer_loop
    given: Meta-learner and batch
    when: Meta-update
    then: Return updated meta-learner
    
  - name: compute_meta_gradient
    given: Adapted model and query
    when: Computing outer gradient
    then: Return meta gradient
    
  - name: evaluate_adaptation
    given: Model and episode
    when: Testing adaptation
    then: Return test result
    
  - name: meta_train_step
    given: Meta-learner and episodes
    when: One meta-training step
    then: Return loss and updated learner
    
  - name: few_shot_classify
    given: Adapted model and query
    when: Classification
    then: Return predictions
    
  - name: measure_adaptation_speed
    given: Model and task
    when: Measuring learning speed
    then: Return learning curve
