# VIBEE Specification v13517
# WebRTC Integration
# KOSCHEI CYCLE 11 - 1000000x SPEEDUP

name: screen_webrtc
version: "13517"
language: zig
module: screen_webrtc

types:
  WebRTCConfig:
    fields:
      ice_servers: List<Object>
      sdp_semantics: String
      bundle_policy: String

  PeerConnection:
    fields:
      id: String
      local_description: String
      remote_description: String
      ice_state: String
      connection_state: String

  ICECandidate:
    fields:
      candidate: String
      sdp_mid: String
      sdp_mline_index: Int

  MediaTrack:
    fields:
      track_id: String
      kind: String
      label: String
      enabled: Bool
      muted: Bool

  WebRTCStats:
    fields:
      bytes_sent: Int
      bytes_received: Int
      packets_lost: Int
      round_trip_time_ms: Float

  DataChannel:
    fields:
      id: String
      label: String
      state: String
      buffered_amount: Int

behaviors:
  - name: create_connection
    given: WebRTC configuration
    When: Connection requested
    then: Peer connection created

  - name: create_offer
    given: Peer connection
    When: Offer needed
    then: SDP offer created

  - name: create_answer
    given: Remote offer
    When: Answer needed
    then: SDP answer created

  - name: add_ice_candidate
    given: ICE candidate
    When: Candidate received
    then: Candidate added

  - name: add_track
    given: Media track
    When: Track addition requested
    then: Track added to connection

  - name: close_connection
    given: Active connection
    When: Close requested
    then: Connection closed

creation_pattern:
  source: WebRTCConfig
  transformer: WebRTCManager
  result: PeerConnection
