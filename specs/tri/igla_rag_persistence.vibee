# iGLA RAG Persistence
# Persistent storage for RAG index
# Scientific basis: Johnson et al. 2019 (FAISS), Malkov & Yashunin 2018 (HNSW)
# φ² + 1/φ² = 3 | V = n × 3^k × π^m × φ^p

name: igla_rag_persistence
version: "1.0.0"
language: zig
module: igla_rag_persistence

sacred_constants:
  phi: 1.618033988749895
  trinity: 3.0
  phoenix: 999

scientific_references:
  - "Johnson et al. 2019: FAISS"
  - "Malkov & Yashunin 2018: HNSW"
  - "Guo et al. 2020: Accelerating Large-Scale Inference"
  - "Douze et al. 2024: The FAISS library"

types:
  PersistenceConfig:
    fields:
      storage_path: String
      format: String
      compression: Bool
      auto_save: Bool
      save_interval: Int

  IndexMetadata:
    fields:
      version: String
      created_at: Int
      updated_at: Int
      doc_count: Int
      vector_count: Int
      embedding_dim: Int

  StoredChunk:
    fields:
      id: Int
      text: String
      embedding: String
      source: String
      metadata: String

  IndexSnapshot:
    fields:
      metadata: String
      chunks: String
      inverted_index: String
      checksum: String

  StorageStats:
    fields:
      file_size_bytes: Int
      load_time_ms: Float
      save_time_ms: Float
      compression_ratio: Float

  IncrementalUpdate:
    fields:
      added_ids: String
      removed_ids: String
      timestamp: Int

behaviors:
  - name: save_index
    given: "Index, path"
    when: "Persistence"
    then: "Index saved to disk"

  - name: load_index
    given: "Path"
    when: "Loading"
    then: "Index loaded from disk"

  - name: save_incremental
    given: "Changes since last save"
    when: "Incremental save"
    then: "Delta saved efficiently"

  - name: compress_index
    given: "Index"
    when: "Compression"
    then: "Compressed index data"

  - name: decompress_index
    given: "Compressed data"
    when: "Decompression"
    then: "Original index"

  - name: verify_checksum
    given: "Index, checksum"
    when: "Integrity check"
    then: "Validation result"

  - name: migrate_version
    given: "Old index, new version"
    when: "Version migration"
    then: "Migrated index"

  - name: phi_storage_optimization
    given: "Index"
    when: "Sacred optimization"
    then: "φ-ratio storage layout"
