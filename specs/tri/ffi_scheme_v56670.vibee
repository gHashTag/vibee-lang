# FFI Scheme v56670 - Scheme foreign-lambda
# VIBEE → Scheme Native Bindings (Chicken/Gambit/Chez)
# φ² + 1/φ² = 3 | PHOENIX = 999

name: ffi_scheme_v56670
version: "56.6.70"
language: zig
module: ffi_scheme

creation_pattern:
  source: VibeeSpec
  transformer: SchemeBindingsGenerator
  result: SchemeModule

types:
  SchemeType:
    fields:
      name: String
      scheme_type: String
      c_type: String
      dialect: String

  ForeignLambda:
    fields:
      name: String
      return_type: String
      arg_types: List<String>
      c_code: String

  ForeignDeclare:
    fields:
      name: String
      c_declaration: String

  SchemeModule:
    fields:
      name: String
      dialect: String
      imports: List<String>
      exports: List<String>
      foreign_declares: List<ForeignDeclare>
      foreign_lambdas: List<ForeignLambda>

  ChickenEgg:
    fields:
      name: String
      version: String
      dependencies: List<String>
      foreign_libs: List<String>

  GambitConfig:
    fields:
      name: String
      cc_options: List<String>
      ld_options: List<String>

  SchemeCallback:
    fields:
      name: String
      signature: String
      c_callback: String

  SchemePointer:
    fields:
      type_name: String
      is_tagged: Bool

behaviors:
  - name: generate_scheme_module
    given: VibeeSpec
    when: Scheme module needed
    then: Scheme source files

  - name: generate_foreign_lambda
    given: C function
    when: foreign-lambda needed
    then: ForeignLambda

  - name: map_vibee_to_scheme_type
    given: Vibee type
    when: Type mapping needed
    then: Scheme FFI type

  - name: generate_foreign_declare
    given: C declaration
    when: foreign-declare needed
    then: ForeignDeclare

  - name: generate_chicken_egg
    given: Package config
    when: .egg file needed
    then: ChickenEgg

  - name: handle_callback
    given: C callback
    when: foreign-safe-lambda needed
    then: SchemeCallback

  - name: handle_pointer
    given: C pointer
    when: c-pointer needed
    then: SchemePointer

  - name: handle_gc
    given: Scheme object
    when: GC protection needed
    then: gc-root registration
