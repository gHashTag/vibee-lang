# webrtc_data_v2537.vibee - WebRTC DataChannel
# Двунаправленный канал данных
# φ² + 1/φ² = 3 | PHOENIX = 999

name: webrtc_data_v2537
version: "2537.0.0"
language: zig
module: webrtc_data_v2537

types:
  RTCDataChannel:
    fields:
      id: Int
      label: String
      ordered: Bool
      max_packet_life_time: Int
      max_retransmits: Int
      protocol: String
      negotiated: Bool
      ready_state: String
      buffered_amount: Int
      buffered_amount_low_threshold: Int
      binary_type: String

  RTCDataChannelInit:
    fields:
      ordered: Bool
      max_packet_life_time: Int
      max_retransmits: Int
      protocol: String
      negotiated: Bool
      id: Int

  DataChannelMessage:
    fields:
      data: Object
      is_binary: Bool
      timestamp: Timestamp

  DataChannelStats:
    fields:
      messages_sent: Int
      messages_received: Int
      bytes_sent: Int
      bytes_received: Int

behaviors:
  - name: create_data_channel
    given: RTCPeerConnection, label, RTCDataChannelInit
    when: Channel creation requested
    then: Return new RTCDataChannel

  - name: send_string
    given: RTCDataChannel and string data
    when: String send requested
    then: Send UTF-8 encoded string

  - name: send_binary
    given: RTCDataChannel and binary data
    when: Binary send requested
    then: Send ArrayBuffer data

  - name: on_open
    given: RTCDataChannel
    when: Channel opened
    then: Notify channel ready

  - name: on_message
    given: RTCDataChannel and DataChannelMessage
    when: Message received
    then: Deliver to application

  - name: on_close
    given: RTCDataChannel
    when: Channel closed
    then: Cleanup and notify

  - name: on_error
    given: RTCDataChannel and error
    when: Error occurred
    then: Handle error and notify

  - name: close_data_channel
    given: RTCDataChannel
    when: Close requested
    then: Close channel gracefully

sacred_constants:
  phi: 1.618033988749895
  phi_squared_plus_inverse_squared: 3
  phoenix: 999
