# v4801 - Message Passing
# ========================
# MPNN - основа всех GNN
# φ² + 1/φ² = 3 | PHOENIX = 999

name: message_passing
version: "4.8.1"
language: zig
module: message_passing

constants:
  PHI: 1.618033988749895
  MESSAGE_DIM: 128
  UPDATE_DIM: 256

types:
  MPNNConfig:
    fields:
      message_dim: Int
      update_dim: Int
      num_steps: Int
      
  Message:
    fields:
      src_node: Int
      dst_node: Int
      content: List
      
  MessageFunction:
    fields:
      mlp: Object
      edge_features: Bool
      
  UpdateFunction:
    fields:
      gru: Object
      mlp: Object
      
  AggregatedMessages:
    fields:
      node_id: Int
      aggregated: List
      num_messages: Int
      
  GCNLayer:
    fields:
      weight: List
      bias: List
      normalize: Bool
      
  GraphSAGELayer:
    fields:
      weight: List
      aggregator: String
      
  GINLayer:
    fields:
      mlp: Object
      epsilon: Float
      train_epsilon: Bool

behaviors:
  - name: compute_message
    given: Source, target, edge features
    when: Message computation
    then: Вернуть message
    
  - name: aggregate_messages
    given: Messages для node
    when: Sum/Mean/Max aggregation
    then: Вернуть aggregated message
    
  - name: update_node
    given: Node state и aggregated
    when: Node update
    then: Вернуть new node state
    
  - name: gcn_forward
    given: Features, adj, weights
    when: GCN layer
    then: Вернуть updated features
    
  - name: graphsage_forward
    given: Features, neighbors, layer
    when: GraphSAGE layer
    then: Вернуть updated features
    
  - name: gin_forward
    given: Features, adj, layer
    when: GIN layer
    then: Вернуть updated features
    
  - name: message_passing_step
    given: Graph и MPNN config
    when: Один шаг MP
    then: Вернуть updated graph
    
  - name: propagate
    given: Edge index и features
    when: Full propagation
    then: Вернуть propagated features
