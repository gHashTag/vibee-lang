# VIBEE Specification v13528
# Code Comments
# KOSCHEI CYCLE 11 - 1000000x SPEEDUP

name: collab_comments
version: "13528"
language: zig
module: collab_comments

types:
  CodeComment:
    fields:
      id: String
      file: String
      line: Int
      content: String
      author_id: String
      created_at: Timestamp

  CommentThread:
    fields:
      id: String
      comments: List<Object>
      resolved: Bool
      file: String
      line_range: Object

  CommentConfig:
    fields:
      allow_replies: Bool
      allow_resolve: Bool
      notify_mentions: Bool

  CommentReply:
    fields:
      id: String
      thread_id: String
      content: String
      author_id: String

  CommentMetrics:
    fields:
      comments_total: Int
      threads_total: Int
      resolved_threads: Int

  CommentMention:
    fields:
      user_id: String
      comment_id: String
      notified: Bool

behaviors:
  - name: add_comment
    given: Comment content and location
    When: Comment added
    then: Comment created

  - name: reply_to_comment
    given: Thread ID and reply
    When: Reply added
    then: Reply created

  - name: resolve_thread
    given: Thread ID
    When: Resolve requested
    then: Thread resolved

  - name: edit_comment
    given: Comment ID and new content
    When: Edit requested
    then: Comment edited

  - name: delete_comment
    given: Comment ID
    When: Delete requested
    then: Comment deleted

  - name: get_comments
    given: File path
    When: Comments requested
    then: File comments returned

creation_pattern:
  source: CommentConfig
  transformer: CommentManager
  result: CommentThread
