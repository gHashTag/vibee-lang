# v9002 - Retrieval Augmented Generation
# =======================================
# RAG architecture
# Based on: REALM, RAG, RETRO
# φ² + 1/φ² = 3 | PHOENIX = 999

name: retrieval_augmented
version: "9.0.2"
language: zig
module: retrieval_augmented

constants:
  PHI: 1.618033988749895

types:
  RAGConfig:
    fields:
      num_retrieved: Int
      chunk_size: Int
      retriever_type: String
      
  RetrievedContext:
    fields:
      documents: List
      scores: List
      embeddings: List
      
  RAGOutput:
    fields:
      output: List
      retrieved_docs: List
      attribution: List

behaviors:
  - name: retrieve
    given: Query и index
    when: Retrieving documents
    then: Вернуть top-k documents
    
  - name: encode_query
    given: Query text
    when: Query encoding
    then: Вернуть query embedding
    
  - name: encode_documents
    given: Documents
    when: Document encoding
    then: Вернуть document embeddings
    
  - name: augment_context
    given: Input и retrieved docs
    when: Context augmentation
    then: Вернуть augmented input
    
  - name: generate_with_context
    given: Augmented input и model
    when: Generation
    then: Вернуть generated output
    
  - name: rerank_documents
    given: Query и documents
    when: Reranking
    then: Вернуть reranked documents
    
  - name: chunk_documents
    given: Documents и chunk_size
    when: Chunking
    then: Вернуть document chunks
    
  - name: build_index
    given: Document embeddings
    when: Index building
    then: Вернуть searchable index
