# VIBEE Specification v13596
# CDP Network Interception
# Network Request/Response Handling
# φ² + 1/φ² = 3 | PHOENIX = 999

name: cdp_network
version: "13596"
language: zig
module: cdp_network

types:
  NetworkRequest:
    fields:
      request_id: String
      loader_id: String
      url: String
      method: String
      headers: Object
      post_data: String
      has_post_data: Bool
      initial_priority: String

  NetworkResponse:
    fields:
      url: String
      status: Int
      status_text: String
      headers: Object
      mime_type: String
      connection_reused: Bool
      connection_id: Int
      encoded_data_length: Int

  Cookie:
    fields:
      name: String
      value: String
      domain: String
      path: String
      expires: Float
      size: Int
      http_only: Bool
      secure: Bool
      same_site: String

  RequestPattern:
    fields:
      url_pattern: String
      resource_type: String
      interception_stage: String

  InterceptedRequest:
    fields:
      interception_id: String
      request: Object
      frame_id: String
      resource_type: String
      is_navigation_request: Bool

  NetworkMetrics:
    fields:
      requests_total: Int
      requests_blocked: Int
      bytes_received: Int
      bytes_sent: Int

  WebSocketFrame:
    fields:
      opcode: Int
      mask: Bool
      payload_data: String

  ResourceTiming:
    fields:
      request_time: Float
      proxy_start: Float
      proxy_end: Float
      dns_start: Float
      dns_end: Float
      connect_start: Float
      connect_end: Float
      ssl_start: Float
      ssl_end: Float
      send_start: Float
      send_end: Float
      receive_headers_end: Float

behaviors:
  - name: enable
    given: Network domain
    when: Enable requested
    then: Network events enabled

  - name: disable
    given: Network domain
    when: Disable requested
    then: Network events disabled

  - name: set_request_interception
    given: Request patterns
    when: Interception setup requested
    then: Matching requests intercepted

  - name: continue_intercepted
    given: Intercepted request
    when: Continue requested
    then: Request continues normally

  - name: fulfill_request
    given: Intercepted request and response
    when: Fulfill requested
    then: Custom response returned

  - name: abort_request
    given: Intercepted request
    when: Abort requested
    then: Request aborted with error

  - name: get_cookies
    given: URL filter
    when: Cookies requested
    then: Matching cookies returned

  - name: set_cookie
    given: Cookie data
    when: Set cookie requested
    then: Cookie set in browser

  - name: clear_browser_cookies
    given: Browser context
    when: Clear requested
    then: All cookies cleared

creation_pattern:
  source: RequestPattern
  transformer: NetworkInterceptor
  result: InterceptedRequest
