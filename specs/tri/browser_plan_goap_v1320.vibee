# VIBEE Specification: GOAP Planning v1320
# YOLO XV - Production Ascension
# Based on: Goal-Oriented Action Planning

name: browser_plan_goap
version: "1320"
language: zig
module: browser_plan_goap

types:
  GOAPAgent:
    fields:
      actions: List
      goals: List
      world_state: WorldState
      current_plan: List

  GOAPAction:
    fields:
      name: String
      cost: Float
      preconditions: Map
      effects: Map
      procedural_precondition: String

  GOAPGoal:
    fields:
      name: String
      priority: Float
      desired_state: Map

  WorldState:
    fields:
      facts: Map

  GOAPPlan:
    fields:
      actions: List
      total_cost: Float
      goal: GOAPGoal

  GOAPNode:
    fields:
      state: WorldState
      action: GOAPAction
      parent: String
      g_cost: Float
      h_cost: Float

behaviors:
  - name: create_agent
    given: "Initial world state"
    when: "Creating GOAP agent"
    then: "Returns initialized agent"

  - name: add_action
    given: "Agent, action"
    when: "Adding action"
    then: "Registers action"

  - name: add_goal
    given: "Agent, goal"
    when: "Adding goal"
    then: "Registers goal"

  - name: update_world_state
    given: "Agent, key, value"
    when: "Updating world"
    then: "Updates state"

  - name: plan
    given: "Agent, goal"
    when: "Finding plan"
    then: "Returns action sequence via A*"

  - name: get_valid_actions
    given: "Agent, state"
    when: "Finding valid actions"
    then: "Returns applicable actions"

  - name: apply_action
    given: "State, action"
    when: "Simulating action"
    then: "Returns new state"

  - name: calculate_heuristic
    given: "State, goal state"
    when: "Estimating cost"
    then: "Returns heuristic value"

  - name: state_satisfies_goal
    given: "State, goal"
    when: "Checking goal"
    then: "Returns true if satisfied"

  - name: select_goal
    given: "Agent"
    when: "Selecting highest priority goal"
    then: "Returns best goal"

creation_pattern:
  source: GOAPAgent
  transformer: GOAPPlanner
  result: GoalPlan

scientific_references:
  - author: "Orkin"
    title: "Applying Goal-Oriented Action Planning to Games"
    venue: "AI Game Programming Wisdom 2"
    year: 2003

test_cases:
  - name: test_action_validity
    input:
      action: {preconditions: {has_key: true}}
      state: {has_key: true}
    expected:
      valid: true

  - name: test_action_effects
    input:
      action: {effects: {door_open: true}}
      state: {door_open: false}
    expected:
      new_state: {door_open: true}

  - name: test_plan_finding
    input:
      goal: {at_destination: true}
      actions: ["walk", "drive", "fly"]
    expected:
      plan_found: true

  - name: test_cost_optimization
    input:
      actions: [{cost: 10}, {cost: 5}]
    expected:
      cheapest_plan: true

  - name: test_goal_selection
    input:
      goals: [{priority: 0.8}, {priority: 0.5}]
    expected:
      highest_selected: true

  - name: test_heuristic
    input:
      current: {a: false, b: false}
      goal: {a: true, b: true}
    expected:
      heuristic: 2

  - name: test_no_valid_plan
    input:
      impossible_goal: true
    expected:
      plan_found: false

  - name: test_procedural_precondition
    input:
      action: "use_tool"
      tool_available: false
    expected:
      action_invalid: true
