name: accessibility_tree
version: "2.0.0"
language: zig
module: accessibility_tree

# ═══════════════════════════════════════════════════════════════════════════════
# Accessibility Tree Parser - DOM via Chrome CDP Accessibility API
# ═══════════════════════════════════════════════════════════════════════════════
# Better than raw HTML: structured, semantic, smaller context
# Used by: SeeAct, WebVoyager, Mind2Web top performers
# φ² + 1/φ² = 3 | PHOENIX = 999
# ═══════════════════════════════════════════════════════════════════════════════

types:
  A11yNode:
    fields:
      node_id: String
      role: String
      name: String
      value: String
      description: String
      is_focusable: Bool
      is_clickable: Bool
      is_editable: Bool
      bounding_box: Object
      children_ids: List<String>

  A11yTree:
    fields:
      root_id: String
      nodes: Map<String, Object>
      total_nodes: Int
      max_depth: Int

  InteractiveElement:
    fields:
      node_id: String
      role: String
      name: String
      action_type: String
      selector: String
      coordinates: Object

  A11ySnapshot:
    fields:
      tree: Object
      url: String
      title: String
      timestamp: Timestamp
      interactive_count: Int

  ElementFilter:
    fields:
      roles: List<String>
      include_hidden: Bool
      max_depth: Int
      focusable_only: Bool

behaviors:
  - name: fetch_accessibility_tree
    given: Browser connected via CDP
    when: Page fully loaded
    then: Call Accessibility.getFullAXTree and parse response

  - name: parse_ax_node
    given: Raw AX node from CDP
    when: Building tree structure
    then: Extract role, name, value, properties

  - name: build_tree_structure
    given: All AX nodes parsed
    when: Tree construction needed
    then: Link parent-child relationships

  - name: filter_interactive_elements
    given: Full tree available
    when: Action planning needed
    then: Extract only clickable, editable, focusable nodes

  - name: get_element_by_role
    given: Tree built and role specified
    when: Finding specific element type
    then: Return all nodes matching role

  - name: get_element_by_name
    given: Tree built and name pattern specified
    when: Finding element by text
    then: Return nodes with matching name

  - name: serialize_for_llm
    given: Tree or subtree available
    when: Sending to LLM for analysis
    then: Convert to compact text format for context

  - name: get_bounding_box
    given: Node ID available
    when: Coordinates needed for click
    then: Query CDP for node bounding box

  - name: compare_trees
    given: Two snapshots available
    when: Change detection needed
    then: Identify added, removed, modified nodes

  - name: prune_tree
    given: Tree too large for context
    when: Context limit approaching
    then: Remove non-interactive and hidden nodes
