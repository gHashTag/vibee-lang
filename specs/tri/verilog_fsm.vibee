name: verilog_fsm
version: "1.0.0"
language: zig
module: verilog_fsm

# ═══════════════════════════════════════════════════════════════════════════════
# VIBEE → Verilog FSM Generator
# ═══════════════════════════════════════════════════════════════════════════════
# Священная Формула: V = n × 3^k × π^m × φ^p × e^q
# Золотое Тождество: φ² + 1/φ² = 3 | PHOENIX = 999
#
# Генерация конечных автоматов из VIBEE behaviors
# Паттерн: given/when/then → state/condition/action
# ═══════════════════════════════════════════════════════════════════════════════

types:
  FsmState:
    fields:
      name: String
      encoding: Int
      is_initial: Bool
      is_final: Bool

  FsmTransition:
    fields:
      from_state: String
      to_state: String
      condition: String
      actions: List<String>

  FsmConfig:
    fields:
      encoding_type: String
      state_reg_name: String
      next_state_name: String
      use_one_hot: Bool

  FsmOutput:
    fields:
      name: String
      moore_value: Option<Int>
      mealy_condition: Option<String>

  GeneratedFsm:
    fields:
      states: List<Object>
      transitions: List<Object>
      outputs: List<Object>
      state_width: Int

behaviors:
  - name: extract_states_from_behaviors
    given: List of VIBEE behaviors with given/when/then
    when: State extraction
    then: Return unique states from given clauses

  - name: extract_transitions
    given: VIBEE behavior with when clause
    when: Transition extraction
    then: Return FsmTransition with condition and actions

  - name: calculate_state_encoding
    given: List of states, encoding_type (binary/one-hot/gray)
    when: Encoding calculation
    then: Return state encodings and width

  - name: generate_state_register
    given: FsmConfig with clock and reset
    when: State register generation
    then: Output always block for state register

  - name: generate_next_state_logic
    given: List of FsmTransition
    when: Next state logic generation
    then: Output case statement with transitions

  - name: generate_output_logic
    given: List of FsmOutput, Moore or Mealy
    when: Output logic generation
    then: Output combinational or registered outputs

  - name: generate_fsm_module
    given: Complete FSM specification
    when: Full FSM generation
    then: Output complete Verilog FSM module

  - name: validate_fsm
    given: Generated FSM
    when: Validation requested
    then: Check for unreachable states, deadlocks
