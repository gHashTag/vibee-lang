# screen_dirty_rect_v12861.vibee - Грязные прямоугольники
# Оптимизация перерисовки
# φ² + 1/φ² = 3 | PHOENIX = 999

name: screen_dirty_rect_v12861
version: "12861.0.0"
language: zig
module: screen_dirty_rect_v12861

types:
  DirtyRect:
    fields:
      rect_id: String
      x: Int
      y: Int
      width: Int
      height: Int
      priority: Int

  DirtyRegion:
    fields:
      region_id: String
      rects: List
      total_area: Int
      merged: Bool

  InvalidationEvent:
    fields:
      event_id: String
      source: String
      rect: Object
      timestamp: Timestamp

  DirtyConfig:
    fields:
      coalesce_threshold: Int
      max_rects: Int
      frame_budget_ms: Float

  DirtyMetrics:
    fields:
      rects_per_frame: Float
      area_per_frame: Float
      coalesce_ratio: Float

behaviors:
  - name: mark_dirty
    given: Rectangle
    when: Invalidation
    then: Return DirtyRect

  - name: coalesce_rects
    given: DirtyRect list
    when: Coalescing
    then: Return DirtyRegion

  - name: get_dirty_rects
    given: Frame ID
    when: Rects request
    then: Return DirtyRect list

  - name: clear_dirty
    given: Region
    when: Clear
    then: Return success

  - name: optimize_rects
    given: DirtyConfig
    when: Optimization
    then: Return optimized rects

sacred_constants:
  phi: 1.618033988749895
  phoenix: 999
