# iGLA Self-RAG Retrieval
# Adaptive retrieval for Self-RAG
# Scientific basis: Asai et al. 2023
# φ² + 1/φ² = 3 | V = n × 3^k × π^m × φ^p

name: igla_selfrag_retrieval
version: "1.0.0"
language: zig
module: igla_selfrag_retrieval

sacred_constants:
  phi: 1.618033988749895
  trinity: 3.0
  phoenix: 999

scientific_references:
  - "Asai et al. 2023: Self-RAG"
  - "Jiang et al. 2023: Active RAG"
  - "Mallen et al. 2023: When Not to Trust LLMs"

types:
  RetrievalConfig:
    fields:
      max_passages: Int
      retrieval_threshold: Float
      adaptive: Bool

  RetrievalDecision:
    fields:
      should_retrieve: Bool
      confidence: Float
      reason: String

  AdaptiveContext:
    fields:
      query_complexity: Float
      knowledge_gap: Float
      uncertainty: Float

  RetrievalResult:
    fields:
      passages: String
      scores: String
      retrieval_triggered: Bool

  QueryAnalysis:
    fields:
      is_factual: Bool
      requires_recent: Bool
      domain: String

  RetrievalStats:
    fields:
      retrievals_triggered: Int
      retrievals_skipped: Int
      avg_passages: Float

behaviors:
  - name: analyze_query
    given: "Query"
    when: "Query analysis"
    then: "Query characteristics"

  - name: decide_retrieval
    given: "Query, context"
    when: "Retrieval decision"
    then: "Retrieve or skip"

  - name: retrieve_adaptive
    given: "Query, decision"
    when: "Adaptive retrieval"
    then: "Passages if needed"

  - name: estimate_uncertainty
    given: "Query, model_state"
    when: "Uncertainty estimation"
    then: "Knowledge gap score"

  - name: select_passages
    given: "Candidates, query"
    when: "Passage selection"
    then: "Best passages"

  - name: iterative_retrieve
    given: "Query, max_iterations"
    when: "Multi-hop"
    then: "Iteratively retrieved"

  - name: cache_decision
    given: "Query, decision"
    when: "Caching"
    then: "Decision cached"

  - name: phi_retrieval_threshold
    given: "Query stats"
    when: "Sacred threshold"
    then: "φ-optimal threshold"
