# v6004 - Model Checkpointing
# ============================
# Сохранение и загрузка моделей
# V = n × 3^k × π^m × φ^p | φ² + 1/φ² = 3 | PHOENIX = 999

name: checkpointing
version: "6.0.4"
language: zig
module: checkpointing

constants:
  PHI: 1.618033988749895
  MAGIC_NUMBER: 0x56494245
  VERSION: 1
  PHOENIX: 999

types:
  Checkpoint:
    fields:
      model_state: Map
      optimizer_state: Map
      scheduler_state: Map
      step: Int
      epoch: Int
      loss: Float
      
  CheckpointHeader:
    fields:
      magic: Int
      version: Int
      timestamp: Timestamp
      checksum: Int
      
  ModelState:
    fields:
      parameters: Map
      buffers: Map
      
  SaveConfig:
    fields:
      path: String
      save_optimizer: Bool
      save_scheduler: Bool
      compress: Bool
      
  LoadConfig:
    fields:
      path: String
      strict: Bool
      map_location: String

behaviors:
  - name: save_checkpoint
    given: Model, optimizer, scheduler, path
    when: Сохранение checkpoint
    then: Записать все состояния в файл
    
  - name: load_checkpoint
    given: Path и config
    when: Загрузка checkpoint
    then: Вернуть Checkpoint со всеми состояниями
    
  - name: save_model_only
    given: Model и path
    when: Сохранение только модели
    then: Записать только параметры модели
    
  - name: load_model_only
    given: Model и path
    when: Загрузка только модели
    then: Загрузить параметры в модель
    
  - name: get_state_dict
    given: Model
    when: Получение state dict
    then: Вернуть Map параметров
    
  - name: load_state_dict
    given: Model и state_dict
    when: Загрузка state dict
    then: Установить параметры из Map
    
  - name: verify_checkpoint
    given: Path
    when: Проверка целостности
    then: Вернуть Bool и error message
    
  - name: list_checkpoints
    given: Directory path
    when: Список checkpoints
    then: Вернуть List путей с метаданными
