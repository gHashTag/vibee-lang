# iGLA RAG Pipeline
# Complete RAG pipeline: Index + Retrieve + Generate
# φ² + 1/φ² = 3 | V = n × 3^k × π^m × φ^p

name: igla_rag_pipeline
version: "1.0.0"
language: zig
module: igla_rag_pipeline

sacred_constants:
  phi: 1.618033988749895
  trinity: 3.0
  phoenix: 999

types:
  RAGConfig:
    fields:
      chunk_size: Int
      chunk_overlap: Int
      top_k: Int
      embedding_model: String
      llm_model: String

  RAGPipeline:
    fields:
      chunker: String
      embedder: String
      vectorstore: String
      retriever: String
      llm: String

  RAGQuery:
    fields:
      question: String
      top_k: Int
      include_sources: Bool
      stream: Bool

  RAGResponse:
    fields:
      answer: String
      sources: String
      context: String
      latency_ms: Float

  IndexResult:
    fields:
      documents_indexed: Int
      chunks_created: Int
      vectors_stored: Int
      time_ms: Float

  RAGMetrics:
    fields:
      queries_total: Int
      avg_latency_ms: Float
      avg_context_length: Int
      retrieval_accuracy: Float

behaviors:
  - name: create_pipeline
    given: "RAGConfig"
    when: "Creation"
    then: "RAG pipeline ready"

  - name: index_documents
    given: "List of documents"
    when: "Indexing"
    then: "Documents indexed"

  - name: index_file
    given: "File path"
    when: "File indexing"
    then: "File content indexed"

  - name: index_directory
    given: "Directory path"
    when: "Directory indexing"
    then: "All files indexed"

  - name: query
    given: "Question"
    when: "RAG query"
    then: "Answer with sources"

  - name: query_stream
    given: "Question"
    when: "Streaming query"
    then: "Streamed answer"

  - name: build_prompt
    given: "Question, context"
    when: "Prompt building"
    then: "RAG prompt created"

  - name: clear_index
    given: "Pipeline"
    when: "Clearing"
    then: "Index cleared"

  - name: get_stats
    given: "Pipeline"
    when: "Stats request"
    then: "Pipeline statistics"

  - name: phi_rag_harmony
    given: "RAG pipeline"
    when: "Harmony"
    then: "φ-optimal retrieval-generation"
