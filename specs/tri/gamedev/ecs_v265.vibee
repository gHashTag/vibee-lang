# ═══════════════════════════════════════════════════════════════════════════════
# ECS v265 - Entity Component System
# ═══════════════════════════════════════════════════════════════════════════════
# Based on: Flecs, EnTT, Bevy ECS
# Scientific: GDC 2024, GAME-ON 2024
# PAS Pattern: D&C + PRE
# φ² + 1/φ² = 3 | PHOENIX = 999
# ═══════════════════════════════════════════════════════════════════════════════

name: ecs
version: "2.6.5"
language: zig
module: ecs

sacred_constants:
  phi: 1.618033988749895
  trinity: 3.0
  phoenix: 999

creation_pattern:
  source: EntityDefinition
  transformer: ECSWorld
  result: GameState

types:
  EntityId:
    fields:
      index: Int
      generation: Int

  ComponentType:
    enum:
      - transform
      - velocity
      - sprite
      - collider
      - health
      - ai
      - physics
      - audio

  Component:
    fields:
      component_type: ComponentType
      data: Object

  TransformComponent:
    fields:
      x: Float
      y: Float
      z: Float
      rotation: Float
      scale_x: Float
      scale_y: Float

  VelocityComponent:
    fields:
      vx: Float
      vy: Float
      vz: Float

  HealthComponent:
    fields:
      current: Int
      max: Int

  Archetype:
    fields:
      id: Int
      component_mask: Int
      entities: List<EntityId>

  Query:
    fields:
      required: List<ComponentType>
      excluded: List<ComponentType>

  SystemPhase:
    enum:
      - pre_update
      - update
      - post_update
      - render

behaviors:
  - name: create_entity
    given: "Component list"
    when: "Entity creation"
    then: "Create entity with components"
    pas_pattern: PRE
    complexity: O(c)
    test_cases:
      - name: test_create
        input: '{"components": ["transform", "velocity"]}'
        expected: '{"entity_id": {...}}'

  - name: destroy_entity
    given: "Entity ID"
    when: "Entity destruction"
    then: "Remove entity"
    pas_pattern: PRE
    complexity: O(c)
    test_cases:
      - name: test_destroy
        input: '{"entity_id": {...}}'
        expected: '{"destroyed": true}'

  - name: add_component
    given: "Entity and component"
    when: "Component addition"
    then: "Add component to entity"
    pas_pattern: PRE
    complexity: O(c)
    test_cases:
      - name: test_add
        input: '{"entity": {...}, "component": {...}}'
        expected: '{"added": true}'

  - name: remove_component
    given: "Entity and component type"
    when: "Component removal"
    then: "Remove component"
    pas_pattern: PRE
    complexity: O(c)
    test_cases:
      - name: test_remove
        input: '{"entity": {...}, "type": "velocity"}'
        expected: '{"removed": true}'

  - name: query_entities
    given: "Query definition"
    when: "Query execution"
    then: "Return matching entities"
    pas_pattern: D&C
    complexity: O(n)
    test_cases:
      - name: test_query
        input: '{"required": ["transform", "velocity"]}'
        expected: '{"entities": [...]}'

  - name: run_system
    given: "System and query"
    when: "System execution"
    then: "Process entities"
    pas_pattern: D&C
    complexity: O(n)
    test_cases:
      - name: test_system
        input: '{"system": "movement", "query": {...}}'
        expected: '{"processed": 100}'

# ═══════════════════════════════════════════════════════════════════════════════
# φ² + 1/φ² = 3 | PHOENIX = 999
# ═══════════════════════════════════════════════════════════════════════════════
