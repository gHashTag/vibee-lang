# ═══════════════════════════════════════════════════════════════════════════════
# PATHFINDING v267 - Navigation and Pathfinding
# ═══════════════════════════════════════════════════════════════════════════════
# Based on: A*, JPS, NavMesh, Flow Fields
# Scientific: AIIDE 2024, CIG 2024
# PAS Pattern: D&C + PRE + HSH
# φ² + 1/φ² = 3 | PHOENIX = 999
# ═══════════════════════════════════════════════════════════════════════════════

name: pathfinding
version: "2.6.7"
language: zig
module: pathfinding

sacred_constants:
  phi: 1.618033988749895
  trinity: 3.0
  phoenix: 999

creation_pattern:
  source: NavigationQuery
  transformer: Pathfinder
  result: NavigationPath

types:
  PathfindingAlgorithm:
    enum:
      - a_star
      - dijkstra
      - jps
      - theta_star
      - flow_field

  HeuristicType:
    enum:
      - manhattan
      - euclidean
      - chebyshev
      - octile

  GridCell:
    fields:
      x: Int
      y: Int
      walkable: Bool
      cost: Float

  NavMeshPolygon:
    fields:
      polygon_id: Int
      vertices: List<Float>
      neighbors: List<Int>
      center: List<Float>

  PathNode:
    fields:
      position: List<Float>
      g_cost: Float
      h_cost: Float
      parent: Option<Int>

  NavigationPath:
    fields:
      waypoints: List<List<Float>>
      total_cost: Float
      smoothed: Bool

  FlowField:
    fields:
      width: Int
      height: Int
      directions: List<Int>
      costs: List<Float>

  PathRequest:
    fields:
      start: List<Float>
      goal: List<Float>
      algorithm: PathfindingAlgorithm
      heuristic: HeuristicType

behaviors:
  - name: find_path
    given: "Start and goal"
    when: "Path request"
    then: "Find optimal path"
    pas_pattern: D&C
    complexity: O(n log n)
    test_cases:
      - name: test_path
        input: '{"start": [0, 0], "goal": [10, 10]}'
        expected: '{"path": {...}}'

  - name: build_navmesh
    given: "Geometry data"
    when: "NavMesh generation"
    then: "Build navigation mesh"
    pas_pattern: D&C
    complexity: O(n log n)
    test_cases:
      - name: test_navmesh
        input: '{"vertices": [...], "triangles": [...]}'
        expected: '{"navmesh": {...}}'

  - name: generate_flow_field
    given: "Goal position"
    when: "Flow field generation"
    then: "Generate flow field"
    pas_pattern: D&C
    complexity: O(n)
    test_cases:
      - name: test_flow
        input: '{"goal": [50, 50]}'
        expected: '{"field": {...}}'

  - name: smooth_path
    given: "Raw path"
    when: "Path smoothing"
    then: "Smooth path"
    pas_pattern: ALG
    complexity: O(n)
    test_cases:
      - name: test_smooth
        input: '{"path": {...}}'
        expected: '{"smoothed": {...}}'

  - name: query_navmesh
    given: "Position"
    when: "NavMesh query"
    then: "Find containing polygon"
    pas_pattern: HSH
    complexity: O(log n)
    test_cases:
      - name: test_query
        input: '{"position": [5.5, 3.2]}'
        expected: '{"polygon_id": 42}'

  - name: update_obstacles
    given: "Obstacle list"
    when: "Dynamic update"
    then: "Update navigation data"
    pas_pattern: PRE
    complexity: O(k)
    test_cases:
      - name: test_update
        input: '{"obstacles": [...]}'
        expected: '{"updated": true}'

# ═══════════════════════════════════════════════════════════════════════════════
# φ² + 1/φ² = 3 | PHOENIX = 999
# ═══════════════════════════════════════════════════════════════════════════════
