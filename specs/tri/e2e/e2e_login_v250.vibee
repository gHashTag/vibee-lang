# VIBEE E2E Login Flow v250
# End-to-End Testing for Authentication

name: e2e_login_v250
version: "250.0.0"
language: zig
module: e2e_login

types:
  LoginCredentials:
    fields:
      username: String
      password: String
      remember_me: Bool

  LoginResult:
    fields:
      success: Bool
      token: String
      user_id: String
      error: String

  LoginPage:
    fields:
      url: String
      username_selector: String
      password_selector: String
      submit_selector: String

  AuthState:
    fields:
      authenticated: Bool
      session_id: String
      expires_at: Timestamp

  LoginMetrics:
    fields:
      total_time_ms: Int
      navigation_ms: Int
      input_ms: Int
      submit_ms: Int
      verification_ms: Int

  SecurityCheck:
    fields:
      csrf_token: Bool
      https: Bool
      secure_cookies: Bool

  LoginScenario:
    fields:
      name: String
      credentials: Object
      expected_result: String

behaviors:
  - name: e2e_valid_login
    given: "Valid credentials"
    when: "Login submitted"
    then: "User authenticated"
    benchmark:
      vibee_ms: 450
      playwright_ms: 650
      puppeteer_ms: 750
      selenium_ms: 1100
    steps:
      - "Navigate to login page"
      - "Enter username"
      - "Enter password"
      - "Click submit"
      - "Verify dashboard"

  - name: e2e_invalid_login
    given: "Invalid credentials"
    when: "Login submitted"
    then: "Error displayed"
    benchmark:
      vibee_ms: 400
      playwright_ms: 600
      puppeteer_ms: 700
      selenium_ms: 1000
    steps:
      - "Navigate to login page"
      - "Enter invalid credentials"
      - "Click submit"
      - "Verify error message"

  - name: e2e_remember_me
    given: "Remember me checked"
    when: "Login successful"
    then: "Session persisted"
    benchmark:
      vibee_ms: 500
      playwright_ms: 700
      puppeteer_ms: 800
      selenium_ms: 1200
    steps:
      - "Login with remember me"
      - "Close browser"
      - "Reopen browser"
      - "Verify still logged in"

  - name: e2e_logout
    given: "User logged in"
    when: "Logout clicked"
    then: "Session terminated"
    benchmark:
      vibee_ms: 300
      playwright_ms: 450
      puppeteer_ms: 550
      selenium_ms: 800
    steps:
      - "Click logout"
      - "Verify redirect to login"
      - "Verify session cleared"

  - name: e2e_password_reset
    given: "Forgot password clicked"
    when: "Email submitted"
    then: "Reset email sent"
    benchmark:
      vibee_ms: 350
      playwright_ms: 500
      puppeteer_ms: 600
      selenium_ms: 900
    steps:
      - "Click forgot password"
      - "Enter email"
      - "Submit"
      - "Verify confirmation"

  - name: e2e_mfa_login
    given: "MFA enabled"
    when: "Code entered"
    then: "Login complete"
    benchmark:
      vibee_ms: 600
      playwright_ms: 850
      puppeteer_ms: 950
      selenium_ms: 1400
    steps:
      - "Enter credentials"
      - "Submit"
      - "Enter MFA code"
      - "Verify dashboard"

  - name: e2e_social_login
    given: "Social provider"
    when: "OAuth flow"
    then: "User authenticated"
    benchmark:
      vibee_ms: 800
      playwright_ms: 1100
      puppeteer_ms: 1250
      selenium_ms: 1800
    steps:
      - "Click social login"
      - "Handle OAuth popup"
      - "Authorize"
      - "Verify dashboard"

test_cases:
  - name: test_valid_login
    input: { username: "user@test.com", password: "password123" }
    expected: { authenticated: true, time_ms: 450 }

  - name: test_invalid_login
    input: { username: "user@test.com", password: "wrong" }
    expected: { error: "Invalid credentials" }

  - name: test_remember_me
    input: { remember: true }
    expected: { persisted: true }

  - name: test_logout
    input: { logged_in: true }
    expected: { logged_out: true }

  - name: test_password_reset
    input: { email: "user@test.com" }
    expected: { email_sent: true }

  - name: test_mfa
    input: { code: "123456" }
    expected: { authenticated: true }

  - name: test_social
    input: { provider: "google" }
    expected: { authenticated: true }

benchmark_summary:
  vibee_avg_ms: 486
  playwright_avg_ms: 693
  puppeteer_avg_ms: 800
  selenium_avg_ms: 1171
  vibee_speedup: "1.4x-2.4x"
  proof: "Direct CDP commands, optimized waits, parallel assertions"
