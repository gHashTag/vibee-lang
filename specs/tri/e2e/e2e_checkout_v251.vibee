# VIBEE E2E Checkout Flow v251
# End-to-End Testing for E-commerce Checkout

name: e2e_checkout_v251
version: "251.0.0"
language: zig
module: e2e_checkout

types:
  CartItem:
    fields:
      product_id: String
      name: String
      quantity: Int
      price: Float

  ShippingAddress:
    fields:
      name: String
      street: String
      city: String
      zip: String
      country: String

  PaymentInfo:
    fields:
      card_number: String
      expiry: String
      cvv: String
      name: String

  OrderResult:
    fields:
      order_id: String
      total: Float
      status: String

  CheckoutMetrics:
    fields:
      total_time_ms: Int
      cart_ms: Int
      shipping_ms: Int
      payment_ms: Int
      confirmation_ms: Int

  CheckoutStep:
    fields:
      name: String
      completed: Bool
      time_ms: Int

  DiscountCode:
    fields:
      code: String
      discount_percent: Float
      valid: Bool

behaviors:
  - name: e2e_add_to_cart
    given: "Product page"
    when: "Add to cart clicked"
    then: "Item in cart"
    benchmark:
      vibee_ms: 200
      playwright_ms: 300
      puppeteer_ms: 350
      selenium_ms: 500
    steps:
      - "Navigate to product"
      - "Select options"
      - "Click add to cart"
      - "Verify cart updated"

  - name: e2e_update_cart
    given: "Items in cart"
    when: "Quantity changed"
    then: "Cart updated"
    benchmark:
      vibee_ms: 150
      playwright_ms: 250
      puppeteer_ms: 300
      selenium_ms: 450
    steps:
      - "Open cart"
      - "Change quantity"
      - "Verify total updated"

  - name: e2e_apply_discount
    given: "Valid discount code"
    when: "Code applied"
    then: "Discount reflected"
    benchmark:
      vibee_ms: 180
      playwright_ms: 280
      puppeteer_ms: 330
      selenium_ms: 480
    steps:
      - "Enter discount code"
      - "Apply"
      - "Verify discount"

  - name: e2e_enter_shipping
    given: "Checkout started"
    when: "Shipping entered"
    then: "Address saved"
    benchmark:
      vibee_ms: 300
      playwright_ms: 450
      puppeteer_ms: 520
      selenium_ms: 750
    steps:
      - "Fill shipping form"
      - "Select shipping method"
      - "Continue"

  - name: e2e_enter_payment
    given: "Shipping complete"
    when: "Payment entered"
    then: "Payment ready"
    benchmark:
      vibee_ms: 350
      playwright_ms: 500
      puppeteer_ms: 580
      selenium_ms: 850
    steps:
      - "Fill payment form"
      - "Verify card"
      - "Continue"

  - name: e2e_complete_order
    given: "Payment ready"
    when: "Order placed"
    then: "Order confirmed"
    benchmark:
      vibee_ms: 400
      playwright_ms: 600
      puppeteer_ms: 700
      selenium_ms: 1000
    steps:
      - "Review order"
      - "Place order"
      - "Verify confirmation"

  - name: e2e_full_checkout
    given: "Empty cart"
    when: "Full flow"
    then: "Order complete"
    benchmark:
      vibee_ms: 1500
      playwright_ms: 2200
      puppeteer_ms: 2500
      selenium_ms: 3600
    steps:
      - "Add items"
      - "Checkout"
      - "Shipping"
      - "Payment"
      - "Confirm"

test_cases:
  - name: test_add_cart
    input: { product_id: "p1", quantity: 2 }
    expected: { in_cart: true }

  - name: test_update_cart
    input: { item_id: "i1", quantity: 3 }
    expected: { updated: true }

  - name: test_discount
    input: { code: "SAVE10" }
    expected: { discount: 10 }

  - name: test_shipping
    input: { address: { city: "NYC" } }
    expected: { saved: true }

  - name: test_payment
    input: { card: "4111111111111111" }
    expected: { valid: true }

  - name: test_complete
    input: { order: true }
    expected: { confirmed: true }

  - name: test_full_flow
    input: { items: 3 }
    expected: { order_id: true }

benchmark_summary:
  vibee_total_ms: 3080
  playwright_total_ms: 4580
  puppeteer_total_ms: 5280
  selenium_total_ms: 7630
  vibee_speedup: "1.5x-2.5x"
