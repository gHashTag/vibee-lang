# Anthropic Provider Implementation
# Claude 3.5, Claude 4 models
# Computer Use and extended thinking support

name: llm_provider_anthropic
version: "1.0.0"
language: zig
module: llm_provider_anthropic

types:
  AnthropicConfig:
    fields:
      api_key: String
      base_url: String
      anthropic_version: String
      beta_features: List<String>

  AnthropicModel:
    fields:
      model_id: String
      display_name: String
      context_window: Int
      max_output: Int
      supports_vision: Bool
      supports_computer_use: Bool
      supports_extended_thinking: Bool

  AnthropicRequest:
    fields:
      model: String
      messages: List<String>
      system: String
      max_tokens: Int
      temperature: Float
      top_p: Float
      top_k: Int
      tools: Option<String>
      tool_choice: Option<String>

  AnthropicResponse:
    fields:
      id: String
      response_type: String
      role: String
      content: List<String>
      model: String
      stop_reason: String
      usage_input: Int
      usage_output: Int

  AnthropicContentBlock:
    fields:
      block_type: String
      text: Option<String>
      tool_use_id: Option<String>
      tool_name: Option<String>
      tool_input: Option<String>

  ComputerUseTool:
    fields:
      tool_type: String
      display_width: Int
      display_height: Int
      display_number: Int

  ComputerUseAction:
    fields:
      action_type: String
      coordinate_x: Option<Int>
      coordinate_y: Option<Int>
      text: Option<String>
      key: Option<String>

  ExtendedThinking:
    fields:
      thinking_budget: Int
      thinking_content: String
      thinking_tokens: Int

behaviors:
  - name: create_message
    given: Anthropic config and message request
    when: Messages API is called
    then: Returns Anthropic response with content blocks

  - name: stream_message
    given: Anthropic config and request with stream
    when: Streaming API is called
    then: Yields SSE events until message_stop

  - name: use_computer_tool
    given: Computer use tool configuration
    when: Model requests computer action
    then: Returns action to execute on screen

  - name: execute_computer_action
    given: Computer use action specification
    when: Action execution requested
    then: Returns screenshot result after action

  - name: enable_extended_thinking
    given: Request with thinking budget
    when: Complex reasoning needed
    then: Returns response with thinking trace

  - name: handle_tool_use
    given: Tool use content block
    when: Model invokes a tool
    then: Returns tool result for continuation

  - name: handle_anthropic_error
    given: Anthropic API error
    when: Error handling triggered
    then: Returns parsed error with overload handling

  - name: validate_anthropic_key
    given: API key string
    when: Key validation requested
    then: Returns validation status with tier info
