name: wasm_audio_synth
version: "1.0.0"
language: zig
module: wasm_audio_synth

types:
  Oscillator:
    fields:
      frequency: Float
      amplitude: Float
      phase: Float
      waveform: String
      
  AudioBuffer:
    fields:
      sample_rate: Int
      channels: Int
      samples: List<Float>
      
  Envelope:
    fields:
      attack: Float
      decay: Float
      sustain: Float
      release: Float
      
  Filter:
    fields:
      filter_type: String
      cutoff: Float
      resonance: Float
      
  SpatialPosition:
    fields:
      x: Float
      y: Float
      z: Float
      
  AudioRegion:
    fields:
      x_min: Float
      x_max: Float
      y_min: Float
      y_max: Float
      density: Float
      
  HarmonicSeries:
    fields:
      fundamental: Float
      harmonics: List<Float>
      amplitudes: List<Float>
      
  PhiScale:
    fields:
      root_frequency: Float
      phi_ratio: Float
      notes: List<Float>
      
  SonificationMap:
    fields:
      parameter: String
      min_freq: Float
      max_freq: Float
      
  AudioStats:
    fields:
      peak_amplitude: Float
      rms_level: Float
      frequency_centroid: Float

behaviors:
  - name: init_audio
    given: Sample rate and buffer size
    when: Initialize audio system
    then: Audio buffers allocated
    
  - name: create_oscillator
    given: Frequency and waveform type
    when: Create oscillator
    then: Returns configured oscillator
    
  - name: generate_sine
    given: Oscillator and sample count
    when: Generate sine wave
    then: Returns audio samples
    
  - name: generate_square
    given: Oscillator and sample count
    when: Generate square wave
    then: Returns audio samples
    
  - name: generate_sawtooth
    given: Oscillator and sample count
    when: Generate sawtooth wave
    then: Returns audio samples
    
  - name: generate_triangle
    given: Oscillator and sample count
    when: Generate triangle wave
    then: Returns audio samples
    
  - name: generate_noise
    given: Sample count
    when: Generate white noise
    then: Returns random samples
    
  - name: apply_envelope
    given: Samples and envelope
    when: Shape amplitude
    then: ADSR applied to samples
    
  - name: apply_lowpass
    given: Samples and cutoff
    when: Filter high frequencies
    then: Filtered samples returned
    
  - name: apply_highpass
    given: Samples and cutoff
    when: Filter low frequencies
    then: Filtered samples returned
    
  - name: apply_bandpass
    given: Samples, low, high
    when: Filter to band
    then: Band-limited samples
    
  - name: mix_channels
    given: Two audio buffers
    when: Mix together
    then: Combined audio buffer
    
  - name: pan_stereo
    given: Mono samples and pan
    when: Create stereo
    then: Left/right balanced
    
  - name: spatial_position
    given: Samples and position
    when: 3D positioning
    then: Spatially positioned audio
    
  - name: sonify_density
    given: Region density
    when: Map to frequency
    then: Higher density = higher pitch
    
  - name: sonify_velocity
    given: Photon velocity
    when: Map to amplitude
    then: Faster = louder
    
  - name: sonify_interference
    given: Wave interference value
    when: Map to timbre
    then: Constructive = bright, destructive = dark
    
  - name: phi_frequency
    given: Base frequency and steps
    when: Calculate φ-based frequency
    then: Returns freq * φ^steps
    
  - name: golden_scale
    given: Root frequency
    when: Generate φ scale
    then: Returns 8 notes based on φ
    
  - name: harmonic_series
    given: Fundamental frequency
    when: Generate harmonics
    then: Returns natural harmonic series
    
  - name: fibonacci_rhythm
    given: BPM and length
    when: Generate rhythm
    then: Fibonacci-timed beats
    
  - name: emotion_to_chord
    given: Emotion state
    when: Map emotion to harmony
    then: Joy=major, calm=sus, energy=power
    
  - name: wave_to_audio
    given: Visual wave pattern
    when: Convert to sound
    then: Audible representation
    
  - name: region_to_oscillator
    given: Screen region
    when: Map region to sound
    then: 8 regions = 8 oscillators
    
  - name: export_buffer
    given: Audio buffer
    when: Prepare for Web Audio
    then: Returns float array for JS
    
  - name: import_microphone
    given: Samples from JS
    when: Receive mic input
    then: Process external audio
    
  - name: calculate_fft
    given: Audio samples
    when: Frequency analysis
    then: Returns frequency spectrum
    
  - name: calculate_rms
    given: Audio samples
    when: Calculate loudness
    then: Returns RMS level
    
  - name: phoenix_chord
    given: Time
    when: Generate 999 chord
    then: Rebirth harmonic sequence
    
  - name: koschei_drone
    given: Base frequency
    when: Generate immortal drone
    then: Never-ending sustained tone
    
  - name: golden_identity_tone
    given: Nothing
    when: Generate φ² + 1/φ² = 3 tone
    then: Three-frequency chord
