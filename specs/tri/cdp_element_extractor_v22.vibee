# cdp_element_extractor_v22.vibee
# KOSCHEI CYCLE 22 - Element Extractor for Agent Observation
# Extract structured data from DOM for LLM
# φ² + 1/φ² = 3 | PHOENIX = 999

name: cdp_element_extractor_v22
version: "22.0.0"
language: zig
module: cdp_element_extractor_v22

types:
  ExtractConfig:
    fields:
      include_links: Bool
      include_buttons: Bool
      include_inputs: Bool
      include_text: Bool
      max_text_length: Int

  LinkInfo:
    fields:
      href: String
      text: String
      is_visible: Bool

  ButtonInfo:
    fields:
      selector: String
      text: String
      is_enabled: Bool
      button_type: String

  InputInfo:
    fields:
      selector: String
      input_type: String
      name: String
      value: String
      placeholder: String

  TextBlock:
    fields:
      tag: String
      text: String
      is_heading: Bool

  PageElements:
    fields:
      links: String
      buttons: String
      inputs: String
      headings: String
      paragraphs: String

  InteractiveElement:
    fields:
      element_type: String
      selector: String
      text: String
      is_clickable: Bool
      is_typeable: Bool

  ExtractionResult:
    fields:
      success: Bool
      elements_count: Int
      extraction_time_ms: Int
      formatted_output: String

  AccessibilityInfo:
    fields:
      role: String
      name: String
      description: String

behaviors:
  - name: extract_links
    given: DOM document
    when: Extracting all links
    then: Return list of LinkInfo

  - name: extract_buttons
    given: DOM document
    when: Extracting all buttons
    then: Return list of ButtonInfo

  - name: extract_inputs
    given: DOM document
    when: Extracting all input fields
    then: Return list of InputInfo

  - name: extract_text_blocks
    given: DOM document
    when: Extracting text content
    then: Return list of TextBlock

  - name: extract_all
    given: ExtractConfig
    when: Extracting all elements
    then: Return PageElements

  - name: find_interactive
    given: DOM document
    when: Finding clickable/typeable elements
    then: Return list of InteractiveElement

  - name: format_for_llm
    given: PageElements
    when: Formatting for LLM prompt
    then: Return formatted string

  - name: get_element_selector
    given: Node ID
    when: Generating unique CSS selector
    then: Return selector string

  - name: is_visible
    given: Element node
    when: Checking element visibility
    then: Return visibility status

  - name: get_accessibility_info
    given: Node ID
    when: Getting accessibility tree info
    then: Return AccessibilityInfo

test_cases:
  - name: extract_google_links
    input: google.com page
    expected: links_count > 5

  - name: format_for_agent
    input: page elements
    expected: formatted string contains links

  - name: find_search_input
    input: search page
    expected: input with type=text found

sacred_constants:
  phi: 1.618033988749895
  phi_squared_plus_inverse_squared: 3
  phoenix: 999
