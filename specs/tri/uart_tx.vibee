name: uart_tx
version: "1.0.0"
language: verilog
module: uart_tx

# Generated from Python by py2vibee
# Sacred Formula: φ² + 1/φ² = 3

constants:
  CLOCK_FREQ: 50000000
  BAUD_RATE: 115200

signals:
  - name: clk
    width: 1
    direction: input
  - name: rst_n
    width: 1
    direction: input
  - name: tx_data
    width: 8
    direction: input
  - name: tx_start
    width: 1
    direction: input
  - name: tx_out
    width: 1
    direction: output
    default: 1
  - name: tx_busy
    width: 1
    direction: output
  - name: tx_done
    width: 1
    direction: output
  - name: tx_data_reg
    width: 8
    direction: reg
  - name: bit_index
    width: 3
    direction: reg
  - name: clk_count
    width: 16
    direction: reg

fsm:
  - name: UartTxFSM
    initial: IDLE
    encoding: onehot
    states:
      - IDLE
      - START_BIT
      - DATA_BITS
      - STOP_BIT
      - CLEANUP

types:
  UartState:
    description: "UART transmitter state"
    fields:
      tx_data: Int
      bit_index: Int
      clk_count: Int
      tx_active: Bool
      tx_done: Bool

behaviors:
  - name: clk
    given: "System clock input"
    when: "Function is called"
    then: "Returns Bool"
    returns: Bool
  - name: rst_n
    given: "Active-low reset"
    when: "Function is called"
    then: "Returns Bool"
    returns: Bool
  - name: tx_data
    given: "8-bit parallel data to transmit"
    when: "Function is called"
    then: "Returns Int"
    returns: Int
  - name: tx_start
    given: "Start transmission trigger"
    when: "Function is called"
    then: "Returns Bool"
    returns: Bool
  - name: tx_out
    given: "Serial data output (idle high)"
    when: "Function is called"
    then: "Returns Bool"
    returns: Bool
  - name: tx_busy
    given: "Transmitter busy flag"
    when: "Function is called"
    then: "Returns Bool"
    returns: Bool
  - name: tx_done
    given: "Transmission complete pulse"
    when: "Function is called"
    then: "Returns Bool"
    returns: Bool
  - name: tx_data_reg
    given: "Registered copy of transmit data"
    when: "Function is called"
    then: "Returns Int"
    returns: Int
  - name: bit_index
    given: "Current bit index (0-7)"
    when: "Function is called"
    then: "Returns Int"
    returns: Int
  - name: clk_count
    given: "Baud rate clock counter"
    when: "Function is called"
    then: "Returns Int"
    returns: Int
  - name: uart_tx_process
    given: "Current state, start signal, and data"
    when: "Rising edge of clock"
    then: "Updates state machine and outputs"
    hdl_type: sequential
    clock: clk
    reset: rst_n
    params:
      - name: state
        type: UartState
      - name: tx_start
        type: Bool
      - name: tx_data
        type: Int
    returns: UartState
  - name: get_tx_bit
    given: "Current state"
    when: "Output is requested"
    then: "Returns appropriate bit (start=0, data, stop=1)"
    hdl_type: combinational
    sensitivity: [*]
    params:
      - name: state
        type: UartState
    returns: Bool
  - name: get_busy
    given: "Transmitter active flag"
    when: "Status requested"
    then: "Returns busy state"
    hdl_type: combinational
    sensitivity: [*]
    params:
      - name: tx_active
        type: Bool
    returns: Bool
  - name: calculate_clks_per_bit
    given: "Clock frequency and baud rate"
    when: "Configuration needed"
    then: "Returns clock divider value"
    params:
      - name: clock_freq
        type: Int
      - name: baud_rate
        type: Int
    returns: Int
  - name: init_state
    given: "Reset condition"
    when: "Module initializes"
    then: "Returns idle state"
    returns: UartState
