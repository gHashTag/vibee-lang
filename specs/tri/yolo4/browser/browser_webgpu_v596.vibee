name: browser_webgpu_v596
version: "596.0.0"
language: zig
module: browser_webgpu_v596

types:
  WebGPUContext:
    fields:
      context_id: String
      adapter: String
      device: String
      queue: String
      phi_compute: Bool

  GPUBuffer:
    fields:
      buffer_id: String
      size: Int
      usage: String
      mapped: Bool

  ComputePipeline:
    fields:
      pipeline_id: String
      shader: String
      bind_group_layout: String
      workgroup_size: List<Int>

  WebGPUMetrics:
    fields:
      dispatches: Int
      buffer_uploads: Int
      compute_time_us: Float
      phi_throughput: Float

behaviors:
  - name: initialize_gpu
    given: GPU config
    when: Initialization
    then: Get adapter and device

  - name: create_buffer
    given: Buffer config
    when: Buffer creation
    then: Allocate GPU buffer

  - name: create_pipeline
    given: Shader code
    when: Pipeline creation
    then: Compile compute pipeline

  - name: dispatch_compute
    given: Pipeline and data
    When: Compute dispatch
    then: Run on GPU

  - name: read_buffer
    given: GPU buffer
    When: Read needed
    then: Copy to CPU

  - name: write_buffer
    given: Data and buffer
    When: Write needed
    then: Upload to GPU

  - name: phi_workgroups
    given: Problem size
    When: Workgroup sizing
    then: Size by phi ratio

  - name: get_metrics
    given: GPU state
    When: Metrics query
    then: Return GPU metrics
