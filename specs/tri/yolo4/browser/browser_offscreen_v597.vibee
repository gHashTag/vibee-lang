name: browser_offscreen_v597
version: "597.0.0"
language: zig
module: browser_offscreen_v597

types:
  OffscreenCanvas:
    fields:
      canvas_id: String
      width: Int
      height: Int
      context_type: String
      phi_rendering: Bool

  OffscreenContext:
    fields:
      context_id: String
      canvas_id: String
      context_type: String
      attributes: Object

  RenderResult:
    fields:
      result_id: String
      image_bitmap: String
      render_time_us: Int

  OffscreenMetrics:
    fields:
      frames_rendered: Int
      avg_frame_time_us: Float
      transfers: Int
      phi_efficiency: Float

behaviors:
  - name: create_offscreen
    given: Dimensions
    when: Canvas creation
    then: Create offscreen canvas

  - name: get_context
    given: Context type
    when: Context needed
    then: Get rendering context

  - name: render_frame
    given: Render commands
    when: Rendering
    then: Render to offscreen

  - name: transfer_to_main
    given: Rendered frame
    When: Transfer needed
    then: Send to main thread

  - name: convert_to_blob
    given: Canvas content
    When: Blob needed
    then: Export as blob

  - name: resize_canvas
    given: New dimensions
    When: Resize needed
    then: Update canvas size

  - name: phi_batch_render
    given: Multiple frames
    When: Batching beneficial
    then: Batch render

  - name: get_metrics
    given: Canvas state
    When: Metrics query
    then: Return offscreen metrics
