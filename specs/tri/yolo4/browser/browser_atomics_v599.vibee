name: browser_atomics_v599
version: "599.0.0"
language: zig
module: browser_atomics_v599

types:
  AtomicsOp:
    fields:
      op_id: String
      operation: String
      array: String
      index: Int
      value: Option<Int>

  AtomicLock:
    fields:
      lock_id: String
      array: String
      index: Int
      held: Bool

  WaitResult:
    fields:
      result: String
      waited_ms: Int
      value_changed: Bool

  AtomicsMetrics:
    fields:
      atomic_ops: Int
      waits: Int
      notifies: Int
      phi_contention: Float

behaviors:
  - name: atomic_load
    given: Array and index
    when: Load needed
    then: Atomic read

  - name: atomic_store
    given: Array, index, value
    when: Store needed
    then: Atomic write

  - name: atomic_add
    given: Array, index, value
    when: Add needed
    then: Atomic add

  - name: compare_exchange
    given: Array, index, expected, desired
    When: CAS needed
    then: Compare and swap

  - name: wait
    given: Array, index, value, timeout
    When: Wait needed
    then: Block until change

  - name: notify
    given: Array, index, count
    When: Notify needed
    then: Wake waiting threads

  - name: acquire_lock
    given: Lock
    When: Lock needed
    then: Spin until acquired

  - name: release_lock
    given: Lock
    When: Unlock needed
    then: Release lock

  - name: get_metrics
    given: Atomics state
    When: Metrics query
    then: Return atomics metrics
