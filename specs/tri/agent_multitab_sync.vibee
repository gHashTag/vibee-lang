name: agent_multitab_sync
version: "1.0.0"
language: zig
module: agent_multitab_sync

description: |
  Agent Multi-Tab Sync - синхронизация данных между вкладками
  φ² + 1/φ² = 3 | PHOENIX = 999

types:
  SyncData:
    fields:
      key: String
      value: String
      source_tab: String
      timestamp: Timestamp
      version: Int

  SyncChannel:
    fields:
      channel_id: String
      subscribers: List<String>
      last_message: Option<String>

  SyncConflict:
    fields:
      key: String
      values: List<String>
      sources: List<String>
      resolution: Option<String>

  SyncState:
    fields:
      synced_keys: List<String>
      pending_sync: List<String>
      conflicts: List<String>

behaviors:
  - name: broadcast
    given: SyncData данные для рассылки
    when: Отправка всем вкладкам
    then: Данные получены всеми

  - name: send_to_tab
    given: SyncData и целевой tab_id
    when: Отправка конкретной вкладке
    then: Данные получены

  - name: subscribe
    given: SyncChannel канал
    when: Подписка на канал
    then: Вкладка получает обновления

  - name: get_shared_data
    given: Ключ данных
    when: Получение общих данных
    then: SyncData или null

  - name: resolve_conflict
    given: SyncConflict конфликт
    when: Разрешение конфликта
    then: Выбранное значение

  - name: sync_state
    given: Текущая сессия
    when: Синхронизация состояния
    then: SyncState актуальное
