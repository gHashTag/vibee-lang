# iGLA Binary Quantization
# 1-bit binary quantization for ultra-fast search
# Scientific basis: Gong et al. 2013, Shen et al. 2015
# φ² + 1/φ² = 3 | V = n × 3^k × π^m × φ^p

name: igla_quantization_binary
version: "1.0.0"
language: zig
module: igla_quantization_binary

sacred_constants:
  phi: 1.618033988749895
  trinity: 3.0
  phoenix: 999

scientific_references:
  - "Gong et al. 2013: Iterative Quantization"
  - "Shen et al. 2015: Supervised Discrete Hashing"
  - "Wang et al. 2018: A Survey on Learning to Hash"

types:
  BinaryConfig:
    fields:
      dim: Int
      threshold: Float
      use_mean: Bool

  BinaryVector:
    fields:
      bits: String
      num_bits: Int
      original_norm: Float

  BinaryIndex:
    fields:
      vectors: String
      count: Int
      dim: Int

  HammingResult:
    fields:
      id: Int
      hamming_distance: Int
      estimated_cosine: Float

  HashFunction:
    fields:
      projection: String
      threshold: Float

  BinaryStats:
    fields:
      compression_ratio: Float
      recall_at_100: Float
      search_speedup: Float

behaviors:
  - name: binarize_sign
    given: "FP32 vector"
    when: "Sign binarization"
    then: "Binary vector (sign of each dim)"

  - name: binarize_threshold
    given: "FP32 vector, threshold"
    when: "Threshold binarization"
    then: "Binary vector (above/below threshold)"

  - name: hamming_distance
    given: "Two binary vectors"
    when: "Distance computation"
    then: "Hamming distance (popcount XOR)"

  - name: hamming_search
    given: "Query binary, index, k"
    when: "Binary search"
    then: "K nearest by Hamming"

  - name: estimate_cosine
    given: "Hamming distance, dim"
    when: "Cosine estimation"
    then: "Estimated cosine similarity"

  - name: multi_probe
    given: "Query, num_probes"
    when: "Multi-probe search"
    then: "Results from multiple buckets"

  - name: learn_hash_functions
    given: "Training vectors"
    when: "Hash learning"
    then: "Optimized hash functions"

  - name: phi_binary_threshold
    given: "Vector distribution"
    when: "Sacred threshold"
    then: "φ-optimal threshold"
