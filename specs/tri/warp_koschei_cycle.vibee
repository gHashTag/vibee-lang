name: warp_koschei_cycle
version: "1.0.0"
language: zig
module: warp_koschei_cycle

description: |
  WARP Koschei Cycle - бессмертный цикл улучшений
  ЗАЯЦ → УТКА → ЯЙЦО → ИГЛА → СМЕРТЬ → ВОЗРОЖДЕНИЕ
  Каждый цикл: +φ% улучшение (1.618%)
  φ² + 1/φ² = 3 | PHOENIX = 999

types:
  KoscheiStage:
    fields:
      name: String
      description: String
      duration_ms: Float
      success: Bool
      output: String

  KoscheiCycle:
    fields:
      cycle_number: Int
      stages: List<String>
      total_time_ms: Float
      improvement_percent: Float
      lessons_learned: List<String>

  KoscheiState:
    fields:
      current_stage: String
      cycles_completed: Int
      total_improvement: Float
      immortal: Bool

  KoscheiConfig:
    fields:
      max_cycles: Int
      target_improvement: Float
      auto_continue: Bool
      phi_factor: Float

  KoscheiMetrics:
    fields:
      cycles_run: Int
      avg_cycle_time_ms: Float
      cumulative_improvement: Float
      best_cycle_improvement: Float

behaviors:
  - name: start_cycle
    given: KoscheiConfig конфигурация
    when: Начало нового цикла
    then: KoscheiState инициализирован

  - name: execute_hare
    given: Входные данные (ЗАЯЦ)
    when: Этап получения задачи
    then: KoscheiStage с задачей

  - name: execute_duck
    given: Задача (УТКА)
    when: Этап трансформации в план
    then: KoscheiStage с планом

  - name: execute_egg
    given: План (ЯЙЦО)
    when: Этап оптимизации плана
    then: KoscheiStage с оптимизированным планом

  - name: execute_needle
    given: Оптимизированный план (ИГЛА)
    when: Этап выполнения
    then: KoscheiStage с результатом

  - name: execute_death
    given: Результат (СМЕРТЬ)
    when: Этап завершения и оценки
    then: KoscheiStage с метриками

  - name: resurrect
    given: KoscheiCycle завершённый цикл
    when: Возрождение с улучшениями
    then: Новый цикл с +φ% улучшением
