# ═══════════════════════════════════════════════════════════════════════════════
# SCHEDULER v972 - Learning Rate Scheduler
# ═══════════════════════════════════════════════════════════════════════════════
# φ² + 1/φ² = 3 | PHOENIX = 999 | V = n × 3^k × π^m × φ^p × e^q
# ═══════════════════════════════════════════════════════════════════════════════

name: scheduler
version: "9.7.2"
language: zig
module: scheduler

sacred_constants:
  phi: 1.618033988749895
  trinity: 3.0
  phoenix: 999

creation_pattern:
  source: TrainingStep
  transformer: LRScheduler
  result: LearningRate

types:
  SchedulerConfig:
    fields:
      warmup_steps: Int
      total_steps: Int
      min_lr: Float
      max_lr: Float

  SchedulerState:
    fields:
      current_step: Int
      current_lr: Float

behaviors:
  - name: cosine_schedule
    given: "Step and config"
    when: "Cosine annealing"
    then: "Learning rate"
    pas_pattern: ALG
    test_cases:
      - name: test_cosine
        input: '{"step": 1000, "total": 10000}'
        expected: '{"lr": 0.00009}'

  - name: warmup_schedule
    given: "Step in warmup"
    when: "Linear warmup"
    then: "Warmed up LR"
    pas_pattern: ALG
    test_cases:
      - name: test_warmup
        input: '{"step": 100, "warmup": 1000}'
        expected: '{"lr": 0.00001}'

  - name: phi_schedule
    given: "Step with φ decay"
    when: "Sacred schedule"
    then: "φ-decayed LR"
    pas_pattern: ALG
    test_cases:
      - name: test_phi
        input: '{"step": 1000, "phi_factor": 1.618}'
        expected: '{"lr": 0.00006, "phi_applied": true}'

  - name: step_schedule
    given: "Step and milestones"
    when: "Step decay"
    then: "Stepped LR"
    pas_pattern: ALG
    test_cases:
      - name: test_step
        input: '{"step": 5000, "milestones": [3000, 6000]}'
        expected: '{"lr": 0.00001}'

  - name: get_lr
    given: "Current state"
    when: "LR query"
    then: "Current LR"
    pas_pattern: PRE
    test_cases:
      - name: test_get
        input: '{"state": {...}}'
        expected: '{"lr": 0.0001}'

# ═══════════════════════════════════════════════════════════════════════════════
# φ² + 1/φ² = 3 | PHOENIX = 999
# ═══════════════════════════════════════════════════════════════════════════════
