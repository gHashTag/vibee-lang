# FFI Erlang v56530 - Erlang NIFs/Port Drivers
# VIBEE → Erlang Native Bindings
# φ² + 1/φ² = 3 | PHOENIX = 999

name: ffi_erlang_v56530
version: "56.5.30"
language: zig
module: ffi_erlang

creation_pattern:
  source: VibeeSpec
  transformer: ErlangBindingsGenerator
  result: ErlangNIF

types:
  ErlNifTerm:
    fields:
      type_tag: String
      value: Int

  ErlNifFunc:
    fields:
      name: String
      arity: Int
      fptr: String
      flags: Int

  ErlNifResourceType:
    fields:
      name: String
      dtor: Option<String>
      down: Option<String>

  ErlangModule:
    fields:
      name: String
      exports: List<String>
      nif_funcs: List<ErlNifFunc>
      on_load: Option<String>

  PortDriver:
    fields:
      name: String
      init: String
      start: String
      stop: String
      output: String

  RebarConfig:
    fields:
      app_name: String
      port_specs: List<String>
      pre_hooks: List<String>

  ErlangNIF:
    fields:
      module: ErlangModule
      c_source: String
      rebar_config: RebarConfig

  ErlNifEnv:
    fields:
      is_process_bound: Bool
      heap_size: Int

behaviors:
  - name: generate_erlang_nif
    given: VibeeSpec
    when: Erlang NIF needed
    then: ErlangNIF files

  - name: generate_nif_func
    given: C function
    when: NIF function needed
    then: ErlNifFunc

  - name: map_vibee_to_erl_term
    given: Vibee type
    when: Type mapping needed
    then: ERL_NIF_TERM

  - name: generate_resource_type
    given: C type
    when: Resource type needed
    then: ErlNifResourceType

  - name: generate_port_driver
    given: VibeeSpec
    when: Port driver needed
    then: PortDriver

  - name: generate_rebar_config
    given: Project config
    when: rebar.config needed
    then: RebarConfig

  - name: handle_enif_make
    given: C value
    when: Term creation needed
    then: enif_make_* call

  - name: handle_enif_get
    given: ERL_NIF_TERM
    when: Value extraction needed
    then: enif_get_* call
