# FFI Go CGO v56040 - Go cgo Integration
# VIBEE → Go with C interop
# φ² + 1/φ² = 3 | PHOENIX = 999

name: ffi_go_cgo_v56040
version: "56.0.40"
language: zig
module: ffi_go_cgo

creation_pattern:
  source: VibeeSpec
  transformer: GoCGOGenerator
  result: GoPackageWithCGO

types:
  GoType:
    fields:
      name: String
      go_name: String
      cgo_type: String
      is_pointer: Bool
      package_path: Option<String>

  GoFunction:
    fields:
      name: String
      receiver: Option<String>
      parameters: List<GoParam>
      returns: List<String>
      cgo_preamble: String
      body: String

  GoParam:
    fields:
      name: String
      type_name: String
      is_variadic: Bool

  GoStruct:
    fields:
      name: String
      fields: List<GoField>
      tags: List<String>
      methods: List<GoFunction>

  GoField:
    fields:
      name: String
      type_name: String
      tag: Option<String>
      embedded: Bool

  CGOPreamble:
    fields:
      includes: List<String>
      cflags: List<String>
      ldflags: List<String>
      code: String

  GoPackage:
    fields:
      name: String
      import_path: String
      cgo_preamble: CGOPreamble
      types: List<GoType>
      structs: List<GoStruct>
      functions: List<GoFunction>
      exports: List<String>

  GoModule:
    fields:
      name: String
      packages: List<GoPackage>
      go_mod: String
      go_sum: String

behaviors:
  - name: generate_cgo_preamble
    given: C headers and flags
    when: CGO setup needed
    then: import "C" block with preamble

  - name: generate_go_wrapper
    given: C function
    when: Go wrapper needed
    then: Go function calling C

  - name: map_vibee_to_go_type
    given: Vibee type
    when: Type mapping needed
    then: Go type with CGO equivalent

  - name: generate_go_struct
    given: Vibee struct
    when: Go struct needed
    then: Go struct with CGO conversion

  - name: generate_export_comment
    given: Go function
    when: C export needed
    then: //export directive

  - name: handle_go_string
    given: C string
    when: String conversion needed
    then: C.GoString/C.CString calls

  - name: handle_go_slice
    given: C array
    when: Slice conversion needed
    then: unsafe.Slice conversion

  - name: generate_go_mod
    given: Module config
    when: Go module needed
    then: go.mod file
