# v3901 - World Models
# =====================
# Environment simulation and prediction
# φ² + 1/φ² = 3 | PHOENIX = 999

name: world_models
version: "3.9.1"
language: zig
module: world_models

constants:
  PHI: 1.618033988749895
  LATENT_DIM: 256
  SEQUENCE_LENGTH: 50
  IMAGINATION_HORIZON: 15

types:
  WorldModelConfig:
    fields:
      latent_dim: Int
      hidden_size: Int
      num_layers: Int
      
  LatentState:
    fields:
      deterministic: List
      stochastic: List
      
  Observation:
    fields:
      image: List
      reward: Float
      done: Bool
      
  EncoderOutput:
    fields:
      latent: List
      reconstruction: List
      
  DynamicsModel:
    fields:
      transition: Object
      reward_predictor: Object
      continue_predictor: Object
      
  ImaginedTrajectory:
    fields:
      states: List
      rewards: List
      continues: List
      
  DreamerConfig:
    fields:
      imagination_horizon: Int
      discount: Float
      lambda_: Float

behaviors:
  - name: encode_observation
    given: Observation
    when: Encoding to latent
    then: Return latent state
    
  - name: decode_latent
    given: Latent state
    when: Reconstructing observation
    then: Return predicted observation
    
  - name: predict_next_state
    given: Current state and action
    when: Dynamics prediction
    then: Return next latent state
    
  - name: predict_reward
    given: Latent state
    when: Reward prediction
    then: Return predicted reward
    
  - name: imagine_trajectory
    given: Initial state and policy
    when: Imagining future
    then: Return imagined trajectory
    
  - name: train_world_model
    given: Experience buffer
    when: Learning dynamics
    then: Return updated model
    
  - name: actor_critic_imagination
    given: World model and policy
    when: Learning in imagination
    then: Return updated policy
    
  - name: compute_imagination_loss
    given: Imagined and real trajectories
    when: Comparing predictions
    then: Return prediction error
