# Bridge Error Handler
# Error classification and recovery
# Retry strategies

name: bridge_error_handler
version: "1.0.0"
language: zig
module: bridge_error_handler

types:
  BridgeError:
    fields:
      error_id: String
      error_type: String
      message: String
      is_recoverable: Bool
      original_request: Option<String>

  ErrorType:
    fields:
      type_name: String
      retry_strategy: String
      max_retries: Int

  RetryStrategy:
    fields:
      strategy_type: String
      initial_delay_ms: Int
      max_delay_ms: Int
      backoff_multiplier: Float

  ErrorContext:
    fields:
      context_id: String
      request_method: String
      attempt_number: Int
      last_error: String

  RecoveryAction:
    fields:
      action_type: String
      parameters: Map<String,String>

  ErrorStats:
    fields:
      total_errors: Int
      by_type: Map<String,Int>
      recovery_rate: Float

behaviors:
  - name: classify_error
    given: Error message and context
    when: Error classification needed
    then: Returns classified error

  - name: should_retry
    given: Error and attempt count
    when: Retry decision needed
    then: Returns retry decision

  - name: get_retry_delay
    given: Strategy and attempt
    when: Delay calculation needed
    then: Returns delay in milliseconds

  - name: create_recovery_action
    given: Error type
    When: Recovery action needed
    then: Returns recovery action

  - name: handle_connection_error
    given: Connection error
    when: Connection error handling needed
    then: Returns handling result

  - name: handle_timeout_error
    given: Timeout error
    when: Timeout handling needed
    then: Returns handling result

  - name: handle_protocol_error
    given: Protocol error
    when: Protocol error handling needed
    then: Returns handling result

  - name: record_error
    given: Error
    when: Error recording needed
    then: Returns recorded error

  - name: get_error_stats
    given: Time range
    when: Stats query needed
    then: Returns error statistics
