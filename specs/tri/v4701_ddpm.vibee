# v4701 - DDPM
# =============
# Denoising Diffusion Probabilistic Models
# φ² + 1/φ² = 3 | PHOENIX = 999

name: ddpm
version: "4.7.1"
language: zig
module: ddpm

constants:
  PHI: 1.618033988749895
  T: 1000
  BETA_1: 0.0001
  BETA_T: 0.02

types:
  DDPMConfig:
    fields:
      timesteps: Int
      beta_schedule: String
      loss_type: String
      
  ForwardProcess:
    fields:
      sqrt_alphas_cumprod: List
      sqrt_one_minus_alphas_cumprod: List
      
  ReverseProcess:
    fields:
      posterior_mean_coef1: List
      posterior_mean_coef2: List
      posterior_variance: List
      
  DDPMSample:
    fields:
      x_0: List
      x_t: List
      t: Int
      epsilon: List
      
  UNetConfig:
    fields:
      in_channels: Int
      out_channels: Int
      channels: List
      attention_resolutions: List
      
  TimeEmbedding:
    fields:
      dim: Int
      embedding: List
      
  DDPMLoss:
    fields:
      simple_loss: Float
      vlb_loss: Float
      hybrid_loss: Float
      
  SamplingTrajectory:
    fields:
      steps: List
      x_values: List

behaviors:
  - name: q_sample
    given: x_0, t, noise
    when: Forward process q(x_t|x_0)
    then: Вернуть x_t
    
  - name: q_posterior
    given: x_0, x_t, t
    when: Posterior q(x_{t-1}|x_t,x_0)
    then: Вернуть mean и variance
    
  - name: p_mean_variance
    given: Model, x_t, t
    when: Reverse process p(x_{t-1}|x_t)
    then: Вернуть predicted mean и variance
    
  - name: p_sample
    given: Model, x_t, t
    when: Один шаг sampling
    then: Вернуть x_{t-1}
    
  - name: p_sample_loop
    given: Model, shape
    when: Полный sampling loop
    then: Вернуть x_0
    
  - name: compute_simple_loss
    given: Epsilon pred и epsilon
    when: Simple MSE loss
    then: Вернуть loss
    
  - name: compute_vlb
    given: Model outputs и x_0
    when: Variational lower bound
    then: Вернуть VLB loss
    
  - name: sinusoidal_embedding
    given: Timestep и dim
    when: Time embedding
    then: Вернуть positional embedding
