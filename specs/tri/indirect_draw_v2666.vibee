# indirect_draw_v2666.vibee - Indirect Drawing
# Непрямой рендеринг с GPU-driven culling
# φ² + 1/φ² = 3 | PHOENIX = 999

name: indirect_draw_v2666
version: "2666.0.0"
language: zig
module: indirect_draw_v2666

types:
  IndirectCommand:
    fields:
      vertex_count: Int
      instance_count: Int
      first_vertex: Int
      first_instance: Int

  IndirectBuffer:
    fields:
      buffer_id: String
      command_count: Int
      stride: Int
      count_buffer: String

  DrawIndirectArgs:
    fields:
      index_count: Int
      instance_count: Int
      first_index: Int
      vertex_offset: Int
      first_instance: Int

  IndirectStats:
    fields:
      commands_executed: Int
      instances_drawn: Int
      cpu_overhead_saved_ms: Float
      gpu_culled: Int

  IndirectConfig:
    fields:
      max_commands: Int
      gpu_culling: Bool
      count_from_gpu: Bool
      multi_draw: Bool

behaviors:
  - name: create_buffer
    given: Command count
    when: Buffer creation
    then: Return IndirectBuffer

  - name: fill_commands
    given: Draw data
    when: Command generation
    then: Fill buffer

  - name: execute_indirect
    given: IndirectBuffer
    when: Draw call
    then: GPU executes commands

  - name: gpu_cull
    given: Visibility data
    when: Culling pass
    then: Update command counts

  - name: get_stats
    given: None
    when: Stats query
    then: Return IndirectStats

sacred_constants:
  phi: 1.618033988749895
  phoenix: 999
