name: bottleneck_cdp_client
version: "1.0.0"
language: zig
module: bottleneck_cdp_client

# BOTTLENECK: Chrome DevTools Protocol Client
# Zig WebSocket client for CDP communication
# Mirrors existing cdp-client.js but faster

types:
  CDPConfig:
    fields:
      host: String
      port: Int
      page_id: Option<String>

  CDPConnection:
    fields:
      ws_url: String
      connected: Bool
      message_id: Int

  CDPCommand:
    fields:
      method: String
      params: String
      id: Int

  CDPResponse:
    fields:
      id: Int
      result: Option<String>
      error: Option<String>

  CDPEvent:
    fields:
      method: String
      params: String

  DOMNode:
    fields:
      node_id: Int
      tag_name: String
      attributes: Map<String,String>
      text_content: Option<String>

behaviors:
  - name: connect
    given: CDPConfig with host and port
    when: Establishing CDP connection
    then: Return CDPConnection handle

  - name: send_command
    given: CDPConnection and CDPCommand
    when: Sending CDP command
    then: Return CDPResponse

  - name: navigate
    given: CDPConnection and URL
    when: Navigating browser to URL
    then: Return navigation result

  - name: click
    given: CDPConnection and selector
    when: Clicking element
    then: Return click result

  - name: type_text
    given: CDPConnection, selector, text
    when: Typing into input
    then: Return type result

  - name: screenshot
    given: CDPConnection and format
    when: Taking page screenshot
    then: Return base64 image data

  - name: get_dom
    given: CDPConnection
    when: Getting page DOM
    then: Return DOM tree as string

  - name: evaluate
    given: CDPConnection and JS expression
    when: Evaluating JavaScript
    then: Return evaluation result
