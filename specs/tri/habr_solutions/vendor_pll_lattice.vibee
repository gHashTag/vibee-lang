# ═══════════════════════════════════════════════════════════════════════════════
# VENDOR PLL LATTICE - PLL обертка для Lattice FPGA
# ═══════════════════════════════════════════════════════════════════════════════
# Решение проблемы mozg37: Поддержка Lattice PLL примитивов
#
# Sacred Formula: V = n × 3^k × π^m × φ^p × e^q
# Golden Identity: φ² + 1/φ² = 3 | PHOENIX = 999
# ═══════════════════════════════════════════════════════════════════════════════

name: vendor_pll_lattice
version: "1.0.0"
language: varlog
module: vendor_pll_lattice
vendor: lattice
author: "VIBEE Team"

# ═══════════════════════════════════════════════════════════════════════════════
# LATTICE PLL PRIMITIVES
# ═══════════════════════════════════════════════════════════════════════════════

lattice_primitives:
  pll:
    name: "PLL"
    description: "Phase-Locked Loop for Lattice FPGAs"
    families: ["ECP5", "ECP3", "MachXO2", "MachXO3"]

# ═══════════════════════════════════════════════════════════════════════════════
# TYPES
# ═══════════════════════════════════════════════════════════════════════════════

types:
  PLLConfig:
    description: "PLL configuration parameters (Lattice)"
    fields:
      input_frequency: Float
      output_frequencies: List<Float>
      phase_shifts: List<Float>
    width: 128
    
  PLLStatus:
    description: "PLL status signals (Lattice)"
    fields:
      lock: Bool
    width: 1

# ═══════════════════════════════════════════════════════════════════════════════
# INTERFACES
# ═══════════════════════════════════════════════════════════════════════════════

interfaces:
  clk_rst:
    - clki: input
    - rst: input
    
  clk_outputs:
    - clko: output
    - clkop: output
    
  status:
    - lock: output

# ═══════════════════════════════════════════════════════════════════════════════
# BEHAVIORS
# ═══════════════════════════════════════════════════════════════════════════════

behaviors:
  - name: instantiate_lattice_pll
    given: PLL configuration and input clock
    when: Lattice PLL primitive needed
    then: Instantiate PLL with calculated parameters
    params:
      - name: config
        type: PLLConfig

  - name: calculate_lattice_pll_params
    given: Input frequency and output frequencies
    when: Parameter calculation needed
    then: Calculate PLL parameters for Lattice FPGA
    params:
      - name: input_freq
        type: Float
      - name: output_freqs
        type: List<Float>
    returns: LatticePLLParams

test_cases:
  - name: test_lattice_pll_25mhz_to_100mhz
    given: 25MHz input clock
    when: Generate 100MHz output
    then: PLL instantiated with correct parameters
