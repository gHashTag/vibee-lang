# v4603 - BYOL/SimSiam
# =====================
# SSL без негативных примеров
# φ² + 1/φ² = 3 | PHOENIX = 999

name: byol_simsiam
version: "4.6.3"
language: zig
module: byol_simsiam

constants:
  PHI: 1.618033988749895
  BASE_MOMENTUM: 0.996
  PREDICTOR_HIDDEN: 4096
  PROJECTION_DIM: 256

types:
  BYOLConfig:
    fields:
      base_momentum: Float
      projection_dim: Int
      predictor_hidden: Int
      
  OnlineNetwork:
    fields:
      encoder: Object
      projector: Object
      predictor: Object
      
  TargetNetwork:
    fields:
      encoder: Object
      projector: Object
      
  SimSiamConfig:
    fields:
      projection_dim: Int
      predictor_hidden: Int
      
  PredictorMLP:
    fields:
      hidden_dim: Int
      output_dim: Int
      
  BYOLLoss:
    fields:
      loss: Float
      online_norm: Float
      target_norm: Float
      
  CollapseMetrics:
    fields:
      std: Float
      correlation: Float
      rank: Int
      
  MomentumSchedule:
    fields:
      base_value: Float
      final_value: Float
      schedule_type: String

behaviors:
  - name: byol_forward
    given: Views и online/target networks
    when: BYOL forward pass
    then: Вернуть predictions и targets
    
  - name: compute_byol_loss
    given: Online prediction и target
    when: Cosine similarity loss
    then: Вернуть symmetrized loss
    
  - name: simsiam_forward
    given: Views и network
    when: SimSiam forward pass
    then: Вернуть z и p
    
  - name: compute_simsiam_loss
    given: z1, z2, p1, p2
    when: Stop-gradient loss
    then: Вернуть negative cosine similarity
    
  - name: update_target_network
    given: Online, target, momentum
    when: EMA update
    then: Вернуть обновлённый target
    
  - name: schedule_momentum
    given: Step и schedule
    when: Momentum scheduling
    then: Вернуть текущий momentum
    
  - name: detect_collapse
    given: Representations
    when: Проверка коллапса
    then: Вернуть collapse metrics
    
  - name: predictor_forward
    given: Projection и predictor
    when: Predictor MLP
    then: Вернуть prediction
