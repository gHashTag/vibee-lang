# iGLA Dense Embeddings v2
# MiniLM-based dense vector embeddings (384-dim)
# Scientific basis: Reimers & Gurevych 2019 (Sentence-BERT)
# φ² + 1/φ² = 3 | V = n × 3^k × π^m × φ^p

name: igla_dense_embeddings
version: "2.0.0"
language: zig
module: igla_dense_embeddings

sacred_constants:
  phi: 1.618033988749895
  trinity: 3.0
  phoenix: 999
  embedding_dim: 384

scientific_references:
  - "Reimers & Gurevych 2019: Sentence-BERT"
  - "Wang et al. 2020: MiniLM"
  - "Gao et al. 2021: SimCSE"
  - "Xiao et al. 2023: C-Pack"

types:
  DenseConfig:
    fields:
      model_name: String
      embedding_dim: Int
      max_seq_length: Int
      pooling_strategy: String
      normalize: Bool

  DenseVector:
    fields:
      values: String
      dim: Int
      norm: Float

  TokenizedInput:
    fields:
      input_ids: String
      attention_mask: String
      token_count: Int

  PoolingOutput:
    fields:
      cls_embedding: String
      mean_embedding: String
      max_embedding: String

  MatryoshkaEmbedding:
    fields:
      full_dim: String
      half_dim: String
      quarter_dim: String
      eighth_dim: String

behaviors:
  - name: tokenize_text
    given: "Raw text input"
    when: "Tokenization requested"
    then: "TokenizedInput with BPE tokens"

  - name: forward_pass
    given: "TokenizedInput"
    when: "Model inference"
    then: "Hidden states from transformer"

  - name: mean_pooling
    given: "Hidden states, attention mask"
    when: "Pooling"
    then: "Mean-pooled embedding"

  - name: cls_pooling
    given: "Hidden states"
    when: "CLS pooling"
    then: "CLS token embedding"

  - name: normalize_l2
    given: "DenseVector"
    when: "Normalization"
    then: "Unit-norm vector"

  - name: matryoshka_truncate
    given: "Full embedding, target_dim"
    when: "Dimension reduction"
    then: "Truncated embedding preserving quality"

  - name: batch_encode
    given: "List of texts"
    when: "Batch encoding"
    then: "List of DenseVectors"

  - name: cosine_similarity_dense
    given: "Two DenseVectors"
    when: "Similarity computation"
    then: "Cosine similarity in [-1, 1]"

  - name: phi_harmonic_projection
    given: "DenseVector"
    when: "Sacred projection"
    then: "φ-aligned vector space"
