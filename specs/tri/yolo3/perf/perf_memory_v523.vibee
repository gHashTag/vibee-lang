name: perf_memory_v523
version: "523.0.0"
language: zig
module: perf_memory_v523

types:
  MemoryBenchmark:
    fields:
      benchmark_id: String
      workload_type: String
      duration_ms: Int
      sample_interval_ms: Int

  HeapMetrics:
    fields:
      heap_size_mb: Float
      heap_used_mb: Float
      external_mb: Float
      array_buffers_mb: Float

  AllocationMetrics:
    fields:
      allocations_per_second: Float
      bytes_allocated: Int
      peak_allocation_mb: Float
      fragmentation_ratio: Float

  GCMetrics:
    fields:
      gc_count: Int
      gc_time_ms: Float
      major_gc_count: Int
      minor_gc_count: Int

  MemoryBenchmarkResult:
    fields:
      benchmark_id: String
      heap_metrics: Object
      allocation_metrics: Object
      gc_metrics: Object
      leaks_detected: List<Object>

behaviors:
  - name: run_heap_benchmark
    given: Workload
    when: Benchmark requested
    then: Return heap metrics

  - name: run_allocation_benchmark
    given: Allocation pattern
    when: Benchmark requested
    then: Return allocation metrics

  - name: run_gc_benchmark
    given: GC scenario
    when: Benchmark requested
    then: Return GC metrics

  - name: detect_leaks
    given: Memory snapshots
    when: Leak detection
    then: Return detected leaks

  - name: profile_allocations
    given: Code path
    when: Profiling needed
    then: Return allocation profile

  - name: compare_memory_usage
    given: Scenarios
    when: Comparison needed
    then: Return comparison

  - name: generate_report
    given: All metrics
    when: Report needed
    then: Return memory report

  - name: suggest_optimizations
    given: Metrics
    when: Suggestions needed
    then: Return optimization tips

  - name: visualize_heap
    given: Heap snapshot
    when: Visualization needed
    then: Return heap visualization
