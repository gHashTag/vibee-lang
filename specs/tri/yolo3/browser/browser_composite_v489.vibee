name: browser_composite_v489
version: "489.0.0"
language: zig
module: browser_composite_v489

types:
  CompositorLayer:
    fields:
      layer_id: Int
      texture_id: Int
      bounds: Object
      transform: Object
      opacity: Float
      blend_mode: String

  CompositorFrame:
    fields:
      frame_id: Int
      layers: List<Int>
      damage_rects: List<Object>
      timestamp: Timestamp

  TileGrid:
    fields:
      tile_size: Int
      columns: Int
      rows: Int
      tiles: List<Int>

  ScrollingLayer:
    fields:
      layer_id: Int
      scroll_offset_x: Float
      scroll_offset_y: Float
      content_size: Object
      viewport_size: Object

  AnimationFrame:
    fields:
      frame_number: Int
      timestamp: Timestamp
      animations: List<Object>
      needs_composite: Bool

behaviors:
  - name: create_layer
    given: Layer properties
    when: Layer needed
    then: Allocate compositor layer

  - name: update_layer_transform
    given: Layer and transform
    when: Transform changed
    then: Update layer matrix

  - name: composite_frame
    given: All layers
    when: Frame requested
    then: Merge layers to output

  - name: handle_scroll
    given: Scroll delta
    when: Scroll event
    then: Update scroll layers

  - name: animate_layer
    given: Animation parameters
    when: Animation frame
    then: Interpolate properties

  - name: rasterize_tile
    given: Tile coordinates
    when: Tile needed
    then: Rasterize tile content

  - name: discard_tiles
    given: Off-screen tiles
    when: Memory pressure
    then: Free tile memory

  - name: sync_to_display
    given: Compositor frame
    when: VSync signal
    then: Present to screen

  - name: get_frame_timing
    given: Frame context
    when: Query timing
    then: Return frame metrics
