name: agent_auth_v499
version: "499.0.0"
language: zig
module: agent_auth_v499

types:
  AuthAgent:
    fields:
      agent_id: String
      auth_state: String
      credentials: Option<Object>
      tokens: Map<String,String>

  AuthCredentials:
    fields:
      username: String
      password: String
      totp_secret: Option<String>
      api_key: Option<String>

  AuthSession:
    fields:
      session_id: String
      user_id: String
      expires_at: Timestamp
      refresh_token: Option<String>

  OAuthConfig:
    fields:
      provider: String
      client_id: String
      client_secret: String
      redirect_uri: String
      scopes: List<String>

  AuthResult:
    fields:
      success: Bool
      session: Option<Object>
      error_message: Option<String>
      requires_2fa: Bool

behaviors:
  - name: detect_login_form
    given: Page content
    when: Login detection
    then: Return login form if found

  - name: login_basic
    given: Username and password
    when: Basic auth requested
    then: Perform login

  - name: login_oauth
    given: OAuth config
    when: OAuth requested
    then: Complete OAuth flow

  - name: handle_2fa
    given: 2FA challenge
    when: 2FA required
    then: Submit 2FA code

  - name: generate_totp
    given: TOTP secret
    when: TOTP needed
    then: Generate current code

  - name: refresh_session
    given: Refresh token
    when: Session expired
    then: Obtain new tokens

  - name: logout
    given: Active session
    when: Logout requested
    then: End session

  - name: check_auth_state
    given: Current page
    when: Auth check
    then: Return auth status

  - name: store_credentials
    given: Credentials
    when: Save requested
    then: Securely store
