name: minimal_http_client_v22
version: "22.6.0"
language: zig
module: minimal_http_client_v22

types:
  HttpMethod:
    fields:
      name: String

  HttpRequest:
    fields:
      method: String
      url: String
      headers: Object
      body: Option<String>

  HttpResponse:
    fields:
      status: Int
      headers: Object
      body: String
      duration_ms: Int

  HttpError:
    fields:
      code: String
      message: String

  HttpClient:
    fields:
      base_url: String
      timeout_ms: Int
      headers: Object

behaviors:
  - name: create_client
    given: Base URL
    when: Initialize client
    then: HttpClient instance

  - name: get
    given: HttpClient and path
    when: Send GET request
    then: HttpResponse

  - name: post
    given: HttpClient and path and body
    when: Send POST request
    then: HttpResponse

  - name: post_json
    given: HttpClient and path and json
    when: Send JSON POST
    then: HttpResponse

  - name: set_header
    given: HttpClient and name and value
    when: Set header
    then: Updated client

  - name: set_timeout
    given: HttpClient and timeout_ms
    when: Set timeout
    then: Updated client

  - name: request
    given: HttpClient and HttpRequest
    when: Send request
    then: HttpResponse

  - name: is_success
    given: HttpResponse
    when: Check success
    then: Boolean

  - name: get_json
    given: HttpResponse
    when: Parse JSON body
    then: Parsed JSON

  - name: close
    given: HttpClient
    when: Close client
    then: Closed
