# VIBEE Specification - IGLA Browser Actions
# High-level browser automation actions
# Browser Automation v4
# φ² + 1/φ² = 3 | PHOENIX = 999

name: igla_browser_actions
version: "4.0.0"
language: zig
module: igla_browser_actions

types:
  BrowserContext:
    fields:
      id: String
      cdp_url: String
      viewport_width: Int
      viewport_height: Int
      user_agent: String
      headless: Bool

  Page:
    fields:
      id: String
      url: String
      title: String
      ready_state: String
      frame_count: Int

  Element:
    fields:
      selector: String
      tag_name: String
      text_content: String
      inner_html: String
      bounding_box: String
      visible: Bool
      enabled: Bool

  ClickOptions:
    fields:
      button: String
      click_count: Int
      delay_ms: Int
      force: Bool
      modifiers: String

  TypeOptions:
    fields:
      delay_ms: Int
      clear_first: Bool
      press_enter: Bool

  WaitOptions:
    fields:
      timeout_ms: Int
      state: String
      poll_interval_ms: Int

  NavigationOptions:
    fields:
      timeout_ms: Int
      wait_until: String
      referer: String

  ScreenshotOptions:
    fields:
      full_page: Bool
      format: String
      quality: Int
      clip_x: Int
      clip_y: Int
      clip_width: Int
      clip_height: Int

  ScrollOptions:
    fields:
      x: Int
      y: Int
      behavior: String

  SelectOption:
    fields:
      value: String
      label: String
      index: Int

  FileUpload:
    fields:
      selector: String
      file_paths: String

  ActionResult:
    fields:
      success: Bool
      error_message: String
      duration_ms: Int
      screenshot: String

  ActionMetrics:
    fields:
      total_actions: Int
      successful_actions: Int
      failed_actions: Int
      avg_duration_ms: Float

behaviors:
  - name: goto
    given: Browser context
    when: Navigate to URL
    then: Page loaded with content

  - name: click
    given: Element selector
    when: Click action performed
    then: Element clicked successfully

  - name: double_click
    given: Element selector
    when: Double click performed
    then: Element double-clicked

  - name: right_click
    given: Element selector
    when: Right click performed
    then: Context menu triggered

  - name: hover
    given: Element selector
    when: Mouse hover performed
    then: Element hovered

  - name: type_text
    given: Element selector and text
    when: Type action performed
    then: Text entered into element

  - name: clear
    given: Input element
    when: Clear action performed
    then: Input value cleared

  - name: select_option
    given: Select element
    when: Option selected
    then: Option value set

  - name: check
    given: Checkbox element
    when: Check action performed
    then: Checkbox checked

  - name: uncheck
    given: Checkbox element
    when: Uncheck action performed
    then: Checkbox unchecked

  - name: upload_file
    given: File input element
    when: File uploaded
    then: File attached to input

  - name: scroll_to
    given: Target coordinates or element
    when: Scroll performed
    then: Viewport scrolled

  - name: wait_for_selector
    given: CSS selector
    when: Wait initiated
    then: Element found or timeout

  - name: wait_for_navigation
    given: Navigation trigger
    when: Wait initiated
    then: Navigation complete

  - name: wait_for_network_idle
    given: Network activity
    when: Wait initiated
    then: Network idle detected

  - name: get_text
    given: Element selector
    when: Text extraction requested
    then: Text content returned

  - name: get_attribute
    given: Element and attribute name
    when: Attribute requested
    then: Attribute value returned

  - name: get_value
    given: Input element
    when: Value requested
    then: Input value returned

  - name: is_visible
    given: Element selector
    when: Visibility check
    then: Boolean visibility status

  - name: is_enabled
    given: Element selector
    when: Enabled check
    then: Boolean enabled status

  - name: screenshot
    given: Page or element
    when: Screenshot requested
    then: Image data returned

  - name: pdf
    given: Page content
    when: PDF export requested
    then: PDF data returned

  - name: evaluate
    given: JavaScript expression
    when: Script evaluated
    then: Result returned

  - name: get_metrics
    given: Action history
    when: Metrics requested
    then: Action statistics returned

test_cases:
  - name: test_goto
    input: { url: "https://example.com" }
    expected: { success: true }

  - name: test_click
    input: { selector: "#button" }
    expected: { success: true }

  - name: test_type
    input: { selector: "#input", text: "hello" }
    expected: { success: true }

  - name: test_wait
    input: { selector: ".loaded", timeout_ms: 5000 }
    expected: { found: true }

  - name: test_screenshot
    input: { full_page: true, format: "png" }
    expected: { has_data: true }

  - name: test_evaluate
    input: { expression: "1 + 1" }
    expected: { result: 2 }

  - name: test_scroll
    input: { x: 0, y: 500 }
    expected: { scrolled: true }

  - name: test_metrics
    input: {}
    expected: { total_actions: 0 }
