# v3903 - Tool Use
# =================
# External tool integration for agents
# φ² + 1/φ² = 3 | PHOENIX = 999

name: tool_use
version: "3.9.3"
language: zig
module: tool_use

constants:
  PHI: 1.618033988749895
  MAX_TOOL_CALLS: 10
  TIMEOUT_MS: 30000

types:
  ToolConfig:
    fields:
      name: String
      description: String
      parameters: List
      
  ToolCall:
    fields:
      tool_name: String
      arguments: Map
      call_id: String
      
  ToolResult:
    fields:
      call_id: String
      output: String
      success: Bool
      
  ToolRegistry:
    fields:
      tools: List
      schemas: List
      
  ReActStep:
    fields:
      thought: String
      action: String
      observation: String
      
  AgentState:
    fields:
      history: List
      current_goal: String
      tools_used: List
      
  FunctionSchema:
    fields:
      name: String
      description: String
      parameters: Object
      
  ExecutionContext:
    fields:
      timeout_ms: Int
      max_retries: Int
      sandbox: Bool

behaviors:
  - name: register_tool
    given: Tool configuration
    when: Adding to registry
    then: Return updated registry
    
  - name: parse_tool_call
    given: LLM output
    when: Extracting tool call
    then: Return parsed tool call
    
  - name: execute_tool
    given: Tool call and context
    when: Running tool
    then: Return tool result
    
  - name: format_tool_result
    given: Tool result
    when: Preparing for LLM
    then: Return formatted string
    
  - name: react_step
    given: Query and tools
    when: One ReAct iteration
    then: Return thought, action, observation
    
  - name: react_loop
    given: Query and max steps
    when: Full ReAct reasoning
    then: Return final answer
    
  - name: validate_tool_call
    given: Tool call and schema
    when: Checking arguments
    then: Return validation result
    
  - name: retry_with_feedback
    given: Failed call and error
    when: Retrying with correction
    then: Return corrected call
