# Interop Marshaling v56110 - Data Marshaling
# Cross-Language Data Conversion
# φ² + 1/φ² = 3 | PHOENIX = 999

name: interop_marshaling_v56110
version: "56.1.10"
language: zig
module: interop_marshaling

creation_pattern:
  source: SourceValue
  transformer: Marshaler
  result: TargetValue

types:
  MarshalDirection:
    fields:
      name: String
      from_lang: String
      to_lang: String

  MarshalRule:
    fields:
      source_type: String
      target_type: String
      conversion: String
      requires_allocation: Bool
      requires_cleanup: Bool

  MarshalContext:
    fields:
      direction: MarshalDirection
      allocator: String
      error_handler: String
      string_encoding: String

  StringMarshal:
    fields:
      source_encoding: String
      target_encoding: String
      null_terminated: Bool
      length_prefixed: Bool
      max_length: Option<Int>

  ArrayMarshal:
    fields:
      element_type: String
      length_location: String
      is_null_terminated: Bool
      copy_mode: String

  StructMarshal:
    fields:
      source_layout: String
      target_layout: String
      field_mappings: List<String>
      padding_handling: String

  PointerMarshal:
    fields:
      pointee_type: String
      ownership: String
      nullable: Bool
      lifetime: String

  MarshalBuffer:
    fields:
      data: String
      size: Int
      capacity: Int
      owns_memory: Bool

behaviors:
  - name: marshal_string
    given: Source string and encoding
    when: String conversion needed
    then: Target string with proper encoding

  - name: marshal_array
    given: Source array and element type
    when: Array conversion needed
    then: Target array with marshaled elements

  - name: marshal_struct
    given: Source struct and layout
    when: Struct conversion needed
    then: Target struct with proper layout

  - name: marshal_pointer
    given: Source pointer and ownership
    when: Pointer conversion needed
    then: Target pointer with proper lifetime

  - name: allocate_marshal_buffer
    given: Required size
    When: Buffer allocation needed
    then: MarshalBuffer with memory

  - name: free_marshal_buffer
    given: MarshalBuffer
    when: Cleanup needed
    then: Memory freed

  - name: convert_encoding
    given: String and encodings
    when: Encoding conversion needed
    then: Re-encoded string

  - name: validate_marshal_result
    given: Marshaled value
    when: Validation needed
    then: Validation result
