# VIBEE Specification - IGLA Multi-Modal Index
# Unified index for text, images, and cross-modal search
# RAG v3 - Multi-Modal
# φ² + 1/φ² = 3 | PHOENIX = 999

name: igla_multimodal_index
version: "3.0.0"
language: zig
module: igla_multimodal_index

types:
  MultiModalIndex:
    fields:
      id: String
      text_count: Int
      image_count: Int
      dimension: Int
      unified: Bool

  Document:
    fields:
      id: String
      modality: String
      content: String
      embedding: String
      metadata: String

  CrossModalQuery:
    fields:
      query_type: String
      query_content: String
      target_modality: String
      top_k: Int

  SearchResult:
    fields:
      id: String
      modality: String
      score: Float
      content: String
      metadata: String

  IndexConfig:
    fields:
      text_model: String
      image_model: String
      unified_space: Bool
      normalize: Bool

  ModalityStats:
    fields:
      modality: String
      count: Int
      avg_embedding_time_ms: Float

  IndexMetrics:
    fields:
      total_documents: Int
      text_documents: Int
      image_documents: Int
      cross_modal_queries: Int
      avg_search_latency_ms: Float

behaviors:
  - name: create_index
    given: Index config
    when: Index creation
    then: Multi-modal index ready

  - name: add_text
    given: Text document
    when: Text added
    then: Text indexed with embedding

  - name: add_image
    given: Image document
    when: Image added
    then: Image indexed with embedding

  - name: search_text
    given: Text query
    when: Text search
    then: Relevant documents returned

  - name: search_image
    given: Image query
    when: Image search
    then: Relevant documents returned

  - name: cross_modal_search
    given: Cross-modal query
    when: Search executed
    then: Results from target modality

  - name: text_to_image
    given: Text query
    when: T2I search
    then: Relevant images returned

  - name: image_to_text
    given: Image query
    when: I2T search
    then: Relevant texts returned

  - name: hybrid_search
    given: Multi-modal query
    when: Hybrid search
    then: Combined results returned

  - name: get_metrics
    given: Index
    when: Metrics requested
    then: Index metrics returned

test_cases:
  - name: test_create_index
    input: { unified: true }
    expected: { created: true }

  - name: test_add_text
    input: { text: "Hello world" }
    expected: { indexed: true }

  - name: test_add_image
    input: { image: "test.png" }
    expected: { indexed: true }

  - name: test_search_text
    input: { query: "hello", k: 5 }
    expected: { results_count: 5 }

  - name: test_cross_modal
    input: { text: "cat", target: "image" }
    expected: { found_images: true }

  - name: test_hybrid
    input: { query: "test" }
    expected: { has_results: true }

  - name: test_metrics
    input: {}
    expected: { total_documents: 0 }
