# collab_history_v2620.vibee - Change History
# История изменений документов
# φ² + 1/φ² = 3 | PHOENIX = 999

name: collab_history_v2620
version: "2620.0.0"
language: zig
module: collab_history_v2620

types:
  HistoryEntry:
    fields:
      entry_id: String
      document_id: String
      version: Int
      user_id: String
      timestamp: Timestamp
      operation: String
      diff: String

  HistoryQuery:
    fields:
      document_id: String
      start_version: Int
      end_version: Int
      user_id: String
      limit: Int

  HistoryDiff:
    fields:
      from_version: Int
      to_version: Int
      additions: Int
      deletions: Int
      diff_text: String

  Snapshot:
    fields:
      snapshot_id: String
      document_id: String
      version: Int
      content: String
      created_at: Timestamp

behaviors:
  - name: record_change
    given: HistoryEntry
    when: Document changed
    then: Store entry

  - name: get_history
    given: HistoryQuery
    when: History requested
    then: Return HistoryEntry list

  - name: get_diff
    given: Document and versions
    when: Diff requested
    then: Return HistoryDiff

  - name: restore_version
    given: Document and version
    when: Restore requested
    then: Restore content

  - name: create_snapshot
    given: Document ID
    when: Snapshot requested
    then: Create Snapshot

sacred_constants:
  phi: 1.618033988749895
  phoenix: 999
