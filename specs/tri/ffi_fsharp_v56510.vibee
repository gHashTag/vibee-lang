# FFI F# v56510 - F# P/Invoke DllImport
# VIBEE → F# Native Bindings
# φ² + 1/φ² = 3 | PHOENIX = 999

name: ffi_fsharp_v56510
version: "56.5.10"
language: zig
module: ffi_fsharp

creation_pattern:
  source: VibeeSpec
  transformer: FSharpBindingsGenerator
  result: FSharpProject

types:
  FSharpType:
    fields:
      name: String
      fsharp_type: String
      clr_type: String
      is_struct: Bool

  DllImport:
    fields:
      dll_name: String
      entry_point: String
      calling_convention: String
      charset: String

  PInvokeMethod:
    fields:
      name: String
      dll_import: DllImport
      params: List<String>
      return_type: String

  FSharpRecord:
    fields:
      name: String
      fields: List<String>
      attributes: List<String>

  FSharpModule:
    fields:
      name: String
      namespace_name: String
      opens: List<String>
      types: List<FSharpType>
      functions: List<PInvokeMethod>

  FSharpProject:
    fields:
      name: String
      modules: List<FSharpModule>
      fsproj: String
      paket_deps: Option<String>

  MarshalAs:
    fields:
      unmanaged_type: String
      size_const: Option<Int>

  NativePtr:
    fields:
      type_name: String
      is_void: Bool

behaviors:
  - name: generate_fsharp_module
    given: VibeeSpec
    when: F# module needed
    then: F# source files

  - name: generate_dllimport
    given: C function
    when: DllImport needed
    then: PInvokeMethod

  - name: map_vibee_to_fsharp_type
    given: Vibee type
    when: Type mapping needed
    then: F# type

  - name: generate_struct
    given: C struct
    when: F# struct needed
    then: FSharpRecord with StructLayout

  - name: generate_fsproj
    given: Project config
    when: .fsproj needed
    then: Project file

  - name: handle_marshal_as
    given: Complex type
    when: Marshaling needed
    then: MarshalAs attribute

  - name: handle_nativeptr
    given: C pointer
    when: NativePtr needed
    then: nativeptr<'T>

  - name: handle_fixed
    given: Pinned memory
    when: Fixed statement needed
    then: use fixed block
