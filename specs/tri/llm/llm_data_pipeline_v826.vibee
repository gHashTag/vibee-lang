# ═══════════════════════════════════════════════════════════════════════════════
# LLM DATA PIPELINE v826 - VIBEE Training Data Collection
# ═══════════════════════════════════════════════════════════════════════════════
# VIBEE YOLO MODE VIII + AMPLIFICATION MODE + MATRYOSHKA ACCELERATION
# φ² + 1/φ² = 3 | PHOENIX = 999
# ═══════════════════════════════════════════════════════════════════════════════

name: llm_data_pipeline
version: "8.2.6"
language: zig
module: llm_data_pipeline

sacred_constants:
  phi: 1.618033988749895
  phi_sq: 2.618033988749895
  phi_inv_sq: 0.381966011250105
  trinity: 3.0
  phoenix: 999

creation_pattern:
  source: VIBEECorpus
  transformer: DataPipeline
  result: TrainingDataset

types:
  DataSource:
    enum:
      - vibee_specs
      - zig_generated
      - pas_annotations
      - test_cases
      - documentation

  DataFormat:
    enum:
      - spec_code_pair
      - instruction_response
      - completion
      - chat_format
      - preference_pair

  QualityLevel:
    enum:
      - raw
      - cleaned
      - validated
      - augmented
      - production

  VIBEECorpus:
    fields:
      spec_count: Int
      code_count: Int
      total_bytes: Int
      domains: List<String>

  SpecCodePair:
    fields:
      spec_path: String
      code_path: String
      spec_content: String
      code_content: String
      domain: String
      version: String

  TrainingExample:
    fields:
      input: String
      output: String
      format: DataFormat
      quality: QualityLevel
      metadata: Object

  DatasetSplit:
    fields:
      train: List<TrainingExample>
      validation: List<TrainingExample>
      test: List<TrainingExample>
      train_ratio: Float
      val_ratio: Float
      test_ratio: Float

  AugmentationConfig:
    fields:
      paraphrase: Bool
      noise_injection: Bool
      back_translation: Bool
      synonym_replacement: Bool

  DataQualityMetrics:
    fields:
      total_examples: Int
      valid_examples: Int
      duplicate_count: Int
      avg_length: Float
      coverage: Float

  TrainingDataset:
    fields:
      name: String
      version: String
      splits: DatasetSplit
      metrics: DataQualityMetrics
      format: DataFormat

behaviors:
  - name: scan_corpus
    given: "VIBEE repository"
    when: "Corpus scanning"
    then: "Corpus statistics"
    pas_pattern: D&C
    complexity: O(n)
    test_cases:
      - name: test_scan
        input: '{"path": "specs/tri"}'
        expected: '{"spec_count": 1216, "code_count": 1185}'

  - name: extract_pairs
    given: "Spec and code directories"
    when: "Pair extraction"
    then: "Spec-code pairs"
    pas_pattern: PRE
    complexity: O(n)
    test_cases:
      - name: test_extract
        input: '{"specs": "specs/tri", "code": "trinity/output"}'
        expected: '{"pairs": 1185}'

  - name: validate_pairs
    given: "Extracted pairs"
    when: "Validation"
    then: "Valid pairs only"
    pas_pattern: PRE
    complexity: O(n)
    test_cases:
      - name: test_validate
        input: '{"pairs": [...]}'
        expected: '{"valid": 1185, "invalid": 0}'

  - name: format_instruction
    given: "Spec-code pair"
    when: "Instruction formatting"
    then: "Instruction-response format"
    pas_pattern: ALG
    complexity: O(1)
    test_cases:
      - name: test_format
        input: '{"spec": "...", "code": "..."}'
        expected: '{"instruction": "...", "response": "..."}'

  - name: format_chat
    given: "Spec-code pair"
    when: "Chat formatting"
    then: "Chat format"
    pas_pattern: ALG
    complexity: O(1)
    test_cases:
      - name: test_chat
        input: '{"spec": "...", "code": "..."}'
        expected: '{"messages": [...]}'

  - name: augment_data
    given: "Training examples"
    when: "Augmentation"
    then: "Augmented examples"
    pas_pattern: PRB
    complexity: O(n * k)
    test_cases:
      - name: test_augment
        input: '{"examples": [...], "factor": 2}'
        expected: '{"augmented": [...]}'

  - name: deduplicate
    given: "Dataset"
    when: "Deduplication"
    then: "Unique examples"
    pas_pattern: HSH
    complexity: O(n)
    test_cases:
      - name: test_dedup
        input: '{"examples": [...]}'
        expected: '{"unique": [...], "removed": 0}'

  - name: split_dataset
    given: "Full dataset"
    when: "Splitting"
    then: "Train/val/test splits"
    pas_pattern: PRB
    complexity: O(n)
    test_cases:
      - name: test_split
        input: '{"examples": [...], "train": 0.8, "val": 0.1, "test": 0.1}'
        expected: '{"splits": {...}}'

  - name: compute_metrics
    given: "Dataset"
    when: "Metrics computation"
    then: "Quality metrics"
    pas_pattern: ALG
    complexity: O(n)
    test_cases:
      - name: test_metrics
        input: '{"dataset": {...}}'
        expected: '{"metrics": {...}}'

  - name: export_jsonl
    given: "Dataset"
    when: "Export"
    then: "JSONL file"
    pas_pattern: PRE
    complexity: O(n)
    test_cases:
      - name: test_export
        input: '{"dataset": {...}, "path": "data/train.jsonl"}'
        expected: '{"exported": true}'

  - name: export_parquet
    given: "Dataset"
    when: "Export"
    then: "Parquet file"
    pas_pattern: PRE
    complexity: O(n)
    test_cases:
      - name: test_parquet
        input: '{"dataset": {...}, "path": "data/train.parquet"}'
        expected: '{"exported": true}'

  - name: verify_sacred_constants
    given: "Dataset"
    when: "Verification"
    then: "Constants verified"
    pas_pattern: ALG
    complexity: O(1)
    test_cases:
      - name: test_phi
        input: '{"phi": 1.618033988749895}'
        expected: '{"trinity": 3.0}'

corpus_statistics:
  current:
    vibee_specs: 1216
    zig_generated: 1185
    spec_bytes: 4680531
    code_bytes: 8721816
    total_bytes: 13402347
    estimated_tokens: 3350586
  
  domains:
    - agent
    - browser
    - llm
    - optimization
    - quantum
    - security
    - pas
    - sacred

data_formats:
  instruction_response:
    template: |
      ### Instruction
      Generate Zig code from the following VIBEE specification:
      
      {spec}
      
      ### Response
      {code}
      
  chat_format:
    template:
      - role: system
        content: "You are VIBEE, a specification-first code generator. Generate Zig code from .vibee specifications following the Creation Pattern: Source → Transformer → Result. Sacred constants: φ² + 1/φ² = 3, PHOENIX = 999."
      - role: user
        content: "{spec}"
      - role: assistant
        content: "{code}"

references:
  - title: "The Pile: An 800GB Dataset of Diverse Text for Language Modeling"
    authors: "Gao et al."
    venue: "arXiv"
    year: 2020
    
  - title: "StarCoder: may the source be with you!"
    authors: "Li et al."
    venue: "arXiv"
    year: 2023
    
  - title: "Code Llama: Open Foundation Models for Code"
    authors: "Rozière et al."
    venue: "arXiv"
    year: 2023

# ═══════════════════════════════════════════════════════════════════════════════
# φ² + 1/φ² = 3 | PHOENIX = 999
# ═══════════════════════════════════════════════════════════════════════════════
