# iGLA Serve Router
# Request routing and path matching
# φ² + 1/φ² = 3 | V = n × 3^k × π^m × φ^p

name: igla_serve_router
version: "1.0.0"
language: zig
module: igla_serve_router

sacred_constants:
  phi: 1.618033988749895
  trinity: 3.0
  phoenix: 999

types:
  Route:
    fields:
      method: String
      path: String
      handler: String
      middleware: String

  Router:
    fields:
      routes: String
      not_found_handler: String
      error_handler: String

  RouteMatch:
    fields:
      matched: Bool
      params: String
      handler: String

  PathParams:
    fields:
      params: String
      count: Int

  RouteGroup:
    fields:
      prefix: String
      routes: String
      middleware: String

  RouterMetrics:
    fields:
      routes_count: Int
      matches_total: Int
      misses_total: Int

behaviors:
  - name: create_router
    given: "Routes config"
    when: "Router creation"
    then: "Router instance created"

  - name: add_route
    given: "Method, path, handler"
    when: "Route registration"
    then: "Route added to router"

  - name: match_route
    given: "Request path"
    when: "Route matching"
    then: "Matching route found"

  - name: extract_params
    given: "Path with params"
    when: "Param extraction"
    then: "Path params extracted"

  - name: create_group
    given: "Prefix"
    when: "Group creation"
    then: "Route group created"

  - name: add_middleware
    given: "Route or group"
    when: "Middleware addition"
    then: "Middleware attached"

  - name: handle_not_found
    given: "No match"
    when: "404 handling"
    then: "Not found response"

  - name: handle_error
    given: "Error"
    when: "Error handling"
    then: "Error response"

  - name: phi_router_harmony
    given: "Router"
    when: "Harmony"
    then: "φ-optimal route matching"
