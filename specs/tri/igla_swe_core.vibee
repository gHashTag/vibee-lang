# VIBEE Specification - IGLA SWE Core
# Core SWE Agent orchestration
# V = n × 3^k × π^m × φ^p | φ² + 1/φ² = 3 | PHOENIX = 999

name: igla_swe_core
version: "1.0.0"
language: zig
module: igla_swe_core

types:
  SWEAgent:
    fields:
      id: String
      name: String
      status: String
      current_task: String
      memory_id: String

  Task:
    fields:
      id: String
      description: String
      priority: Int
      status: String
      created_at: Int

  AgentConfig:
    fields:
      max_iterations: Int
      timeout_ms: Int
      model: String
      temperature: Float

  ExecutionResult:
    fields:
      success: Bool
      output: String
      error_message: String
      duration_ms: Int

  AgentState:
    fields:
      phase: String
      iteration: Int
      context: String
      history: String

  AgentMetrics:
    fields:
      tasks_completed: Int
      success_rate: Float
      avg_duration_ms: Float
      tokens_used: Int

behaviors:
  - name: create_agent
    given: Agent config
    when: Agent creation
    then: SWE agent initialized

  - name: execute_task
    given: Task description
    when: Task execution
    then: Result returned

  - name: plan_task
    given: Task
    when: Planning phase
    then: Subtasks created

  - name: delegate_subtask
    given: Subtask
    when: Delegation
    then: Subtask assigned to specialist

  - name: aggregate_results
    given: Subtask results
    when: Aggregation
    then: Final result composed

  - name: handle_error
    given: Error
    when: Error handling
    then: Recovery attempted

  - name: get_metrics
    given: Agent
    when: Metrics requested
    then: Agent metrics returned

test_cases:
  - name: test_create_agent
    input: { name: "swe-1" }
    expected: { created: true }

  - name: test_execute
    input: { task: "fix bug" }
    expected: { has_result: true }

  - name: test_plan
    input: { task: "implement feature" }
    expected: { subtasks_count: 3 }

  - name: test_metrics
    input: {}
    expected: { tasks_completed: 0 }
