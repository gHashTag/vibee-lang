# huggingface_llm_v21.vibee
# KOSCHEI CYCLE 21 - HuggingFace LLM Integration
# Free LLM API for browser automation
# φ² + 1/φ² = 3 | PHOENIX = 999

name: huggingface_llm_v21
version: "21.0.0"
language: zig
module: huggingface_llm_v21

types:
  HFConfig:
    fields:
      api_key: String
      model: String
      base_url: String
      max_tokens: Int
      temperature: Float
      timeout_ms: Int

  HFModel:
    enum:
      - Qwen25_72B
      - Llama33_70B
      - DeepSeekR1
      - Mistral7B

  ChatMessage:
    fields:
      role: String
      content: String

  ChatRequest:
    fields:
      model: String
      messages: List<String>
      max_tokens: Int
      temperature: Float
      stream: Bool

  ChatResponse:
    fields:
      content: String
      model: String
      finish_reason: String
      prompt_tokens: Int
      completion_tokens: Int
      latency_ms: Int

  BrowserAction:
    fields:
      thought: String
      action: String
      input: String

  AgentPrompt:
    fields:
      system: String
      observation: String
      task: String

  HFError:
    fields:
      status_code: Int
      message: String
      retryable: Bool

behaviors:
  - name: create_hf_config
    given: API key and model name
    when: Initializing HuggingFace client
    then: Return HFConfig with defaults

  - name: chat_completion
    given: HFConfig and ChatRequest
    when: Making LLM inference call
    then: Return ChatResponse with content

  - name: parse_browser_action
    given: LLM response content
    when: Extracting Thought/Action/Input
    then: Return BrowserAction struct

  - name: build_agent_prompt
    given: Task description and browser observation
    when: Creating prompt for browser agent
    then: Return formatted AgentPrompt

  - name: format_messages
    given: List of ChatMessage
    when: Preparing API request body
    then: Return JSON string

  - name: parse_response
    given: JSON response from HuggingFace
    when: Extracting completion content
    then: Return ChatResponse

  - name: handle_error
    given: HTTP status code and body
    when: API error occurred
    then: Return HFError with retry info

  - name: estimate_tokens
    given: Text string
    when: Estimating token count
    then: Return approximate token count

test_cases:
  - name: qwen_simple_math
    input: "What is 2+2?"
    expected: content contains "4"

  - name: browser_action_parse
    input: "Thought: I need to click\nAction: click\nInput: button#submit"
    expected: action equals "click"

  - name: agent_prompt_format
    input: task="Find price", observation="Page shows $99"
    expected: prompt contains "Find price"

sacred_constants:
  phi: 1.618033988749895
  phi_squared_plus_inverse_squared: 3
  phoenix: 999

# HuggingFace Models Reference
# Qwen/Qwen2.5-72B-Instruct - Best quality, ~300ms
# meta-llama/Llama-3.3-70B-Instruct - Fast, ~284ms
# deepseek-ai/DeepSeek-R1 - Reasoning, ~8000ms
# mistralai/Mistral-7B-Instruct-v0.3 - Lightweight, ~100ms
