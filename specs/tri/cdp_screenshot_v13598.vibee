# VIBEE Specification v13598
# CDP Screenshot Operations
# Page/Element Screenshots and PDF
# φ² + 1/φ² = 3 | PHOENIX = 999

name: cdp_screenshot
version: "13598"
language: zig
module: cdp_screenshot

types:
  ScreenshotConfig:
    fields:
      format: String
      quality: Int
      clip: Object
      from_surface: Bool
      capture_beyond_viewport: Bool

  ScreenshotClip:
    fields:
      x: Float
      y: Float
      width: Float
      height: Float
      scale: Float

  ScreenshotResult:
    fields:
      data: String
      format: String
      width: Int
      height: Int
      size_bytes: Int

  PDFConfig:
    fields:
      landscape: Bool
      display_header_footer: Bool
      print_background: Bool
      scale: Float
      paper_width: Float
      paper_height: Float
      margin_top: Float
      margin_bottom: Float
      margin_left: Float
      margin_right: Float
      page_ranges: String
      prefer_css_page_size: Bool

  PDFResult:
    fields:
      data: String
      pages: Int
      size_bytes: Int

  ScreencastConfig:
    fields:
      format: String
      quality: Int
      max_width: Int
      max_height: Int
      every_nth_frame: Int

  ScreencastFrame:
    fields:
      data: String
      metadata: Object
      session_id: Int

  ScreenshotMetrics:
    fields:
      screenshots_taken: Int
      pdfs_generated: Int
      total_bytes: Int
      avg_capture_time_ms: Float

behaviors:
  - name: capture_screenshot
    given: Screenshot configuration
    when: Capture requested
    then: Screenshot data returned as base64

  - name: capture_element
    given: Element selector and config
    when: Element capture requested
    then: Element screenshot returned

  - name: capture_full_page
    given: Screenshot config
    when: Full page capture requested
    then: Full scrollable page captured

  - name: generate_pdf
    given: PDF configuration
    when: PDF generation requested
    then: PDF data returned as base64

  - name: start_screencast
    given: Screencast configuration
    when: Screencast start requested
    then: Frame events begin streaming

  - name: stop_screencast
    given: Active screencast
    when: Stop requested
    then: Screencast stopped

  - name: ack_screencast_frame
    given: Frame session ID
    when: Ack requested
    then: Frame acknowledged for next

creation_pattern:
  source: ScreenshotConfig
  transformer: ScreenshotEngine
  result: ScreenshotResult
