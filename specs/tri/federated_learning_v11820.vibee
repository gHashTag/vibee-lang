name: federated_learning_v11820
version: "11820"
language: zig
module: federated_learning

description: |
  TIER 266: Federated Learning
  Trains models without centralizing data
  Based on: McMahan et al., FedAvg, FedProx

types:
  FLConfig:
    fields:
      algorithm: FLAlgorithm
      num_rounds: Int
      clients_per_round: Int
      local_epochs: Int
      privacy_budget: Float

  FLAlgorithm:
    variants:
      - fed_avg
      - fed_prox
      - fed_sgd
      - scaffold

  ClientUpdate:
    fields:
      client_id: String
      model_delta: List<Float>
      num_samples: Int
      local_loss: Float

  FLRound:
    fields:
      round_num: Int
      participating_clients: Int
      global_loss: Float
      convergence_metric: Float

behaviors:
  - name: initialize_global_model
    given: Model architecture
    When: Initializing
    then: Returns global model

  - name: select_clients
    given: Available clients
    When: Selecting for round
    then: Returns selected clients

  - name: distribute_model
    given: Global model
    When: Distributing
    then: Returns distribution status

  - name: train_local
    given: Client data
    When: Training locally
    then: Returns client update

  - name: aggregate_updates
    given: Client updates
    When: Aggregating
    then: Returns new global model

  - name: apply_dp_to_updates
    given: Updates and epsilon
    When: Adding DP
    then: Returns private updates

  - name: evaluate_global
    given: Global model
    When: Evaluating
    then: Returns evaluation

  - name: check_convergence
    given: Round history
    When: Checking convergence
    then: Returns convergence status

creation_pattern:
  source: DistributedData
  transformer: FederatedTrainer
  result: GlobalModel
