# v5300 - Protein Structure
# ==========================
# AlphaFold, ESMFold - предсказание структуры белков
# φ² + 1/φ² = 3 | PHOENIX = 999

name: protein_structure
version: "5.3.0"
language: zig
module: protein_structure

constants:
  PHI: 1.618033988749895
  MAX_SEQ_LENGTH: 2048
  NUM_RESIDUES: 20
  EMBEDDING_DIM: 1280

types:
  AminoAcidSequence:
    fields:
      sequence: String
      length: Int
      
  MSA:
    fields:
      sequences: List
      num_sequences: Int
      
  ProteinStructure:
    fields:
      coordinates: List
      residue_indices: List
      chain_id: String
      
  PairwiseFeatures:
    fields:
      pair_repr: List
      distance_matrix: List
      
  StructurePrediction:
    fields:
      coordinates: List
      plddt: List
      pae: List
      
  EvoformerOutput:
    fields:
      msa_repr: List
      pair_repr: List
      
  StructureModule:
    fields:
      ipa_attention: Object
      backbone_update: Object
      
  ConfidenceMetrics:
    fields:
      plddt: Float
      ptm: Float
      ipae: Float

behaviors:
  - name: encode_sequence
    given: Amino acid sequence
    when: Sequence encoding
    then: Вернуть sequence embedding
    
  - name: search_msa
    given: Query sequence
    when: MSA search
    then: Вернуть MSA
    
  - name: evoformer_forward
    given: MSA и pair features
    when: Evoformer processing
    then: Вернуть evoformer output
    
  - name: structure_module_forward
    given: Representations
    when: Structure prediction
    then: Вернуть 3D coordinates
    
  - name: predict_structure
    given: Sequence и model
    when: Full structure prediction
    then: Вернуть structure prediction
    
  - name: compute_plddt
    given: Logits
    when: Confidence estimation
    then: Вернуть per-residue confidence
    
  - name: compute_pae
    given: Pair representations
    when: PAE prediction
    then: Вернуть predicted aligned error
    
  - name: refine_structure
    given: Initial structure
    when: Structure refinement
    then: Вернуть refined structure
