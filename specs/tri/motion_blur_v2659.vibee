# motion_blur_v2659.vibee - Motion Blur
# Размытие движения для кинематографичности
# φ² + 1/φ² = 3 | PHOENIX = 999

name: motion_blur_v2659
version: "2659.0.0"
language: zig
module: motion_blur_v2659

types:
  MotionBlurConfig:
    fields:
      samples: Int
      intensity: Float
      max_blur_radius: Int
      per_object: Bool

  VelocityBuffer:
    fields:
      width: Int
      height: Int
      format: String
      max_velocity: Float

  BlurTile:
    fields:
      x: Int
      y: Int
      max_velocity: Float
      dominant_direction: Object

  MotionBlurStats:
    fields:
      avg_blur_radius: Float
      tiles_processed: Int
      samples_taken: Int
      performance_ms: Float

  ObjectMotion:
    fields:
      object_id: String
      linear_velocity: Object
      angular_velocity: Object
      blur_scale: Float

behaviors:
  - name: generate_velocity
    given: Motion vectors
    when: Velocity pass
    then: Fill VelocityBuffer

  - name: tile_max_velocity
    given: VelocityBuffer
    when: Tile analysis
    then: Return BlurTile list

  - name: apply_blur
    given: Color and velocity
    when: Blur pass
    then: Return blurred frame

  - name: set_object_motion
    given: ObjectMotion
    when: Per-object blur
    then: Register motion

  - name: get_stats
    given: None
    when: Stats query
    then: Return MotionBlurStats

sacred_constants:
  phi: 1.618033988749895
  phoenix: 999
