# C++ to VIBEE Transpiler Specification
# φ² + 1/φ² = 3 | PHOENIX = 999

name: cpp_transpiler
version: "1.0.0"
language: zig
module: cpp_transpiler

creation_pattern:
  source: CppSourceFile
  transformer: CppToVibeeTranspiler
  result: VibeeSpecification

types:
  CppToken:
    fields:
      kind: String
      value: String
      line: Int
      column: Int

  CppType:
    fields:
      name: String
      is_pointer: Bool
      is_const: Bool
      is_reference: Bool
      template_args: String

  CppField:
    fields:
      name: String
      cpp_type: String
      vibee_type: String
      default_value: String

  CppFunction:
    fields:
      name: String
      return_type: String
      params: String
      body: String
      is_static: Bool
      is_const: Bool

  CppClass:
    fields:
      name: String
      base_classes: String
      fields: String
      methods: String
      is_struct: Bool

  CppSourceFile:
    fields:
      path: String
      includes: String
      namespaces: String
      classes: String
      functions: String
      globals: String

  VibeeType:
    fields:
      name: String
      fields: String

  VibeeBehavior:
    fields:
      name: String
      given: String
      when: String
      then: String

  VibeeSpecification:
    fields:
      name: String
      version: String
      language: String
      module: String
      types: String
      behaviors: String

  TypeMapping:
    fields:
      cpp_type: String
      vibee_type: String
      zig_type: String

  TranspilerConfig:
    fields:
      input_dir: String
      output_dir: String
      recursive: Bool
      parallel_jobs: Int
      type_mappings: String

  TranspilerResult:
    fields:
      success: Bool
      files_processed: Int
      specs_generated: Int
      errors: String

behaviors:
  - name: tokenize_cpp
    given: "C++ source code string"
    when: "Lexer processes the input"
    then: "Returns array of CppToken"

  - name: parse_cpp_type
    given: "C++ type declaration string"
    when: "Parser analyzes the type"
    then: "Returns CppType with mapped vibee_type"

  - name: parse_cpp_class
    given: "C++ class/struct definition"
    when: "Parser extracts members"
    then: "Returns CppClass with fields and methods"

  - name: parse_cpp_function
    given: "C++ function definition"
    when: "Parser extracts signature and body"
    then: "Returns CppFunction"

  - name: map_cpp_to_vibee_type
    given: "CppType"
    when: "Type mapper processes it"
    then: "Returns equivalent VibeeType string"

  - name: generate_vibee_type
    given: "CppClass"
    when: "Generator creates VIBEE type"
    then: "Returns VibeeType specification"

  - name: generate_vibee_behavior
    given: "CppFunction"
    when: "Generator creates VIBEE behavior"
    then: "Returns VibeeBehavior specification"

  - name: generate_vibee_spec
    given: "CppSourceFile"
    when: "Full transpilation runs"
    then: "Returns complete VibeeSpecification"

  - name: transpile_file
    given: "Path to .cpp or .h file"
    when: "Transpiler processes single file"
    then: "Writes .vibee file to output directory"

  - name: transpile_directory
    given: "TranspilerConfig with input directory"
    when: "Batch transpilation runs"
    then: "Returns TranspilerResult with statistics"

  - name: transpile_chromium_component
    given: "Chromium component name (e.g., 'ui', 'base')"
    when: "Component transpilation runs"
    then: "Generates all .vibee specs for component"

type_mappings:
  # Primitive types
  - cpp: "int"
    vibee: "Int"
    zig: "i32"
  - cpp: "int64_t"
    vibee: "Int"
    zig: "i64"
  - cpp: "uint64_t"
    vibee: "Int"
    zig: "u64"
  - cpp: "float"
    vibee: "Float"
    zig: "f32"
  - cpp: "double"
    vibee: "Float"
    zig: "f64"
  - cpp: "bool"
    vibee: "Bool"
    zig: "bool"
  - cpp: "char"
    vibee: "String"
    zig: "u8"
  - cpp: "const char*"
    vibee: "String"
    zig: "[]const u8"
  - cpp: "std::string"
    vibee: "String"
    zig: "[]const u8"
  - cpp: "void"
    vibee: "Void"
    zig: "void"
  
  # Pointer types
  - cpp: "T*"
    vibee: "Option<T>"
    zig: "?*T"
  - cpp: "const T*"
    vibee: "Option<T>"
    zig: "?*const T"
  - cpp: "std::unique_ptr<T>"
    vibee: "Option<T>"
    zig: "?*T"
  - cpp: "std::shared_ptr<T>"
    vibee: "Option<T>"
    zig: "?*T"
  
  # Container types
  - cpp: "std::vector<T>"
    vibee: "List<T>"
    zig: "[]T"
  - cpp: "std::array<T, N>"
    vibee: "List<T>"
    zig: "[N]T"
  - cpp: "std::map<K, V>"
    vibee: "Map<K, V>"
    zig: "std.StringHashMap(V)"
  - cpp: "std::unordered_map<K, V>"
    vibee: "Map<K, V>"
    zig: "std.StringHashMap(V)"
  
  # Chromium-specific types
  - cpp: "base::StringPiece"
    vibee: "String"
    zig: "[]const u8"
  - cpp: "base::span<T>"
    vibee: "List<T>"
    zig: "[]T"
  - cpp: "absl::optional<T>"
    vibee: "Option<T>"
    zig: "?T"
  - cpp: "gfx::Rect"
    vibee: "Rect"
    zig: "Rect"
  - cpp: "gfx::Size"
    vibee: "Size"
    zig: "Size"
  - cpp: "gfx::Point"
    vibee: "Point"
    zig: "Point"
  - cpp: "SkColor"
    vibee: "Color"
    zig: "u32"

batch_config:
  parallel_jobs: 8
  chunk_size: 100
  output_format: "vibee"
  generate_tests: true
  preserve_comments: true
  
chromium_components:
  - name: "base"
    priority: 1
    files: "~500"
  - name: "ui/gfx"
    priority: 2
    files: "~200"
  - name: "ui/views"
    priority: 3
    files: "~800"
  - name: "chrome/browser/ui"
    priority: 4
    files: "~2000"
  - name: "content"
    priority: 5
    files: "~3000"
