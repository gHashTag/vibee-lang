# VIBEE YOLO MODE XII - browser_collab_offline v1159
# Offline-First Sync - Local-First Software
# Reference: Kleppmann et al. (2019) - Ink & Switch
name: browser_collab_offline_v1159
version: "12.0.0"
language: zig
module: browser_collab_offline

sacred_constants:
  phi: 1.618033988749895
  phi_identity: 3
  phoenix: 999
  yolo_mode: 12

types:
  OfflineQueue:
    fields:
      operations: List<String>
      pending_count: Int
      last_sync: Timestamp
      storage_key: String

  SyncStatus:
    fields:
      online: Bool
      syncing: Bool
      pending_changes: Int
      last_error: String

  LocalStorage:
    fields:
      db_name: String
      store_name: String
      version: Int

  NetworkState:
    fields:
      online: Bool
      effective_type: String
      downlink: Float
      rtt: Int

behaviors:
  - name: queue_operation
    given: Operation
    when: Offline
    then: Operation queued for sync
  - name: sync_pending
    given: OfflineQueue
    when: Online
    then: Pending operations synced
  - name: persist_local
    given: LocalStorage
    when: Persist
    then: Data persisted to IndexedDB
  - name: detect_network
    given: NetworkState
    when: Detect
    then: Network state detected
  - name: reconcile
    given: Local and remote state
    when: Reconcile
    then: States reconciled

test_cases:
  - name: test_offline_queue
    input: {operation: "insert"}
    expected: {queued: true}
  - name: test_offline_sync
    input: {pending: 5}
    expected: {synced: true}
  - name: test_offline_persist
    input: {db: "vibee"}
    expected: {persisted: true}
  - name: test_offline_network
    input: {online: true}
    expected: {detected: true}
  - name: test_offline_reconcile
    input: {local: "a", remote: "b"}
    expected: {reconciled: true}
  - name: test_phi_offline
    input: {phi: 1.618033988749895}
    expected: {identity: 3}
