name: test_server_v22
version: "22.6.0"
language: zig
module: test_server_v22

types:
  ServerConfig:
    fields:
      host: String
      port: Int
      static_dir: Option<String>

  Route:
    fields:
      method: String
      path: String
      handler: String

  ServerState:
    fields:
      running: Bool
      requests_count: Int
      start_time: Timestamp

  TestServer:
    fields:
      config: Object
      routes: List<String>
      state: Object

behaviors:
  - name: create_server
    given: ServerConfig
    when: Initialize server
    then: TestServer instance

  - name: start
    given: TestServer
    when: Start server
    then: Started

  - name: stop
    given: TestServer
    when: Stop server
    then: Stopped

  - name: add_route
    given: TestServer and Route
    when: Add route
    then: Route added

  - name: add_static
    given: TestServer and path and content
    when: Add static file
    then: File added

  - name: get_url
    given: TestServer
    when: Get server URL
    then: URL string

  - name: get_state
    given: TestServer
    When: Get server state
    then: ServerState

  - name: reset_state
    given: TestServer
    When: Reset state
    then: State reset

  - name: get_requests
    given: TestServer
    When: Get request log
    then: Request list

  - name: wait_for_request
    given: TestServer and timeout
    When: Wait for request
    then: Request or timeout
