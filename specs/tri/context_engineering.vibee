# Context Engineering Core Architecture
# Based on Manus AI philosophy: Context > Fine-tuning
# Ship improvements in hours, not weeks

name: context_engineering
version: "1.0.0"
language: zig
module: context_engineering

types:
  ContextEngine:
    fields:
      engine_id: String
      base_model: String
      active_template: String
      variables: Map<String,String>
      iteration_count: Int
      last_updated: Timestamp

  ContextLayer:
    fields:
      layer_id: String
      layer_type: String
      priority: Int
      content: String
      is_mutable: Bool

  ContextStack:
    fields:
      stack_id: String
      layers: List<String>
      total_tokens: Int
      max_tokens: Int

  ContextDiff:
    fields:
      diff_id: String
      before_hash: String
      after_hash: String
      changes: List<String>
      performance_impact: Float

  ContextVersion:
    fields:
      version_id: String
      timestamp: Timestamp
      template_snapshot: String
      variables_snapshot: String
      benchmark_score: Float

  ContextRollback:
    fields:
      rollback_id: String
      target_version: String
      reason: String
      executed_at: Timestamp

behaviors:
  - name: initialize_engine
    given: Base model and initial configuration
    when: Context engine is created
    then: Returns ready engine with default template

  - name: apply_context_layer
    given: Layer content and priority
    when: Layer is added to stack
    then: Returns updated context stack

  - name: compose_final_context
    given: Context stack with all layers
    when: Final prompt is assembled
    then: Returns optimized prompt within token limit

  - name: track_version
    given: Current context state
    when: Version checkpoint is created
    then: Returns version ID for rollback

  - name: compute_diff
    given: Two context versions
    when: Comparison is requested
    then: Returns detailed diff with impact analysis

  - name: rollback_to_version
    given: Target version ID
    when: Rollback is triggered
    then: Restores context to previous state

  - name: measure_iteration_speed
    given: Change request and deployment
    when: Iteration cycle completes
    then: Returns time from idea to production

  - name: optimize_token_budget
    given: Context stack and token limit
    when: Optimization runs
    then: Returns compressed stack within budget
