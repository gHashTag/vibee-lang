# VIBEE Specification: MCP Tool Registration v1315
# YOLO XV - Production Ascension

name: browser_mcp_tools
version: "1315"
language: zig
module: browser_mcp_tools

types:
  ToolDefinition:
    fields:
      name: String
      description: String
      input_schema: JSONSchema
      annotations: Map

  JSONSchema:
    fields:
      schema_type: String
      properties: Map
      required: List
      additional_properties: Bool

  ToolResult:
    fields:
      content: List
      is_error: Bool

  TextContent:
    fields:
      content_type: String
      text: String

  ImageContent:
    fields:
      content_type: String
      data: String
      mime_type: String

  ToolRegistry:
    fields:
      tools: Map
      handlers: Map
      middleware: List

  ToolMiddleware:
    fields:
      name: String
      before: String
      after: String

behaviors:
  - name: create_registry
    given: "Nothing"
    when: "Creating tool registry"
    then: "Returns empty registry"

  - name: define_tool
    given: "Name, description, schema"
    when: "Defining tool"
    then: "Returns tool definition"

  - name: register_handler
    given: "Registry, tool name, handler"
    when: "Registering handler"
    then: "Associates handler with tool"

  - name: add_middleware
    given: "Registry, middleware"
    when: "Adding middleware"
    then: "Adds to middleware chain"

  - name: execute_tool
    given: "Registry, tool name, arguments"
    when: "Executing tool"
    then: "Runs handler, returns result"

  - name: validate_arguments
    given: "Tool definition, arguments"
    when: "Validating input"
    then: "Returns validation result"

  - name: create_text_result
    given: "Text content"
    when: "Creating text result"
    then: "Returns text content object"

  - name: create_image_result
    given: "Image data, mime type"
    when: "Creating image result"
    then: "Returns image content object"

  - name: create_error_result
    given: "Error message"
    when: "Creating error result"
    then: "Returns error content"

  - name: list_tools
    given: "Registry"
    when: "Listing tools"
    then: "Returns all tool definitions"

creation_pattern:
  source: ToolRegistry
  transformer: ToolManagement
  result: RegisteredTools

test_cases:
  - name: test_tool_definition
    input:
      name: "search"
      schema: {type: "object", properties: {query: {type: "string"}}}
    expected:
      definition_valid: true

  - name: test_handler_registration
    input:
      tool: "search"
      handler: "search_handler"
    expected:
      handler_registered: true

  - name: test_argument_validation
    input:
      schema: {required: ["query"]}
      arguments: {}
    expected:
      validation_failed: true

  - name: test_middleware_execution
    input:
      middleware: ["logging", "auth"]
    expected:
      all_middleware_called: true

  - name: test_text_result
    input:
      text: "Search results..."
    expected:
      content_type: "text"

  - name: test_image_result
    input:
      data: "base64..."
      mime_type: "image/png"
    expected:
      content_type: "image"

  - name: test_error_result
    input:
      error: "Tool failed"
    expected:
      is_error: true

  - name: test_list_tools
    input:
      registered_tools: 10
    expected:
      tools_count: 10
