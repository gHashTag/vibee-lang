# FFI Lua v56420 - LuaJIT FFI / Lua C API
# VIBEE → Lua Native Modules
# φ² + 1/φ² = 3 | PHOENIX = 999

name: ffi_lua_v56420
version: "56.4.20"
language: zig
module: ffi_lua

creation_pattern:
  source: VibeeSpec
  transformer: LuaBindingsGenerator
  result: LuaModule

types:
  LuaType:
    fields:
      tag: String
      value: String
      is_light_userdata: Bool

  LuaFunction:
    fields:
      name: String
      nargs: Int
      nresults: Int
      c_func: String

  LuaTable:
    fields:
      name: String
      fields: List<String>
      methods: List<LuaFunction>

  LuaUserdata:
    fields:
      name: String
      size: Int
      metatable: String
      gc_func: Option<String>

  LuaModule:
    fields:
      name: String
      functions: List<LuaFunction>
      tables: List<LuaTable>
      userdatas: List<LuaUserdata>

  LuaJITFFI:
    fields:
      cdef: String
      library: String
      functions: List<String>

  LuaReg:
    fields:
      name: String
      func: String

  LuaStack:
    fields:
      top: Int
      base: Int
      size: Int

behaviors:
  - name: generate_lua_module
    given: VibeeSpec
    when: Lua C module needed
    then: Lua module files

  - name: generate_luajit_ffi
    given: VibeeSpec
    when: LuaJIT FFI needed
    then: ffi.cdef string

  - name: map_vibee_to_lua_type
    given: Vibee type
    when: Type mapping needed
    then: Lua type tag

  - name: generate_luaopen
    given: Module name
    when: Module loader needed
    then: luaopen_* function

  - name: generate_metatable
    given: Userdata type
    when: Metatable needed
    then: Metatable registration

  - name: push_value
    given: C value
    when: Stack push needed
    then: lua_push* call

  - name: check_value
    given: Stack index
    when: Type check needed
    then: luaL_check* call

  - name: create_userdata
    given: Type and size
    when: Userdata needed
    then: lua_newuserdata call
