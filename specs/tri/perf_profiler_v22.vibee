name: perf_profiler_v22
version: "22.5.0"
language: zig
module: perf_profiler_v22

types:
  ProfilerConfig:
    fields:
      enabled: Bool
      sample_rate_ms: Int
      output_format: String

  ProfileSample:
    fields:
      timestamp: Timestamp
      function_name: String
      duration_ns: Int
      memory_bytes: Int

  ProfileSpan:
    fields:
      name: String
      start_time: Timestamp
      end_time: Option<Timestamp>
      children: List<String>

  ProfileReport:
    fields:
      total_duration_ms: Int
      hotspots: List<String>
      memory_peak: Int
      call_counts: Object

  Profiler:
    fields:
      config: Object
      samples: List<String>
      spans: List<String>
      active_span: Option<String>

behaviors:
  - name: create_profiler
    given: ProfilerConfig
    when: Initialize profiler
    then: Profiler instance

  - name: start_span
    given: Profiler and span name
    when: Start profiling span
    then: ProfileSpan

  - name: end_span
    given: Profiler and span
    when: End profiling span
    then: Completed span

  - name: record_sample
    given: Profiler and ProfileSample
    when: Record sample
    then: Recorded

  - name: get_hotspots
    given: Profiler
    when: Find hotspots
    then: Hotspot list

  - name: get_memory_usage
    given: Profiler
    When: Get memory usage
    then: Memory stats

  - name: get_call_graph
    given: Profiler
    When: Get call graph
    then: Call graph

  - name: generate_report
    given: Profiler
    When: Generate report
    then: ProfileReport

  - name: export_flamegraph
    given: Profiler
    When: Export flamegraph
    then: Flamegraph data

  - name: reset
    given: Profiler
    When: Reset profiler
    then: Reset complete

  - name: enable
    given: Profiler
    When: Enable profiling
    then: Enabled
