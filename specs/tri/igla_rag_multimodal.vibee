# iGLA RAG Multimodal
# Multimodal RAG for text + code
# Scientific basis: Yasunaga et al. 2023, Chen et al. 2021 (Codex)
# φ² + 1/φ² = 3 | V = n × 3^k × π^m × φ^p

name: igla_rag_multimodal
version: "1.0.0"
language: zig
module: igla_rag_multimodal

sacred_constants:
  phi: 1.618033988749895
  trinity: 3.0
  phoenix: 999

scientific_references:
  - "Yasunaga et al. 2023: Retrieval-Augmented Multimodal LLMs"
  - "Chen et al. 2021: Codex"
  - "Parvez et al. 2021: Retrieval Augmented Code Generation"
  - "Zhou et al. 2023: DocPrompting"

types:
  MultimodalConfig:
    fields:
      text_weight: Float
      code_weight: Float
      enable_ast: Bool
      languages: String

  CodeChunk:
    fields:
      id: Int
      code: String
      language: String
      ast_hash: String
      docstring: String

  TextCodePair:
    fields:
      text: String
      code: String
      similarity: Float

  ASTNode:
    fields:
      node_type: String
      name: String
      children: String
      line_start: Int
      line_end: Int

  MultimodalEmbedding:
    fields:
      text_embedding: String
      code_embedding: String
      fused_embedding: String

  CodeSearchResult:
    fields:
      chunk_id: Int
      code: String
      language: String
      score: Float
      context: String

behaviors:
  - name: parse_code
    given: "Code string, language"
    when: "AST parsing"
    then: "AST representation"

  - name: extract_functions
    given: "AST"
    when: "Function extraction"
    then: "List of function chunks"

  - name: embed_code
    given: "Code chunk"
    when: "Code embedding"
    then: "Code vector embedding"

  - name: fuse_embeddings
    given: "Text embedding, Code embedding"
    when: "Multimodal fusion"
    then: "Fused embedding"

  - name: search_code
    given: "Query, language filter"
    when: "Code search"
    then: "Relevant code chunks"

  - name: search_text_code
    given: "Query"
    when: "Multimodal search"
    then: "Mixed text and code results"

  - name: generate_docstring
    given: "Code chunk"
    when: "Documentation"
    then: "Generated docstring"

  - name: phi_multimodal_fusion
    given: "Text, Code embeddings"
    when: "Sacred fusion"
    then: "φ-weighted multimodal vector"
