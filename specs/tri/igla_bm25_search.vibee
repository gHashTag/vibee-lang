# iGLA BM25 Search
# Classic BM25 (Best Matching 25) algorithm
# Scientific basis: Robertson & Zaragoza 2009
# φ² + 1/φ² = 3 | V = n × 3^k × π^m × φ^p

name: igla_bm25_search
version: "1.0.0"
language: zig
module: igla_bm25_search

sacred_constants:
  phi: 1.618033988749895
  trinity: 3.0
  phoenix: 999
  k1: 1.2
  b: 0.75

scientific_references:
  - "Robertson & Zaragoza 2009: The Probabilistic Relevance Framework"
  - "Robertson et al. 1994: Okapi at TREC-3"
  - "Sparck Jones et al. 2000: A probabilistic model of IR"

types:
  BM25Config:
    fields:
      k1: Float
      b: Float
      epsilon: Float
      avg_doc_length: Float

  TermFrequency:
    fields:
      term: String
      count: Int
      doc_id: Int

  InvertedIndex:
    fields:
      term: String
      doc_ids: String
      frequencies: String
      idf: Float

  DocumentStats:
    fields:
      doc_id: Int
      length: Int
      unique_terms: Int

  BM25Score:
    fields:
      doc_id: Int
      score: Float
      matched_terms: Int

  CorpusStats:
    fields:
      total_docs: Int
      avg_doc_length: Float
      vocabulary_size: Int

behaviors:
  - name: build_inverted_index
    given: "List of documents"
    when: "Indexing"
    then: "InvertedIndex for all terms"

  - name: compute_idf
    given: "Term, total_docs, doc_freq"
    when: "IDF calculation"
    then: "IDF score using log formula"

  - name: compute_tf
    given: "Term frequency, doc_length, avg_length"
    when: "TF calculation"
    then: "Normalized term frequency"

  - name: score_document
    given: "Query terms, document"
    when: "Scoring"
    then: "BM25 score for document"

  - name: search_bm25
    given: "Query, top_k"
    when: "Search"
    then: "Top-K documents by BM25 score"

  - name: tokenize_query
    given: "Query string"
    when: "Tokenization"
    then: "List of query terms"

  - name: update_index
    given: "New document"
    when: "Index update"
    then: "Updated inverted index"

  - name: phi_weighted_bm25
    given: "BM25 scores"
    when: "Sacred weighting"
    then: "φ-harmonized relevance scores"
