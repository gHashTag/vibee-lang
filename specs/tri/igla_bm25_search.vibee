# IGLA BM25 Search
# Best Matching 25 algorithm for code search
# Robertson et al. 1994 | φ² + 1/φ² = 3 | PHOENIX = 999

name: igla_bm25_search
version: "1.0.0"
language: zig
module: igla_bm25_search

sacred_constants:
  phi: 1.618033988749895
  phoenix: 999
  trinity: 3
  bm25_k1: 1.2
  bm25_b: 0.75

types:
  BM25Config:
    fields:
      k1: Float
      b: Float
      avg_doc_length: Float

  TermFrequency:
    fields:
      term: String
      frequency: Int
      doc_frequency: Int

  BM25Score:
    fields:
      doc_id: String
      score: Float
      matched_terms: List<String>

  SearchResult:
    fields:
      results: List<BM25Score>
      query: String
      total_docs: Int

behaviors:
  - name: build_index
    given: List of documents
    when: Index building requested
    then: Returns term frequency index

  - name: search
    given: Query and index
    when: Search requested
    then: Returns ranked SearchResult

  - name: calculate_idf
    given: Term and corpus size
    when: IDF calculation requested
    then: Returns inverse document frequency

  - name: calculate_tf
    given: Term and document
    when: TF calculation requested
    then: Returns term frequency score

  - name: score_document
    given: Query terms and document
    when: Scoring requested
    then: Returns BM25Score

  - name: tokenize
    given: Text
    when: Tokenization requested
    then: Returns list of tokens

test_cases:
  - name: test_tokenization
    expected: tokens_extracted
  - name: test_idf_calculation
    expected: idf_computed
  - name: test_tf_calculation
    expected: tf_computed
  - name: test_bm25_scoring
    expected: score_valid
  - name: test_search_ranking
    expected: results_ranked
