# v6011 - Training Loop
# ======================
# Полный цикл тренировки
# φ² + 1/φ² = 3 | PHOENIX = 999

name: training_loop
version: "6.0.11"
language: zig
module: training_loop

constants:
  PHI: 1.618033988749895
  PHOENIX: 999

types:
  TrainingConfig:
    fields:
      max_steps: Int
      batch_size: Int
      learning_rate: Float
      weight_decay: Float
      grad_accum_steps: Int
      log_interval: Int
      save_interval: Int
      
  TrainingState:
    fields:
      step: Int
      epoch: Int
      total_loss: Float
      best_loss: Float
      
  TrainingMetrics:
    fields:
      loss: Float
      grad_norm: Float
      lr: Float
      throughput: Float

behaviors:
  - name: train_step
    given: Batch, model, optimizer
    when: Один шаг тренировки
    then: Вернуть loss и metrics
    
  - name: train_epoch
    given: DataLoader, model, optimizer
    when: Одна эпоха
    then: Вернуть epoch metrics
    
  - name: train_loop
    given: Config, model, data
    when: Полный цикл тренировки
    then: Тренировать до max_steps
    
  - name: evaluate
    given: Model и eval_data
    when: Оценка модели
    then: Вернуть eval metrics
