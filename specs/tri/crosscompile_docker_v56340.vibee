# CrossCompile Docker v56340 - Docker Builds
# Containerized Cross-Compilation
# φ² + 1/φ² = 3 | PHOENIX = 999

name: crosscompile_docker_v56340
version: "56.3.40"
language: zig
module: crosscompile_docker

creation_pattern:
  source: BuildSpec
  transformer: DockerBuilder
  result: ContainerizedBuild

types:
  DockerImage:
    fields:
      name: String
      tag: String
      digest: Option<String>
      size: Int

  Dockerfile:
    fields:
      base_image: String
      instructions: List<String>
      build_args: List<String>
      labels: List<String>

  BuildContainer:
    fields:
      id: String
      image: DockerImage
      status: String
      mounts: List<String>

  ContainerMount:
    fields:
      source: String
      target: String
      read_only: Bool
      type_name: String

  DockerBuildConfig:
    fields:
      dockerfile: Dockerfile
      context: String
      target: Option<String>
      build_args: List<String>
      cache_from: List<String>

  BuildxConfig:
    fields:
      platforms: List<String>
      builder: String
      push: Bool
      load: Bool

  ContainerExec:
    fields:
      container: BuildContainer
      command: List<String>
      working_dir: String
      env: List<String>

  DockerBuildResult:
    fields:
      image: DockerImage
      build_time_ms: Int
      layers: Int
      cache_hits: Int

behaviors:
  - name: build_image
    given: DockerBuildConfig
    When: Image build needed
    then: DockerImage

  - name: create_container
    given: DockerImage and mounts
    when: Container creation needed
    then: BuildContainer

  - name: exec_in_container
    given: ContainerExec
    when: Command execution needed
    then: Execution result

  - name: copy_from_container
    given: Container and path
    when: File extraction needed
    then: Extracted files

  - name: build_multiplatform
    given: BuildxConfig
    when: Multi-platform build needed
    then: List of DockerImage

  - name: push_image
    given: DockerImage and registry
    when: Push needed
    then: Push result

  - name: cleanup_container
    given: BuildContainer
    when: Cleanup needed
    then: Container removed

  - name: generate_dockerfile
    given: Target platform
    when: Dockerfile generation needed
    then: Dockerfile
