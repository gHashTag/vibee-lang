name: agent_auth_oauth
version: "1.0.0"
language: zig
module: agent_auth_oauth

description: |
  Agent Auth OAuth - OAuth авторизация
  Поддержка: Google, Facebook, GitHub, Apple, Microsoft
  φ² + 1/φ² = 3 | PHOENIX = 999

types:
  OAuthProvider:
    fields:
      name: String
      auth_url: String
      token_url: String
      scopes: List<String>

  OAuthButton:
    fields:
      provider: String
      selector: String
      text: String

  OAuthFlow:
    fields:
      provider: String
      state: String
      redirect_uri: String
      popup_window: Bool

  OAuthResult:
    fields:
      success: Bool
      provider: String
      access_token: Option<String>
      user_info: Option<String>
      error: Option<String>

behaviors:
  - name: detect_oauth_buttons
    given: Текущая страница
    when: Поиск кнопок OAuth
    then: Список OAuthButton

  - name: start_oauth_flow
    given: OAuthProvider провайдер
    when: Начало OAuth flow
    then: OAuthFlow с state

  - name: handle_oauth_popup
    given: OAuthFlow текущий flow
    when: Обработка popup окна
    then: OAuthResult после авторизации

  - name: handle_oauth_redirect
    given: Redirect URL с кодом
    when: Обработка redirect
    then: OAuthResult с токеном

  - name: refresh_token
    given: Refresh token
    when: Обновление access token
    then: Новый access token

  - name: revoke_access
    given: OAuthProvider и токен
    when: Отзыв доступа
    then: Доступ отозван
