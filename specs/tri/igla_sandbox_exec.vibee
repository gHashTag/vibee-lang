# VIBEE Specification - IGLA Sandbox Execution
# Safe code execution environment
# V = n × 3^k × π^m × φ^p | φ² + 1/φ² = 3 | PHOENIX = 999

name: igla_sandbox_exec
version: "1.0.0"
language: zig
module: igla_sandbox_exec

types:
  Sandbox:
    fields:
      id: String
      status: String
      memory_limit_mb: Int
      timeout_ms: Int

  ExecRequest:
    fields:
      code: String
      language: String
      stdin: String
      args: String

  ExecResult:
    fields:
      stdout: String
      stderr: String
      exit_code: Int
      duration_ms: Int

  SandboxConfig:
    fields:
      memory_limit_mb: Int
      timeout_ms: Int
      network_enabled: Bool
      filesystem_readonly: Bool

  SandboxMetrics:
    fields:
      executions_total: Int
      success_rate: Float
      avg_duration_ms: Float
      timeouts: Int

behaviors:
  - name: create_sandbox
    given: Config
    when: Creation
    then: Sandbox created

  - name: execute_code
    given: Code and language
    when: Execution
    then: Result returned

  - name: kill_execution
    given: Sandbox ID
    when: Kill request
    then: Execution terminated

  - name: cleanup_sandbox
    given: Sandbox ID
    when: Cleanup
    then: Resources freed

  - name: get_metrics
    given: Executor
    when: Metrics requested
    then: Sandbox metrics returned

test_cases:
  - name: test_create
    input: { memory: 256, timeout: 5000 }
    expected: { created: true }

  - name: test_execute
    input: { code: "print(1+1)", language: "python" }
    expected: { exit_code: 0 }

  - name: test_timeout
    input: { code: "while True: pass", timeout: 100 }
    expected: { timed_out: true }

  - name: test_metrics
    input: {}
    expected: { executions_total: 0 }
