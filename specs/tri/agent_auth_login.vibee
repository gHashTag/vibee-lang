name: agent_auth_login
version: "1.0.0"
language: zig
module: agent_auth_login

description: |
  Agent Auth Login - логин/пароль аутентификация
  OpenAI Operator: требует помощь с CAPTCHA
  VIBEE: умная аутентификация
  φ² + 1/φ² = 3 | PHOENIX = 999

types:
  LoginCredentials:
    fields:
      username: String
      password: String
      remember_me: Bool

  LoginForm:
    fields:
      username_field: String
      password_field: String
      submit_button: String
      captcha_present: Bool

  LoginResult:
    fields:
      success: Bool
      redirect_url: Option<String>
      error_message: Option<String>
      requires_2fa: Bool

  LoginState:
    fields:
      logged_in: Bool
      username: Option<String>
      session_valid: Bool
      expires_at: Option<Timestamp>

behaviors:
  - name: detect_login_form
    given: Текущая страница
    when: Поиск формы логина
    then: LoginForm или null

  - name: login
    given: LoginCredentials и LoginForm
    when: Выполнение логина
    then: LoginResult

  - name: check_login_state
    given: Текущая сессия
    when: Проверка состояния логина
    then: LoginState

  - name: logout
    given: Текущая сессия
    when: Выход из аккаунта
    then: LoginState logged_in false

  - name: handle_captcha
    given: CAPTCHA на странице
    when: Обработка CAPTCHA
    then: Запрос помощи пользователя

  - name: save_credentials
    given: LoginCredentials для сохранения
    when: Сохранение в secure storage
    then: Credentials сохранены
