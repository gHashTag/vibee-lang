# Interop ABI v56100 - Application Binary Interface
# Cross-Language ABI Compatibility Layer
# φ² + 1/φ² = 3 | PHOENIX = 999

name: interop_abi_v56100
version: "56.1.0"
language: zig
module: interop_abi

creation_pattern:
  source: PlatformTarget
  transformer: ABIResolver
  result: ABISpecification

types:
  ABIKind:
    fields:
      name: String
      platform: String
      architecture: String
      calling_convention: String

  CallingConvention:
    fields:
      name: String
      int_regs: List<String>
      float_regs: List<String>
      stack_alignment: Int
      return_in_memory_threshold: Int
      shadow_space: Int

  TypeLayout:
    fields:
      type_name: String
      size: Int
      alignment: Int
      field_offsets: List<Int>
      padding: List<Int>

  StructABI:
    fields:
      name: String
      layout: TypeLayout
      pass_by: String
      return_method: String

  FunctionABI:
    fields:
      name: String
      calling_convention: CallingConvention
      param_locations: List<String>
      return_location: String
      stack_cleanup: String

  PlatformABI:
    fields:
      name: String
      os: String
      arch: String
      conventions: List<CallingConvention>
      type_sizes: List<TypeLayout>
      alignment_rules: List<String>

  ABICompatibility:
    fields:
      source_abi: PlatformABI
      target_abi: PlatformABI
      compatible: Bool
      issues: List<String>
      thunks_needed: List<String>

  ABIThunk:
    fields:
      name: String
      source_convention: String
      target_convention: String
      code: String

behaviors:
  - name: detect_platform_abi
    given: Target triple
    when: ABI detection needed
    then: PlatformABI for target

  - name: calculate_struct_layout
    given: Struct definition and ABI
    when: Layout calculation needed
    then: TypeLayout with offsets

  - name: determine_calling_convention
    given: Function signature and ABI
    when: Call convention needed
    then: FunctionABI specification

  - name: check_abi_compatibility
    given: Two platform ABIs
    when: Cross-platform call needed
    then: ABICompatibility report

  - name: generate_abi_thunk
    given: Incompatible ABIs
    When: Thunk needed
    then: ABIThunk code

  - name: align_struct_fields
    given: Struct and target ABI
    when: Proper alignment needed
    then: Aligned struct layout

  - name: pack_function_args
    given: Arguments and ABI
    when: Function call needed
    then: Register/stack assignment

  - name: unpack_return_value
    given: Return value and ABI
    when: Return handling needed
    then: Proper value extraction
