# Tool Executor Module
# Unified tool execution with state machine
# Manus insight: Mask, Don't Remove

name: agent_tool_executor
version: "1.0.0"
language: zig
module: agent_tool_executor

types:
  Tool:
    fields:
      tool_id: String
      name: String
      description: String
      parameters_schema: String
      is_available: Bool

  ToolRegistry:
    fields:
      registry_id: String
      tools: Map<String,String>
      categories: List<String>
      total_tools: Int

  ToolCall:
    fields:
      call_id: String
      tool_name: String
      parameters: Map<String,String>
      timestamp: Timestamp

  ToolResult:
    fields:
      result_id: String
      call_id: String
      success: Bool
      output: String
      error: Option<String>
      execution_time_ms: Int

  ToolStateMachine:
    fields:
      state_id: String
      current_state: String
      allowed_tools: List<String>
      masked_tools: List<String>
      transitions: Map<String,String>

  ToolMask:
    fields:
      mask_id: String
      tool_pattern: String
      is_allowed: Bool
      reason: String

behaviors:
  - name: register_tool
    given: Tool definition
    when: Tool registration needed
    then: Returns registered tool in registry

  - name: execute_tool
    given: Tool call and environment
    when: Tool execution needed
    then: Returns tool result

  - name: mask_tools
    given: Current state and mask rules
    when: Tool masking needed
    then: Returns masked tool list without removing

  - name: validate_tool_call
    given: Tool call and schema
    when: Validation needed
    then: Returns validation result

  - name: transition_state
    given: Current state and action
    when: State transition needed
    then: Returns new state with updated masks

  - name: get_available_tools
    given: Current state machine state
    when: Tool listing needed
    then: Returns available tools for current state

  - name: handle_tool_error
    given: Tool error and context
    when: Error handling needed
    then: Returns error handling strategy
