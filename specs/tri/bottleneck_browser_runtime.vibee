name: bottleneck_browser_runtime
version: "1.0.0"
language: zig
module: bottleneck_browser_runtime

# BOTTLENECK: Browser Runtime Coordination
# Manages Electron/Chrome lifecycle and CDP connection
# Coordinates between process, CDP, and agent

types:
  BrowserConfig:
    fields:
      browser_type: String
      headless: Bool
      viewport_width: Int
      viewport_height: Int
      cdp_port: Int
      user_data_dir: Option<String>

  BrowserInstance:
    fields:
      pid: Int
      cdp_url: String
      ready: Bool
      page_url: String

  PageState:
    fields:
      url: String
      title: String
      dom_hash: String
      screenshot_available: Bool

  BrowserAction:
    fields:
      action_type: String
      selector: Option<String>
      value: Option<String>
      url: Option<String>

  ActionResult:
    fields:
      success: Bool
      error: Option<String>
      page_changed: Bool
      duration_ms: Int

behaviors:
  - name: launch_browser
    given: BrowserConfig
    when: Starting browser instance
    then: Return BrowserInstance when ready

  - name: close_browser
    given: BrowserInstance
    when: Shutting down browser
    then: Return close status

  - name: execute_action
    given: BrowserInstance and BrowserAction
    when: Agent performs action
    then: Return ActionResult

  - name: get_page_state
    given: BrowserInstance
    when: Agent needs current state
    then: Return PageState

  - name: wait_for_navigation
    given: BrowserInstance and timeout
    when: Waiting for page load
    then: Return navigation complete status

  - name: inject_script
    given: BrowserInstance and JS code
    when: Need to run custom JS
    then: Return script result
