name: pas_async_v358
version: "1.0.0"
language: zig
module: pas_async_v358

types:
  AsyncTask:
    fields:
      id: String
      operation: String
      status: String
      result: Option<Object>

  AsyncQueue:
    fields:
      pending: List<AsyncTask>
      running: List<AsyncTask>
      completed: List<AsyncTask>
      max_concurrent: Int

  AsyncConfig:
    fields:
      concurrency: Int
      timeout_ms: Int
      retry_on_error: Bool

  AsyncResult:
    fields:
      task_id: String
      success: Bool
      value: Option<Object>
      error_obj: Option<String>

  AsyncMetrics:
    fields:
      tasks_completed: Int
      avg_latency_ms: Float
      concurrency_used: Float

behaviors:
  - name: spawn_async
    given: Operation
    When: Spawn called
    then: Task queued for execution

  - name: await_task
    given: Task ID
    When: Await called
    then: Blocks until complete

  - name: await_all
    given: Multiple tasks
    When: Await all called
    then: Blocks until all complete

  - name: await_any
    given: Multiple tasks
    When: Await any called
    then: Returns first complete

  - name: cancel_task
    given: Running task
    When: Cancel called
    then: Task cancelled

  - name: timeout_task
    given: Timeout config
    When: Timeout reached
    then: Task cancelled with error

  - name: retry_failed
    given: Failed task
    When: Retry enabled
    then: Task retried

  - name: measure_concurrency
    given: Async operations
    When: Measurement runs
    then: Concurrency metrics computed
