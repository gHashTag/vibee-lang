# VIBEE Agent Communication v247
# Inter-Agent Communication Protocol

name: agent_communication_v247
version: "247.0.0"
language: zig
module: agent_communication

types:
  Message:
    fields:
      id: String
      sender: String
      receiver: String
      type: String
      content: Object
      timestamp: Timestamp

  MessageType:
    fields:
      request: String
      response: String
      broadcast: String
      notification: String

  Channel:
    fields:
      id: String
      participants: List<String>
      type: String
      buffer_size: Int

  Protocol:
    fields:
      name: String
      version: String
      encoding: String

  CommunicationMetrics:
    fields:
      messages_sent: Int
      messages_received: Int
      avg_latency_us: Float
      errors: Int

  Subscription:
    fields:
      topic: String
      subscriber: String
      filter: String

  MessageQueue:
    fields:
      pending: Int
      processing: Int
      completed: Int

behaviors:
  - name: send_message
    given: "Message to send"
    when: "Communication needed"
    then: "Deliver message"
    benchmark:
      vibee_us: 10
      playwright_us: 50
      puppeteer_us: 60
      selenium_us: 100
    deliverables:
      - "Serialization"
      - "Routing"
      - "Delivery confirmation"

  - name: receive_message
    given: "Incoming message"
    when: "Message arrives"
    then: "Process message"
    benchmark:
      vibee_us: 5
      playwright_us: 25
      puppeteer_us: 30
      selenium_us: 50
    deliverables:
      - "Deserialization"
      - "Validation"
      - "Handler dispatch"

  - name: broadcast_message
    given: "Broadcast content"
    when: "Broadcast needed"
    then: "Send to all"
    benchmark:
      vibee_us: 20
      playwright_us: 100
      puppeteer_us: 120
      selenium_us: 200
    deliverables:
      - "Recipient list"
      - "Parallel send"
      - "Acknowledgment"

  - name: subscribe_topic
    given: "Topic interest"
    when: "Subscription requested"
    then: "Register subscription"
    benchmark:
      vibee_us: 5
      playwright_us: 20
      puppeteer_us: 25
      selenium_us: 40
    deliverables:
      - "Topic registration"
      - "Filter setup"
      - "Callback binding"

  - name: request_response
    given: "Request message"
    when: "Response needed"
    then: "Wait for response"
    benchmark:
      vibee_us: 50
      playwright_us: 200
      puppeteer_us: 250
      selenium_us: 400
    deliverables:
      - "Request tracking"
      - "Timeout handling"
      - "Response correlation"

  - name: handle_disconnect
    given: "Agent disconnected"
    when: "Connection lost"
    then: "Handle gracefully"
    benchmark:
      vibee_us: 10
      playwright_us: 40
      puppeteer_us: 50
      selenium_us: 80
    deliverables:
      - "Detection"
      - "Cleanup"
      - "Reconnection"

  - name: compress_message
    given: "Large message"
    when: "Compression enabled"
    then: "Compress content"
    benchmark:
      vibee_us: 100
      playwright_us: 400
      puppeteer_us: 500
      selenium_us: 800
    deliverables:
      - "Compression"
      - "Decompression"
      - "Size optimization"

test_cases:
  - name: test_send
    input: { to: "agent2", content: "hello" }
    expected: { sent: true }

  - name: test_receive
    input: { message_id: "m1" }
    expected: { received: true }

  - name: test_broadcast
    input: { content: "update", recipients: 10 }
    expected: { delivered: 10 }

  - name: test_subscribe
    input: { topic: "events" }
    expected: { subscribed: true }

  - name: test_request
    input: { request: "status" }
    expected: { response: true }

  - name: test_disconnect
    input: { agent_id: "agent2" }
    expected: { handled: true }

  - name: test_compress
    input: { size_kb: 100 }
    expected: { compressed: true }

benchmark_summary:
  vibee_avg_us: 29
  playwright_avg_us: 119
  puppeteer_avg_us: 148
  selenium_avg_us: 239
  vibee_speedup: "4.1x-8.2x"
