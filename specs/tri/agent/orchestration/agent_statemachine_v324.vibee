name: agent_statemachine_v324
version: "1.0.0"
language: zig
module: agent_statemachine_v324

types:
  State:
    fields:
      id: String
      name: String
      entry_action: Option<String>
      exit_action: Option<String>
      is_final: Bool

  Transition:
    fields:
      from_state: String
      to_state: String
      event: String
      guard: Option<String>
      action: Option<String>

  StateMachine:
    fields:
      id: String
      initial_state: String
      states: List<State>
      transitions: List<Transition>
      context: Object

  FSMExecution:
    fields:
      machine_id: String
      current_state: String
      history: List<String>
      context: Object

  StateEvent:
    fields:
      name: String
      payload: Object
      timestamp: Timestamp

behaviors:
  - name: initialize_fsm
    given: Machine definition
    when: Initialization runs
    then: FSM starts in initial state

  - name: process_event
    given: Event received
    when: Processing runs
    then: Valid transition executed

  - name: guard_transition
    given: Guard condition exists
    when: Transition attempted
    then: Guard evaluated before transition

  - name: execute_entry_action
    given: State entered
    when: Entry runs
    then: Entry action performed

  - name: execute_exit_action
    given: State exited
    when: Exit runs
    then: Exit action performed

  - name: handle_invalid_event
    given: No valid transition
    when: Event received
    then: Event ignored or error raised

  - name: serialize_state
    given: Persistence needed
    when: Serialization runs
    then: FSM state serialized

  - name: restore_state
    given: Serialized state exists
    when: Restoration runs
    then: FSM restored to saved state
