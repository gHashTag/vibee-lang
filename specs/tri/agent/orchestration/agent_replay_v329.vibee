name: agent_replay_v329
version: "1.0.0"
language: zig
module: agent_replay_v329

types:
  RecordedAction:
    fields:
      id: String
      type: String
      target: String
      value: Option<String>
      timestamp: Timestamp
      screenshot: Option<String>

  RecordingSession:
    fields:
      id: String
      url: String
      actions: List<RecordedAction>
      duration_ms: Int
      viewport: Object

  ReplayConfig:
    fields:
      speed: Float
      pause_on_error: Bool
      screenshot_compare: Bool
      network_mock: Bool

  ReplayResult:
    fields:
      session_id: String
      success: Bool
      failed_action: Option<String>
      diff_screenshots: List<String>

  ActionDiff:
    fields:
      expected: RecordedAction
      actual: Object
      match: Bool
      difference: String

behaviors:
  - name: start_recording
    given: Page loaded
    when: Recording starts
    then: Actions captured

  - name: capture_action
    given: User action
    when: Action performed
    then: Action recorded with metadata

  - name: capture_screenshot
    given: Screenshot enabled
    when: Action recorded
    then: Screenshot captured

  - name: stop_recording
    given: Recording active
    when: Stop requested
    then: Session finalized

  - name: replay_session
    given: Recorded session
    when: Replay starts
    then: Actions replayed in order

  - name: compare_screenshots
    given: Baseline screenshots
    when: Comparison runs
    then: Visual differences detected

  - name: export_recording
    given: Session complete
    when: Export requested
    then: Recording exported to format

  - name: import_recording
    given: Recording file
    when: Import requested
    then: Session loaded for replay
