name: agent_telemetry_v328
version: "1.0.0"
language: zig
module: agent_telemetry_v328

types:
  Metric:
    fields:
      name: String
      value: Float
      unit: String
      tags: Object
      timestamp: Timestamp

  Span:
    fields:
      trace_id: String
      span_id: String
      parent_id: Option<String>
      name: String
      start_time: Timestamp
      duration_us: Int

  LogEntry:
    fields:
      level: String
      message: String
      context: Object
      timestamp: Timestamp
      trace_id: Option<String>

  TelemetryConfig:
    fields:
      metrics_enabled: Bool
      tracing_enabled: Bool
      logging_enabled: Bool
      sample_rate: Float

  Dashboard:
    fields:
      panels: List<Object>
      refresh_interval_ms: Int
      time_range: String

behaviors:
  - name: record_metric
    given: Metric data
    when: Recording runs
    then: Metric stored and aggregated

  - name: start_span
    given: Operation begins
    when: Span started
    then: Trace context propagated

  - name: end_span
    given: Operation completes
    when: Span ended
    then: Duration recorded

  - name: log_event
    given: Event occurs
    when: Logging runs
    then: Log entry created with context

  - name: correlate_traces
    given: Distributed operation
    when: Correlation runs
    then: Spans linked across services

  - name: aggregate_metrics
    given: Raw metrics
    when: Aggregation runs
    then: Statistics computed

  - name: export_telemetry
    given: Export configured
    when: Export runs
    then: Data sent to backend

  - name: alert_on_threshold
    given: Threshold defined
    when: Threshold crossed
    then: Alert triggered
