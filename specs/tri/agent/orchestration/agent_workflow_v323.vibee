name: agent_workflow_v323
version: "1.0.0"
language: zig
module: agent_workflow_v323

types:
  WorkflowStep:
    fields:
      id: String
      name: String
      action: String
      next: List<String>
      condition: Option<String>

  WorkflowDefinition:
    fields:
      id: String
      name: String
      steps: List<WorkflowStep>
      variables: Object
      version: String

  WorkflowExecution:
    fields:
      workflow_id: String
      current_step: String
      state: Object
      started_at: Timestamp
      status: String

  WorkflowResult:
    fields:
      execution_id: String
      success: Bool
      outputs: Object
      duration_ms: Int

  BranchCondition:
    fields:
      expression: String
      true_branch: String
      false_branch: String

behaviors:
  - name: parse_workflow
    given: Workflow definition
    when: Parsing runs
    then: Workflow graph constructed

  - name: execute_step
    given: Current step identified
    when: Execution runs
    then: Step action performed

  - name: evaluate_condition
    given: Branch point reached
    when: Condition evaluated
    then: Correct branch selected

  - name: handle_parallel
    given: Parallel steps defined
    when: Fork reached
    then: Steps execute concurrently

  - name: join_branches
    given: Parallel branches complete
    when: Join point reached
    then: Results merged correctly

  - name: retry_failed_step
    given: Step fails
    when: Retry policy allows
    then: Step retried with backoff

  - name: checkpoint_state
    given: Checkpoint configured
    when: Checkpoint reached
    then: State persisted for recovery

  - name: resume_workflow
    given: Checkpoint exists
    when: Resume requested
    then: Workflow continues from checkpoint
