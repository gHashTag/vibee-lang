name: agent_sandbox_v327
version: "1.0.0"
language: zig
module: agent_sandbox_v327

types:
  SandboxConfig:
    fields:
      memory_limit_mb: Int
      cpu_limit_percent: Int
      network_allowed: Bool
      filesystem_readonly: Bool

  SandboxPolicy:
    fields:
      allowed_apis: List<String>
      blocked_domains: List<String>
      max_execution_ms: Int
      allow_eval: Bool

  SandboxInstance:
    fields:
      id: String
      config: SandboxConfig
      policy: SandboxPolicy
      status: String
      pid: Int

  SecurityViolation:
    fields:
      type: String
      resource: String
      action: String
      timestamp: Timestamp
      blocked: Bool

  ResourceUsage:
    fields:
      memory_mb: Float
      cpu_percent: Float
      network_bytes: Int
      file_ops: Int

behaviors:
  - name: create_sandbox
    given: Config provided
    when: Creation requested
    then: Isolated sandbox created

  - name: execute_in_sandbox
    given: Code to run
    when: Execution requested
    then: Code runs in isolation

  - name: enforce_memory_limit
    given: Memory threshold
    when: Limit exceeded
    then: Execution terminated

  - name: enforce_cpu_limit
    given: CPU threshold
    when: Limit exceeded
    then: Execution throttled

  - name: block_network_access
    given: Network disabled
    when: Network call attempted
    then: Call blocked and logged

  - name: audit_api_calls
    given: API call made
    when: Audit enabled
    then: Call logged with details

  - name: detect_escape_attempt
    given: Suspicious activity
    when: Detection runs
    then: Attempt blocked and alerted

  - name: cleanup_sandbox
    given: Execution complete
    when: Cleanup runs
    then: Resources released securely
