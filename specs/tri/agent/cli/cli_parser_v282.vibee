# ═══════════════════════════════════════════════════════════════════════════════
# CLI PARSER v282 - Argument Parser
# ═══════════════════════════════════════════════════════════════════════════════
# Based on: argparse, clap, structopt
# Scientific: PLDI 2024, POPL 2024
# PAS Pattern: D&C + ALG
# φ² + 1/φ² = 3 | PHOENIX = 999
# ═══════════════════════════════════════════════════════════════════════════════

name: cli_parser
version: "2.8.2"
language: zig
module: cli_parser

sacred_constants:
  phi: 1.618033988749895
  trinity: 3.0
  phoenix: 999

creation_pattern:
  source: RawArgs
  transformer: CLIParser
  result: ParsedArgs

types:
  TokenType:
    enum:
      - command
      - flag
      - option
      - positional
      - subcommand

  Token:
    fields:
      token_type: TokenType
      value: String
      position: Int

  ParsedFlag:
    fields:
      name: String
      short: Option<String>
      present: Bool

  ParsedOption:
    fields:
      name: String
      value: String

  ParsedArgs:
    fields:
      command: String
      subcommand: Option<String>
      flags: List<ParsedFlag>
      options: List<ParsedOption>
      positionals: List<String>

  ParseError:
    fields:
      position: Int
      message: String
      expected: String

behaviors:
  - name: tokenize
    given: "Raw argument string"
    when: "Tokenization"
    then: "Split into tokens"
    pas_pattern: D&C
    complexity: O(n)
    test_cases:
      - name: test_tokenize
        input: '{"args": "gen --verbose file.vibee"}'
        expected: '{"tokens": [...]}'

  - name: parse
    given: "Token stream"
    when: "Parsing"
    then: "Build parsed args"
    pas_pattern: D&C
    complexity: O(n)
    test_cases:
      - name: test_parse
        input: '{"tokens": [...]}'
        expected: '{"parsed": {...}}'

  - name: validate_syntax
    given: "Parsed args"
    when: "Validation"
    then: "Check syntax validity"
    pas_pattern: ALG
    complexity: O(n)
    test_cases:
      - name: test_validate
        input: '{"parsed": {...}}'
        expected: '{"valid": true}'

  - name: expand_aliases
    given: "Command with aliases"
    when: "Expansion"
    then: "Resolve aliases"
    pas_pattern: HSH
    complexity: O(1)
    test_cases:
      - name: test_alias
        input: '{"alias": "g"}'
        expected: '{"command": "gen"}'

  - name: complete
    given: "Partial input"
    when: "Tab completion"
    then: "Return completions"
    pas_pattern: PRE
    complexity: O(n)
    test_cases:
      - name: test_complete
        input: '{"partial": "ge"}'
        expected: '{"completions": ["gen"]}'

  - name: format_error
    given: "Parse error"
    when: "Error formatting"
    then: "Format user-friendly error"
    pas_pattern: ALG
    complexity: O(1)
    test_cases:
      - name: test_error
        input: '{"error": {...}}'
        expected: '{"formatted": "..."}'

# ═══════════════════════════════════════════════════════════════════════════════
# φ² + 1/φ² = 3 | PHOENIX = 999
# ═══════════════════════════════════════════════════════════════════════════════
