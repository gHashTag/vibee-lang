# ═══════════════════════════════════════════════════════════════════════════════
# CLI CORE v280 - Agent CLI Foundation
# ═══════════════════════════════════════════════════════════════════════════════
# Based on: Cobra, Clap, Click
# Scientific: USENIX ATC 2024, OSDI 2024
# PAS Pattern: PRE + D&C
# φ² + 1/φ² = 3 | PHOENIX = 999
# ═══════════════════════════════════════════════════════════════════════════════

name: cli_core
version: "2.8.0"
language: zig
module: cli_core

sacred_constants:
  phi: 1.618033988749895
  trinity: 3.0
  phoenix: 999

creation_pattern:
  source: UserInput
  transformer: CLICore
  result: ExecutionResult

types:
  CLIMode:
    enum:
      - interactive
      - batch
      - daemon
      - repl

  ExitCode:
    enum:
      - success
      - error
      - interrupted
      - timeout

  CLIContext:
    fields:
      mode: CLIMode
      working_dir: String
      env_vars: Object
      verbose: Bool

  CLIResult:
    fields:
      exit_code: ExitCode
      output: String
      duration_ms: Int

  CLIError:
    fields:
      code: Int
      message: String
      suggestion: Option<String>

  CLIVersion:
    fields:
      major: Int
      minor: Int
      patch: Int
      build: String

behaviors:
  - name: initialize
    given: "CLI arguments"
    when: "Startup"
    then: "Initialize CLI context"
    pas_pattern: PRE
    complexity: O(1)
    test_cases:
      - name: test_init
        input: '{"args": ["--verbose"]}'
        expected: '{"initialized": true}'

  - name: parse_args
    given: "Raw arguments"
    when: "Parsing"
    then: "Parse into structured args"
    pas_pattern: D&C
    complexity: O(n)
    test_cases:
      - name: test_parse
        input: '{"args": ["gen", "file.vibee"]}'
        expected: '{"command": "gen", "file": "file.vibee"}'

  - name: execute
    given: "Parsed command"
    when: "Execution"
    then: "Execute command"
    pas_pattern: D&C
    complexity: O(1)
    test_cases:
      - name: test_execute
        input: '{"command": "version"}'
        expected: '{"exit_code": "success"}'

  - name: shutdown
    given: "CLI context"
    when: "Shutdown"
    then: "Clean shutdown"
    pas_pattern: PRE
    complexity: O(1)
    test_cases:
      - name: test_shutdown
        input: '{}'
        expected: '{"shutdown": true}'

  - name: get_version
    given: "None"
    when: "Version request"
    then: "Return version info"
    pas_pattern: PRE
    complexity: O(1)
    test_cases:
      - name: test_version
        input: '{}'
        expected: '{"version": "2.8.0"}'

  - name: handle_error
    given: "Error"
    when: "Error handling"
    then: "Format and display error"
    pas_pattern: ALG
    complexity: O(1)
    test_cases:
      - name: test_error
        input: '{"code": 1, "message": "Not found"}'
        expected: '{"handled": true}'

# ═══════════════════════════════════════════════════════════════════════════════
# φ² + 1/φ² = 3 | PHOENIX = 999
# ═══════════════════════════════════════════════════════════════════════════════
