name: gpt4v_client_v22
version: "22.4.0"
language: zig
module: gpt4v_client_v22

types:
  GPT4VConfig:
    fields:
      api_key: String
      model: String
      max_tokens: Int
      temperature: Float
      detail: String

  VisionMessage:
    fields:
      role: String
      content: List<String>

  ImageContent:
    fields:
      type: String
      image_url: Object

  TextContent:
    fields:
      type: String
      text: String

  VisionRequest:
    fields:
      model: String
      messages: List<String>
      max_tokens: Int

  VisionResponse:
    fields:
      content: String
      model: String
      usage: Object
      finish_reason: String

  GPT4VClient:
    fields:
      config: Object
      http_client: Object

behaviors:
  - name: create_client
    given: GPT4VConfig
    when: Initialize client
    then: GPT4VClient instance

  - name: analyze_image
    given: GPT4VClient and image and prompt
    when: Analyze image
    then: VisionResponse

  - name: analyze_screenshot
    given: GPT4VClient and screenshot and goal
    when: Analyze for browser action
    then: Action suggestion

  - name: describe_page
    given: GPT4VClient and screenshot
    When: Describe page content
    then: Page description

  - name: find_element
    given: GPT4VClient and screenshot and description
    When: Find element by description
    then: Element location

  - name: compare_screenshots
    given: GPT4VClient and before and after
    When: Compare screenshots
    then: Difference description

  - name: build_vision_message
    given: Text and image
    When: Build message
    then: VisionMessage

  - name: encode_image_for_api
    given: Image data
    When: Prepare for API
    then: Encoded image

  - name: parse_response
    given: API response
    When: Parse response
    then: VisionResponse

  - name: estimate_cost
    given: Image and prompt
    When: Estimate API cost
    then: Cost estimate

  - name: validate_api_key
    given: GPT4VClient
    When: Validate key
    then: Validation result
