name: dom_mutation_v338
version: "1.0.0"
language: zig
module: dom_mutation_v338

types:
  MutationRecord:
    fields:
      type: String
      target: String
      added_nodes: List<String>
      removed_nodes: List<String>
      attribute_name: Option<String>
      old_value: Option<String>

  MutationObserverConfig:
    fields:
      child_list: Bool
      attributes: Bool
      character_data: Bool
      subtree: Bool
      attribute_old_value: Bool

  MutationFilter:
    fields:
      target_selector: String
      mutation_types: List<String>
      attribute_filter: List<String>

  MutationBatch:
    fields:
      records: List<MutationRecord>
      timestamp: Timestamp
      observer_id: String

  MutationAssertion:
    fields:
      expected_type: String
      expected_target: String
      timeout_ms: Int

behaviors:
  - name: observe_mutations
    given: Target element
    When: Observer started
    then: Mutations captured

  - name: wait_for_mutation
    given: Expected mutation
    When: Wait runs
    then: Resolves when mutation occurs

  - name: filter_mutations
    given: Filter criteria
    When: Filtering runs
    then: Matching mutations returned

  - name: assert_mutation
    given: Expected mutation
    When: Assertion runs
    then: Passes if mutation occurred

  - name: stop_observing
    given: Active observer
    When: Stop called
    then: Observer disconnected

  - name: get_mutation_history
    given: Observer active
    When: History requested
    then: All mutations returned

  - name: observe_attribute
    given: Attribute name
    When: Attribute changes
    then: Change captured

  - name: observe_children
    given: Parent element
    When: Children change
    then: Add/remove captured
