name: dom_intersection_v339
version: "1.0.0"
language: zig
module: dom_intersection_v339

types:
  IntersectionEntry:
    fields:
      target: String
      is_intersecting: Bool
      intersection_ratio: Float
      bounding_rect: Object
      root_bounds: Object

  IntersectionConfig:
    fields:
      root: Option<String>
      root_margin: String
      threshold: List<Float>

  VisibilityState:
    fields:
      element: String
      visible: Bool
      percent_visible: Float
      in_viewport: Bool

  LazyLoadState:
    fields:
      total_items: Int
      loaded_items: Int
      pending_items: Int

  IntersectionAssertion:
    fields:
      target: String
      expected_visible: Bool
      min_ratio: Float
      timeout_ms: Int

behaviors:
  - name: observe_intersection
    given: Target element
    When: Observer started
    then: Visibility tracked

  - name: wait_for_visible
    given: Element selector
    When: Wait runs
    then: Resolves when visible

  - name: wait_for_hidden
    given: Element selector
    When: Wait runs
    then: Resolves when hidden

  - name: get_visibility_ratio
    given: Element
    When: Query runs
    then: Intersection ratio returned

  - name: assert_in_viewport
    given: Element
    When: Assertion runs
    then: Passes if in viewport

  - name: trigger_lazy_load
    given: Lazy element
    When: Scroll into view
    then: Lazy content loaded

  - name: observe_multiple
    given: Multiple elements
    When: Observer started
    then: All elements tracked

  - name: stop_intersection
    given: Active observer
    When: Stop called
    then: Observer disconnected
