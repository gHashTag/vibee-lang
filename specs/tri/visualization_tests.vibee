# VIBEE BitNet Visualization Tests Specification
# Священная Формула: V = n × 3^k × π^m × φ^p × e^q
# Золотое Тождество: φ² + 1/φ² = 3 | PHOENIX = 999

name: visualization_tests
version: "1.0.0"
language: python
module: tests

description: |
  Unit тесты для модуля визуализации BitNet Benchmark.
  Используют mock matplotlib для изолированного тестирования.

# ═══════════════════════════════════════════════════════════════════════════════
# Типы данных
# ═══════════════════════════════════════════════════════════════════════════════

types:
  MockFigure:
    description: "Mock объект matplotlib Figure"
    fields:
      figsize: List<Int>
      dpi: Int
      axes: List<MockAxes>

  MockAxes:
    description: "Mock объект matplotlib Axes"
    fields:
      title: String
      xlabel: String
      ylabel: String
      plots: List<Object>

# ═══════════════════════════════════════════════════════════════════════════════
# Поведения - Инициализация
# ═══════════════════════════════════════════════════════════════════════════════

behaviors:
  # --- Initialization ---
  - name: test_visualizer_init
    given: BenchmarkSuite с результатами
    when: Создание BenchmarkVisualizer
    then: Объект создан с правильной конфигурацией

  - name: test_visualizer_init_no_suite
    given: Нет suite
    when: Создание BenchmarkVisualizer(suite=None)
    then: Объект создан, методы выбрасывают ValueError

  - name: test_visualizer_custom_config
    given: Кастомная конфигурация
    when: Создание BenchmarkVisualizer(config={...})
    then: Конфигурация применена

  - name: test_check_dependencies
    given: matplotlib не установлен
    when: Вызов check_dependencies()
    then: ImportError с понятным сообщением

  # --- Latency Charts ---
  - name: test_plot_latency_histogram
    given: BenchmarkResult с raw_data
    when: Вызов plot_latency_histogram()
    then: Figure создан с гистограммой

  - name: test_plot_latency_histogram_empty
    given: BenchmarkResult с пустым raw_data
    when: Вызов plot_latency_histogram()
    then: ValueError

  - name: test_plot_latency_percentiles
    given: BenchmarkResult с metrics p50, p95, p99
    when: Вызов plot_latency_percentiles()
    then: Figure создан с bar chart

  - name: test_plot_latency_boxplot
    given: Список BenchmarkResult
    when: Вызов plot_latency_boxplot()
    then: Figure создан с boxplot

  # --- Throughput Charts ---
  - name: test_plot_throughput_bar
    given: BenchmarkResult с tokens_per_second
    when: Вызов plot_throughput_bar()
    then: Figure создан с bar chart

  - name: test_plot_throughput_scaling
    given: Список результатов с разными output_length
    when: Вызов plot_throughput_scaling()
    then: Figure создан с line chart

  # --- Memory Charts ---
  - name: test_plot_memory_bandwidth
    given: BenchmarkResult с bandwidth_gbps
    when: Вызов plot_memory_bandwidth()
    then: Figure создан с bar chart

  # --- Dashboard ---
  - name: test_plot_summary_dashboard
    given: BenchmarkSuite со всеми типами результатов
    when: Вызов plot_summary_dashboard()
    then: Figure создан с 2x2 grid

  - name: test_plot_summary_dashboard_partial
    given: BenchmarkSuite только с latency
    when: Вызов plot_summary_dashboard()
    then: Figure создан, пустые панели показывают "No data"

  # --- Save ---
  - name: test_save_single
    given: Figure и output path
    when: Вызов save(name, fig, output_dir)
    then: Файл сохранён в указанном формате

  - name: test_save_all
    given: Несколько созданных figures
    when: Вызов save_all(output_dir)
    then: Все файлы сохранены

  - name: test_save_formats
    given: Figure
    when: Вызов save с formats=["png", "svg", "pdf"]
    then: Три файла созданы

  # --- Cleanup ---
  - name: test_close_all
    given: Несколько открытых figures
    when: Вызов close_all()
    then: Все figures закрыты, список очищен

# ═══════════════════════════════════════════════════════════════════════════════
# Тестовые данные
# ═══════════════════════════════════════════════════════════════════════════════

test_data:
  sample_latency_data:
    - 10.5
    - 11.2
    - 10.8
    - 12.1
    - 10.3
    - 11.0
    - 10.9
    - 11.5
    - 10.7
    - 11.1

  sample_metrics:
    mean: 11.01
    p50: 10.95
    p95: 12.1
    p99: 12.1
    min: 10.3
    max: 12.1

# ═══════════════════════════════════════════════════════════════════════════════
# Метаданные
# ═══════════════════════════════════════════════════════════════════════════════

metadata:
  author: "VIBEE Project"
  created: "2025-01-25"
  test_framework: "pytest"
  mock_library: "unittest.mock"
