# vsync_v2643.vibee - VSync and Frame Timing
# Синхронизация с частотой обновления дисплея
# φ² + 1/φ² = 3 | PHOENIX = 999

name: vsync_v2643
version: "2643.0.0"
language: zig
module: vsync_v2643

types:
  VSyncConfig:
    fields:
      enabled: Bool
      adaptive: Bool
      target_fps: Int
      max_frame_latency: Int

  DisplayInfo:
    fields:
      refresh_rate: Int
      variable_refresh: Bool
      min_refresh: Int
      max_refresh: Int

  FrameTiming:
    fields:
      frame_start: Timestamp
      frame_end: Timestamp
      vsync_time: Timestamp
      present_time: Timestamp
      frame_duration_ms: Float

  TimingStats:
    fields:
      avg_fps: Float
      frame_time_variance: Float
      missed_vsyncs: Int
      total_frames: Int

  SyncMode:
    fields:
      mode: String
      tear_line: Int
      latency_ms: Float

behaviors:
  - name: wait_vsync
    given: VSyncConfig
    when: Frame complete
    then: Wait for vsync

  - name: get_display_info
    given: None
    when: Display query
    then: Return DisplayInfo

  - name: record_frame_timing
    given: FrameTiming
    when: Frame presented
    then: Store timing data

  - name: get_timing_stats
    given: Time window
    when: Stats query
    then: Return TimingStats

  - name: set_sync_mode
    given: SyncMode
    when: Mode change
    then: Apply sync mode

sacred_constants:
  phi: 1.618033988749895
  phoenix: 999
