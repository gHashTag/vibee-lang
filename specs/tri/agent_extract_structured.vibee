name: agent_extract_structured
version: "1.0.0"
language: zig
module: agent_extract_structured

description: |
  Agent Extract Structured - структурированный вывод JSON/CSV
  Научные основы: WebVoyager structured output
  φ² + 1/φ² = 3 | PHOENIX = 999

types:
  ExtractionSchema:
    fields:
      name: String
      fields: List<String>
      field_types: String
      required_fields: List<String>

  ExtractedData:
    fields:
      schema_name: String
      data: String
      records_count: Int
      extraction_time_ms: Float

  ExportConfig:
    fields:
      format: String
      pretty_print: Bool
      include_metadata: Bool

  PriceInfo:
    fields:
      amount: Float
      currency: String
      original_text: String

  ProductInfo:
    fields:
      name: String
      price: String
      description: String
      image_url: Option<String>
      rating: Option<Float>

behaviors:
  - name: extract_by_schema
    given: ExtractionSchema схема
    when: Извлечение по схеме
    then: ExtractedData в JSON

  - name: extract_prices
    given: Текущая страница
    when: Извлечение всех цен
    then: Список PriceInfo

  - name: extract_products
    given: Страница с товарами
    when: Извлечение информации о товарах
    then: Список ProductInfo

  - name: export_json
    given: ExtractedData и ExportConfig
    when: Экспорт в JSON
    then: JSON строка

  - name: export_csv
    given: ExtractedData и ExportConfig
    when: Экспорт в CSV
    then: CSV строка

  - name: validate_extracted
    given: ExtractedData и ExtractionSchema
    when: Валидация извлечённых данных
    then: Список ошибок валидации
