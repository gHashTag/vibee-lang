# VIBEE Specification: Agent Mirror - Self-Observation System
# Based on: MIRIX, AFRAgent, Ferret-UI, WebGym, DAVE
# Author: Dmitrii Vasilev
# Revolutionary: Agent sees itself like in a mirror

name: agent_mirror
version: "1.0.0"
language: "999"
module: ⲍⲉⲣⲕⲁⲗⲟ_ⲁⲅⲉⲛⲧⲁ

creation_pattern:
  source: CanvasState
  transformer: SelfObserver
  result: VisualFeedback

description: |
  ЗЕРКАЛО АГЕНТА - Revolutionary self-observation system
  
  Agent can SEE ITSELF and AUTO-CORRECT issues:
  1. Canvas pixel analysis (real-time)
  2. Element overlap detection
  3. Contrast and readability checks
  4. FPS and performance monitoring
  5. Layout validation
  6. Auto-fix suggestions
  
  Based on scientific research:
  - MIRIX (arXiv:2507.07957) - Screen monitoring + memory
  - AFRAgent (arXiv:2512.00846) - GUI visual understanding
  - Ferret-UI (arXiv:2404.05719) - Grounded UI understanding
  - WebGym (arXiv:2601.02439) - Visual web agent training
  - DAVE (arXiv:2512.17221) - Vision encoder for web agents

# ═══════════════════════════════════════════════════════════════════
# SENSOR TYPES (All possible sensors)
# ═══════════════════════════════════════════════════════════════════

sensors:
  # Visual sensors
  pixel_analyzer:
    type: "visual"
    description: "Analyzes canvas pixels in real-time"
    metrics: ["brightness", "contrast", "color_distribution", "empty_regions"]
    frequency: "every_frame"
    
  element_detector:
    type: "visual"
    description: "Detects UI elements and their boundaries"
    metrics: ["bounding_boxes", "overlaps", "z_index_conflicts"]
    frequency: "every_100ms"
    
  text_readability:
    type: "visual"
    description: "Checks text contrast and size"
    metrics: ["contrast_ratio", "font_size", "line_height"]
    frequency: "on_change"
    
  # Performance sensors
  fps_monitor:
    type: "performance"
    description: "Monitors frames per second"
    metrics: ["current_fps", "avg_fps", "min_fps", "frame_drops"]
    frequency: "every_frame"
    
  memory_monitor:
    type: "performance"
    description: "Monitors memory usage"
    metrics: ["heap_used", "heap_total", "gc_frequency"]
    frequency: "every_1000ms"
    
  latency_monitor:
    type: "performance"
    description: "Monitors response latency"
    metrics: ["render_time", "input_latency", "network_latency"]
    frequency: "on_event"
    
  # Interaction sensors
  input_tracker:
    type: "interaction"
    description: "Tracks user input patterns"
    metrics: ["click_positions", "scroll_patterns", "typing_speed"]
    frequency: "on_event"
    
  gaze_tracker:
    type: "interaction"
    description: "Tracks gaze position (mouse proxy)"
    metrics: ["gaze_x", "gaze_y", "dwell_time", "saccades"]
    frequency: "every_frame"
    
  # Layout sensors
  overlap_detector:
    type: "layout"
    description: "Detects element overlaps"
    metrics: ["overlap_pairs", "overlap_area", "severity"]
    frequency: "on_change"
    
  alignment_checker:
    type: "layout"
    description: "Checks element alignment"
    metrics: ["grid_alignment", "center_offset", "spacing_consistency"]
    frequency: "on_change"
    
  scroll_analyzer:
    type: "layout"
    description: "Analyzes scroll behavior"
    metrics: ["scroll_position", "content_height", "visible_area", "scroll_needed"]
    frequency: "on_scroll"

# ═══════════════════════════════════════════════════════════════════
# BEHAVIORS
# ═══════════════════════════════════════════════════════════════════

behaviors:
  - name: capture_visual_state
    given: Canvas rendering active
    when: Every frame
    then: Full visual state captured and analyzed
    scientific_basis: "MIRIX - Screen monitoring"
    test_cases:
      - name: capture_frame
        input: { canvas_id: "c" }
        expected: { pixels: true, dimensions: true, timestamp: true }

  - name: detect_overlaps
    given: Visual state captured
    when: Elements rendered
    then: Overlapping elements identified
    scientific_basis: "AFRAgent - Widget identification"
    test_cases:
      - name: detect_jarvis_overlap
        input: { elements: ["jarvis_panel", "steps_panel"] }
        expected: { overlaps: [], severity: 0 }

  - name: check_contrast
    given: Text elements present
    when: Readability check triggered
    then: Contrast ratios calculated
    scientific_basis: "WCAG 2.1 guidelines"
    test_cases:
      - name: check_message_contrast
        input: { foreground: "#B4DCFF", background: "#003C64" }
        expected: { ratio: 7.5, passes_aa: true, passes_aaa: true }

  - name: monitor_performance
    given: Rendering loop active
    when: Every frame
    then: Performance metrics collected
    scientific_basis: "WebGym - Real-time feedback"
    test_cases:
      - name: check_fps
        input: { target_fps: 60 }
        expected: { current_fps: ">30", status: "acceptable" }

  - name: generate_fix_suggestions
    given: Issues detected
    when: Auto-fix enabled
    then: Correction suggestions generated
    scientific_basis: "Ferret-UI - Grounded understanding"
    test_cases:
      - name: suggest_overlap_fix
        input: { issue: "overlap", elements: ["panel_a", "panel_b"] }
        expected: { suggestion: "reposition", confidence: 0.85 }

  - name: auto_correct_issues
    given: Fix suggestion approved
    when: Auto-correct enabled
    then: Issue automatically corrected
    scientific_basis: "DAVE - Vision encoder feedback"
    test_cases:
      - name: auto_fix_overlap
        input: { suggestion: "reposition", target: "steps_panel" }
        expected: { fixed: true, new_position: { y: "+100" } }

  - name: render_mirror_view
    given: Self-observation active
    when: Mirror mode enabled
    then: Agent sees itself with annotations
    scientific_basis: "Novel - Self-reflection UI"
    test_cases:
      - name: render_annotations
        input: { show_overlaps: true, show_fps: true }
        expected: { annotations: ["fps_counter", "overlap_markers"] }

# ═══════════════════════════════════════════════════════════════════
# MIRROR VIEW COMPONENTS
# ═══════════════════════════════════════════════════════════════════

mirror_components:
  fps_counter:
    position: "top-left"
    color: "dynamic"  # Green > 30, Yellow > 15, Red < 15
    coptic: ⲪⲠⲤ
    
  memory_gauge:
    position: "top-left"
    color: "dynamic"  # Based on usage %
    coptic: ⲠⲀⲘⲀⲦ
    
  overlap_markers:
    position: "on_elements"
    color: "rgba(255, 0, 0, 0.5)"
    coptic: ⲠⲈⲢⲈⲔⲢ
    
  contrast_warnings:
    position: "on_text"
    color: "rgba(255, 255, 0, 0.5)"
    coptic: ⲔⲞⲚⲦⲢ
    
  scroll_indicator:
    position: "right-edge"
    color: "rgba(0, 150, 255, 0.5)"
    coptic: ⲤⲔⲢⲞⲖ
    
  health_score:
    position: "top-right"
    color: "dynamic"
    coptic: ⲌⲆⲞⲢⲞⲂ

exports:
  - capture_visual_state
  - detect_overlaps
  - check_contrast
  - monitor_performance
  - generate_fix_suggestions
  - auto_correct_issues
  - render_mirror_view
