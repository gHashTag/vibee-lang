# Layer 32: Neural Color Grading & Style Transfer
# SA-LUT and photorealistic style transfer
# Author: Dmitrii Vasilev

name: layer_32_color_grading
version: "1.0.0"
language: 999
module: neural_color_grading

creation_pattern:
  source: ContentImage
  transformer: SpatialAdaptive4DLUT
  result: StylizedImage

# ═══════════════════════════════════════════════════════════════════════════════
# SA-LUT (2506.13465) - Spatial Adaptive 4D Look-Up Table
# ═══════════════════════════════════════════════════════════════════════════════

sa_lut:
  paper: "SA-LUT: Spatial Adaptive 4D Look-Up Table for Photorealistic Style Transfer"
  arxiv: "2506.13465"
  authors: ["Gong", "Wu", "Tao", "Li", "Loy"]
  
  concept:
    description: "Combines LUT efficiency with neural network adaptability"
    problem_solved: "Global LUTs lack local adaptability"
    
  architecture:
    style_guided_4d_lut_generator:
      input: "Style image"
      process: "Multi-scale feature extraction"
      output: "4D LUT (RGB + context dimension)"
      
    context_generator:
      input: "Content image, style features"
      process: "Content-style cross-attention"
      output: "Context map for spatial adaptation"
      
  key_innovations:
    - 4d_lut: "Adds context dimension to traditional 3D LUT"
    - spatial_adaptive: "Different transformations per region"
    - cross_attention: "Content-style alignment"
    - structure_preservation: "Maintains content integrity"
    
  performance:
    lpips_reduction: "66.7% vs 3D LUT"
    speed: "16 FPS for video"
    quality: "Photorealistic style transfer"
    
  benchmark:
    name: "PST50"
    description: "First benchmark for photorealistic style transfer"
    images: 50
    metrics: ["LPIPS", "SSIM", "User study"]

pas_prediction:
  target: "Neural Color Grading"
  current: "3D LUT"
  predicted: "Spatial adaptive 4D LUT"
  confidence: 0.85
  timeline: "2025"
  patterns: [MLS, PRE]

behaviors:
  - name: extract_style_features
    given: Style reference image
    when: Style features are extracted
    then: Multi-scale style representation created
    
  - name: generate_4d_lut
    given: Style features
    when: 4D LUT is generated
    then: Context-aware color transformation ready
    
  - name: apply_spatial_style
    given: Content image and 4D LUT
    when: Style transfer is applied
    then: Photorealistic stylized image produced
    
  - name: process_video
    given: Video frames and style
    when: Video stylization is applied
    then: Temporally consistent stylized video at 16 FPS
