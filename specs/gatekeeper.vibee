# ============================================
# GATEKEEPER - Страж единственного пути
# Guardian of the only way
# .vibee → .999
# ============================================

name: gatekeeper
version: "1.0.0"
target: 999
module: Ⲙ_gatekeeper

creation_pattern:
  source: AnyFile
  transformer: Validation
  result: PassOrBlock

# ============================================
# СТРОГИЕ ПРАВИЛА / STRICT RULES
# ============================================

strict_rules:
  - rule: ONLY_VIBEE_SOURCE
    description_ru: "Весь код генерируется ТОЛЬКО из .vibee"
    description_en: "All code is generated ONLY from .vibee"
    violation: FATAL

  - rule: ONLY_999_OUTPUT
    description_ru: "Выход ТОЛЬКО в .999 формате"
    description_en: "Output ONLY in .999 format"
    violation: FATAL

  - rule: GENERATION_MARKER_REQUIRED
    description_ru: "Каждый .999 файл должен иметь маркер генерации"
    description_en: "Every .999 file must have generation marker"
    violation: FATAL

  - rule: NO_MANUAL_CODE
    description_ru: "РУЧНОЙ КОД - АНТИПАТТЕРН!"
    description_en: "MANUAL CODE IS ANTIPATTERN!"
    violation: FATAL

# ============================================
# ТИПЫ / TYPES
# ============================================

types:
  - name: ViolationType
    enum:
      - FORBIDDEN_LANGUAGE
      - MANUAL_CODE
      - MISSING_MARKER
      - MISSING_SOURCE

  - name: Violation
    fields:
      - type: ViolationType
      - path: Ⲧⲉⲝⲧ
      - message_ru: Ⲧⲉⲝⲧ
      - message_en: Ⲧⲉⲝⲧ

# ============================================
# КОНСТАНТЫ / CONSTANTS
# ============================================

constants:
  - name: FORBIDDEN
    value: [".py", ".js", ".ts", ".go", ".rs", ".zig", ".c", ".cpp"]
    
  - name: ALLOWED
    value: [".vibee", ".999"]
    
  - name: MARKER
    value: "Сгенерировано из:"

# ============================================
# ПОВЕДЕНИЯ / BEHAVIORS
# ============================================

behaviors:
  - name: check_file
    given: "Путь к файлу / File path"
    when: "Проверка файла / File check"
    then: "△ если валиден, ▽ если нарушение / △ if valid, ▽ if violation"
    test_cases:
      - name: reject_python
        input: {path: "script.py"}
        expected: {valid: false, type: FORBIDDEN_LANGUAGE}
      - name: accept_vibee
        input: {path: "spec.vibee"}
        expected: {valid: true}
      - name: reject_manual_999
        input: {path: "manual.999", has_marker: false}
        expected: {valid: false, type: MANUAL_CODE}

  - name: check_generated
    given: ".999 файл / .999 file"
    when: "Проверка маркера / Marker check"
    then: "△ если есть маркер / △ if has marker"

  - name: check_directory
    given: "Путь к директории / Directory path"
    when: "Рекурсивная проверка / Recursive check"
    then: "△ если все файлы валидны / △ if all files valid"

  - name: fatal_error
    given: "Нарушение обнаружено / Violation detected"
    when: "Строгий режим / Strict mode"
    then: "Блокировка с сообщением / Block with message"

# ============================================
# ИНТЕРФЕЙС / INTERFACE
# ============================================

interface:
  - name: check
    params: [{path: Ⲧⲉⲝⲧ}]
    returns: Ⲃⲟⲟⲗ

  - name: check_dir
    params: [{dir: Ⲧⲉⲝⲧ}]
    returns: Ⲃⲟⲟⲗ

  - name: report
    returns: Ⲃⲟⲓⲇ

  - name: fatal
    returns: Ⲃⲟⲓⲇ

# ============================================
# CLI
# ============================================

cli:
  name: gatekeeper
  commands:
    - name: check
      args: ["<path>"]
      flags: ["--strict"]
      action: "check(path)"

# ============================================
# МЕТАДАННЫЕ / METADATA
# ============================================

metadata:
  purpose_ru: "Блокировка ручного кода"
  purpose_en: "Block manual code"
  mantra: ".vibee → .999 ЕДИНСТВЕННЫЙ ПУТЬ / THE ONLY WAY"
