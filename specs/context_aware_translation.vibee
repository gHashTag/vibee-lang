name: context_aware_translation
version: "2.0.0"
language: zig
module: context_translation
target: context_translator.zig
description: Multi-layer context-aware translation with idiom support

behaviors:
  - name: detect_idiom
    given: English phrase
    when: Idiom detection requested
    then: Idiom identified or marked as literal
    test_cases:
      - name: break_a_leg_idiom
        input: {phrase: "Break a leg"}
        expected: {is_idiom: true, idiom_id: "break_a_leg"}
      - name: literal_break
        input: {phrase: "I broke my leg"}
        expected: {is_idiom: false}

  - name: translate_idiom
    given: Detected idiom
    when: Translation to Russian requested
    then: Cultural equivalent returned
    test_cases:
      - name: break_a_leg_to_russian
        input: {idiom: "break_a_leg", target: "russian"}
        expected: {translation: "Ни пуха ни пера", confidence: 0.95}
      - name: raining_cats_and_dogs
        input: {idiom: "raining_cats_and_dogs", target: "russian"}
        expected: {translation: "Льёт как из ведра", confidence: 0.90}

  - name: translate_with_context
    given: Text with idioms and context
    when: Full translation requested
    then: Contextually appropriate translation returned
    test_cases:
      - name: theater_context
        input: {text: "Break a leg!", context: "Theater"}
        expected: {translation: "Ни пуха ни пера!", confidence: 0.95}

types:
  IdiomDetection:
    is_idiom: Bool
    idiom_id: String
    confidence: Float
    
  IdiomMapping:
    source_idiom: String
    target_idiom: String
    confidence: Float
    meaning: String
    domain: String
    
  TranslationContext:
    domain: String
    formality: String
    emotion: String

functions:
  - name: detect_idiom
    params: {phrase: String}
    returns: Result<IdiomDetection, Error>
    
  - name: translate_idiom
    params: {idiom_id: String, target_lang: String}
    returns: Result<IdiomMapping, Error>
    
  - name: translate_with_context
    params: {text: String, context: TranslationContext}
    returns: Result<String, Error>

idiom_database:
  break_a_leg:
    meaning: "Good luck"
    domain: "Theater"
    russian: "Ни пуха ни пера"
    
  raining_cats_and_dogs:
    meaning: "Heavy rain"
    domain: "Weather"
    russian: "Льёт как из ведра"
    
  piece_of_cake:
    meaning: "Very easy"
    domain: "General"
    russian: "Проще простого"
    
  hit_the_nail_on_the_head:
    meaning: "Exactly right"
    domain: "General"
    russian: "Попасть в точку"
    
  spill_the_beans:
    meaning: "Reveal a secret"
    domain: "General"
    russian: "Раскрыть секрет"

imports:
  - std
  - std.mem
  - std.hash_map
