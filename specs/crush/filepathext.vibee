# filepathext.vibee - Filepath Extension Utilities
# Author: Dmitrii Vasilev
# Source: github.com/charmbracelet/crush/internal/filepathext

name: filepathext
version: "1.0.0"
language: zig
module: filepathext

sacred_formula:
  V: "n × 3^k × π^m × φ^p × e^q"
  golden_identity: "φ² + 1/φ² = 3"
  self_evolution: enabled

creation_pattern:
  source: PathComponents
  transformer: SmartPathResolver
  result: ResolvedPath

# Smart filepath utilities with cross-platform support

behaviors:
  - name: smart_join
    given: "Two path components"
    when: "SmartJoin(one, two) is called"
    then: "Returns joined path, treating second as absolute if it is"
    test_cases:
      - name: join_relative
        input:
          one: "/home/user"
          two: "documents"
        expected: "/home/user/documents"
      - name: join_absolute_second
        input:
          one: "/home/user"
          two: "/etc/config"
        expected: "/etc/config"
      - name: join_empty_first
        input:
          one: ""
          two: "file.txt"
        expected: "file.txt"
      - name: join_empty_second
        input:
          one: "/home/user"
          two: ""
        expected: "/home/user"

  - name: smart_is_abs
    given: "A file path"
    when: "SmartIsAbs(path) is called"
    then: "Returns true if path is absolute (OS-aware)"
    test_cases:
      - name: unix_absolute
        input: "/home/user"
        expected: true
      - name: unix_relative
        input: "documents/file.txt"
        expected: false
      - name: windows_absolute_drive
        input: "C:\\Users\\user"
        os: windows
        expected: true
      - name: windows_unix_style
        input: "/Users/user"
        os: windows
        expected: true
      - name: current_dir
        input: "."
        expected: false
      - name: parent_dir
        input: ".."
        expected: false

  - name: cross_platform_handling
    given: "Path with mixed separators"
    when: "SmartIsAbs is called on Windows"
    then: "Handles both / and \\ separators"
    test_cases:
      - name: forward_slash_windows
        input: "/path/to/file"
        os: windows
        expected: true
      - name: backslash_windows
        input: "\\path\\to\\file"
        os: windows
        expected: true

algorithms:
  - name: smart_path_resolution
    complexity: "O(n) where n = path length"
    description: "Resolve path considering OS-specific rules"
    steps:
      - "Check if second path is absolute"
      - "If absolute, return second path"
      - "Otherwise, join paths with separator"

pas_analysis:
  current_algorithm: "String prefix checking"
  current_complexity: "O(n)"
  theoretical_lower_bound: "Ω(1) for cached paths"
  gap: 1
  patterns_applicable:
    - pattern: PRE
      reason: "Common paths could be cached"
    - pattern: HSH
      reason: "Path normalization could use hashing"
  prediction:
    target: "Path resolution"
    current: "O(n)"
    predicted: "O(1) for common paths"
    confidence: 0.65
    timeline: "2026"
    reasoning: "LRU cache for frequently accessed paths"

dependencies:
  - "path/filepath"
  - "runtime"
  - "strings"

test_generation:
  strategy: property_based
  coverage_target: 95
  edge_cases:
    - "empty paths"
    - "paths with only separators"
    - "very long paths"
    - "unicode in paths"
    - "trailing separators"
    - "double separators"
