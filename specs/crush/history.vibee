# history.vibee - File History Module
# Author: Dmitrii Vasilev
# Source: github.com/charmbracelet/crush/internal/history

name: history
version: "1.0.0"
language: zig
module: history

sacred_formula:
  V: "n × 3^k × π^m × φ^p × e^q"
  golden_identity: "φ² + 1/φ² = 3"

creation_pattern:
  source: FileContent
  transformer: VersionManager
  result: VersionedFile

behaviors:
  - name: create
    given: "Session ID, path, content"
    when: "Create is called"
    then: "Creates initial version of file"

  - name: create_version
    given: "Existing file"
    when: "CreateVersion is called"
    then: "Creates new version with incremented number"

  - name: get
    given: "File ID"
    when: "Get is called"
    then: "Returns file record"

  - name: list_by_session
    given: "Session ID"
    when: "ListBySession is called"
    then: "Returns all files for session"

  - name: delete
    given: "File ID"
    when: "Delete is called"
    then: "Removes file record"

dependencies:
  - "database/sql"
  - "pubsub"
