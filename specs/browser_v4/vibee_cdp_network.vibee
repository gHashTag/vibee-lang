# VIBEE CDP Network v4.0.0
# Network interception and monitoring
# KOSCHEI CYCLE: УТКА (Duck) - Classical Execution

name: vibee_cdp_network
version: "4.0.0"
language: zig
module: vibee_cdp_network

constants:
  PHI: 1.6180339887498948482
  PHOENIX: 999
  MAX_BODY_SIZE: 10485760
  INTERCEPT_TIMEOUT_MS: 5000

types:
  Request:
    fields:
      request_id: String
      url: String
      method: String
      headers: Map<String, String>
      post_data: Option<String>
      resource_type: String

  Response:
    fields:
      request_id: String
      url: String
      status: Int
      status_text: String
      headers: Map<String, String>
      mime_type: String

  InterceptedRequest:
    fields:
      interception_id: String
      request: Object
      frame_id: String
      resource_type: String
      is_navigation: Bool

  NetworkConditions:
    fields:
      offline: Bool
      latency_ms: Int
      download_throughput: Int
      upload_throughput: Int

  Cookie:
    fields:
      name: String
      value: String
      domain: String
      path: String
      expires: Int
      http_only: Bool
      secure: Bool

  CacheEntry:
    fields:
      url: String
      response: Object
      body: List<Int>

behaviors:
  - name: enable_network
    given: Page
    when: Enable network domain
    then: Network events enabled

  - name: set_request_interception
    given: Patterns
    when: Enable interception
    then: Interception active

  - name: continue_request
    given: Interception ID
    when: Allow request
    then: Request continued

  - name: fulfill_request
    given: Interception ID and response
    when: Mock response
    then: Response sent

  - name: fail_request
    given: Interception ID and reason
    when: Block request
    then: Request failed

  - name: get_response_body
    given: Request ID
    when: Get body
    then: Body bytes

  - name: set_extra_headers
    given: Headers map
    when: Add headers
    then: Headers set

  - name: emulate_conditions
    given: NetworkConditions
    when: Throttle network
    then: Conditions applied

  - name: get_cookies
    given: URLs
    when: Get cookies
    then: Cookie list

  - name: set_cookie
    given: Cookie
    when: Set cookie
    then: Cookie set

  - name: clear_cache
    given: Nothing
    when: Clear browser cache
    then: Cache cleared

  - name: get_har
    given: Page
    when: Export HAR
    then: HAR JSON

test_cases:
  - name: test_intercept
    input:
      pattern: "*"
    expected:
      interception_enabled: true

  - name: test_mock_response
    input:
      status: 200
      body: "mocked"
    expected:
      fulfilled: true
