# VIBEE VSCode Terminal v4.0.0
# Integrated terminal with PTY support

name: vibee_vscode_terminal
version: "4.0.0"
language: zig
module: vibee_vscode_terminal

constants:
  PHI: 1.6180339887498948482
  PHOENIX: 999
  DEFAULT_COLS: 80
  DEFAULT_ROWS: 24
  SCROLLBACK: 10000

types:
  TerminalConfig:
    fields:
      shell: String
      args: List<String>
      cwd: String
      env: Map<String, String>
      cols: Int
      rows: Int

  Terminal:
    fields:
      id: String
      name: String
      pid: Int
      active: Bool
      exit_code: Option<Int>

  TerminalData:
    fields:
      terminal_id: String
      data: String

  TerminalDimensions:
    fields:
      cols: Int
      rows: Int

  TerminalLink:
    fields:
      start_index: Int
      length: Int
      url: String

behaviors:
  - name: create_terminal
    given: TerminalConfig
    when: Spawn terminal
    then: Terminal created

  - name: write
    given: Terminal and data
    when: Write to stdin
    then: Data written

  - name: resize
    given: Terminal and dimensions
    when: Resize PTY
    then: Terminal resized

  - name: kill
    given: Terminal
    when: Kill process
    then: Terminal killed

  - name: on_data
    given: Terminal and callback
    when: Register data handler
    then: Handler registered

  - name: on_exit
    given: Terminal and callback
    when: Register exit handler
    then: Handler registered

  - name: show
    given: Terminal
    when: Show terminal
    then: Terminal visible

  - name: hide
    given: Terminal
    when: Hide terminal
    then: Terminal hidden

  - name: clear
    given: Terminal
    when: Clear buffer
    then: Buffer cleared

  - name: scroll_to_bottom
    given: Terminal
    when: Scroll down
    then: At bottom

  - name: get_selection
    given: Terminal
    when: Get selected text
    then: Selection text

  - name: detect_links
    given: Terminal data
    when: Find URLs
    then: TerminalLink list

test_cases:
  - name: test_create_terminal
    input:
      shell: "/bin/bash"
    expected:
      created: true

  - name: test_write
    input:
      data: "echo hello"
    expected:
      written: true
