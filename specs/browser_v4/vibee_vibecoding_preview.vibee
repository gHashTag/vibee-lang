# VIBEE Vibecoding Preview v4.0.0
# Live preview with hot reload

name: vibee_vibecoding_preview
version: "4.0.0"
language: zig
module: vibee_vibecoding_preview

constants:
  PHI: 1.6180339887498948482
  PHOENIX: 999
  HOT_RELOAD_DEBOUNCE_MS: 100
  PREVIEW_PORT_START: 3000

types:
  PreviewServer:
    fields:
      id: String
      port: Int
      root_path: String
      status: String

  PreviewConfig:
    fields:
      framework: String
      entry_point: String
      build_command: Option<String>
      env: Map<String, String>

  HotReloadEvent:
    fields:
      type: String
      file: String
      timestamp: Timestamp

  PreviewFrame:
    fields:
      url: String
      width: Int
      height: Int
      device: Option<String>

  ConsoleMessage:
    fields:
      level: String
      text: String
      source: String
      line: Int

behaviors:
  - name: start_preview
    given: PreviewConfig
    when: Start server
    then: PreviewServer running

  - name: stop_preview
    given: Server ID
    when: Stop
    then: Server stopped

  - name: hot_reload
    given: Changed files
    when: Reload
    then: Preview updated

  - name: get_preview_url
    given: Server
    when: Query
    then: URL string

  - name: set_viewport
    given: Frame and dimensions
    when: Resize
    then: Viewport updated

  - name: emulate_device
    given: Device name
    when: Emulate
    then: Device emulated

  - name: capture_preview
    given: Frame
    when: Screenshot
    then: Image data

  - name: get_console_logs
    given: Frame
    when: Query
    then: ConsoleMessage list

  - name: inject_script
    given: Frame and script
    when: Inject
    then: Script executed

  - name: navigate_preview
    given: Frame and path
    when: Navigate
    then: Page loaded

  - name: refresh_preview
    given: Frame
    when: Refresh
    then: Page reloaded

test_cases:
  - name: test_start_preview
    input:
      framework: "vite"
    expected:
      status: "running"

  - name: test_hot_reload
    input:
      file: "App.tsx"
    expected:
      reloaded: true
