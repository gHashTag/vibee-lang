# VIBEE E2E Browser Agent v4.0.0
# End-to-end testing for browser agent

name: vibee_e2e_browser_agent
version: "4.0.0"
language: zig
module: vibee_e2e_browser_agent

constants:
  PHI: 1.6180339887498948482
  PHOENIX: 999
  TEST_TIMEOUT_MS: 60000
  RETRY_COUNT: 3

types:
  E2ETest:
    fields:
      id: String
      name: String
      steps: List<Object>
      timeout_ms: Int

  TestStep:
    fields:
      action: String
      target: Option<String>
      value: Option<String>
      assertion: Option<Object>

  TestResult:
    fields:
      test_id: String
      passed: Bool
      duration_ms: Float
      steps_passed: Int
      steps_failed: Int
      error: Option<String>
      screenshots: List<String>

  TestSuite:
    fields:
      name: String
      tests: List<String>
      setup: Option<Object>
      teardown: Option<Object>

  Assertion:
    fields:
      type: String
      expected: String
      actual: Option<String>
      passed: Bool

behaviors:
  - name: create_test
    given: Test config
    when: Create
    then: E2ETest ready

  - name: run_test
    given: E2ETest
    when: Execute
    then: TestResult

  - name: run_suite
    given: TestSuite
    when: Execute all
    then: Results list

  - name: assert_element_exists
    given: Selector
    when: Check
    then: Assertion result

  - name: assert_text_contains
    given: Selector and text
    when: Check
    then: Assertion result

  - name: assert_url_matches
    given: Pattern
    when: Check
    then: Assertion result

  - name: assert_screenshot_matches
    given: Baseline
    when: Compare
    then: Assertion result

  - name: wait_for_navigation
    given: Timeout
    when: Wait
    then: Navigation complete

  - name: wait_for_element
    given: Selector and timeout
    when: Wait
    then: Element found

  - name: capture_on_failure
    given: Test
    when: Failure
    then: Screenshot captured

  - name: generate_report
    given: Results
    when: Generate
    then: HTML report

  - name: retry_failed
    given: Failed tests
    when: Retry
    then: Retry results

test_cases:
  - name: test_navigation
    input:
      url: "about:blank"
    expected:
      passed: true

  - name: test_click_action
    input:
      selector: "button"
    expected:
      clicked: true
