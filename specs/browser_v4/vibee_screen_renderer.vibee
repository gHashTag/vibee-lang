# VIBEE Screen Renderer v4.0.0
# Fast rendering pipeline

name: vibee_screen_renderer
version: "4.0.0"
language: zig
module: vibee_screen_renderer

constants:
  PHI: 1.6180339887498948482
  PHOENIX: 999
  MAX_DRAW_CALLS: 1000
  BATCH_SIZE: 100

types:
  Renderer:
    fields:
      id: String
      backend: String
      width: Int
      height: Int

  DrawCommand:
    fields:
      type: String
      params: Object
      z_index: Int

  RenderBatch:
    fields:
      commands: List<Object>
      texture_id: Option<Int>
      shader_id: Int

  Texture:
    fields:
      id: Int
      width: Int
      height: Int
      format: String

  Shader:
    fields:
      id: Int
      vertex_source: String
      fragment_source: String

  RenderTarget:
    fields:
      id: Int
      width: Int
      height: Int
      texture_id: Int

behaviors:
  - name: create_renderer
    given: Backend type
    when: Initialize
    then: Renderer ready

  - name: begin_frame
    given: Renderer
    when: Start frame
    then: Frame started

  - name: end_frame
    given: Renderer
    when: End frame
    then: Frame submitted

  - name: draw_rect
    given: Bounds and color
    when: Draw
    then: Rect queued

  - name: draw_text
    given: Text, position, style
    when: Draw
    then: Text queued

  - name: draw_image
    given: Texture and bounds
    when: Draw
    then: Image queued

  - name: draw_path
    given: Path and style
    when: Draw
    then: Path queued

  - name: create_texture
    given: Image data
    when: Create
    then: Texture created

  - name: update_texture
    given: Texture and data
    when: Update
    then: Texture updated

  - name: create_shader
    given: Sources
    when: Compile
    then: Shader created

  - name: set_render_target
    given: Target
    when: Set
    then: Target active

  - name: flush_batches
    given: Renderer
    when: Flush
    then: Batches rendered

test_cases:
  - name: test_draw_rect
    input:
      x: 0
      y: 0
      width: 100
      height: 100
    expected:
      queued: true

  - name: test_batch_efficiency
    input:
      draw_calls: 100
    expected:
      batches_max: 10
