# VIBEE Vibecoding Flow v4.0.0
# Chat-to-code pipeline with live preview
# KOSCHEI CYCLE: УТКА (Duck) - Execution

name: vibee_vibecoding_flow
version: "4.0.0"
language: zig
module: vibee_vibecoding_flow

constants:
  PHI: 1.6180339887498948482
  PHOENIX: 999
  MAX_ITERATIONS: 10
  PREVIEW_DEBOUNCE_MS: 300

types:
  VibecodeSession:
    fields:
      id: String
      user_id: String
      project_path: String
      history: List<Object>
      current_file: Option<String>

  VibecodeMessage:
    fields:
      role: String
      content: String
      timestamp: Timestamp
      attachments: List<Object>

  CodeChange:
    fields:
      file: String
      action: String
      before: Option<String>
      after: String
      accepted: Bool

  PreviewState:
    fields:
      url: String
      status: String
      error: Option<String>
      last_update: Timestamp

  IterationResult:
    fields:
      iteration: Int
      changes: List<Object>
      preview_url: Option<String>
      user_feedback: Option<String>

behaviors:
  - name: start_session
    given: Project path
    when: Initialize
    then: VibecodeSession created

  - name: send_message
    given: User message
    when: Process
    then: AI response with code

  - name: apply_changes
    given: CodeChange list
    when: Apply
    then: Files updated

  - name: preview_changes
    given: Changes
    when: Generate preview
    then: PreviewState

  - name: accept_changes
    given: Change IDs
    when: Accept
    then: Changes committed

  - name: reject_changes
    given: Change IDs
    when: Reject
    then: Changes reverted

  - name: iterate
    given: Feedback
    when: Improve
    then: IterationResult

  - name: undo_last
    given: Session
    when: Undo
    then: Previous state

  - name: redo_last
    given: Session
    when: Redo
    then: Next state

  - name: get_history
    given: Session
    when: Query
    then: Message list

  - name: export_session
    given: Session
    when: Export
    then: Session JSON

  - name: import_session
    given: Session JSON
    when: Import
    then: Session restored

test_cases:
  - name: test_send_message
    input:
      message: "create a button"
    expected:
      has_code: true

  - name: test_apply_changes
    input:
      changes: [{"file": "test.js", "action": "create"}]
    expected:
      applied: true
