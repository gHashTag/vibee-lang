# VIBEE Agent Coder v4.0.0
# AI agent for code generation and editing
# Target: 500ms response (4x improvement)

name: vibee_agent_coder
version: "4.0.0"
language: zig
module: vibee_agent_coder

constants:
  PHI: 1.6180339887498948482
  PHOENIX: 999
  TARGET_RESPONSE_MS: 500
  MAX_CONTEXT_TOKENS: 128000
  MAX_OUTPUT_TOKENS: 8192

types:
  CoderAgent:
    fields:
      id: String
      model: String
      system_prompt: String
      temperature: Float
      context_files: List<String>

  CodeRequest:
    fields:
      instruction: String
      file_path: Option<String>
      selection: Option<Object>
      context: List<String>

  CodeResponse:
    fields:
      code: String
      explanation: String
      file_changes: List<Object>
      tokens_used: Int
      duration_ms: Float

  FileChange:
    fields:
      path: String
      action: String
      content: Option<String>
      diff: Option<String>

  CodeContext:
    fields:
      file_path: String
      content: String
      language: String
      cursor_line: Int

  RefactorSuggestion:
    fields:
      description: String
      before: String
      after: String
      confidence: Float

behaviors:
  - name: create_coder
    given: Model config
    when: Initialize
    then: CoderAgent ready

  - name: generate_code
    given: CodeRequest
    when: Generate
    then: CodeResponse in <500ms

  - name: edit_code
    given: File and instruction
    when: Edit
    then: FileChange

  - name: explain_code
    given: Code snippet
    when: Explain
    then: Explanation text

  - name: fix_error
    given: Code and error
    when: Fix
    then: Fixed code

  - name: refactor
    given: Code and instruction
    when: Refactor
    then: Refactored code

  - name: complete_code
    given: Partial code
    when: Complete
    then: Completion

  - name: suggest_refactors
    given: Code
    when: Analyze
    then: RefactorSuggestion list

  - name: generate_tests
    given: Code
    when: Generate tests
    then: Test code

  - name: add_documentation
    given: Code
    when: Document
    then: Documented code

  - name: translate_language
    given: Code and target
    when: Translate
    then: Translated code

  - name: stream_response
    given: Request and callback
    when: Stream
    then: Tokens streamed

test_cases:
  - name: test_generate_speed
    input:
      instruction: "create hello world"
    expected:
      duration_ms_max: 500

  - name: test_fix_error
    input:
      code: "const x ="
      error: "unexpected end"
    expected:
      fixed: true
