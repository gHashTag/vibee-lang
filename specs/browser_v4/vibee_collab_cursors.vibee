# VIBEE Collab Cursors v4.0.0
# Multi-cursor synchronization

name: vibee_collab_cursors
version: "4.0.0"
language: zig
module: vibee_collab_cursors

constants:
  PHI: 1.6180339887498948482
  PHOENIX: 999
  CURSOR_UPDATE_THROTTLE_MS: 50
  MAX_CURSORS: 50

types:
  Cursor:
    fields:
      user_id: String
      position: Object
      selection: Option<Object>
      color: String

  CursorPosition:
    fields:
      line: Int
      column: Int

  CursorSelection:
    fields:
      start: Object
      end: Object
      direction: String

  CursorDecoration:
    fields:
      cursor_id: String
      range: Object
      class_name: String
      hover_message: Option<String>

  CursorUpdate:
    fields:
      user_id: String
      position: Object
      selection: Option<Object>
      timestamp: Timestamp

behaviors:
  - name: add_cursor
    given: User ID and position
    when: Add
    then: Cursor created

  - name: remove_cursor
    given: User ID
    when: Remove
    then: Cursor removed

  - name: update_cursor
    given: CursorUpdate
    when: Update
    then: Cursor moved

  - name: update_selection
    given: User ID and selection
    when: Update
    then: Selection updated

  - name: get_cursors
    given: Document ID
    when: Query
    then: Cursor list

  - name: render_cursors
    given: Editor
    when: Render
    then: Decorations applied

  - name: animate_cursor
    given: Cursor and target
    when: Animate
    then: Smooth transition

  - name: show_cursor_label
    given: Cursor
    when: Show
    then: Label visible

  - name: hide_cursor_label
    given: Cursor
    when: Hide
    then: Label hidden

  - name: on_cursor_move
    given: Callback
    when: Register
    then: Handler registered

  - name: throttle_updates
    given: Update stream
    when: Throttle
    then: Throttled stream

test_cases:
  - name: test_add_cursor
    input:
      user_id: "user1"
      line: 1
      column: 0
    expected:
      added: true

  - name: test_update_throttle
    input:
      updates_per_second: 100
    expected:
      throttled_to: 20
