# VIBEE CDP Screenshot v4.0.0
# Screenshot and recording with 10ms target
# KOSCHEI CYCLE: ЗАЯЦ (Hare) - Feedback

name: vibee_cdp_screenshot
version: "4.0.0"
language: zig
module: vibee_cdp_screenshot

constants:
  PHI: 1.6180339887498948482
  PHOENIX: 999
  TARGET_SCREENSHOT_MS: 10
  DEFAULT_QUALITY: 80
  MAX_WIDTH: 16384

types:
  ScreenshotOptions:
    fields:
      format: String
      quality: Int
      clip: Option<Object>
      full_page: Bool
      from_surface: Bool

  ScreenshotResult:
    fields:
      data: String
      width: Int
      height: Int
      duration_ms: Float

  RecordingOptions:
    fields:
      format: String
      fps: Int
      quality: Int
      max_duration_s: Int

  RecordingState:
    fields:
      recording: Bool
      frames: Int
      duration_s: Float
      file_path: Option<String>

  PDFOptions:
    fields:
      landscape: Bool
      print_background: Bool
      scale: Float
      paper_width: Float
      paper_height: Float
      margin_top: Float
      margin_bottom: Float
      margin_left: Float
      margin_right: Float

  Viewport:
    fields:
      x: Float
      y: Float
      width: Float
      height: Float
      scale: Float

behaviors:
  - name: capture_screenshot
    given: ScreenshotOptions
    when: Capture page
    then: ScreenshotResult in <10ms

  - name: capture_element
    given: Node ID and options
    when: Capture element
    then: Element screenshot

  - name: capture_full_page
    given: Options
    when: Capture scrolled page
    then: Full page screenshot

  - name: start_recording
    given: RecordingOptions
    when: Begin recording
    then: Recording started

  - name: stop_recording
    given: Nothing
    when: End recording
    then: Video file path

  - name: capture_frame
    given: Nothing
    when: Capture single frame
    then: Frame data

  - name: print_to_pdf
    given: PDFOptions
    when: Generate PDF
    then: PDF data

  - name: set_device_metrics
    given: Width, height, scale
    when: Set viewport
    then: Metrics updated

  - name: emulate_device
    given: Device name
    when: Emulate device
    then: Device emulated

  - name: get_layout_metrics
    given: Page
    when: Get page size
    then: Layout metrics

test_cases:
  - name: test_screenshot_speed
    input:
      format: "png"
    expected:
      duration_ms_max: 10

  - name: test_full_page
    input:
      full_page: true
    expected:
      captured: true
