# ═══════════════════════════════════════════════════════════════════════════════
# CRUSH ENV - Транспиляция env из charmbracelet/crush
# ═══════════════════════════════════════════════════════════════════════════════
# SOURCE: github.com/charmbracelet/crush/internal/env/env.go
# φ² + 1/φ² = 3 | PHOENIX = 999
# ═══════════════════════════════════════════════════════════════════════════════

name: crush_env
version: "1.0.0"
author: "Dmitrii Vasilev"
license: "MIT"
language: zig
module: env

source_go:
  package: "env"
  file: "env.go"
  repository: "github.com/charmbracelet/crush"
  path: "internal/env/env.go"

sacred_formula:
  V: "n × 3^k × π^m × φ^p × e^q"
  golden_identity: "φ² + 1/φ² = 3"
  phoenix: 999

constants:
  - name: PHI
    value: 1.618033988749895
  - name: TRINITY
    value: 3.0

creation_pattern:
  source: "Go env module"
  transformer: "VIBEE Transpiler"
  result: "Zig env module"

go_source:
  imports:
    - "os"
    - "testing"
  
  types:
    - name: "Env"
      kind: "interface"
      methods:
        - "Get(key string) string"
        - "Env() []string"
    - name: "osEnv"
      kind: "struct"
    - name: "mapEnv"
      kind: "struct"
      fields:
        - "m map[string]string"
  
  functions:
    - name: "New"
      signature: "func New() Env"
      description: "Creates new Env from OS"
    - name: "NewFromMap"
      signature: "func NewFromMap(m map[string]string) Env"
      description: "Creates Env from map"

behaviors:
  - name: get
    given: "Environment key"
    when: "get() is called"
    then: "Returns environment value or empty string"
    go_original: "os.Getenv(key)"
    zig_implementation: "std.posix.getenv"
    test_cases:
      - name: get_path
        input: "PATH"
        expected: "non-empty string"
      - name: get_nonexistent
        input: "NONEXISTENT_VAR_12345"
        expected: ""

  - name: env_list
    given: "Env instance"
    when: "envList() is called"
    then: "Returns list of KEY=VALUE strings"
    go_original: "os.Environ()"
    zig_implementation: "std.process.environ"
    test_cases:
      - name: env_list_not_empty
        input: "os env"
        expected: "non-empty slice"

  - name: new_from_map
    given: "Map of key-value pairs"
    when: "newFromMap() is called"
    then: "Returns Env backed by map"
    test_cases:
      - name: map_env_get
        input: "map{HOME: /home/user}"
        expected: "/home/user"

dependency_mapping:
  - go_dep: "os.Getenv"
    zig_equiv: "std.posix.getenv"
  - go_dep: "os.Environ"
    zig_equiv: "std.process.environ"
  - go_dep: "interface{}"
    zig_equiv: "tagged union or vtable"
    notes: "Go interface → Zig union or function pointers"

metrics:
  go_lines: 58
  zig_lines_estimated: 80
  functions_count: 4
  test_count: 5
  trinity_score: 1.0

signature: "IGLA CRUSH ENV V1.0"
