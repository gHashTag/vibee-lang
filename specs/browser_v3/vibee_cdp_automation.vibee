# VIBEE CDP Automation v1.1.0
# Chrome DevTools Protocol for browser control

name: vibee_cdp_automation
version: "1.1.0"
language: zig
module: vibee_cdp_automation

constants:
  TARGET_CLICK_MS: 10
  TARGET_TYPE_MS: 5
  TARGET_SCREENSHOT_MS: 20
  TARGET_DOM_QUERY_MS: 1

types:
  CDPSession:
    fields:
      id: String
      target_id: String
      connected: Bool

  CDPCommand:
    fields:
      id: Int
      method: String
      params: Object

  CDPResponse:
    fields:
      id: Int
      result: Option<Object>
      error: Option<String>

  DOMElement:
    fields:
      node_id: Int
      backend_node_id: Int
      tag_name: String
      attributes: Object
      bounding_box: Option<Object>

  InputEvent:
    fields:
      type: String
      x: Int
      y: Int
      button: Option<String>
      key: Option<String>
      text: Option<String>

  AutomationResult:
    fields:
      success: Bool
      duration_ms: Float
      error: Option<String>

behaviors:
  - name: attach_debugger
    given: "WebContents"
    when: "Attach"
    then: "Connect CDP debugger"

  - name: detach_debugger
    given: "Session"
    when: "Detach"
    then: "Disconnect CDP"

  - name: send_command
    given: "Method and params"
    when: "Send"
    then: "Execute CDP command"

  - name: click_element
    given: "Selector"
    when: "Click"
    then: "Find and click element"

  - name: click_coordinates
    given: "X, Y"
    when: "Click"
    then: "Click at coordinates"

  - name: type_text
    given: "Text"
    when: "Type"
    then: "Input text characters"

  - name: type_into_element
    given: "Selector and text"
    when: "Type"
    then: "Focus element and type"

  - name: scroll_page
    given: "X, Y delta"
    when: "Scroll"
    then: "Scroll viewport"

  - name: scroll_to_element
    given: "Selector"
    when: "Scroll"
    then: "Scroll element into view"

  - name: get_element_box
    given: "Selector"
    when: "Query"
    then: "Return bounding box"

  - name: wait_for_selector
    given: "Selector and timeout"
    when: "Wait"
    then: "Return when element appears"

  - name: evaluate_expression
    given: "JS expression"
    when: "Evaluate"
    then: "Return result"

  - name: take_screenshot
    given: "Options"
    when: "Capture"
    then: "Return image data"

  - name: batch_commands
    given: "Command list"
    when: "Execute batch"
    then: "Run all commands efficiently"

test_cases:
  - name: test_click_speed
    input: { selector: "#btn" }
    expected: { duration_lt: 10 }

  - name: test_type_speed
    input: { text: "hello" }
    expected: { duration_lt: 25 }

  - name: test_screenshot_speed
    input: { format: "webp" }
    expected: { duration_lt: 20 }

  - name: test_dom_query_speed
    input: { selector: "div" }
    expected: { duration_lt: 1 }

  - name: test_batch_execution
    input: { commands: 10 }
    expected: { all_executed: true }
