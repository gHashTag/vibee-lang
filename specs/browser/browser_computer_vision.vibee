# VIBEE Browser Computer Vision v0.0.1
# Screenshot analysis, DOM parsing, OCR

name: browser_computer_vision
version: "0.0.1"
language: zig
module: browser_computer_vision

description: |
  Computer vision engine for visual webpage analysis.
  Includes screenshot capture, DOM parsing, OCR,
  and element detection.

types:
  Screenshot:
    description: "Captured screenshot"
    fields:
      id: String
      width: Int
      height: Int
      data: String
      format: String
      timestamp: Timestamp

  BoundingBox:
    description: "Element bounding box"
    fields:
      x: Int
      y: Int
      width: Int
      height: Int

  VisualElement:
    description: "Detected visual element"
    fields:
      id: String
      type: String
      bbox: BoundingBox
      confidence: Float
      text: Option<String>

  DOMNode:
    description: "Parsed DOM node"
    fields:
      node_id: Int
      tag: String
      attributes: Object
      text: Option<String>
      children: List<Int>
      bbox: Option<BoundingBox>

  DOMTree:
    description: "Full DOM tree"
    fields:
      root: Int
      nodes: List<DOMNode>
      interactive: List<Int>

  OCRResult:
    description: "OCR extraction result"
    fields:
      text: String
      confidence: Float
      bbox: BoundingBox
      language: String

  TableCell:
    description: "Detected table cell"
    fields:
      row: Int
      col: Int
      text: String
      bbox: BoundingBox

  DetectedTable:
    description: "Detected table structure"
    fields:
      rows: Int
      cols: Int
      cells: List<TableCell>
      headers: List<String>

  FormField:
    description: "Detected form field"
    fields:
      id: String
      type: String
      label: Option<String>
      value: Option<String>
      bbox: BoundingBox
      required: Bool

  VisualDiff:
    description: "Visual difference between screenshots"
    fields:
      before_id: String
      after_id: String
      changed_regions: List<BoundingBox>
      similarity: Float

behaviors:
  - name: capture_screenshot
    given: "Browser viewport"
    when: "Capture"
    then: "Return screenshot data"

  - name: capture_element
    given: "Element selector"
    when: "Capture element"
    then: "Return element screenshot"

  - name: parse_dom
    given: "Page HTML"
    when: "Parse DOM"
    then: "Return DOM tree"

  - name: find_interactive
    given: "DOM tree"
    when: "Find clickable elements"
    then: "Return interactive elements"

  - name: extract_text_ocr
    given: "Screenshot"
    when: "Run OCR"
    then: "Return extracted text"

  - name: detect_elements
    given: "Screenshot"
    when: "Run element detection"
    then: "Return visual elements"

  - name: detect_buttons
    given: "Screenshot"
    when: "Find buttons"
    then: "Return button elements"

  - name: detect_inputs
    given: "Screenshot"
    when: "Find input fields"
    then: "Return input elements"

  - name: detect_tables
    given: "Screenshot"
    when: "Find tables"
    then: "Return table structures"

  - name: detect_forms
    given: "DOM tree"
    when: "Find forms"
    then: "Return form fields"

  - name: compare_screenshots
    given: "Two screenshots"
    when: "Compare visually"
    then: "Return visual diff"

  - name: get_element_at_point
    given: "X, Y coordinates"
    when: "Query DOM"
    then: "Return element at point"

  - name: analyze_layout
    given: "Screenshot"
    when: "Analyze page layout"
    then: "Return layout structure"

test_cases:
  - name: test_screenshot_capture
    input: { width: 1920, height: 1080 }
    expected: { captured: true }

  - name: test_dom_parsing
    input: { html: "<div><button>Click</button></div>" }
    expected: { nodes_count: 2 }

  - name: test_interactive_detection
    input: { dom: "sample" }
    expected: { has_interactive: true }

  - name: test_ocr_extraction
    input: { image: "text_image" }
    expected: { text_extracted: true }

  - name: test_button_detection
    input: { screenshot: "page" }
    expected: { buttons_found: true }

  - name: test_table_detection
    input: { screenshot: "table_page" }
    expected: { table_found: true }

  - name: test_visual_diff
    input: { before: "s1", after: "s2" }
    expected: { diff_calculated: true }
