# VIBEE Browser CDP Client v1.0.0
# Chrome DevTools Protocol WebSocket client

name: cdp_client
version: "1.0.0"
language: zig
module: cdp_client

description: |
  CDP WebSocket client for browser automation.
  Direct control over Chromium via DevTools Protocol.

types:
  CDPConnection:
    fields:
      ws_url: String
      connected: Bool
      session_id: Option<String>

  CDPMessage:
    fields:
      id: Int
      method: String
      params: Option<Object>

  CDPResponse:
    fields:
      id: Int
      result: Option<Object>
      error: Option<Object>

  CDPEvent:
    fields:
      method: String
      params: Object

  DOMNode:
    fields:
      node_id: Int
      backend_node_id: Int
      node_type: Int
      node_name: String
      node_value: Option<String>
      children: Option<List<Int>>

  BoxModel:
    fields:
      content: List<Float>
      padding: List<Float>
      border: List<Float>
      margin: List<Float>
      width: Int
      height: Int

behaviors:
  - name: connect
    given: "WebSocket URL"
    when: "Connect"
    then: "Establish CDP connection"

  - name: disconnect
    given: "Active connection"
    when: "Disconnect"
    then: "Close WebSocket"

  - name: send_command
    given: "Method and params"
    when: "Send"
    then: "Execute CDP command"

  - name: enable_domain
    given: "Domain name"
    when: "Enable"
    then: "Activate CDP domain"

  - name: page_navigate
    given: "URL"
    when: "Navigate"
    then: "Load page via CDP"

  - name: dom_get_document
    given: "Connection"
    when: "Get document"
    then: "Return DOM root"

  - name: dom_query_selector
    given: "Node ID and selector"
    when: "Query"
    then: "Return matching node"

  - name: dom_get_box_model
    given: "Node ID"
    when: "Get box"
    then: "Return element dimensions"

  - name: input_dispatch_mouse
    given: "Type, x, y, button"
    when: "Dispatch"
    then: "Simulate mouse event"

  - name: input_dispatch_key
    given: "Type, key, code"
    when: "Dispatch"
    then: "Simulate keyboard event"

  - name: page_screenshot
    given: "Format and options"
    when: "Capture"
    then: "Return screenshot data"

  - name: runtime_evaluate
    given: "Expression"
    when: "Evaluate"
    then: "Execute JS and return result"

test_cases:
  - name: test_connect
    input: { url: "ws://localhost:9222" }
    expected: { connected: true }

  - name: test_navigate
    input: { url: "https://example.com" }
    expected: { frame_id_exists: true }

  - name: test_click
    input: { x: 100, y: 200 }
    expected: { dispatched: true }

  - name: test_type
    input: { text: "hello" }
    expected: { typed: true }

  - name: test_screenshot
    input: { format: "png" }
    expected: { data_length_gt: 0 }
