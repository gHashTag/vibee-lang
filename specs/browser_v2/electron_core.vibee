# VIBEE Browser Electron Core v1.0.0
# Main process for Electron application

name: electron_core
version: "1.0.0"
language: zig
module: electron_core

description: |
  Electron main process managing BrowserViews,
  IPC communication, and window lifecycle.
  Golden ratio layout: 61.8% | 14.6% | 23.6%

constants:
  PHI: 1.6180339887498949
  PHI_SQUARED: 2.6180339887498949
  PHI_INV_SQUARED: 0.3819660112501051
  TRINITY: 3.0
  BROWSER_RATIO: 0.618
  CHAT_RATIO: 0.146
  EDITOR_RATIO: 0.236

types:
  WindowConfig:
    fields:
      width: Int
      height: Int
      min_width: Int
      min_height: Int
      title: String
      frame: Bool
      transparent: Bool

  PanelBounds:
    fields:
      x: Int
      y: Int
      width: Int
      height: Int

  GoldenLayout:
    fields:
      total_width: Int
      total_height: Int
      toolbar_height: Int
      browser_bounds: PanelBounds
      chat_bounds: PanelBounds
      editor_bounds: PanelBounds

  IPCMessage:
    fields:
      channel: String
      payload: Object
      timestamp: Timestamp

  ViewState:
    fields:
      id: String
      url: String
      title: String
      loading: Bool
      can_go_back: Bool
      can_go_forward: Bool

behaviors:
  - name: create_window
    given: "Window configuration"
    when: "App ready"
    then: "Create main BrowserWindow"

  - name: calculate_golden_layout
    given: "Window dimensions"
    when: "Calculate layout"
    then: "Return panel bounds using Ï† ratio"

  - name: create_browser_view
    given: "Panel bounds"
    when: "Initialize browser"
    then: "Create BrowserView for web content"

  - name: create_chat_view
    given: "Panel bounds"
    when: "Initialize chat"
    then: "Create BrowserView for AI chat"

  - name: create_editor_view
    given: "Panel bounds"
    when: "Initialize editor"
    then: "Create BrowserView for Monaco"

  - name: handle_resize
    given: "New window size"
    when: "Window resized"
    then: "Recalculate and apply golden layout"

  - name: send_ipc
    given: "Channel and payload"
    when: "Send message"
    then: "Deliver to renderer process"

  - name: handle_ipc
    given: "IPC message"
    when: "Message received"
    then: "Process and respond"

test_cases:
  - name: test_golden_layout_1600
    input: { width: 1600, height: 900 }
    expected: { browser_width: 989, chat_width: 234, editor_width: 377 }

  - name: test_golden_layout_1920
    input: { width: 1920, height: 1080 }
    expected: { browser_width: 1187, chat_width: 280, editor_width: 453 }

  - name: test_trinity_verification
    input: {}
    expected: { phi_sq_plus_inv: 3.0 }
