# ═══════════════════════════════════════════════════════════════════════════════
# LEVEL 2: VIBEE PIPELINE - .vibee → Compiler → .zig
# ═══════════════════════════════════════════════════════════════════════════════
#
# Complete specification-to-code pipeline
# Time: 2-3 weeks
#
# φ² + 1/φ² = 3 | PHOENIX = 999
#
# ═══════════════════════════════════════════════════════════════════════════════

name: level2_pipeline
version: "1.0.0"
language: zig
module: pipeline

sacred_constants:
  phi: 1.618033988749895
  trinity: 3.0
  phoenix: 999

creation_pattern:
  source: VibeeSpec
  transformer: SpecCompiler
  result: GeneratedZigCode

# ═══════════════════════════════════════════════════════════════════════════════
# TYPES
# ═══════════════════════════════════════════════════════════════════════════════

types:
  - name: SpecField
    description: "Field definition in a type"
    fields:
      - name: name
        type: String
      - name: field_type
        type: String
      - name: optional
        type: Bool

  - name: SpecType
    description: "Type definition in specification"
    fields:
      - name: name
        type: String
      - name: description
        type: String
      - name: fields
        type: List<SpecField>
      - name: is_enum
        type: Bool

  - name: SpecTestCase
    description: "Test case in specification"
    fields:
      - name: name
        type: String
      - name: input
        type: String
      - name: expected
        type: String

  - name: SpecBehavior
    description: "Behavior definition in specification"
    fields:
      - name: name
        type: String
      - name: given
        type: String
      - name: when
        type: String
      - name: then
        type: String
      - name: pas_pattern
        type: String
      - name: test_cases
        type: List<SpecTestCase>

  - name: VibeeSpec
    description: "Complete VIBEE specification"
    fields:
      - name: name
        type: String
      - name: version
        type: String
      - name: language
        type: String
      - name: module
        type: String
      - name: types
        type: List<SpecType>
      - name: behaviors
        type: List<SpecBehavior>

  - name: CompilerStats
    description: "Compilation statistics"
    fields:
      - name: types_generated
        type: Int
      - name: functions_generated
        type: Int
      - name: tests_generated
        type: Int
      - name: output_size_bytes
        type: Int
      - name: compile_time_ms
        type: Int

  - name: PipelineResult
    description: "Pipeline execution result"
    fields:
      - name: success
        type: Bool
      - name: output_file
        type: String
      - name: stats
        type: CompilerStats
      - name: tests_passed
        type: Int
      - name: tests_failed
        type: Int

# ═══════════════════════════════════════════════════════════════════════════════
# BEHAVIORS
# ═══════════════════════════════════════════════════════════════════════════════

behaviors:
  - name: parse_vibee_spec
    given: "Valid .vibee file content"
    when: "Parser is invoked"
    then: "Return parsed VibeeSpec structure"
    pas_pattern: PRE
    test_cases:
      - name: test_parse_minimal
        input: '{"content": "name: test\\nversion: 1.0.0"}'
        expected: '{"name": "test", "version": "1.0.0"}'
      - name: test_parse_with_types
        input: '{"content": "name: test\\ntypes:\\n  - name: User"}'
        expected: '{"types_count": 1}'

  - name: generate_struct
    given: "Parsed SpecType"
    when: "Struct generation is invoked"
    then: "Return valid Zig struct code"
    pas_pattern: PRE
    test_cases:
      - name: test_simple_struct
        input: '{"name": "User", "fields": [{"name": "id", "type": "Int"}]}'
        expected: '{"code": "pub const User = struct { id: i64, };"}'

  - name: generate_function
    given: "Parsed SpecBehavior"
    when: "Function generation is invoked"
    then: "Return valid Zig function code"
    pas_pattern: PRE
    test_cases:
      - name: test_simple_function
        input: '{"name": "create_user", "given": "Valid data"}'
        expected: '{"code": "pub fn create_user() !void { }"}'

  - name: generate_test
    given: "Parsed SpecTestCase"
    when: "Test generation is invoked"
    then: "Return valid Zig test code"
    pas_pattern: PRE
    test_cases:
      - name: test_simple_test
        input: '{"name": "test_create", "input": "{}", "expected": "{}"}'
        expected: '{"code": "test \"test_create\" { }"}'

  - name: compile_spec
    given: "Valid VibeeSpec"
    when: "Full compilation is invoked"
    then: "Return complete Zig file with structs, functions, tests"
    pas_pattern: D_C
    test_cases:
      - name: test_full_compile
        input: '{"spec": {"name": "test", "types": [], "behaviors": []}}'
        expected: '{"success": true, "has_golden_identity": true}'

  - name: run_generated_tests
    given: "Generated Zig file"
    when: "zig test is executed"
    then: "Return test results"
    pas_pattern: PRE
    test_cases:
      - name: test_all_pass
        input: '{"file": "output.zig"}'
        expected: '{"passed": true}'

# ═══════════════════════════════════════════════════════════════════════════════
# EXERCISES
# ═══════════════════════════════════════════════════════════════════════════════

exercises:
  - name: create_user_spec
    description: "Create a User entity specification"
    difficulty: 2
    expected_time: "20 minutes"

  - name: compile_and_test
    description: "Compile spec and run generated tests"
    difficulty: 2
    expected_time: "15 minutes"

  - name: add_behaviors
    description: "Add CRUD behaviors to specification"
    difficulty: 3
    expected_time: "30 minutes"

  - name: full_pipeline
    description: "Complete pipeline from spec to passing tests"
    difficulty: 3
    expected_time: "45 minutes"

# ═══════════════════════════════════════════════════════════════════════════════
# φ² + 1/φ² = 3 | PHOENIX = 999
# ═══════════════════════════════════════════════════════════════════════════════
