# MediaPipe Integration for VIBEE
# Full analog of Google MediaPipe with sacred geometry visualization

name: mediapipe_vision
version: "1.0.0"
language: 999
module: mediapipe

# ═══════════════════════════════════════════════════════════════
# CREATION PATTERN
# ═══════════════════════════════════════════════════════════════

creation_pattern:
  source: Camera + MediaPipe Models
  transformer: VisionPipeline
  result: BodyAwareVisualization

# ═══════════════════════════════════════════════════════════════
# MEDIAPIPE TASKS
# ═══════════════════════════════════════════════════════════════

mediapipe_tasks:
  # Hand Landmark Detection - 21 points per hand
  hand_landmarker:
    enabled: true
    model: "hand_landmarker.task"
    num_hands: 2
    min_detection_confidence: 0.5
    min_tracking_confidence: 0.5
    landmarks:
      - WRIST
      - THUMB_CMC, THUMB_MCP, THUMB_IP, THUMB_TIP
      - INDEX_FINGER_MCP, INDEX_FINGER_PIP, INDEX_FINGER_DIP, INDEX_FINGER_TIP
      - MIDDLE_FINGER_MCP, MIDDLE_FINGER_PIP, MIDDLE_FINGER_DIP, MIDDLE_FINGER_TIP
      - RING_FINGER_MCP, RING_FINGER_PIP, RING_FINGER_DIP, RING_FINGER_TIP
      - PINKY_MCP, PINKY_PIP, PINKY_DIP, PINKY_TIP
      
  # Face Landmark Detection - 478 points
  face_landmarker:
    enabled: true
    model: "face_landmarker.task"
    num_faces: 1
    min_detection_confidence: 0.5
    min_tracking_confidence: 0.5
    output_blendshapes: true
    output_transformation_matrix: true
    key_regions:
      - lips: [61, 146, 91, 181, 84, 17, 314, 405, 321, 375, 291]
      - left_eye: [33, 7, 163, 144, 145, 153, 154, 155, 133]
      - right_eye: [362, 382, 381, 380, 374, 373, 390, 249, 263]
      - left_eyebrow: [70, 63, 105, 66, 107]
      - right_eyebrow: [336, 296, 334, 293, 300]
      - face_oval: [10, 338, 297, 332, 284, 251, 389, 356, 454, 323, 361, 288, 397, 365, 379, 378, 400, 377, 152, 148, 176, 149, 150, 136, 172, 58, 132, 93, 234, 127, 162, 21, 54, 103, 67, 109]
      
  # Pose Landmark Detection - 33 points
  pose_landmarker:
    enabled: true
    model: "pose_landmarker.task"
    num_poses: 1
    min_detection_confidence: 0.5
    min_tracking_confidence: 0.5
    landmarks:
      - NOSE
      - LEFT_EYE_INNER, LEFT_EYE, LEFT_EYE_OUTER
      - RIGHT_EYE_INNER, RIGHT_EYE, RIGHT_EYE_OUTER
      - LEFT_EAR, RIGHT_EAR
      - MOUTH_LEFT, MOUTH_RIGHT
      - LEFT_SHOULDER, RIGHT_SHOULDER
      - LEFT_ELBOW, RIGHT_ELBOW
      - LEFT_WRIST, RIGHT_WRIST
      - LEFT_PINKY, RIGHT_PINKY
      - LEFT_INDEX, RIGHT_INDEX
      - LEFT_THUMB, RIGHT_THUMB
      - LEFT_HIP, RIGHT_HIP
      - LEFT_KNEE, RIGHT_KNEE
      - LEFT_ANKLE, RIGHT_ANKLE
      - LEFT_HEEL, RIGHT_HEEL
      - LEFT_FOOT_INDEX, RIGHT_FOOT_INDEX
      
  # Gesture Recognition
  gesture_recognizer:
    enabled: true
    model: "gesture_recognizer.task"
    gestures:
      - None
      - Closed_Fist
      - Open_Palm
      - Pointing_Up
      - Thumb_Down
      - Thumb_Up
      - Victory
      - ILoveYou

# ═══════════════════════════════════════════════════════════════
# VISUALIZATION MODES
# ═══════════════════════════════════════════════════════════════

visualization:
  modes:
    - name: skeleton
      description: "Classic skeleton overlay"
      draw_landmarks: true
      draw_connections: true
      
    - name: sacred_geometry
      description: "Sacred geometry patterns from body"
      generate_from_landmarks: true
      patterns:
        - flower_of_life_from_face
        - metatron_from_pose
        - fibonacci_from_hands
        
    - name: aura
      description: "Energy field visualization"
      particle_system: true
      glow_effect: true
      
    - name: chakras
      description: "Chakra points on body"
      points:
        - name: root
          pose_landmark: between_hips
          color: { h: 0, s: 100, l: 50 }
        - name: sacral
          pose_landmark: below_navel
          color: { h: 30, s: 100, l: 50 }
        - name: solar_plexus
          pose_landmark: stomach
          color: { h: 60, s: 100, l: 50 }
        - name: heart
          pose_landmark: chest_center
          color: { h: 120, s: 100, l: 50 }
        - name: throat
          pose_landmark: throat
          color: { h: 180, s: 100, l: 50 }
        - name: third_eye
          pose_landmark: between_eyes
          color: { h: 240, s: 100, l: 50 }
        - name: crown
          pose_landmark: top_of_head
          color: { h: 280, s: 100, l: 50 }

# ═══════════════════════════════════════════════════════════════
# GESTURE ACTIONS
# ═══════════════════════════════════════════════════════════════

gesture_actions:
  Open_Palm:
    action: toggle_mode
    description: "Switch visualization mode"
    
  Closed_Fist:
    action: capture_screenshot
    description: "Take screenshot"
    
  Victory:
    action: toggle_recording
    description: "Start/stop recording"
    
  Thumb_Up:
    action: increase_effect
    description: "Increase effect intensity"
    
  Thumb_Down:
    action: decrease_effect
    description: "Decrease effect intensity"
    
  Pointing_Up:
    action: next_color_scheme
    description: "Change color scheme"
    
  ILoveYou:
    action: toggle_mirror
    description: "Toggle mirror mode"

# ═══════════════════════════════════════════════════════════════
# FACE EFFECTS
# ═══════════════════════════════════════════════════════════════

face_effects:
  blendshapes:
    - eyeBlinkLeft
    - eyeBlinkRight
    - eyeSquintLeft
    - eyeSquintRight
    - eyeWideLeft
    - eyeWideRight
    - jawOpen
    - mouthSmileLeft
    - mouthSmileRight
    - mouthFrownLeft
    - mouthFrownRight
    - browDownLeft
    - browDownRight
    - browInnerUp
    - browOuterUpLeft
    - browOuterUpRight
    
  emotion_detection:
    happy: "mouthSmileLeft + mouthSmileRight > 0.6"
    sad: "mouthFrownLeft + mouthFrownRight > 0.4"
    surprised: "eyeWideLeft + eyeWideRight + jawOpen > 1.0"
    angry: "browDownLeft + browDownRight > 0.5"
    neutral: "default"

# ═══════════════════════════════════════════════════════════════
# BEHAVIORS
# ═══════════════════════════════════════════════════════════════

behaviors:
  - name: hand_tracking_visualization
    given: Camera stream active
    when: Hands detected
    then: |
      1. Get 21 landmarks per hand
      2. Draw skeleton connections
      3. Generate sacred geometry from finger positions
      4. Detect gestures and trigger actions
      5. Create particle trails from fingertips
      
  - name: face_mesh_visualization
    given: Camera stream active
    when: Face detected
    then: |
      1. Get 478 face landmarks
      2. Draw face mesh or key regions
      3. Calculate blendshapes for expression
      4. Detect emotion from blendshapes
      5. Generate Flower of Life from face proportions
      
  - name: pose_body_visualization
    given: Camera stream active
    when: Body detected
    then: |
      1. Get 33 pose landmarks
      2. Draw skeleton
      3. Calculate chakra positions
      4. Generate Metatron's Cube from body proportions
      5. Create aura effect around body

# ═══════════════════════════════════════════════════════════════
# RUNTIME CONFIG
# ═══════════════════════════════════════════════════════════════

runtime:
  quality: HD  # 720p for performance with ML
  fullscreen: true
  camera:
    facing: user
    width: 1280
    height: 720
  target_fps: 30  # ML inference limited

# ═══════════════════════════════════════════════════════════════
# CODE GENERATION
# ═══════════════════════════════════════════════════════════════

codegen:
  target: 999
  output: "generated/mediapipe_vision.999"
  
  mappings:
    hand_tracker: "atom HandTracker"
    face_tracker: "atom FaceTracker"
    pose_tracker: "atom PoseTracker"
    gesture_handler: "atom GestureHandler"
    visualizer: "atom Visualizer"
    
  imports:
    - mediapipe_tasks_vision
    - sacred_geometry
    - particle_system
