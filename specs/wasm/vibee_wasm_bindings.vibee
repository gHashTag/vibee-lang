# ═══════════════════════════════════════════════════════════════════════════════
# VIBEE WASM Bindings - JavaScript/Browser Bindings
# ═══════════════════════════════════════════════════════════════════════════════
# φ² + 1/φ² = 3 | PHOENIX = 999
#
# JavaScript and Browser API bindings for WASM modules
# Handles DOM, Console, Fetch, Storage, Canvas
# ═══════════════════════════════════════════════════════════════════════════════

name: vibee_wasm_bindings
version: "1.1.0"
language: zig
module: vibee_wasm_bindings

constants:
  PHI: 1.6180339887498948482
  PHOENIX: 999
  MAX_STRING_LEN: 65536
  CALLBACK_TABLE_SIZE: 256

types:
  JsValue:
    fields:
      kind: String
      ref_id: Int
      cached_string: String

  DomElement:
    fields:
      tag: String
      id: String
      class_list: List<String>
      ref_id: Int

  ConsoleBinding:
    fields:
      log_level: String
      buffer_size: Int

  FetchRequest:
    fields:
      url: String
      method: String
      headers: Map<String, String>
      body: String

  FetchResponse:
    fields:
      status: Int
      status_text: String
      headers: Map<String, String>
      body: String

  StorageBinding:
    fields:
      storage_type: String
      prefix: String

  CanvasContext:
    fields:
      canvas_id: String
      width: Int
      height: Int
      context_type: String

  EventListener:
    fields:
      element_id: String
      event_type: String
      callback_id: Int
      capture: Bool

behaviors:
  - name: console_log
    given: Message string
    when: Log to browser console
    then: Message printed

  - name: console_error
    given: Error message
    when: Log error to console
    then: Error printed in red

  - name: console_time
    given: Label
    when: Start timer
    then: Timer started

  - name: console_time_end
    given: Label
    when: End timer
    then: Duration printed

  - name: dom_query
    given: CSS selector
    when: Query DOM element
    then: DomElement or null

  - name: dom_create
    given: Tag name
    when: Create new element
    then: DomElement created

  - name: dom_append
    given: Parent and child
    when: Append child to parent
    then: Child appended

  - name: dom_set_text
    given: Element and text
    when: Set text content
    then: Text updated

  - name: dom_set_attr
    given: Element, name, value
    when: Set attribute
    then: Attribute set

  - name: dom_add_class
    given: Element and class
    when: Add CSS class
    then: Class added

  - name: fetch_get
    given: URL
    when: HTTP GET request
    then: FetchResponse returned

  - name: fetch_post
    given: URL and body
    when: HTTP POST request
    then: FetchResponse returned

  - name: storage_get
    given: Key
    when: Read from localStorage
    then: Value or null

  - name: storage_set
    given: Key and value
    when: Write to localStorage
    then: Value stored

  - name: canvas_get_context
    given: Canvas ID and type
    when: Get rendering context
    then: CanvasContext returned

  - name: canvas_fill_rect
    given: Context, x, y, w, h
    when: Draw filled rectangle
    then: Rectangle drawn

  - name: add_event_listener
    given: Element, event, callback
    when: Register event handler
    then: Listener added

  - name: remove_event_listener
    given: Element and callback_id
    when: Unregister handler
    then: Listener removed

  - name: request_animation_frame
    given: Callback function
    when: Schedule next frame
    then: Frame ID returned

test_cases:
  - name: test_console_log
    input:
      message: "Hello WASM"
    expected:
      logged: true

  - name: test_dom_query
    input:
      selector: "#app"
    expected:
      found: true

  - name: test_fetch_get
    input:
      url: "/api/data"
    expected:
      status: 200
