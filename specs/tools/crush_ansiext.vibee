# ═══════════════════════════════════════════════════════════════════════════════
# CRUSH ANSIEXT - Транспиляция ansiext из charmbracelet/crush
# ═══════════════════════════════════════════════════════════════════════════════
# SOURCE: github.com/charmbracelet/crush/internal/ansiext/ansi.go
# φ² + 1/φ² = 3 | PHOENIX = 999
# ═══════════════════════════════════════════════════════════════════════════════

name: crush_ansiext
version: "1.0.0"
author: "Dmitrii Vasilev"
license: "MIT"
language: zig
module: ansiext

source_go:
  package: "ansiext"
  file: "ansi.go"
  repository: "github.com/charmbracelet/crush"
  path: "internal/ansiext/ansi.go"

sacred_formula:
  V: "n × 3^k × π^m × φ^p × e^q"
  golden_identity: "φ² + 1/φ² = 3"
  phoenix: 999

constants:
  - name: PHI
    value: 1.618033988749895
  - name: TRINITY
    value: 3.0
  - name: CONTROL_PICTURES_BASE
    value: 0x2400
    description: "Unicode Control Pictures block start"
  - name: DEL_PICTURE
    value: 0x2421
    description: "Unicode symbol for DEL (0x7F)"
  - name: DEL
    value: 0x7F
    description: "ASCII DEL character"

creation_pattern:
  source: "Go ansiext module"
  transformer: "VIBEE Transpiler"
  result: "Zig ansiext module"

go_source:
  imports:
    - "strings"
    - "github.com/charmbracelet/x/ansi"
  
  functions:
    - name: "Escape"
      signature: "func Escape(content string) string"
      description: "Replaces control characters with Unicode Control Pictures"

behaviors:
  - name: escape
    given: "String with control characters"
    when: "escape() is called"
    then: "Returns string with control chars replaced by Unicode pictures"
    go_original: "strings.Builder with rune iteration"
    zig_implementation: "ArrayList with Unicode replacement"
    test_cases:
      - name: escape_null
        input: "\x00"
        expected: "␀"
      - name: escape_newline
        input: "\n"
        expected: "␊"
      - name: escape_tab
        input: "\t"
        expected: "␉"
      - name: escape_del
        input: "\x7f"
        expected: "␡"
      - name: escape_normal
        input: "hello"
        expected: "hello"
      - name: escape_mixed
        input: "a\x00b"
        expected: "a␀b"

algorithms:
  - name: control_char_escape
    complexity: "O(n)"
    description: "Replace control characters with Unicode pictures"
    steps:
      - "Iterate through each character"
      - "If char is 0x00-0x1F, replace with 0x2400+char"
      - "If char is DEL (0x7F), replace with 0x2421"
      - "Otherwise keep original"

dependency_mapping:
  - go_dep: "strings.Builder"
    zig_equiv: "std.ArrayList(u8)"
  - go_dep: "github.com/charmbracelet/x/ansi.DEL"
    zig_equiv: "const DEL = 0x7F"

metrics:
  go_lines: 22
  zig_lines_estimated: 50
  functions_count: 1
  test_count: 6
  trinity_score: 1.0

signature: "IGLA CRUSH ANSIEXT V1.0"
