# Incremental Type Checker - Инкрементальная проверка типов
# PAS: 5x speedup, 80% confidence, Q3 2026
# Author: Dmitrii Vasilev
# Version: 1.0.0

name: incremental_types
version: "1.0.0"
language: 999
module: ⲧⲓⲡⲩ.ⲓⲛⲕⲣⲉⲙⲉⲛⲧ

creation_pattern:
  source: ASTWithChanges
  transformer: IncrementalChecker
  result: TypedAST

pas_analysis:
  current: "O(n²) full recheck"
  target: "O(δ) incremental"
  speedup: "5x"
  confidence: 0.80
  patterns: ["PRE", "AMR", "INC"]

components:
  type_cache:
    name: "ⲔⲈⲰ_ⲦⲒⲠⲞⲂ"
    description: "Кэш проверенных типов"
    operations:
      - "lookup"
      - "invalidate"
      - "update"

  dependency_graph:
    name: "ⲄⲢⲀⲪ_ⲌⲀⲂⲒⲤⲒⲘⲞⲤⲦⲈⲒ"
    description: "Граф зависимостей между символами"
    operations:
      - "add_dependency"
      - "get_dependents"
      - "invalidate_cascade"

  parallel_solver:
    name: "ⲠⲀⲢⲀⲖⲖⲈⲖⲒ_ⲤⲞⲖⲂⲈⲢ"
    description: "Параллельное решение ограничений"
    speedup: "2x"

behaviors:
  - name: check_with_cache
    given: "Символ и его тип"
    when: "Проверка типа"
    then: "Возврат из кэша за O(1) или вычисление"
    test_cases:
      - name: "cache_hit"
        input: {symbol: "test", cached: true}
        expected: {time: "O(1)"}
      - name: "cache_miss"
        input: {symbol: "new", cached: false}
        expected: {cached_after: true}

  - name: invalidate_on_change
    given: "Изменённый символ"
    when: "Инвалидация"
    then: "Только зависимые символы перепроверяются"
    test_cases:
      - name: "local_change"
        input: {changed: 1, dependents: 3}
        expected: {rechecked: 4}
