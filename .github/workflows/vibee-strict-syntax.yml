name: VIBEE Strict Syntax Check

on:
  push:
    paths:
      - '**.vibee'
  pull_request:
    paths:
      - '**.vibee'

jobs:
  strict-check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: Run VIBEE Strict Compiler
        run: |
          python3 vibee_strict_compiler.py --strict --dir . --json > vibee_strict_report.json
      
      - name: Check Results
        run: |
          ERRORS=$(cat vibee_strict_report.json | python3 -c "import json,sys; d=json.load(sys.stdin); print(d['summary']['errors'])")
          if [ "$ERRORS" -gt 0 ]; then
            echo "❌ VIBEE Strict Check Failed: $ERRORS violations"
            cat vibee_strict_report.json | python3 -c "import json,sys; d=json.load(sys.stdin); [print(f'{v[\"file\"]}:{v[\"line\"]} - {v[\"message\"]}') for v in d['violations'][:20]]"
            echo "..."
            exit 1
          else
            echo "✅ VIBEE Strict Check Passed: No violations"
          fi
      
      - name: Upload Report
        uses: actions/upload-artifact@v4
        with:
          name: vibee-strict-report
          path: vibee_strict_report.json
