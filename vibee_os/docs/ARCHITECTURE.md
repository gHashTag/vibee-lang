# VIBEE OS - Архитектура

## Обзор

VIBEE OS — микроядерная операционная система, написанная на языке спецификаций Vibee.
Ключевая особенность: один и тот же код работает везде — в браузере (WASM), на сервере, на bare metal.

## Архитектура

```
┌─────────────────────────────────────────────────────────────┐
│                    Приложения VIBEE OS                       │
│              (Написаны на Vibee спецификациях)               │
├─────────────────────────────────────────────────────────────┤
│                      VIBEE Shell                             │
│            (Командная оболочка пользователя)                 │
├─────────────────────────────────────────────────────────────┤
│                   Сервисы (User Space)                       │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐       │
│  │   VFS    │ │   Net    │ │  Init    │ │ Console  │       │
│  │ (файлы)  │ │  (сеть)  │ │(запуск)  │ │ (ввод)   │       │
│  └──────────┘ └──────────┘ └──────────┘ └──────────┘       │
├─────────────────────────────────────────────────────────────┤
│                    Ядро VIBEE OS                             │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐       │
│  │  Memory  │ │ Process  │ │   IPC    │ │ Syscall  │       │
│  │ (память) │ │(процессы)│ │(общение) │ │ (вызовы) │       │
│  └──────────┘ └──────────┘ └──────────┘ └──────────┘       │
├─────────────────────────────────────────────────────────────┤
│              Платформенный слой (HAL)                        │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐                    │
│  │   WASM   │ │  Native  │ │  Hosted  │                    │
│  │(браузер) │ │(Zig/Rust)│ │ (Linux)  │                    │
│  └──────────┘ └──────────┘ └──────────┘                    │
└─────────────────────────────────────────────────────────────┘
```

## Основные модули

### 1. Ядро (Kernel)

| Модуль | Описание |
|--------|----------|
| **memory** | Управление памятью: аллокатор, виртуальная память |
| **process** | Процессы и потоки, планировщик |
| **ipc** | Межпроцессное взаимодействие через каналы |
| **syscall** | Системные вызовы |
| **drivers** | Базовые драйверы устройств |

### 2. Сервисы (Services)

| Сервис | Описание |
|--------|----------|
| **vfs** | Виртуальная файловая система (схемы как в Redox) |
| **net** | Сетевой стек |
| **init** | Первый процесс, запуск системы |

### 3. Платформы (Platform)

| Платформа | Описание |
|-----------|----------|
| **wasm** | WebAssembly + WASI для браузера и облака |
| **native** | Нативная компиляция через Zig |
| **hosted** | Работа поверх Linux/macOS/Windows |

### 4. Shell

Командная оболочка с базовыми командами: ls, cat, echo, ps, help.

## Принципы проектирования

1. **Микроядро** — минимальное ядро, всё остальное в user space
2. **Capability-based** — доступ к ресурсам через capabilities
3. **Схемы (Schemes)** — унифицированный доступ к ресурсам через URL
4. **Портативность** — один код для всех платформ
5. **Спецификация-первична** — поведение описано в .vibee файлах

## Схемы доступа к ресурсам

```
file://path/to/file      — файловая система
console://stdin          — консольный ввод
console://stdout         — консольный вывод
tcp://host:port          — TCP соединение
proc://pid/status        — информация о процессе
mem://heap               — управление памятью
```

## Системные вызовы (MVP)

```
// Процессы
sys_spawn(spec) -> pid
sys_exit(code)
sys_yield()
sys_getpid() -> pid

// Память
sys_alloc(size) -> ptr
sys_free(ptr)

// IPC
sys_channel_create() -> (sender, receiver)
sys_send(channel, message)
sys_recv(channel) -> message

// Схемы
sys_open(url, flags) -> handle
sys_read(handle, buffer) -> bytes_read
sys_write(handle, data) -> bytes_written
sys_close(handle)
```

## MVP Scope

Для первой версии реализуем:

1. ✅ Базовый аллокатор памяти
2. ✅ Простой кооперативный планировщик
3. ✅ IPC через каналы
4. ✅ Консольный ввод/вывод
5. ✅ Простой shell с командами
6. ✅ WASM таргет для запуска в браузере
