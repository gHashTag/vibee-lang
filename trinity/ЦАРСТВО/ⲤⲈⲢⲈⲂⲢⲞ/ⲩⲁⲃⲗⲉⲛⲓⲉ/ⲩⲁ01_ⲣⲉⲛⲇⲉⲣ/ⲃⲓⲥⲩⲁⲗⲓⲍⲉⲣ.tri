// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TECH TREE VISUALIZER - SVG/HTML Generator with Fog of War
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â²® â²§â²‰â²­â²›â²

â² TechVisualizer {
    â²‚ tree: TechTree
    â²‚ width: â²’â²›â²§ = 2000
    â²‚ height: â²’â²›â²§ = 1200
    
    â²ª new(â²€ tree: TechTree) â†’ TechVisualizer {
        â²¢ TechVisualizer { tree: tree }
    }
    
    // Generate full SVG
    â²ª to_svg(â²¤) â†’ â²¦â²‰â²â²§ {
        â²‚ svg = "<svg xmlns='http://www.w3.org/2000/svg' width='" + â²¤.width.to_string() + "' height='" + â²¤.height.to_string() + "'>\n"
        svg += â²¤.svg_defs()
        svg += â²¤.svg_background()
        svg += â²¤.svg_era_labels()
        svg += â²¤.svg_connections()
        svg += â²¤.svg_nodes()
        svg += â²¤.svg_legend()
        svg += "</svg>"
        â²¢ svg
    }
    
    â²ª svg_defs(â²¤) â†’ â²¦â²‰â²â²§ {
        â²¢ "<defs>
  <filter id='fog'><feGaussianBlur stdDeviation='3'/></filter>
  <filter id='glow'><feGaussianBlur stdDeviation='2' result='glow'/><feMerge><feMergeNode in='glow'/><feMergeNode in='SourceGraphic'/></feMerge></filter>
  <linearGradient id='researched' x1='0%' y1='0%' x2='100%' y2='100%'><stop offset='0%' stop-color='#4ade80'/><stop offset='100%' stop-color='#22c55e'/></linearGradient>
  <linearGradient id='progress' x1='0%' y1='0%' x2='100%' y2='100%'><stop offset='0%' stop-color='#fbbf24'/><stop offset='100%' stop-color='#f59e0b'/></linearGradient>
  <linearGradient id='available' x1='0%' y1='0%' x2='100%' y2='100%'><stop offset='0%' stop-color='#60a5fa'/><stop offset='100%' stop-color='#3b82f6'/></linearGradient>
  <linearGradient id='locked' x1='0%' y1='0%' x2='100%' y2='100%'><stop offset='0%' stop-color='#9ca3af'/><stop offset='100%' stop-color='#6b7280'/></linearGradient>
  <linearGradient id='future' x1='0%' y1='0%' x2='100%' y2='100%'><stop offset='0%' stop-color='#c084fc'/><stop offset='100%' stop-color='#a855f7'/></linearGradient>
</defs>\n"
    }
    
    â²ª svg_background(â²¤) â†’ â²¦â²‰â²â²§ {
        â²¢ "<rect width='100%' height='100%' fill='#0f172a'/>\n"
    }
    
    â²ª svg_era_labels(â²¤) â†’ â²¦â²‰â²â²§ {
        â²‚ labels = ""
        â²‚ eras = ["Ancient", "Classical", "Medieval", "Renaissance", "Industrial", "Modern", "Atomic", "Info", "Future"]
        â²œ i âˆˆ 0..eras.len() {
            â²‚ x = 100 + i * 200
            labels += "<text x='" + x.to_string() + "' y='30' fill='#94a3b8' font-size='14' text-anchor='middle'>" + eras[i] + "</text>\n"
        }
        â²¢ labels
    }
    
    â²ª svg_connections(â²¤) â†’ â²¦â²‰â²â²§ {
        â²‚ lines = "<g stroke-width='2'>\n"
        â²œ (id, node) âˆˆ â²¤.tree.nodes {
            â²œ dep_id âˆˆ node.dependencies {
                â²‚ dep = â²¤.tree.get_node(dep_id)
                â²ˆ dep != â—‹ {
                    â²‚ color = â²ˆ node.status == TechStatus.FogOfWar { "#1e293b" } â²€ { "#475569" }
                    lines += "<line x1='" + (dep.x + 50).to_string() + "' y1='" + (dep.y + 60).to_string() + "' x2='" + (node.x + 50).to_string() + "' y2='" + (node.y + 60).to_string() + "' stroke='" + color + "'/>\n"
                }
            }
        }
        lines += "</g>\n"
        â²¢ lines
    }
    
    â²ª svg_nodes(â²¤) â†’ â²¦â²‰â²â²§ {
        â²‚ nodes = ""
        â²œ (id, node) âˆˆ â²¤.tree.nodes {
            nodes += â²¤.svg_node(node)
        }
        â²¢ nodes
    }
    
    â²ª svg_node(â²¤, â²€ node: TechNode) â†’ â²¦â²‰â²â²§ {
        â²‚ x = node.x + 50
        â²‚ y = node.y + 50
        â²‚ fill = â²¤.status_gradient(node.status)
        â²‚ opacity = â²ˆ node.status == TechStatus.FogOfWar { "0.3" } â²€ { "1" }
        â²‚ filter = â²ˆ node.status == TechStatus.FogOfWar { "filter='url(#fog)'" } â²€ â²ˆ node.status == TechStatus.Researched { "filter='url(#glow)'" } â²€ { "" }
        
        â²‚ svg = "<g transform='translate(" + x.to_string() + "," + y.to_string() + ")' opacity='" + opacity + "' " + filter + ">\n"
        svg += "  <rect x='-45' y='-25' width='90' height='50' rx='8' fill='url(#" + fill + ")'/>\n"
        svg += "  <text x='0' y='-5' fill='white' font-size='20' text-anchor='middle'>" + node.icon + "</text>\n"
        svg += "  <text x='0' y='15' fill='white' font-size='10' text-anchor='middle'>" + node.id + "</text>\n"
        â²ˆ node.speedup > 1.0 {
            svg += "  <text x='35' y='-15' fill='#fef08a' font-size='8'>" + node.speedup.to_string() + "x</text>\n"
        }
        svg += "</g>\n"
        â²¢ svg
    }
    
    â²ª status_gradient(â²¤, â²€ status: TechStatus) â†’ â²¦â²‰â²â²§ {
        â²ˆ status == TechStatus.Researched { â²¢ "researched" }
        â²ˆ status == TechStatus.InProgress { â²¢ "progress" }
        â²ˆ status == TechStatus.Available { â²¢ "available" }
        â²ˆ status == TechStatus.Future { â²¢ "future" }
        â²¢ "locked"
    }
    
    â²ª svg_legend(â²¤) â†’ â²¦â²‰â²â²§ {
        â²‚ stats = â²¤.tree.stats()
        â²‚ y = â²¤.height - 100
        â²¢ "<g transform='translate(50," + y.to_string() + ")'>
  <text fill='white' font-size='16'>âœ… Researched: " + stats.researched.to_string() + "</text>
  <text y='20' fill='white' font-size='16'>ğŸ”„ In Progress: " + stats.in_progress.to_string() + "</text>
  <text y='40' fill='white' font-size='16'>ğŸ”“ Available: " + stats.available.to_string() + "</text>
  <text y='60' fill='white' font-size='16'>ğŸŒ«ï¸ Hidden: " + stats.fog_of_war.to_string() + "</text>
  <text x='200' fill='#fef08a' font-size='20'>Total Speedup: " + stats.total_speedup.to_string() + "x</text>
</g>\n"
    }
    
    // Save to file
    â²ª save(â²¤, â²€ path: â²¦â²‰â²â²§) {
        fs_write(path, â²¤.to_svg())
    }
}

// Main generator function
â²ª generate_tech_tree_visualization(â²€ root: â²¦â²‰â²â²§, â²€ output: â²¦â²‰â²â²§) {
    â²‚ tree = build_tech_tree(root)
    â²‚ viz = TechVisualizer.new(tree)
    viz.save(output)
}
