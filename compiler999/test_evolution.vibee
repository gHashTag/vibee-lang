// ═══════════════════════════════════════════════════════════════
// ТЕСТ САМОЭВОЛЮЦИИ КОМПИЛЯТОРА 999
// v1 → v2 → v3 → v∞
// ═══════════════════════════════════════════════════════════════

имя: тест_эволюции
версия: Ⲁ

// ═══════════════════════════════════════════════════════════════
// ТЕСТОВАЯ ПРОГРАММА НА ТРИДЕВЯТИЦЕ
// ═══════════════════════════════════════════════════════════════

// Простая программа для компиляции
ТЕСТОВЫЙ_КОД: "
// Программа на языке 999 (Тридевятица)

// Структура: Точка
Ⲏ Точка:
  x: Ⲛ
  y: Ⲛ

// Действие: сложить два числа
Ⲇ сложить(а: Ⲛ, б: Ⲛ) → Ⲛ:
  а Ⲁ б

// Действие: расстояние между точками
Ⲇ расстояние(т1: Точка, т2: Точка) → Ⲛ:
  Ⲗ dx = т2.x Ⲃ т1.x
  Ⲗ dy = т2.y Ⲃ т1.y
  корень(dx Ⲅ dx Ⲁ dy Ⲅ dy)

// Действие: факториал (рекурсия)
Ⲇ факториал(n: Ⲛ) → Ⲛ:
  Ⲑ n Ⲋ Ⲁ:
    Ⲁ
  Ⲓ:
    n Ⲅ факториал(n Ⲃ Ⲁ)

// Главная
Ⲇ главная():
  Ⲗ а = Ⲅ  // 3
  Ⲗ б = Ⲉ  // 5
  Ⲗ сумма = сложить(а, б)
  печатать(сумма)  // 8 = Ⲏ
"

// ═══════════════════════════════════════════════════════════════
// ТЕСТ 1: КОМПИЛЯЦИЯ ПРОСТОЙ ПРОГРАММЫ
// ═══════════════════════════════════════════════════════════════

Ⲇ тест_компиляции():
  печатать("═══ ТЕСТ 1: Компиляция ═══")
  
  // Создаём Горыныча
  Ⲗ горыныч = создать_горыныча(ТЕСТОВЫЙ_КОД)
  
  // Компилируем
  Ⲗ результат = компилировать(&горыныч, ТЕСТОВЫЙ_КОД)
  
  печатать("Входной код:")
  печатать(ТЕСТОВЫЙ_КОД)
  печатать("")
  печатать("Выходной код:")
  печатать(результат)
  
  // Проверка
  Ⲑ длина(результат) Ⲑ 0:
    печатать("✅ ТЕСТ 1 ПРОЙДЕН")
    Ⲣ
  Ⲓ:
    печатать("❌ ТЕСТ 1 ПРОВАЛЕН")
    Ⲃ

// ═══════════════════════════════════════════════════════════════
// ТЕСТ 2: РЕГЕНЕРАЦИЯ ГОЛОВЫ
// ═══════════════════════════════════════════════════════════════

Ⲇ тест_регенерации():
  печатать("\n═══ ТЕСТ 2: Регенерация ═══")
  
  Ⲗ горыныч = создать_горыныча(ТЕСТОВЫЙ_КОД)
  
  // Отрубаем каждую голову
  Ⲙ номер Ⲋ [Ⲁ, Ⲃ, Ⲅ]:
    печатать("\nОтрубаем голову " + номер + "...")
    отрубить_голову(&горыныч, номер)
    
    // Проверяем что голова жива
    Ⲑ горыныч.статус_голов[номер - 1] ≠ Жива:
      печатать("❌ ТЕСТ 2 ПРОВАЛЕН: голова " + номер + " не регенерировалась")
      Ⲛ Ⲃ
  
  печатать("\n✅ ТЕСТ 2 ПРОЙДЕН: все головы регенерировались")
  печатать("Всего регенераций: " + горыныч.счётчик_регенераций)
  Ⲣ

// ═══════════════════════════════════════════════════════════════
// ТЕСТ 3: САМОГЕНЕРАЦИЯ (BOOTSTRAPPING)
// ═══════════════════════════════════════════════════════════════

Ⲇ тест_самогенерации():
  печатать("\n═══ ТЕСТ 3: Самогенерация ═══")
  
  // Читаем спецификацию компилятора
  Ⲗ спецификация = "
// Спецификация компилятора 999
имя: компилятор_999
версия: Ⲁ

Ⲇ компилировать(код: Ⲡ) → Ⲡ:
  Ⲗ токены = лексер(код)
  Ⲗ ast = парсер(токены)
  кодоген(ast)
"
  
  // v1: Исходный компилятор
  Ⲗ v1 = создать_горыныча(спецификация)
  печатать("v1 создан: версия " + v1.версия)
  
  // v2: Первая самогенерация
  Ⲗ v2 = самогенерация(&v1)
  печатать("v2 создан: версия " + v2.версия)
  
  // v3: Вторая самогенерация
  Ⲗ v3 = самогенерация(&v2)
  печатать("v3 создан: версия " + v3.версия)
  
  // Проверка версий
  Ⲑ v1.версия = Ⲁ ∧ v2.версия = Ⲃ ∧ v3.версия = Ⲅ:
    печатать("\n✅ ТЕСТ 3 ПРОЙДЕН: v1 → v2 → v3")
    Ⲣ
  Ⲓ:
    печатать("\n❌ ТЕСТ 3 ПРОВАЛЕН")
    Ⲃ

// ═══════════════════════════════════════════════════════════════
// ТЕСТ 4: ФИКСИРОВАННАЯ ТОЧКА
// ═══════════════════════════════════════════════════════════════

Ⲇ тест_фиксированной_точки():
  печатать("\n═══ ТЕСТ 4: Фиксированная точка ═══")
  
  Ⲗ спецификация = "
// Минимальная спецификация для теста
Ⲇ id(x: Ⲛ) → Ⲛ:
  x
"
  
  Ⲗ горыныч = создать_горыныча(спецификация)
  
  // Цикл эволюции до фиксированной точки
  Ⲗ макс = Ⲑ  // 9 итераций максимум
  Ⲗ текущий = горыныч
  Ⲗ достигнута = Ⲃ
  
  Ⲙ i Ⲋ Ⲁ..макс:
    печатать("Итерация " + i + ": v" + текущий.версия)
    
    Ⲗ новый = самогенерация(&текущий)
    
    // Проверка фиксированной точки
    Ⲑ текущий.версия Ⲑ Ⲃ:
      Ⲗ код_текущий = компилировать(&текущий, спецификация)
      Ⲗ код_новый = компилировать(&новый, спецификация)
      
      Ⲑ код_текущий = код_новый:
        печатать("\n🎯 Фиксированная точка достигнута на v" + новый.версия)
        достигнута = Ⲣ
        прервать
    
    текущий = новый
  
  Ⲑ достигнута:
    печатать("\n✅ ТЕСТ 4 ПРОЙДЕН")
    Ⲣ
  Ⲓ:
    печатать("\n⚠️ ТЕСТ 4: фиксированная точка не достигнута за " + макс + " итераций")
    Ⲃ

// ═══════════════════════════════════════════════════════════════
// ТЕСТ 5: ОГНЕННОЕ ДЫХАНИЕ (МУЛЬТИЦЕЛЕВАЯ ГЕНЕРАЦИЯ)
// ═══════════════════════════════════════════════════════════════

Ⲇ тест_огненного_дыхания():
  печатать("\n═══ ТЕСТ 5: Огненное дыхание ═══")
  
  Ⲗ код = "
Ⲇ привет():
  печатать(\"Привет, Тридевятое Царство!\")
"
  
  Ⲗ горыныч = создать_горыныча(код)
  
  // Генерация на разные цели
  Ⲗ цели = [Тридевятица, Zig, WASM, BEAM]
  
  Ⲙ цель Ⲋ цели:
    печатать("\n🔥 Цель: " + цель)
    Ⲗ результат = дышать_огнём(&горыныч, код, цель)
    печатать(результат)
  
  печатать("\n✅ ТЕСТ 5 ПРОЙДЕН")
  Ⲣ

// ═══════════════════════════════════════════════════════════════
// ТЕСТ 6: ЧИСЛА В ТРИДЕВЯТИЦЕ
// ═══════════════════════════════════════════════════════════════

Ⲇ тест_чисел():
  печатать("\n═══ ТЕСТ 6: Числа в Тридевятице ═══")
  
  // Тестовые числа
  Ⲗ тесты = [
    (1, [Ⲁ]),
    (3, [Ⲅ]),
    (9, [Ⲑ]),
    (27, [Ⳃ]),
    (28, [Ⲁ, Ⲁ]),
    (999, [Ⲁ, Ⲑ, Ⲑ])  // 1×27² + 9×27 + 9
  ]
  
  Ⲙ (число, ожидание) Ⲋ тесты:
    Ⲗ результат = число_в_тридевятицу(число)
    печатать(число + " → " + результат)
    
    Ⲑ результат ≠ ожидание:
      печатать("❌ Ожидалось: " + ожидание)
      Ⲛ Ⲃ
  
  печатать("\n✅ ТЕСТ 6 ПРОЙДЕН")
  Ⲣ

// ═══════════════════════════════════════════════════════════════
// ГЛАВНАЯ ФУНКЦИЯ ТЕСТОВ
// ═══════════════════════════════════════════════════════════════

Ⲇ главная():
  печатать("═══════════════════════════════════════════════════════════════")
  печатать("🐉 ТЕСТЫ САМОЭВОЛЮЦИИ КОМПИЛЯТОРА 999")
  печатать("═══════════════════════════════════════════════════════════════")
  
  Ⲗ результаты: [Ⲣ] = []
  
  // Запуск тестов
  результаты.добавить(тест_компиляции())
  результаты.добавить(тест_регенерации())
  результаты.добавить(тест_самогенерации())
  результаты.добавить(тест_фиксированной_точки())
  результаты.добавить(тест_огненного_дыхания())
  результаты.добавить(тест_чисел())
  
  // Итоги
  Ⲗ пройдено = результаты.фильтр(р → р = Ⲣ).длина()
  Ⲗ всего = результаты.длина()
  
  печатать("\n═══════════════════════════════════════════════════════════════")
  печатать("📊 ИТОГИ: " + пройдено + "/" + всего + " тестов пройдено")
  печатать("═══════════════════════════════════════════════════════════════")
  
  Ⲑ пройдено = всего:
    печатать("\n🎉 ВСЕ ТЕСТЫ ПРОЙДЕНЫ!")
    печатать("🐉 Змей Горыныч готов к самоэволюции!")
  Ⲓ:
    печатать("\n⚠️ Некоторые тесты провалены")

// ═══════════════════════════════════════════════════════════════
// ДЕМОНСТРАЦИЯ ЭВОЛЮЦИИ
// ═══════════════════════════════════════════════════════════════

Ⲇ демо_эволюции():
  печатать("\n═══════════════════════════════════════════════════════════════")
  печатать("🎬 ДЕМОНСТРАЦИЯ ЭВОЛЮЦИИ")
  печатать("═══════════════════════════════════════════════════════════════")
  
  // Спецификация компилятора
  Ⲗ спека = читать_файл("gorynych.vibee")
  
  // Создаём первого Горыныча
  Ⲗ горыныч = создать_горыныча(спека)
  печатать("\n" + статус(горыныч))
  
  // Эволюция
  печатать("\n🔄 Начинаем эволюцию...")
  
  Ⲙ i Ⲋ Ⲁ..Ⲅ:
    печатать("\n─── Поколение " + i + " ───")
    
    // Показываем статус
    печатать(статус(горыныч))
    
    // Самогенерация
    горыныч = самогенерация(&горыныч)
    
    // Пауза для наглядности
    ждать(Ⲁ)  // 1 секунда
  
  печатать("\n═══════════════════════════════════════════════════════════════")
  печатать("🏆 ЭВОЛЮЦИЯ ЗАВЕРШЕНА!")
  печатать("Финальная версия: v" + горыныч.версия)
  печатать("═══════════════════════════════════════════════════════════════")
