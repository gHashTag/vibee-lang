<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìö –ö–ù–ò–ì–ê 999 ‚Äî –¢—Ä–∏–¥–µ–≤—è—Ç–æ–µ –¶–∞—Ä—Å—Ç–≤–æ –ê–ª–≥–æ—Ä–∏—Ç–º–æ–≤</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Cormorant+Garamond:wght@400;600&family=JetBrains+Mono:wght@400&display=swap" rel="stylesheet">
    <style>
:root{--gold:#d4af37;--copper:#b87333;--silver:#c0c0c0;--bg:#08080f;--card:#0d0d18;--text:#e8e0d0}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Cormorant Garamond',serif;background:var(--bg);color:var(--text);min-height:100vh}

/* Layout */
.app{display:grid;grid-template-columns:280px 1fr;height:100vh}

/* Sidebar */
.sidebar{background:linear-gradient(180deg,#0a0a15,#050508);border-right:1px solid rgba(212,175,55,0.2);display:flex;flex-direction:column;overflow:hidden}
.logo{padding:25px;text-align:center;border-bottom:1px solid rgba(212,175,55,0.2)}
.logo h1{font-family:'Cinzel',serif;font-size:1.4em;color:var(--gold);letter-spacing:0.15em}
.logo p{font-size:0.85em;color:var(--silver);margin-top:5px}

.nav-section{padding:15px;border-bottom:1px solid rgba(212,175,55,0.1)}
.nav-section h3{font-family:'Cinzel',serif;font-size:0.8em;color:var(--gold);margin-bottom:10px;letter-spacing:0.1em}

.books-list{flex:1;overflow-y:auto;padding:10px}
.book-item{padding:10px 12px;margin:4px 0;background:rgba(0,0,0,0.3);border-left:3px solid transparent;cursor:pointer;transition:all 0.2s;border-radius:0 5px 5px 0;font-size:0.9em}
.book-item:hover{background:rgba(212,175,55,0.1);border-left-color:var(--gold)}
.book-item.active{background:rgba(212,175,55,0.15);border-left-color:var(--gold)}
.book-item .num{color:var(--gold);font-weight:bold;margin-right:8px}
.book-item.copper{border-left-color:var(--copper)}
.book-item.silver{border-left-color:var(--silver)}
.book-item.gold{border-left-color:var(--gold)}

.alphabet-grid{display:grid;grid-template-columns:repeat(9,1fr);gap:3px}
.alpha-btn{background:rgba(0,0,0,0.4);border:1px solid rgba(212,175,55,0.2);padding:6px 2px;text-align:center;cursor:pointer;font-size:1.1em;transition:all 0.2s;border-radius:3px}
.alpha-btn:hover{background:rgba(212,175,55,0.2);border-color:var(--gold)}
.alpha-btn.active{background:rgba(212,175,55,0.3);border-color:var(--gold)}

/* Main */
.main{display:flex;flex-direction:column;overflow:hidden}

/* Header */
.header{display:flex;justify-content:space-between;align-items:center;padding:15px 25px;background:rgba(0,0,0,0.5);border-bottom:1px solid rgba(212,175,55,0.2)}
.chapter-nav{display:flex;align-items:center;gap:10px}
.btn{font-family:'Cinzel',serif;background:transparent;border:1px solid var(--gold);color:var(--gold);padding:8px 16px;cursor:pointer;font-size:0.85em;transition:all 0.2s;border-radius:4px}
.btn:hover{background:rgba(212,175,55,0.2)}
.btn:disabled{opacity:0.3;cursor:not-allowed}
.chapter-input{font-family:'JetBrains Mono',monospace;background:rgba(0,0,0,0.5);border:1px solid var(--gold);color:var(--gold);padding:8px 12px;width:70px;text-align:center;border-radius:4px}
.pattern-display{font-family:'JetBrains Mono',monospace;color:var(--silver);font-size:0.9em}

/* Content */
.content{flex:1;overflow-y:auto;padding:30px 40px}

.chapter-header{text-align:center;margin-bottom:40px;padding-bottom:30px;border-bottom:1px solid rgba(212,175,55,0.2)}
.chapter-number{font-family:'Cinzel',serif;font-size:0.9em;color:var(--silver);letter-spacing:0.2em;margin-bottom:10px}
.chapter-title{font-family:'Cinzel',serif;font-size:2.2em;color:var(--gold);margin-bottom:15px}
.chapter-letter{font-size:4em;margin:20px 0;text-shadow:0 0 40px currentColor}
.chapter-letter.sacred{animation:glow 3s ease-in-out infinite}
@keyframes glow{0%,100%{text-shadow:0 0 30px currentColor}50%{text-shadow:0 0 60px currentColor,0 0 90px currentColor}}

.meta-row{display:flex;justify-content:center;gap:20px;flex-wrap:wrap;margin-top:15px}
.meta-badge{padding:6px 16px;border-radius:20px;font-size:0.85em}
.meta-badge.copper{background:rgba(184,115,51,0.2);border:1px solid var(--copper);color:var(--copper)}
.meta-badge.silver{background:rgba(192,192,192,0.2);border:1px solid var(--silver);color:var(--silver)}
.meta-badge.gold{background:rgba(212,175,55,0.2);border:1px solid var(--gold);color:var(--gold)}
.meta-badge.sacred{background:rgba(212,175,55,0.3);color:var(--gold)}

.section{margin:30px 0;padding:25px;background:var(--card);border-radius:10px;border:1px solid rgba(212,175,55,0.1)}
.section-title{font-family:'Cinzel',serif;color:var(--gold);font-size:1.1em;margin-bottom:15px;display:flex;align-items:center;gap:10px}
.section-title::after{content:'';flex:1;height:1px;background:linear-gradient(90deg,rgba(212,175,55,0.3),transparent)}

.pattern-box{background:#0a0a12;padding:20px;border-radius:8px;text-align:center;font-family:'JetBrains Mono',monospace;border:1px solid #1a1a2a}
.pattern-formula{font-size:1.3em;color:var(--gold)}
.pattern-result{font-size:2em;margin-top:10px}
.pattern-sacred{color:var(--silver);margin-top:8px;font-size:0.9em}

.book-info{display:grid;grid-template-columns:repeat(3,1fr);gap:15px}
.info-card{background:rgba(0,0,0,0.3);padding:15px;border-radius:8px;text-align:center}
.info-label{font-size:0.8em;color:var(--silver);margin-bottom:5px}
.info-value{font-size:1.1em;color:var(--text)}

.code-block{background:#0d1117;border:1px solid #30363d;border-radius:8px;padding:20px;font-family:'JetBrains Mono',monospace;font-size:0.85em;overflow-x:auto;white-space:pre;line-height:1.7;color:#e6edf3}
.code-block .comment{color:#8b949e}
.code-block .keyword{color:#ff7b72}
.code-block .string{color:#a5d6ff}
.code-block .number{color:#79c0ff}
.code-block .type{color:#ffa657}

.wisdom-box{text-align:center;padding:25px;background:linear-gradient(135deg,rgba(212,175,55,0.1),transparent);border:1px solid var(--gold);border-radius:10px}
.wisdom-text{font-size:1.4em;font-style:italic;color:var(--gold);line-height:1.6}

.nav-footer{display:flex;justify-content:space-between;padding:20px 0;margin-top:30px;border-top:1px solid rgba(212,175,55,0.2)}

/* Responsive */
@media(max-width:900px){.app{grid-template-columns:1fr}.sidebar{display:none}}
    </style>
</head>
<body>
<div class="app">
    <aside class="sidebar">
        <div class="logo">
            <h1>–ö–ù–ò–ì–ê 999</h1>
            <p>n √ó 3<sup>k</sup> √ó œÄ<sup>m</sup></p>
        </div>
        
        <div class="nav-section">
            <h3>–ê–õ–§–ê–í–ò–¢</h3>
            <div class="alphabet-grid" id="alphabet"></div>
        </div>
        
        <div class="books-list" id="books"></div>
    </aside>
    
    <main class="main">
        <header class="header">
            <div class="chapter-nav">
                <button class="btn" onclick="go(c-1)" id="prevBtn">‚Üê</button>
                <input type="number" class="chapter-input" id="chInput" value="1" min="1" max="999" onchange="go(this.value)">
                <span style="color:var(--silver)">/999</span>
                <button class="btn" onclick="go(c+1)" id="nextBtn">‚Üí</button>
                <button class="btn" onclick="goRandom()">‚öÇ</button>
                <button class="btn" onclick="goSacred()">‚ú®</button>
            </div>
            <div class="pattern-display" id="patternDisplay"></div>
        </header>
        
        <div class="content" id="content"></div>
    </main>
</div>

<script>
let data = null;
let books = null;
let c = 1;

const ALPHA = "‚≤Ä‚≤Ç‚≤Ñ‚≤Ü‚≤à‚≤ä‚≤å‚≤é‚≤ê‚≤í‚≤î‚≤ñ‚≤ò‚≤ö‚≤ú‚≤û‚≤†‚≤¢‚≤§‚≤¶‚≤®‚≤™‚≤¨‚≤Æ‚≤∞‚≥Ä‚≥Ç".split('');
const œÄ = Math.PI;

async function init() {
    try {
        const [chaptersRes, booksRes] = await Promise.all([
            fetch('generated_tridevyatitsa/full_book/chapters.json'),
            fetch('generated_tridevyatitsa/full_book/books.json')
        ]);
        data = await chaptersRes.json();
        books = await booksRes.json();
        buildUI();
        go(1);
    } catch(e) {
        document.getElementById('content').innerHTML = '<p style="text-align:center;padding:50px">–ó–∞–≥—Ä—É–∑–∫–∞...</p>';
    }
}

function buildUI() {
    // Alphabet
    let alphaHTML = '';
    ALPHA.forEach((s, i) => {
        alphaHTML += `<div class="alpha-btn" onclick="go(${i+1})" id="a${i+1}">${s}</div>`;
    });
    document.getElementById('alphabet').innerHTML = alphaHTML;
    
    // Books
    let booksHTML = '';
    for (let i = 1; i <= 27; i++) {
        const b = books[i];
        const klass = i <= 9 ? 'copper' : i <= 18 ? 'silver' : 'gold';
        booksHTML += `<div class="book-item ${klass}" onclick="go(${b.–≥–ª–∞–≤—ã[0]})" id="b${i}">
            <span class="num">${i}.</span>${b.–Ω–∞–∑–≤–∞–Ω–∏–µ}
        </div>`;
    }
    document.getElementById('books').innerHTML = booksHTML;
}

function pattern(g) {
    const n = ((g - 1) % 27) + 1;
    const k = Math.min(Math.floor((g - 1) / 333), 2);
    const m = g % 27 === 0 ? 2 : g % 9 === 0 ? 1 : g % 3 === 0 ? 0.5 : 0;
    return {n, k, m, v: n * Math.pow(3, k) * Math.pow(œÄ, m)};
}

function go(g) {
    g = parseInt(g);
    if (g < 1 || g > 999 || !data) return;
    c = g;
    
    const ch = data[g - 1];
    const p = pattern(g);
    
    document.getElementById('chInput').value = g;
    document.getElementById('prevBtn').disabled = g <= 1;
    document.getElementById('nextBtn').disabled = g >= 999;
    document.getElementById('patternDisplay').textContent = 
        `${p.n} √ó 3^${p.k} √ó œÄ^${p.m} = ${p.v.toFixed(4)}`;
    
    // Update active states
    document.querySelectorAll('.alpha-btn').forEach((el, i) => el.classList.toggle('active', i + 1 === p.n));
    document.querySelectorAll('.book-item').forEach((el, i) => el.classList.toggle('active', i + 1 === ch.–∫–Ω–∏–≥–∞));
    
    render(ch, p);
}

function highlightCode(code) {
    return code
        .replace(/(\/\/.*)/g, '<span class="comment">$1</span>')
        .replace(/\b(let|const|fn|struct|impl|enum|type|match|if|else|for|while|loop|return|use|mod|pub|async|await|unsafe|trait|self|Self)\b/g, '<span class="keyword">$1</span>')
        .replace(/\b(i8|i16|i32|i64|u8|u32|u64|f32|f64|bool|char|str|String|Vec|Option|Result|Some|None|Ok|Err|Box|Rc|Arc|Tribool)\b/g, '<span class="type">$1</span>')
        .replace(/"([^"]*)"/g, '<span class="string">"$1"</span>')
        .replace(/\b(\d+\.?\d*)\b/g, '<span class="number">$1</span>');
}

function render(ch, p) {
    const kClass = ch.—Ü–∞—Ä—Å—Ç–≤–æ === '–ú–µ–¥–Ω–æ–µ' ? 'copper' : ch.—Ü–∞—Ä—Å—Ç–≤–æ === '–°–µ—Ä–µ–±—Ä—è–Ω–æ–µ' ? 'silver' : 'gold';
    const kColor = ch.—Ü–∞—Ä—Å—Ç–≤–æ === '–ú–µ–¥–Ω–æ–µ' ? '#b87333' : ch.—Ü–∞—Ä—Å—Ç–≤–æ === '–°–µ—Ä–µ–±—Ä—è–Ω–æ–µ' ? '#c0c0c0' : '#d4af37';
    const stars = p.m === 2 ? '‚≠ê‚≠ê‚≠ê' : p.m === 1 ? '‚≠ê‚≠ê' : p.m >= 0.5 ? '‚≠ê' : '';
    const isSacred = p.m >= 1;
    
    document.getElementById('content').innerHTML = `
<div class="chapter-header">
    <div class="chapter-number">–ì–õ–ê–í–ê ${ch.–Ω–æ–º–µ—Ä} ‚Ä¢ –ö–ù–ò–ì–ê ${ch.–∫–Ω–∏–≥–∞}</div>
    <div class="chapter-title">${ch.—Ç–µ–º–∞}</div>
    <div class="chapter-letter ${isSacred ? 'sacred' : ''}" style="color:${kColor}">${ch.–±—É–∫–≤–∞}</div>
    <div style="color:var(--silver)">${ch.–∏–º—è_–±—É–∫–≤—ã} ‚Äî ${ch.—Å–º—ã—Å–ª_–±—É–∫–≤—ã}</div>
    <div class="meta-row">
        <span class="meta-badge ${kClass}">${ch.—Ü–∞—Ä—Å—Ç–≤–æ} —Ü–∞—Ä—Å—Ç–≤–æ</span>
        <span class="meta-badge">–¢–æ–º ${ch.—Ç–æ–º}</span>
        ${ch.—Å–≤—è—â–µ–Ω–Ω–æ—Å—Ç—å !== '–æ–±—ã—á–Ω–æ–µ' ? `<span class="meta-badge sacred">${stars} ${ch.—Å–≤—è—â–µ–Ω–Ω–æ—Å—Ç—å}</span>` : ''}
    </div>
</div>

<div class="section">
    <div class="section-title">üìê –°–í–Ø–©–ï–ù–ù–´–ô –ü–ê–¢–¢–ï–†–ù</div>
    <div class="pattern-box">
        <div class="pattern-formula">${p.n} √ó 3<sup>${p.k}</sup> √ó œÄ<sup>${p.m}</sup></div>
        <div class="pattern-result">= ${p.v.toFixed(6)}</div>
        <div class="pattern-sacred">${ch.—Å–≤—è—â–µ–Ω–Ω–æ—Å—Ç—å}</div>
    </div>
</div>

<div class="section">
    <div class="section-title">üìö –ö–û–ù–¢–ï–ö–°–¢</div>
    <div class="book-info">
        <div class="info-card">
            <div class="info-label">–ö–Ω–∏–≥–∞</div>
            <div class="info-value">${ch.–Ω–∞–∑–≤–∞–Ω–∏–µ_–∫–Ω–∏–≥–∏}</div>
        </div>
        <div class="info-card">
            <div class="info-label">–¢–µ–º–∞ –∫–Ω–∏–≥–∏</div>
            <div class="info-value">${ch.—Ç–µ–º–∞_–∫–Ω–∏–≥–∏}</div>
        </div>
        <div class="info-card">
            <div class="info-label">–¢–µ–º–∞ Vibee</div>
            <div class="info-value">${ch.vibee_—Ç–µ–º–∞}</div>
        </div>
    </div>
</div>

<div class="section">
    <div class="section-title">üíª –ö–û–î VIBEE</div>
    <div class="code-block">${highlightCode(ch.–∫–æ–¥)}</div>
</div>

<div class="wisdom-box">
    <div class="wisdom-text">¬´ ${ch.—Å–º—ã—Å–ª_–±—É–∫–≤—ã} ‚Üí ${ch.vibee_—Ç–µ–º–∞} ¬ª</div>
</div>

<div class="nav-footer">
    <button class="btn" onclick="go(${ch.–Ω–æ–º–µ—Ä - 1})" ${ch.–Ω–æ–º–µ—Ä <= 1 ? 'disabled' : ''}>‚Üê –ì–ª–∞–≤–∞ ${ch.–Ω–æ–º–µ—Ä - 1}</button>
    <button class="btn" onclick="go(${ch.–Ω–æ–º–µ—Ä + 1})" ${ch.–Ω–æ–º–µ—Ä >= 999 ? 'disabled' : ''}>–ì–ª–∞–≤–∞ ${ch.–Ω–æ–º–µ—Ä + 1} ‚Üí</button>
</div>`;
}

function goRandom() { go(Math.floor(Math.random() * 999) + 1); }
function goSacred() {
    const sacred = [];
    for (let i = 27; i <= 999; i += 27) sacred.push(i);
    go(sacred[Math.floor(Math.random() * sacred.length)]);
}

init();
</script>
</body>
</html>
