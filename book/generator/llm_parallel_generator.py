#!/usr/bin/env python3
"""
–ü–ê–†–ê–õ–õ–ï–õ–¨–ù–´–ô –£–õ–¨–¢–†–ê-–ì–ï–ù–ï–†–ê–¢–û–† –ö–ù–ò–ì–ò 999
–£—Å–∫–æ—Ä–µ–Ω–∏–µ —á–µ—Ä–µ–∑ ThreadPoolExecutor (10 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤)
"""

import os
import json
import time
import urllib.request
from concurrent.futures import ThreadPoolExecutor, as_completed
from typing import Tuple

DEEPSEEK_API_KEY = "sk-045135746e63422daac74a1a9f74e31f"
DEEPSEEK_URL = "https://api.deepseek.com/v1/chat/completions"
OUTPUT_DIR = "/workspaces/vibee-lang/book/output"
MAX_WORKERS = 10  # –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã

–ö–ù–ò–ì–ò = {
    1: {"–Ω–∞–∑–≤–∞–Ω–∏–µ": "–ù–∞—á–∞–ª–æ –ü—É—Ç–∏", "—Ç–µ–º–∞": "–ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–æ–∏—á–Ω—ã—Ö —Å–∏—Å—Ç–µ–º",
        "–∫–æ–Ω—Ç–µ–∫—Å—Ç": "–°–µ—Ç—É–Ω—å 1958, –ë—Ä—É—Å–µ–Ω—Ü–æ–≤, {-1,0,+1}, log‚ÇÉ/log‚ÇÇ‚âà0.63, –§–∞—É–ª–µ—Ä 1840"},
    2: {"–Ω–∞–∑–≤–∞–Ω–∏–µ": "–ß–∏—Å–ª–æ –¢—Ä–∏", "—Ç–µ–º–∞": "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ —á–∏—Å–ª–∞ 3",
        "–∫–æ–Ω—Ç–µ–∫—Å—Ç": "œÜ¬≤+1/œÜ¬≤=3, –ø–µ—Ä–≤–æ–µ –Ω–µ—á—ë—Ç–Ω–æ–µ –ø—Ä–æ—Å—Ç–æ–µ, 3 –ø–æ–∫–æ–ª–µ–Ω–∏—è —Ñ–µ—Ä–º–∏–æ–Ω–æ–≤"},
    3: {"–Ω–∞–∑–≤–∞–Ω–∏–µ": "–ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã", "—Ç–µ–º–∞": "–°–≤—è—â–µ–Ω–Ω–∞—è –§–æ—Ä–º—É–ª–∞ V=n√ó3^k√óœÄ^m√óœÜ^p",
        "–∫–æ–Ω—Ç–µ–∫—Å—Ç": "œÜ=2cos(œÄ/5), 1/Œ±=4œÄ¬≥+œÄ¬≤+œÄ‚âà137.036, m_p/m_e=6œÄ‚Åµ"},
    4: {"–Ω–∞–∑–≤–∞–Ω–∏–µ": "–¢—Ä–æ–∏—á–Ω–∞—è –õ–æ–≥–∏–∫–∞", "—Ç–µ–º–∞": "–õ–æ–≥–∏–∫–∞ –õ—É–∫–∞—Å–µ–≤–∏—á–∞",
        "–∫–æ–Ω—Ç–µ–∫—Å—Ç": "True/Unknown/False, SQL NULL, ¬¨¬¨A‚â†A"},
    5: {"–Ω–∞–∑–≤–∞–Ω–∏–µ": "–°—Ç—Ä—É–∫—Ç—É—Ä—ã –î–∞–Ω–Ω—ã—Ö", "—Ç–µ–º–∞": "–¢—Ä–æ–∏—á–Ω—ã–µ –¥–µ—Ä–µ–≤—å—è",
        "–∫–æ–Ω—Ç–µ–∫—Å—Ç": "TST, log‚ÇÉ(n), B-–¥–µ—Ä–µ–≤–æ –ø–æ—Ä—è–¥–∫–∞ 3"},
    6: {"–Ω–∞–∑–≤–∞–Ω–∏–µ": "–ö–≤–∞–Ω—Ç–æ–≤—ã–µ –ö—É—Ç—Ä–∏—Ç—ã", "—Ç–µ–º–∞": "–ö–≤–∞–Ω—Ç–æ–≤—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è",
        "–∫–æ–Ω—Ç–µ–∫—Å—Ç": "|œà‚ü©=Œ±|0‚ü©+Œ≤|1‚ü©+Œ≥|2‚ü©, 1.58 –±–∏—Ç"},
    7: {"–Ω–∞–∑–≤–∞–Ω–∏–µ": "–ù–µ–π—Ä–æ–Ω–Ω—ã–µ –°–µ—Ç–∏", "—Ç–µ–º–∞": "TNN",
        "–∫–æ–Ω—Ç–µ–∫—Å—Ç": "–í–µ—Å–∞ {-1,0,+1}, —ç–∫–æ–Ω–æ–º–∏—è 16x"},
    8: {"–Ω–∞–∑–≤–∞–Ω–∏–µ": "–ö—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—è", "—Ç–µ–º–∞": "–¢—Ä–æ–∏—á–Ω—ã–µ —à–∏—Ñ—Ä—ã",
        "–∫–æ–Ω—Ç–µ–∫—Å—Ç": "C=(M+K)mod3, 3^n –∫–æ–º–±–∏–Ω–∞—Ü–∏–π"},
    9: {"–Ω–∞–∑–≤–∞–Ω–∏–µ": "–°–∏–Ω—Ç–µ–∑ –¢–µ–æ—Ä–∏–∏", "—Ç–µ–º–∞": "–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –¢–æ–º–∞ 1",
        "–∫–æ–Ω—Ç–µ–∫—Å—Ç": "333=9√ó37, –º–µ–¥–Ω—ã–π –∫–ª—é—á"},
    10: {"–Ω–∞–∑–≤–∞–Ω–∏–µ": "Trinity Sort", "—Ç–µ–º–∞": "Dual-Pivot QuickSort",
         "–∫–æ–Ω—Ç–µ–∫—Å—Ç": "Yaroslavskiy 2009, Java 7+, O(n log‚ÇÉ n)"},
    11: {"–Ω–∞–∑–≤–∞–Ω–∏–µ": "Trinity Search", "—Ç–µ–º–∞": "–¢—Ä–æ–∏—á–Ω—ã–π –ø–æ–∏—Å–∫",
         "–∫–æ–Ω—Ç–µ–∫—Å—Ç": "–£–Ω–∏–º–æ–¥–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏, O(log‚ÇÉ n)"},
    12: {"–Ω–∞–∑–≤–∞–Ω–∏–µ": "Trinity Compress", "—Ç–µ–º–∞": "Huffman-3",
         "–∫–æ–Ω—Ç–µ–∫—Å—Ç": "H‚ÇÉ=-Œ£p·µ¢log‚ÇÉ(p·µ¢)"},
    13: {"–Ω–∞–∑–≤–∞–Ω–∏–µ": "–Ø–∑—ã–∫ VIBEE", "—Ç–µ–º–∞": "–°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è 999",
         "–∫–æ–Ω—Ç–µ–∫—Å—Ç": ".vibee‚Üí.999‚Üíruntime, –∫–æ–ø—Ç—Å–∫–∏–π –∞–ª—Ñ–∞–≤–∏—Ç"},
    14: {"–Ω–∞–∑–≤–∞–Ω–∏–µ": "–ö–æ–º–ø–∏–ª—è—Ç–æ—Ä", "—Ç–µ–º–∞": "–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞",
         "–∫–æ–Ω—Ç–µ–∫—Å—Ç": "Lexer‚ÜíParser‚ÜíAST‚ÜíIR‚ÜíCodegen"},
    15: {"–Ω–∞–∑–≤–∞–Ω–∏–µ": "Runtime", "—Ç–µ–º–∞": "–ï–¥–∏–Ω—ã–π HTML",
         "–∫–æ–Ω—Ç–µ–∫—Å—Ç": "runtime.html, –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä"},
    16: {"–Ω–∞–∑–≤–∞–Ω–∏–µ": "PAS", "—Ç–µ–º–∞": "Predictive Algorithmic Systematics",
         "–∫–æ–Ω—Ç–µ–∫—Å—Ç": "D&C 31%, ALG 22%, PRE 16%"},
    17: {"–Ω–∞–∑–≤–∞–Ω–∏–µ": "–ë–µ–Ω—á–º–∞—Ä–∫–∏", "—Ç–µ–º–∞": "–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å",
         "–∫–æ–Ω—Ç–µ–∫—Å—Ç": "speedup=T_old/T_new"},
    18: {"–Ω–∞–∑–≤–∞–Ω–∏–µ": "–°–∏–Ω—Ç–µ–∑ –ü—Ä–∞–∫—Ç–∏–∫–∏", "—Ç–µ–º–∞": "–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –¢–æ–º–∞ 2",
         "–∫–æ–Ω—Ç–µ–∫—Å—Ç": "666=2√ó333, —Å–µ—Ä–µ–±—Ä—è–Ω—ã–π –∫–ª—é—á"},
    19: {"–Ω–∞–∑–≤–∞–Ω–∏–µ": "999 OS", "—Ç–µ–º–∞": "–¢—Ä–æ–∏—á–Ω–∞—è –û–°",
         "–∫–æ–Ω—Ç–µ–∫—Å—Ç": "–¢—Ä–∏ –∫–æ–ª—å—Ü–∞ –∑–∞—â–∏—Ç—ã"},
    20: {"–Ω–∞–∑–≤–∞–Ω–∏–µ": "–ñ–ê–†-–ü–¢–ò–¶–ê", "—Ç–µ–º–∞": "–°–∞–º–æ—ç–≤–æ–ª—é—Ü–∏—è",
         "–∫–æ–Ω—Ç–µ–∫—Å—Ç": "fitness(gen+1)‚â•fitness(gen)"},
    21: {"–Ω–∞–∑–≤–∞–Ω–∏–µ": "50 –Ø–∑—ã–∫–æ–≤", "—Ç–µ–º–∞": "–¢—Ä–∞–Ω—Å–ø–∏–ª—è—Ü–∏—è",
         "–∫–æ–Ω—Ç–µ–∫—Å—Ç": ".999‚ÜíPython/Rust/Go"},
    22: {"–Ω–∞–∑–≤–∞–Ω–∏–µ": "–ö–≤–∞–Ω—Ç–æ–≤–æ–µ –ë—É–¥—É—â–µ–µ", "—Ç–µ–º–∞": "Grover –Ω–∞ –∫—É—Ç—Ä–∏—Ç–∞—Ö",
         "–∫–æ–Ω—Ç–µ–∫—Å—Ç": "O(N^(1/3))"},
    23: {"–Ω–∞–∑–≤–∞–Ω–∏–µ": "–§—Ä–∞–∫—Ç–∞–ª—ã", "—Ç–µ–º–∞": "–°–∞–º–æ–ø–æ–¥–æ–±–∏–µ",
         "–∫–æ–Ω—Ç–µ–∫—Å—Ç": "D=log(N)/log(1/r)"},
    24: {"–Ω–∞–∑–≤–∞–Ω–∏–µ": "–°–æ–∑–Ω–∞–Ω–∏–µ", "—Ç–µ–º–∞": "–°–∞–º–æ—Ä–µ—Ñ–µ—Ä–µ–Ω—Ü–∏—è",
         "–∫–æ–Ω—Ç–µ–∫—Å—Ç": "I=f(I), —Å—Ç—Ä–∞–Ω–Ω—ã–µ –ø–µ—Ç–ª–∏"},
    25: {"–Ω–∞–∑–≤–∞–Ω–∏–µ": "–≠–≤–æ–ª—é—Ü–∏—è", "—Ç–µ–º–∞": "–ú–µ—Ç–∞-—ç–≤–æ–ª—é—Ü–∏—è",
         "–∫–æ–Ω—Ç–µ–∫—Å—Ç": "meta_fitness"},
    26: {"–Ω–∞–∑–≤–∞–Ω–∏–µ": "–¢—Ä–∞–Ω—Å—Ü–µ–Ω–¥–µ–Ω—Ü–∏—è", "—Ç–µ–º–∞": "–ü—Ä–µ–¥–µ–ª—ã –≤—ã—á–∏—Å–ª–∏–º–æ—Å—Ç–∏",
         "–∫–æ–Ω—Ç–µ–∫—Å—Ç": "–ì—ë–¥–µ–ª—å, –ø—Ä–æ–±–ª–µ–º–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏"},
    27: {"–Ω–∞–∑–≤–∞–Ω–∏–µ": "OMEGA", "—Ç–µ–º–∞": "–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ",
         "–∫–æ–Ω—Ç–µ–∫—Å—Ç": "999=37√ó3¬≥, –∫–æ–Ω–µ—Ü=–Ω–∞—á–∞–ª–æ"}
}

SYSTEM_PROMPT = """–¢—ã ‚Äî –º–∞—Å—Ç–µ—Ä-–ø–∏—Å–∞—Ç–µ–ª—å –∫–Ω–∏–≥–∏ "999" –æ —Ç—Ä–æ–∏—á–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö.

–≠–¢–ê–õ–û–ù: 5000-8000 —Å–ª–æ–≤ –Ω–∞ –≥–ª–∞–≤—É. ASCII-–¥–∏–∞–≥—Ä–∞–º–º—ã. –ö–æ–¥ –Ω–∞ Zig/Vibee.

–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–ê–Ø –°–¢–†–£–ö–¢–£–†–ê:

## –≠–ø–∏–≥—Ä–∞—Ñ
*–ü–æ—ç—Ç–∏—á–Ω–∞—è —Ü–∏—Ç–∞—Ç–∞ –≤ —Å—Ç–∏–ª–µ —Ä—É—Å—Å–∫–æ–π —Å–∫–∞–∑–∫–∏*

## –í–≤–µ–¥–µ–Ω–∏–µ: –ö–∞–º–µ–Ω—å –Ω–∞ –†–∞—Å–ø—É—Ç—å–µ
3-4 –∞–±–∑–∞—Ü–∞: –ø–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–æ–±–ª–µ–º—ã —á–µ—Ä–µ–∑ –º–µ—Ç–∞—Ñ–æ—Ä—É —Ç—Ä—ë—Ö –¥–æ—Ä–æ–≥

## –ò—Å—Ç–æ—Ä–∏—è –ò–≤–∞–Ω–∞ (–º–∏–Ω–∏–º—É–º 1000 —Å–ª–æ–≤)
- –ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ª–æ–∫–∞—Ü–∏–∏ (–∑–≤—É–∫–∏, –∑–∞–ø–∞—Ö–∏, —Ü–≤–µ—Ç–∞)
- –ü–µ—Ä—Å–æ–Ω–∞–∂ (–í–∞—Å–∏–ª–∏—Å–∞/–ö–æ—â–µ–π/–ë–∞–±–∞-–Ø–≥–∞) —Å —Ö–∞—Ä–∞–∫—Ç–µ—Ä–æ–º
- –î–∏–∞–ª–æ–≥ –º–∏–Ω–∏–º—É–º 10 —Ä–µ–ø–ª–∏–∫
- –ò—Å–ø—ã—Ç–∞–Ω–∏–µ —Å —Ç—Ä–µ–º—è –ø–æ–ø—ã—Ç–∫–∞–º–∏
- –ú–æ–º–µ–Ω—Ç –æ–∑–∞—Ä–µ–Ω–∏—è

## –ù–∞—É—á–Ω–æ–µ –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ (–º–∏–Ω–∏–º—É–º 2000 —Å–ª–æ–≤)
- –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç (–∫—Ç–æ, –∫–æ–≥–¥–∞, –ø–æ—á–µ–º—É)
- –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ —Å –î–û–ö–ê–ó–ê–¢–ï–õ–¨–°–¢–í–ê–ú–ò
- ASCII-–¥–∏–∞–≥—Ä–∞–º–º—ã (–º–∏–Ω–∏–º—É–º 3 —à—Ç—É–∫–∏)
- –°–≤—è–∑—å —Å V = n √ó 3^k √ó œÄ^m √ó œÜ^p
- –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è

## –ö–æ–¥ –Ω–∞ –Ø–∑—ã–∫–µ 999 (–º–∏–Ω–∏–º—É–º 50 —Å—Ç—Ä–æ–∫)
```999
‚≤ô‚≤ü‚≤á‚≤©‚≤ó‚≤â –∏–º—è;
‚≤ï‚≤ü‚≤õ‚≤•‚≤ß, ‚≤É‚≤Å‚≤£, ‚≤´‚≤©‚≤õ‚≤ï, ‚≤ì‚≤´, ‚≤â‚≤ó‚≤•‚≤â, ‚≤±‚≤è‚≤ì‚≤ó‚≤â, ‚≤´‚≤ü‚≤£, ‚≤£‚≤â‚≤ß‚≤©‚≤£‚≤õ
```

## –¢—Ä–∏ –ò—Å–ø—ã—Ç–∞–Ω–∏—è
‚ö™ –ü–†–û–°–¢–û–ï (—Å —Ä–µ—à–µ–Ω–∏–µ–º)
‚ö´ –°–†–ï–î–ù–ï–ï (—Å –ø–æ–¥—Å–∫–∞–∑–∫–æ–π)  
üî¥ –°–õ–û–ñ–ù–û–ï (–∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ)

## –ú—É–¥—Ä–æ—Å—Ç—å –î—Ä–µ–≤–Ω–∏—Ö
–§–∏–ª–æ—Å–æ—Ñ—Å–∫–æ–µ –∑–∞–∫–ª—é—á–µ–Ω–∏–µ

–ü–ò–®–ò –ú–ê–ö–°–ò–ú–ê–õ–¨–ù–û –†–ê–ó–í–Å–†–ù–£–¢–û! –ú–∏–Ω–∏–º—É–º 5000 —Å–ª–æ–≤!"""


def coords(n): return (n-1)//333+1, (n-1)//37+1, (n-1)%37+1
def sacred(n):
    k=0
    while n%3==0 and n>0: n//=3; k+=1
    return n,k


def call_deepseek(prompt: str) -> str:
    headers = {
        "Authorization": f"Bearer {DEEPSEEK_API_KEY}",
        "Content-Type": "application/json"
    }
    data = {
        "model": "deepseek-chat",
        "messages": [
            {"role": "system", "content": SYSTEM_PROMPT},
            {"role": "user", "content": prompt}
        ],
        "max_tokens": 4096,
        "temperature": 0.85
    }
    try:
        req = urllib.request.Request(DEEPSEEK_URL, 
            data=json.dumps(data).encode('utf-8'),
            headers=headers, method='POST')
        with urllib.request.urlopen(req, timeout=120) as resp:
            return json.loads(resp.read())["choices"][0]["message"]["content"]
    except Exception as e:
        return None


def generate_chapter(num: int) -> Tuple[int, str, int]:
    """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ–¥–Ω—É –≥–ª–∞–≤—É, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç (–Ω–æ–º–µ—Ä, –∫–æ–Ω—Ç–µ–Ω—Ç, —Ä–∞–∑–º–µ—Ä)"""
    —Ç–æ–º, –∫–Ω–∏–≥–∞, –≥–ª–∞–≤–∞ = coords(num)
    n, k = sacred(num)
    —Ü–∞—Ä—Å—Ç–≤–æ = ["–ú–µ–¥–Ω–æ–µ", "–°–µ—Ä–µ–±—Ä—è–Ω–æ–µ", "–ó–æ–ª–æ—Ç–æ–µ"][—Ç–æ–º-1]
    –¥ = –ö–ù–ò–ì–ò.get(–∫–Ω–∏–≥–∞, –ö–ù–ò–ì–ò[1])
    
    prompt = f"""–ù–∞–ø–∏—à–∏ –ü–û–õ–ù–£–Æ –≥–ª–∞–≤—É {num} –∫–Ω–∏–≥–∏ "999" (–º–∏–Ω–∏–º—É–º 5000 —Å–ª–æ–≤).

–¢–æ–º {—Ç–æ–º}: {—Ü–∞—Ä—Å—Ç–≤–æ} –¶–∞—Ä—Å—Ç–≤–æ | –ö–Ω–∏–≥–∞ {–∫–Ω–∏–≥–∞}: {–¥['–Ω–∞–∑–≤–∞–Ω–∏–µ']} | –ì–ª–∞–≤–∞ {–≥–ª–∞–≤–∞}/37
–°–≤—è—â–µ–Ω–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∞: V = {n} √ó 3^{k} = {num}

–¢–ï–ú–ê: {–¥['—Ç–µ–º–∞']}
–ö–û–ù–¢–ï–ö–°–¢: {–¥['–∫–æ–Ω—Ç–µ–∫—Å—Ç']}

–ò—Å–ø–æ–ª—å–∑—É–π –í–°–Æ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏–∑ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞. ASCII-–¥–∏–∞–≥—Ä–∞–º–º—ã –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã!"""

    content = call_deepseek(prompt)
    if content:
        full = f"""# –ì–ª–∞–≤–∞ {num}: {–¥['–Ω–∞–∑–≤–∞–Ω–∏–µ']}

> **–¢–æ–º {—Ç–æ–º}: {—Ü–∞—Ä—Å—Ç–≤–æ} –¶–∞—Ä—Å—Ç–≤–æ** | **–ö–Ω–∏–≥–∞ {–∫–Ω–∏–≥–∞}** | **–ì–ª–∞–≤–∞ {–≥–ª–∞–≤–∞}/37**
> **V = {n} √ó 3^{k} = {num}**

---

{content}

---
*–ì–ª–∞–≤–∞ {num}/999*
"""
        return (num, full, len(full))
    return (num, None, 0)


def save_chapter(num: int, content: str):
    """–°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≥–ª–∞–≤—É –≤ —Ñ–∞–π–ª"""
    —Ç–æ–º, –∫–Ω–∏–≥–∞, _ = coords(num)
    —Ç–æ–º–∞ = ["‚≤ß‚≤ü‚≤ô_1_‚≤ô‚≤â‚≤á‚≤õ‚≤ü‚≤â", "‚≤ß‚≤ü‚≤ô_2_‚≤•‚≤â‚≤£‚≤â‚≤É‚≤£‚≤ü", "‚≤ß‚≤ü‚≤ô_3_‚≤ç‚≤ü‚≤ó‚≤ü‚≤ß‚≤ü"]
    path = f"{OUTPUT_DIR}/{—Ç–æ–º–∞[—Ç–æ–º-1]}/‚≤ï‚≤õ‚≤ì‚≤Ö‚≤Å_{–∫–Ω–∏–≥–∞:02d}"
    os.makedirs(path, exist_ok=True)
    with open(f"{path}/‚≤Ö‚≤ó‚≤Å‚≤É‚≤Å_{num:03d}.md", 'w') as f:
        f.write(content)


def main():
    print("="*60)
    print("  –ü–ê–†–ê–õ–õ–ï–õ–¨–ù–´–ô –£–õ–¨–¢–†–ê-–ì–ï–ù–ï–†–ê–¢–û–† –ö–ù–ò–ì–ò 999")
    print(f"  {MAX_WORKERS} –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤")
    print("="*60)
    
    os.makedirs(OUTPUT_DIR, exist_ok=True)
    
    start_time = time.time()
    —É—Å–ø–µ—à–Ω–æ = 0
    –æ—à–∏–±–∫–∏ = 0
    total_size = 0
    
    # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –≥–ª–∞–≤—ã –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
    with ThreadPoolExecutor(max_workers=MAX_WORKERS) as executor:
        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤—Å–µ –∑–∞–¥–∞—á–∏
        futures = {executor.submit(generate_chapter, num): num for num in range(1, 1000)}
        
        # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ –º–µ—Ä–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
        for future in as_completed(futures):
            num, content, size = future.result()
            
            if content:
                save_chapter(num, content)
                —É—Å–ø–µ—à–Ω–æ += 1
                total_size += size
                print(f"‚úì –ì–ª–∞–≤–∞ {num}: {size//1000}KB")
            else:
                –æ—à–∏–±–∫–∏ += 1
                print(f"‚úó –ì–ª–∞–≤–∞ {num}: –æ—à–∏–±–∫–∞")
            
            if (—É—Å–ø–µ—à–Ω–æ + –æ—à–∏–±–∫–∏) % 50 == 0:
                elapsed = time.time() - start_time
                speed = (—É—Å–ø–µ—à–Ω–æ + –æ—à–∏–±–∫–∏) / elapsed * 60
                print(f"   [{—É—Å–ø–µ—à–Ω–æ} —É—Å–ø–µ—à–Ω–æ, {–æ—à–∏–±–∫–∏} –æ—à–∏–±–æ–∫, {speed:.1f} –≥–ª–∞–≤/–º–∏–Ω]")
    
    elapsed = time.time() - start_time
    print(f"\n{'='*60}")
    print(f"‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ –∑–∞ {elapsed/60:.1f} –º–∏–Ω—É—Ç")
    print(f"   –£—Å–ø–µ—à–Ω–æ: {—É—Å–ø–µ—à–Ω–æ}, –û—à–∏–±–∫–∏: {–æ—à–∏–±–∫–∏}")
    print(f"   –û–±—â–∏–π —Ä–∞–∑–º–µ—Ä: {total_size//1024//1024} MB")
    print(f"   –°–∫–æ—Ä–æ—Å—Ç—å: {999/elapsed*60:.1f} –≥–ª–∞–≤/–º–∏–Ω")


if __name__ == "__main__":
    main()
