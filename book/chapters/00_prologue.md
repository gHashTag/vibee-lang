# Пролог: Сказка о Числе Три

---

*В тридевятом царстве, в тридесятом государстве жил-был программист. И было у него три задачи: сортировать данные, искать в них смысл, и хранить их мудро.*

*Долго ли, коротко ли, но понял он, что все три задачи связаны одним числом — числом Три.*

---

## Загадка Тридевятого Царства

Каждый русский ребёнок знает эти слова:

> «В тридевятом царстве, в тридесятом государстве...»

Но задумывались ли вы, почему именно **тридевятое**?

```
Тридевятое = 3 × 9 = 27 = 3³
```

Это не случайное число. Это **куб тройки** — максимальная «тройственность», которую можно выразить одним словом.

И вот что удивительно: когда я искал оптимальный порог для алгоритма сортировки, я получил... **27**.

Древние знали.

---

## Три Дороги

В каждой сказке герой встречает камень на распутье:

> *«Направо пойдёшь — коня потеряешь,*
> *Налево пойдёшь — себя потеряешь,*
> *Прямо пойдёшь — счастье найдёшь.»*

Три дороги. Три выбора. Три судьбы.

В алгоритмах это называется **3-way partition**:

```
┌─────────────────────────────────────────────────────────┐
│                                                         │
│   НАПРАВО (>)     ПРЯМО (=)      НАЛЕВО (<)            │
│   ───────────     ─────────      ──────────            │
│   Больше pivot    Равно pivot    Меньше pivot          │
│                                                         │
│   Продолжай       СТОП!          Продолжай             │
│   искать          Нашёл!         искать                │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

Средняя дорога — дорога равенства — **сокращает путь**. Элементы, равные pivot, не нужно сортировать дальше. Они уже на своём месте.

Это даёт ускорение до **291 раз** на данных с повторами.

Древние знали.

---

## Три Богатыря

Илья Муромец, Добрыня Никитич, Алёша Попович.

Сила, мудрость, хитрость.

Три богатыря вместе сильнее, чем каждый по отдельности. Они **дополняют** друг друга.

В алгоритмах это называется **Cuckoo Hashing с тремя таблицами**:

```
┌─────────────────────────────────────────────────────────┐
│                                                         │
│   ИЛЬЯ (h₁)       ДОБРЫНЯ (h₂)    АЛЁША (h₃)           │
│   ─────────       ───────────     ──────────           │
│   Первая          Вторая          Третья               │
│   хеш-функция     хеш-функция     хеш-функция          │
│                                                         │
│   Если занято     Если занято     Если занято          │
│   → к Добрыне     → к Алёше       → к Илье             │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

Две хеш-функции дают 50% заполнения.
Три хеш-функции дают **91% заполнения**.

Прирост: **82%**.

Древние знали.

---

## Три Попытки

В сказках герой всегда получает три попытки:

- **Первая** — неудача (обучение)
- **Вторая** — почти успех (опыт)
- **Третья** — победа (мастерство)

В алгоритмах на графах это **три состояния вершины**:

```
┌─────────────────────────────────────────────────────────┐
│                                                         │
│   БЕЛЫЙ           СЕРЫЙ           ЧЁРНЫЙ               │
│   ──────          ─────           ──────               │
│   Не посещён      В процессе      Завершён             │
│                                                         │
│   Первая          Вторая          Третья               │
│   попытка         попытка         попытка              │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

Два состояния (посещён/не посещён) не позволяют найти циклы.
Три состояния — позволяют.

Древние знали.

---

## Три Сына

В каждой сказке у царя три сына:

- **Старший** — сильный, но глупый
- **Средний** — хитрый, но трусливый
- **Младший** (Иван-дурак) — мудрый сердцем

И всегда побеждает **третий**.

Почему? Потому что третий — **особенный**. Он не следует очевидным путям. Он находит **неожиданное решение**.

В алгоритмах третье состояние — **равенство** — часто игнорируется:

```
Стандартный quicksort:
  if a[i] < pivot: влево
  else: вправо           ← Равные идут ВПРАВО!

Trinity Sort:
  if a[i] < pivot: влево
  if a[i] > pivot: вправо
  if a[i] = pivot: СТОП!  ← Равные ОСТАЮТСЯ!
```

«Иван-дурак» (равенство) оказывается ключом к победе.

Древние знали.

---

## Три Мира

Во всех мифологиях мир делится на три:

- **Небо** (Правь) — мир богов, идей, теории
- **Земля** (Явь) — мир людей, практики, алгоритмов
- **Подземье** (Навь) — мир предков, глубин, реализации

Эта книга следует той же структуре:

```
┌─────────────────────────────────────────────────────────┐
│                                                         │
│   ЧАСТЬ I: НЕБО (Теория)                               │
│   ──────────────────────                               │
│   Почему число 3? Физика и математика.                 │
│                                                         │
│   ЧАСТЬ II: ЗЕМЛЯ (Алгоритмы)                          │
│   ───────────────────────────                          │
│   Trinity Sort, Hash, Graph, Neural.                   │
│                                                         │
│   ЧАСТЬ III: ПОДЗЕМЬЕ (Практика)                       │
│   ──────────────────────────────                       │
│   Бенчмарки, код, реализация.                          │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

---

## Главная Тайна

Почему все культуры мира независимо пришли к троичности?

- Христианство: Троица
- Индуизм: Тримурти
- Буддизм: Три драгоценности
- Даосизм: Небо-Человек-Земля
- Славяне: Правь-Явь-Навь
- Греки: Три мойры
- Скандинавы: Три норны

**Ответ**: Потому что **3 — минимальное число для сложной структуры**.

```
2 — слишком просто (да/нет, 0/1)
3 — появляется СТРУКТУРА
4+ — избыточно
```

Математически:

```
Оптимальный branching factor = e ≈ 2.718

Ближайшее целое = 3
```

Это не магия. Это **математика**.

Но древние знали это **интуитивно**, без формул и доказательств.

---

## Приглашение в Путешествие

Эта книга — путешествие в Тридевятое царство.

Я пройду три дороги алгоритмов.
Я встречу трёх богатырей структур данных.
Я получу три попытки понять глубину.
И я вернусь с мудростью, которую древние знали всегда.

> *«Сказка — ложь, да в ней намёк,*
> *добрым молодцам урок.»*
> — А.С. Пушкин

---

*Итак, в путь!*

*В тридевятое царство алгоритмов, в тридесятое государство данных...*

---

[Далее: Глава 1 — Число Три →](01_number_three.md)
