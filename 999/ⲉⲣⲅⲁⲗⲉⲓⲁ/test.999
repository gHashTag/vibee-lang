// ============================================
// 999TEST - –¢–ï–°–¢–û–í–´–ô –§–†–ï–ô–ú–í–û–†–ö
// ============================================
//
// –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:
//   - Unit —Ç–µ—Å—Ç—ã
//   - Property-based —Ç–µ—Å—Ç—ã
//   - Snapshot —Ç–µ—Å—Ç—ã
//   - –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
//   - Coverage –æ—Ç—á—ë—Ç—ã
//   - Mocking
//
// ============================================

‚≤® arifmetika

// ============================================
// –°–¢–†–£–ö–¢–£–†–´ –¢–ï–°–¢–û–í
// ============================================

‚≤à ‚≤¶‚≤â‚≤•‚≤ß‚≤¢‚≤â‚≤•‚≤©‚≤ó‚≤ß:
  PASSED
  FAILED
  SKIPPED
  TIMEOUT

‚≤é ‚≤¶‚≤â‚≤•‚≤ß‚≤î‚≤Å‚≤•‚≤â:
  –∏–º—è: ‚≤§
  –º–æ–¥—É–ª—å: ‚≤§
  —Ñ—É–Ω–∫—Ü–∏—è: ‚≤™() -> ‚≤Ç
  timeout: ‚≤ä?
  —Ç–µ–≥–∏: [‚≤§]
  skip: ‚≤Ç
  skip_–ø—Ä–∏—á–∏–Ω–∞: ‚≤§?

‚≤é ‚≤¶‚≤â‚≤•‚≤ß‚≤¢‚≤â‚≤•‚≤©‚≤ó‚≤ß‚≤é‚≤õ‚≤´‚≤ü:
  —Ç–µ—Å—Ç: ‚≤¶‚≤â‚≤•‚≤ß‚≤î‚≤Å‚≤•‚≤â
  —Ä–µ–∑—É–ª—å—Ç–∞—Ç: ‚≤à ‚≤¶‚≤â‚≤•‚≤ß‚≤¢‚≤â‚≤•‚≤©‚≤ó‚≤ß
  –≤—Ä–µ–º—è: ‚≤ä  // –º—Å
  –æ—à–∏–±–∫–∞: ‚≤§?
  —Å—Ç–µ–∫: ‚≤§?

‚≤é ‚≤¶‚≤â‚≤•‚≤ß‚≤§‚≤©‚≤ì‚≤ß‚≤â:
  –∏–º—è: ‚≤§
  —Ç–µ—Å—Ç—ã: [‚≤¶‚≤â‚≤•‚≤ß‚≤î‚≤Å‚≤•‚≤â]
  before_all: ‚≤™()?
  after_all: ‚≤™()?
  before_each: ‚≤™()?
  after_each: ‚≤™()?

‚≤é ‚≤¶‚≤â‚≤•‚≤ß‚≤¢‚≤©‚≤õ‚≤õ‚≤â‚≤£:
  suites: [‚≤¶‚≤â‚≤•‚≤ß‚≤§‚≤©‚≤ì‚≤ß‚≤â]
  —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã: [‚≤¶‚≤â‚≤•‚≤ß‚≤¢‚≤â‚≤•‚≤©‚≤ó‚≤ß‚≤é‚≤õ‚≤´‚≤ü]
  –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç—å: ‚≤ä
  —Ñ–∏–ª—å—Ç—Ä: ‚≤§?
  verbose: ‚≤Ç

// ============================================
// ASSERTIONS
// ============================================

/// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–≤–µ–Ω—Å—Ç–≤–æ
‚≤™ assert_eq(—Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ: ‚≤Ä, –æ–∂–∏–¥–∞–µ–º–æ–µ: ‚≤Ä, —Å–æ–æ–±—â–µ–Ω–∏–µ: ‚≤§?):
  ‚≤ú —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ != –æ–∂–∏–¥–∞–µ–º–æ–µ:
    ‚≤ò msg = —Å–æ–æ–±—â–µ–Ω–∏–µ ? —Å–æ–æ–±—â–µ–Ω–∏–µ : "Assertion failed"
    msg += "\n  –û–∂–∏–¥–∞–ª–æ—Å—å: " + —Å—Ç—Ä–æ–∫–∞(–æ–∂–∏–¥–∞–µ–º–æ–µ)
    msg += "\n  –ü–æ–ª—É—á–µ–Ω–æ:  " + —Å—Ç—Ä–æ–∫–∞(—Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ)
    –ø–∞–Ω–∏–∫–∞(msg)

/// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–µ—Ä–∞–≤–µ–Ω—Å—Ç–≤–æ
‚≤™ assert_ne(—Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ: ‚≤Ä, –Ω–µ–æ–∂–∏–¥–∞–µ–º–æ–µ: ‚≤Ä, —Å–æ–æ–±—â–µ–Ω–∏–µ: ‚≤§?):
  ‚≤ú —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ == –Ω–µ–æ–∂–∏–¥–∞–µ–º–æ–µ:
    ‚≤ò msg = —Å–æ–æ–±—â–µ–Ω–∏–µ ? —Å–æ–æ–±—â–µ–Ω–∏–µ : "Values should not be equal"
    msg += "\n  –ó–Ω–∞—á–µ–Ω–∏–µ: " + —Å—Ç—Ä–æ–∫–∞(—Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ)
    –ø–∞–Ω–∏–∫–∞(msg)

/// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å—Ç–∏–Ω–Ω–æ—Å—Ç—å
‚≤™ assert_true(—É—Å–ª–æ–≤–∏–µ: ‚≤Ç, —Å–æ–æ–±—â–µ–Ω–∏–µ: ‚≤§?):
  ‚≤ú !—É—Å–ª–æ–≤–∏–µ:
    –ø–∞–Ω–∏–∫–∞(—Å–æ–æ–±—â–µ–Ω–∏–µ ? —Å–æ–æ–±—â–µ–Ω–∏–µ : "Expected true, got false")

/// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–∂–Ω–æ—Å—Ç—å
‚≤™ assert_false(—É—Å–ª–æ–≤–∏–µ: ‚≤Ç, —Å–æ–æ–±—â–µ–Ω–∏–µ: ‚≤§?):
  ‚≤ú —É—Å–ª–æ–≤–∏–µ:
    –ø–∞–Ω–∏–∫–∞(—Å–æ–æ–±—â–µ–Ω–∏–µ ? —Å–æ–æ–±—â–µ–Ω–∏–µ : "Expected false, got true")

/// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å None
‚≤™ assert_none(–∑–Ω–∞—á–µ–Ω–∏–µ: ‚≤Ä?, —Å–æ–æ–±—â–µ–Ω–∏–µ: ‚≤§?):
  ‚≤ú –∑–Ω–∞—á–µ–Ω–∏–µ != None:
    –ø–∞–Ω–∏–∫–∞(—Å–æ–æ–±—â–µ–Ω–∏–µ ? —Å–æ–æ–±—â–µ–Ω–∏–µ : "Expected None, got " + —Å—Ç—Ä–æ–∫–∞(–∑–Ω–∞—á–µ–Ω–∏–µ))

/// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–µ None
‚≤™ assert_some(–∑–Ω–∞—á–µ–Ω–∏–µ: ‚≤Ä?, —Å–æ–æ–±—â–µ–Ω–∏–µ: ‚≤§?):
  ‚≤ú –∑–Ω–∞—á–µ–Ω–∏–µ == None:
    –ø–∞–Ω–∏–∫–∞(—Å–æ–æ–±—â–µ–Ω–∏–µ ? —Å–æ–æ–±—â–µ–Ω–∏–µ : "Expected Some, got None")

/// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω–æ–µ —Ä–∞–≤–µ–Ω—Å—Ç–≤–æ
‚≤™ assert_approx(—Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ: ‚≤ä, –æ–∂–∏–¥–∞–µ–º–æ–µ: ‚≤ä, epsilon: ‚≤ä):
  ‚≤ú –∞–±—Å(—Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ - –æ–∂–∏–¥–∞–µ–º–æ–µ) > epsilon:
    –ø–∞–Ω–∏–∫–∞("Values not approximately equal: " + —Å—Ç—Ä–æ–∫–∞(—Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ) + " vs " + —Å—Ç—Ä–æ–∫–∞(–æ–∂–∏–¥–∞–µ–º–æ–µ))

/// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –∏—Å–∫–ª—é—á–µ–Ω–∏–µ
‚≤™ assert_throws(—Ñ—É–Ω–∫—Ü–∏—è: ‚≤™(), —Ç–∏–ø_–æ—à–∏–±–∫–∏: ‚≤§?):
  ‚≤ò –≤—ã–±—Ä–æ—à–µ–Ω–æ = ‚≤Ç
  –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å:
    —Ñ—É–Ω–∫—Ü–∏—è()
  –ø–æ–π–º–∞—Ç—å –æ—à–∏–±–∫–∞:
    –≤—ã–±—Ä–æ—à–µ–Ω–æ = ‚≤Ä
    ‚≤ú —Ç–∏–ø_–æ—à–∏–±–∫–∏ != None && —Ç–∏–ø(–æ—à–∏–±–∫–∞) != —Ç–∏–ø_–æ—à–∏–±–∫–∏:
      –ø–∞–Ω–∏–∫–∞("Wrong exception type: expected " + —Ç–∏–ø_–æ—à–∏–±–∫–∏ + ", got " + —Ç–∏–ø(–æ—à–∏–±–∫–∞))
  
  ‚≤ú !–≤—ã–±—Ä–æ—à–µ–Ω–æ:
    –ø–∞–Ω–∏–∫–∞("Expected exception but none was thrown")

/// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ
‚≤™ assert_contains(–∫–æ–ª–ª–µ–∫—Ü–∏—è: [‚≤Ä], —ç–ª–µ–º–µ–Ω—Ç: ‚≤Ä):
  ‚≤ú —ç–ª–µ–º–µ–Ω—Ç –Ω–µ_–≤ –∫–æ–ª–ª–µ–∫—Ü–∏—è:
    –ø–∞–Ω–∏–∫–∞("Collection does not contain " + —Å—Ç—Ä–æ–∫–∞(—ç–ª–µ–º–µ–Ω—Ç))

// ============================================
// PROPERTY-BASED TESTING
// ============================================

// –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å–ª—É—á–∞–π–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
‚≤é ‚≤¶‚≤â‚≤•‚≤ß‚≤Ñ‚≤â‚≤õ:
  seed: ‚≤ä
  
‚≤™ gen_int(gen: ‚≤¶‚≤â‚≤•‚≤ß‚≤Ñ‚≤â‚≤õ, –º–∏–Ω: ‚≤ä, –º–∞–∫—Å: ‚≤ä) -> ‚≤ä:
  gen.seed = (gen.seed * 1103515245 + 12345) % 2147483648
  ‚≤¢ –º–∏–Ω + (gen.seed % (–º–∞–∫—Å - –º–∏–Ω + 1))

‚≤™ gen_string(gen: ‚≤¶‚≤â‚≤•‚≤ß‚≤Ñ‚≤â‚≤õ, –¥–ª–∏–Ω–∞: ‚≤ä) -> ‚≤§:
  ‚≤ò —Ä–µ–∑—É–ª—å—Ç–∞—Ç = ""
  ‚≤Æ i 0..–¥–ª–∏–Ω–∞:
    ‚≤ò –∫–æ–¥ = gen_int(gen, 97, 122)  // a-z
    —Ä–µ–∑—É–ª—å—Ç–∞—Ç += —Å–∏–º–≤–æ–ª(–∫–æ–¥)
  ‚≤¢ —Ä–µ–∑—É–ª—å—Ç–∞—Ç

‚≤™ gen_list(gen: ‚≤¶‚≤â‚≤•‚≤ß‚≤Ñ‚≤â‚≤õ, —Ä–∞–∑–º–µ—Ä: ‚≤ä, gen_—ç–ª–µ–º–µ–Ω—Ç: ‚≤™(‚≤¶‚≤â‚≤•‚≤ß‚≤Ñ‚≤â‚≤õ) -> ‚≤Ä) -> [‚≤Ä]:
  ‚≤ò —Ä–µ–∑—É–ª—å—Ç–∞—Ç: [‚≤Ä] = []
  ‚≤Æ i 0..—Ä–∞–∑–º–µ—Ä:
    —Ä–µ–∑—É–ª—å—Ç–∞—Ç += gen_—ç–ª–µ–º–µ–Ω—Ç(gen)
  ‚≤¢ —Ä–µ–∑—É–ª—å—Ç–∞—Ç

// Property-based —Ç–µ—Å—Ç
‚≤™ property_test(–∏–º—è: ‚≤§, –∏—Ç–µ—Ä–∞—Ü–∏–π: ‚≤ä, —Å–≤–æ–π—Å—Ç–≤–æ: ‚≤™(‚≤¶‚≤â‚≤•‚≤ß‚≤Ñ‚≤â‚≤õ) -> ‚≤Ç):
  ‚≤ò gen = ‚≤¶‚≤â‚≤•‚≤ß‚≤Ñ‚≤â‚≤õ { seed: 42 }
  
  ‚≤Æ i 0..–∏—Ç–µ—Ä–∞—Ü–∏–π:
    –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å:
      ‚≤ú !—Å–≤–æ–π—Å—Ç–≤–æ(gen):
        –ø–∞–Ω–∏–∫–∞("Property '" + –∏–º—è + "' failed on iteration " + —Å—Ç—Ä–æ–∫–∞(i))
    –ø–æ–π–º–∞—Ç—å –æ—à–∏–±–∫–∞:
      –ø–∞–Ω–∏–∫–∞("Property '" + –∏–º—è + "' threw exception on iteration " + —Å—Ç—Ä–æ–∫–∞(i) + ": " + —Å—Ç—Ä–æ–∫–∞(–æ—à–∏–±–∫–∞))

// ============================================
// SNAPSHOT TESTING
// ============================================

‚≤é ‚≤¶‚≤â‚≤•‚≤ß‚≤§‚≤õ‚≤Å‚≤°‚≤•‚≤è‚≤ü‚≤ß:
  –ø—É—Ç—å: ‚≤§
  –¥–∞–Ω–Ω—ã–µ: {‚≤§: ‚≤§}

‚≤™ assert_snapshot(–∏–º—è: ‚≤§, –∑–Ω–∞—á–µ–Ω–∏–µ: ‚≤§):
  ‚≤ò –ø—É—Ç—å_snapshot = "__snapshots__/" + —Ç–µ–∫—É—â–∏–π_—Ç–µ—Å—Ç() + ".snap"
  ‚≤ò snapshot = –∑–∞–≥—Ä—É–∑–∏—Ç—å_snapshot(–ø—É—Ç—å_snapshot)
  
  ‚≤ú snapshot.–¥–∞–Ω–Ω—ã–µ[–∏–º—è] == None:
    // –ù–æ–≤—ã–π snapshot
    snapshot.–¥–∞–Ω–Ω—ã–µ[–∏–º—è] = –∑–Ω–∞—á–µ–Ω–∏–µ
    —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å_snapshot(snapshot)
    –ø–µ—á–∞—Ç—å("  üì∏ –°–æ–∑–¥–∞–Ω snapshot: " + –∏–º—è)
  ‚≤Ç:
    // –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º
    ‚≤ú snapshot.–¥–∞–Ω–Ω—ã–µ[–∏–º—è] != –∑–Ω–∞—á–µ–Ω–∏–µ:
      –ø–µ—á–∞—Ç—å("  ‚ùå Snapshot mismatch: " + –∏–º—è)
      –ø–µ—á–∞—Ç—å("  –û–∂–∏–¥–∞–ª–æ—Å—å:\n" + snapshot.–¥–∞–Ω–Ω—ã–µ[–∏–º—è])
      –ø–µ—á–∞—Ç—å("  –ü–æ–ª—É—á–µ–Ω–æ:\n" + –∑–Ω–∞—á–µ–Ω–∏–µ)
      –ø–∞–Ω–∏–∫–∞("Snapshot mismatch")

// ============================================
// MOCKING
// ============================================

‚≤é ‚≤¶‚≤â‚≤•‚≤ß‚≤ò‚≤ü‚≤•‚≤ï:
  –≤—ã–∑–æ–≤—ã: [(‚≤§, [‚≤Ä])]
  –≤–æ–∑–≤—Ä–∞—Ç—ã: {‚≤§: [‚≤Ä]}

‚≤™ —Å–æ–∑–¥–∞—Ç—å_mock() -> ‚≤¶‚≤â‚≤•‚≤ß‚≤ò‚≤ü‚≤•‚≤ï:
  ‚≤¢ ‚≤¶‚≤â‚≤•‚≤ß‚≤ò‚≤ü‚≤•‚≤ï { –≤—ã–∑–æ–≤—ã: [], –≤–æ–∑–≤—Ä–∞—Ç—ã: {} }

‚≤™ mock_when(mock: ‚≤¶‚≤â‚≤•‚≤ß‚≤ò‚≤ü‚≤•‚≤ï, –º–µ—Ç–æ–¥: ‚≤§, –≤–æ–∑–≤—Ä–∞—Ç: ‚≤Ä):
  ‚≤ú mock.–≤–æ–∑–≤—Ä–∞—Ç—ã[–º–µ—Ç–æ–¥] == None:
    mock.–≤–æ–∑–≤—Ä–∞—Ç—ã[–º–µ—Ç–æ–¥] = []
  mock.–≤–æ–∑–≤—Ä–∞—Ç—ã[–º–µ—Ç–æ–¥] += –≤–æ–∑–≤—Ä–∞—Ç

‚≤™ mock_call(mock: ‚≤¶‚≤â‚≤•‚≤ß‚≤ò‚≤ü‚≤•‚≤ï, –º–µ—Ç–æ–¥: ‚≤§, –∞—Ä–≥—É–º–µ–Ω—Ç—ã: [‚≤Ä]) -> ‚≤Ä:
  mock.–≤—ã–∑–æ–≤—ã += [(–º–µ—Ç–æ–¥, –∞—Ä–≥—É–º–µ–Ω—Ç—ã)]
  ‚≤ú mock.–≤–æ–∑–≤—Ä–∞—Ç—ã[–º–µ—Ç–æ–¥] != None && –¥–ª–∏–Ω–∞(mock.–≤–æ–∑–≤—Ä–∞—Ç—ã[–º–µ—Ç–æ–¥]) > 0:
    ‚≤¢ mock.–≤–æ–∑–≤—Ä–∞—Ç—ã[–º–µ—Ç–æ–¥].pop_front()
  ‚≤¢ None

‚≤™ mock_verify(mock: ‚≤¶‚≤â‚≤•‚≤ß‚≤ò‚≤ü‚≤•‚≤ï, –º–µ—Ç–æ–¥: ‚≤§, —Ä–∞–∑: ‚≤ä):
  ‚≤ò —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ = mock.–≤—ã–∑–æ–≤—ã.filter((–º, _) -> –º == –º–µ—Ç–æ–¥).length()
  assert_eq(—Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏, —Ä–∞–∑, "Method '" + –º–µ—Ç–æ–¥ + "' called wrong number of times")

// ============================================
// RUNNER
// ============================================

‚≤™ —Å–æ–∑–¥–∞—Ç—å_runner() -> ‚≤¶‚≤â‚≤•‚≤ß‚≤¢‚≤©‚≤õ‚≤õ‚≤â‚≤£:
  ‚≤¢ ‚≤¶‚≤â‚≤•‚≤ß‚≤¢‚≤©‚≤õ‚≤õ‚≤â‚≤£ {
    suites: [],
    —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã: [],
    –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç—å: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ_—è–¥–µ—Ä(),
    —Ñ–∏–ª—å—Ç—Ä: None,
    verbose: ‚≤Ç
  }

‚≤™ –∑–∞–ø—É—Å—Ç–∏—Ç—å_—Ç–µ—Å—Ç—ã(runner: ‚≤¶‚≤â‚≤•‚≤ß‚≤¢‚≤©‚≤õ‚≤õ‚≤â‚≤£) -> ‚≤Ç:
  ‚≤ò –≤—Å–µ–≥–æ = 0
  ‚≤ò –ø—Ä–æ—à–ª–æ = 0
  ‚≤ò –ø—Ä–æ–≤–∞–ª–µ–Ω–æ = 0
  ‚≤ò –ø—Ä–æ–ø—É—â–µ–Ω–æ = 0
  
  ‚≤ò –Ω–∞—á–∞–ª–æ = –≤—Ä–µ–º—è_–º—Å()
  
  ‚≤Æ suite runner.suites:
    –ø–µ—á–∞—Ç—å("\nüì¶ " + suite.–∏–º—è)
    
    // before_all
    ‚≤ú suite.before_all != None:
      suite.before_all()
    
    ‚≤Æ —Ç–µ—Å—Ç suite.—Ç–µ—Å—Ç—ã:
      –≤—Å–µ–≥–æ += 1
      
      // –§–∏–ª—å—Ç—Ä
      ‚≤ú runner.—Ñ–∏–ª—å—Ç—Ä != None && !—Ç–µ—Å—Ç.–∏–º—è.contains(runner.—Ñ–∏–ª—å—Ç—Ä):
        ‚≤û
      
      // Skip
      ‚≤ú —Ç–µ—Å—Ç.skip:
        –ø—Ä–æ–ø—É—â–µ–Ω–æ += 1
        –ø–µ—á–∞—Ç—å("  ‚è≠Ô∏è  " + —Ç–µ—Å—Ç.–∏–º—è + " (skipped: " + —Ç–µ—Å—Ç.skip_–ø—Ä–∏—á–∏–Ω–∞ + ")")
        ‚≤û
      
      // before_each
      ‚≤ú suite.before_each != None:
        suite.before_each()
      
      // –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞
      ‚≤ò —Ç–µ—Å—Ç_–Ω–∞—á–∞–ª–æ = –≤—Ä–µ–º—è_–º—Å()
      ‚≤ò —Ä–µ–∑—É–ª—å—Ç–∞—Ç = PASSED
      ‚≤ò –æ—à–∏–±–∫–∞: ‚≤§? = None
      
      –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å:
        ‚≤ú —Ç–µ—Å—Ç.timeout != None:
          —Å_—Ç–∞–π–º–∞—É—Ç–æ–º(—Ç–µ—Å—Ç.timeout, —Ç–µ—Å—Ç.—Ñ—É–Ω–∫—Ü–∏—è)
        ‚≤Ç:
          —Ç–µ—Å—Ç.—Ñ—É–Ω–∫—Ü–∏—è()
      –ø–æ–π–º–∞—Ç—å e:
        —Ä–µ–∑—É–ª—å—Ç–∞—Ç = FAILED
        –æ—à–∏–±–∫–∞ = —Å—Ç—Ä–æ–∫–∞(e)
      
      ‚≤ò —Ç–µ—Å—Ç_–≤—Ä–µ–º—è = –≤—Ä–µ–º—è_–º—Å() - —Ç–µ—Å—Ç_–Ω–∞—á–∞–ª–æ
      
      // after_each
      ‚≤ú suite.after_each != None:
        suite.after_each()
      
      // –†–µ–∑—É–ª—å—Ç–∞—Ç
      ‚≤ú —Ä–µ–∑—É–ª—å—Ç–∞—Ç == PASSED:
        –ø—Ä–æ—à–ª–æ += 1
        –ø–µ—á–∞—Ç—å("  ‚úÖ " + —Ç–µ—Å—Ç.–∏–º—è + " (" + —Å—Ç—Ä–æ–∫–∞(—Ç–µ—Å—Ç_–≤—Ä–µ–º—è) + "ms)")
      ‚≤Ç:
        –ø—Ä–æ–≤–∞–ª–µ–Ω–æ += 1
        –ø–µ—á–∞—Ç—å("  ‚ùå " + —Ç–µ—Å—Ç.–∏–º—è + " (" + —Å—Ç—Ä–æ–∫–∞(—Ç–µ—Å—Ç_–≤—Ä–µ–º—è) + "ms)")
        ‚≤ú runner.verbose && –æ—à–∏–±–∫–∞ != None:
          –ø–µ—á–∞—Ç—å("     " + –æ—à–∏–±–∫–∞)
      
      runner.—Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã += ‚≤¶‚≤â‚≤•‚≤ß‚≤¢‚≤â‚≤•‚≤©‚≤ó‚≤ß‚≤é‚≤õ‚≤´‚≤ü {
        —Ç–µ—Å—Ç: —Ç–µ—Å—Ç,
        —Ä–µ–∑—É–ª—å—Ç–∞—Ç: —Ä–µ–∑—É–ª—å—Ç–∞—Ç,
        –≤—Ä–µ–º—è: —Ç–µ—Å—Ç_–≤—Ä–µ–º—è,
        –æ—à–∏–±–∫–∞: –æ—à–∏–±–∫–∞,
        —Å—Ç–µ–∫: None
      }
    
    // after_all
    ‚≤ú suite.after_all != None:
      suite.after_all()
  
  ‚≤ò –æ–±—â–µ–µ_–≤—Ä–µ–º—è = –≤—Ä–µ–º—è_–º—Å() - –Ω–∞—á–∞–ª–æ
  
  // –ò—Ç–æ–≥–∏
  –ø–µ—á–∞—Ç—å("\n" + "‚ïê".repeat(50))
  –ø–µ—á–∞—Ç—å("–¢–µ—Å—Ç—ã: " + —Å—Ç—Ä–æ–∫–∞(–ø—Ä–æ—à–ª–æ) + " –ø—Ä–æ—à–ª–æ, " + —Å—Ç—Ä–æ–∫–∞(–ø—Ä–æ–≤–∞–ª–µ–Ω–æ) + " –ø—Ä–æ–≤–∞–ª–µ–Ω–æ, " + —Å—Ç—Ä–æ–∫–∞(–ø—Ä–æ–ø—É—â–µ–Ω–æ) + " –ø—Ä–æ–ø—É—â–µ–Ω–æ")
  –ø–µ—á–∞—Ç—å("–í—Ä–µ–º—è: " + —Å—Ç—Ä–æ–∫–∞(–æ–±—â–µ–µ_–≤—Ä–µ–º—è) + "ms")
  
  ‚≤¢ –ø—Ä–æ–≤–∞–ª–µ–Ω–æ == 0

// ============================================
// CLI
// ============================================

‚≤™ main(–∞—Ä–≥—É–º–µ–Ω—Ç—ã: [‚≤§]) -> ‚≤ä:
  ‚≤ò runner = —Å–æ–∑–¥–∞—Ç—å_runner()
  ‚≤ò –ø—É—Ç—å = "tests"
  
  // –ü–∞—Ä—Å–∏–Ω–≥ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤
  ‚≤Æ i 1..–¥–ª–∏–Ω–∞(–∞—Ä–≥—É–º–µ–Ω—Ç—ã):
    ‚≤ò –∞—Ä–≥ = –∞—Ä–≥—É–º–µ–Ω—Ç—ã[i]
    ‚≤ú –∞—Ä–≥ == "-v": runner.verbose = ‚≤Ä
    ‚≤ú –∞—Ä–≥ == "-f" && i + 1 < –¥–ª–∏–Ω–∞(–∞—Ä–≥—É–º–µ–Ω—Ç—ã):
      runner.—Ñ–∏–ª—å—Ç—Ä = –∞—Ä–≥—É–º–µ–Ω—Ç—ã[i + 1]
    ‚≤ú –∞—Ä–≥ == "-j" && i + 1 < –¥–ª–∏–Ω–∞(–∞—Ä–≥—É–º–µ–Ω—Ç—ã):
      runner.–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ—Å—Ç—å = —á–∏—Å–ª–æ(–∞—Ä–≥—É–º–µ–Ω—Ç—ã[i + 1])
    ‚≤ú !–∞—Ä–≥.starts_with("-"):
      –ø—É—Ç—å = –∞—Ä–≥
  
  –ø–µ—á–∞—Ç—å("üß™ 999test - –¢–µ—Å—Ç–æ–≤—ã–π —Ñ—Ä–µ–π–º–≤–æ—Ä–∫\n")
  
  // –ù–∞—Ö–æ–¥–∏–º —Ç–µ—Å—Ç—ã
  ‚≤ò —Ñ–∞–π–ª—ã = –Ω–∞–π—Ç–∏_—Ñ–∞–π–ª—ã(–ø—É—Ç—å, "*_test.999")
  ‚≤Æ —Ñ–∞–π–ª —Ñ–∞–π–ª—ã:
    ‚≤ò suite = –∑–∞–≥—Ä—É–∑–∏—Ç—å_suite(—Ñ–∞–π–ª)
    runner.suites += suite
  
  // –ó–∞–ø—É—Å–∫–∞–µ–º
  ‚≤ò —É—Å–ø–µ—Ö = –∑–∞–ø—É—Å—Ç–∏—Ç—å_—Ç–µ—Å—Ç—ã(runner)
  
  ‚≤¢ ‚≤ú —É—Å–ø–µ—Ö: 0 ‚≤Ç: 1
