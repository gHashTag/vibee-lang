# Глава 9: Уроки Пути — Что Работает, Что Нет

---

*«Умный учится на чужих ошибках,*
*дурак — на своих.»*
— Русская пословица

---

## Уроки Пути

Мы прошли долгий путь. Пора подвести итоги.

---

## ✅ Что Работает

### Принцип: 3-Way Partition

```
РАБОТАЕТ потому что:
  • Исключает равные элементы из рекурсии
  • Уменьшает глубину рекурсии
  • Защищает от worst-case

ПРИМЕНЕНИЯ:
  • Trinity Sort: до 291x быстрее
  • Dutch National Flag: классический алгоритм
  • Quickselect: поиск k-го элемента
```

### Принцип: Branching Factor = 3

```
РАБОТАЕТ потому что:
  • Минимизирует b/log(b)
  • Оптимум при b = e ≈ 2.718 ≈ 3

ПРИМЕНЕНИЯ:
  • Trinity B-Tree: 6% меньше сравнений
  • Ternary Search Tree: эффективный prefix search
```

### Принцип: 3 Хеш-Функции

```
РАБОТАЕТ потому что:
  • Максимальный прирост load factor
  • d=2→d=3: +82%
  • d=3→d=4: +7%

ПРИМЕНЕНИЯ:
  • Cuckoo Hashing: 91% заполнения
  • Bloom Filter: оптимальное k ≈ 3
```

### Принцип: 3 Состояния

```
РАБОТАЕТ потому что:
  • Позволяет отличить "в процессе" от "завершено"
  • Необходимо для поиска циклов

ПРИМЕНЕНИЯ:
  • DFS: WHITE/GRAY/BLACK
  • Топологическая сортировка
  • Сильно связные компоненты
```

---

## ❌ Что НЕ Работает

### Trinity Search

```
НЕ РАБОТАЕТ потому что:
  • 2-3 сравнения за итерацию
  • log₃(n) × 2 > log₂(n) × 1
  • Нет "равных элементов" для исключения

УРОК:
  3-way помогает когда есть что ИСКЛЮЧИТЬ
  В поиске нечего исключать
```

### Radix Base 3

```
НЕ РАБОТАЕТ потому что:
  • Radix не использует сравнения
  • Больше база = меньше проходов
  • Base 256 = 3 прохода, Base 3 = 13 проходов

УРОК:
  Число 3 помогает в COMPARISON-BASED алгоритмах
  Radix — не comparison-based
```

### Ternary Hardware

```
НЕ РАБОТАЕТ (на практике) потому что:
  • Вся инфраструктура бинарная
  • Теоретическое преимущество ~5%
  • Не оправдывает перестройку индустрии

УРОК:
  Теория и практика — разные царства
```

---

## Ключевой Инсайт

```
┌─────────────────────────────────────────────────────────┐
│                                                         │
│   ЧИСЛО 3 ПОМОГАЕТ КОГДА:                              │
│                                                         │
│   1. Есть СРАВНЕНИЯ (comparison-based)                 │
│   2. Есть что ИСКЛЮЧИТЬ (равные элементы)              │
│   3. Нужен БАЛАНС (branching factor)                   │
│   4. Нужны СОСТОЯНИЯ (процесс vs результат)            │
│                                                         │
│   ЧИСЛО 3 НЕ ПОМОГАЕТ КОГДА:                           │
│                                                         │
│   1. Нет сравнений (radix sort)                        │
│   2. Нечего исключать (binary search)                  │
│   3. Нужно железо (ternary computers)                  │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

---

## Рекомендации

### Когда Использовать Trinity

```
✅ ИСПОЛЬЗУЙ Trinity Sort когда:
   • Данные могут содержать дубликаты
   • Данные могут быть частично отсортированы
   • Неизвестно распределение данных

✅ ИСПОЛЬЗУЙ Trinity B-Tree когда:
   • Нужно in-memory дерево
   • Важна cache locality

✅ ИСПОЛЬЗУЙ Trinity Hash когда:
   • Нужна высокая загрузка таблицы
   • Допустимы 3 проверки при lookup

✅ ИСПОЛЬЗУЙ 3-state DFS когда:
   • Нужно найти циклы
   • Нужна топологическая сортировка
```

### Когда НЕ Использовать Trinity

```
❌ НЕ ИСПОЛЬЗУЙ Trinity Search:
   Binary search всегда лучше

❌ НЕ ИСПОЛЬЗУЙ Radix base 3:
   Base 256 всегда лучше

❌ НЕ ИСПОЛЬЗУЙ ternary hardware:
   Бинарное железо доминирует
```

---

## Мудрость Главы

> *И понял Иван-программист седьмую истину:*
>
> *Мудрость — знать, когда применять знание.*
>
> *Число 3 — не универсальный ключ.*
> *Оно работает там, где есть сравнения и исключения.*
>
> *Trinity Sort — для данных с повторами.*
> *Binary Search — для уникальных данных.*
>
> *Умный учится на чужих ошибках.*
> *Мы показали, где ошибки, чтобы ты не повторял.*

---

[← Глава 8](08_benchmarks.md) | [Глава 10: Vibee Language →](10_vibee.md)
