#!/usr/bin/env python3
"""
ШАБЛОНЫ ГЛАВ ДЛЯ КНИГИ 999

Три типа шаблонов:
1. Теория — объяснение концепций
2. Практика — код и примеры
3. Сказка — метафоры и образы
"""

# ═══════════════════════════════════════════════════════════════════════════
# ШАБЛОН: ТЕОРИЯ (Медное царство)
# ═══════════════════════════════════════════════════════════════════════════

TEMPLATE_THEORY = """# Глава {номер}: {название}

---

*«{эпиграф}»*

---

## Суть

{основная_идея}

## Три Аспекта

### 1. {аспект_1_название}

{аспект_1_описание}

### 2. {аспект_2_название}

{аспект_2_описание}

### 3. {аспект_3_название}

{аспект_3_описание}

## Связь с Trinity

{связь_с_тройкой}

## Формула

```
{формула}
```

## Диаграмма

```
{диаграмма}
```

## Мудрость

> *{мораль}*

---

[← Глава {prev}]({prev_link}) | [Глава {next} →]({next_link})
"""

# ═══════════════════════════════════════════════════════════════════════════
# ШАБЛОН: ПРАКТИКА (Серебряное царство)
# ═══════════════════════════════════════════════════════════════════════════

TEMPLATE_PRACTICE = """# Глава {номер}: {название}

---

*«{эпиграф}»*

---

## Задача

{постановка_задачи}

## Решение

```vibee
{код}
```

## Три Шага

### Шаг 1: {шаг_1_название}

{шаг_1_описание}

```vibee
{шаг_1_код}
```

### Шаг 2: {шаг_2_название}

{шаг_2_описание}

```vibee
{шаг_2_код}
```

### Шаг 3: {шаг_3_название}

{шаг_3_описание}

```vibee
{шаг_3_код}
```

## Результат

{результат}

## Бенчмарк

```
{бенчмарк}
```

## Применение

{применение}

---

[← Глава {prev}]({prev_link}) | [Глава {next} →]({next_link})
"""

# ═══════════════════════════════════════════════════════════════════════════
# ШАБЛОН: СКАЗКА (Золотое царство)
# ═══════════════════════════════════════════════════════════════════════════

TEMPLATE_FAIRYTALE = """# Глава {номер}: {название}

---

*«{эпиграф}»*

---

## Сказ

{вступление}

### Первое Испытание

{испытание_1}

*{персонаж} подумал: «{мысль_1}»*

### Второе Испытание

{испытание_2}

*{персонаж} понял: «{мысль_2}»*

### Третье Испытание

{испытание_3}

*{персонаж} воскликнул: «{мысль_3}»*

## Код Сказки

```vibee
{код_метафора}
```

## Мораль

> *{мораль}*

## Связь с Реальностью

| Сказка | Программирование |
|--------|------------------|
| {сказка_1} | {код_1} |
| {сказка_2} | {код_2} |
| {сказка_3} | {код_3} |

---

[← Глава {prev}]({prev_link}) | [Глава {next} →]({next_link})
"""

# ═══════════════════════════════════════════════════════════════════════════
# ШАБЛОН: VIBEE OS (Специальный)
# ═══════════════════════════════════════════════════════════════════════════

TEMPLATE_VIBEE_OS = """# Глава {номер}: {название}

---

*«{эпиграф}»*

---

## Архитектура

```
{архитектура_ascii}
```

## Три Компонента

### 1. {компонент_1_название}

{компонент_1_описание}

```vibee
{компонент_1_код}
```

### 2. {компонент_2_название}

{компонент_2_описание}

```vibee
{компонент_2_код}
```

### 3. {компонент_3_название}

{компонент_3_описание}

```vibee
{компонент_3_код}
```

## Пиксельная Магия

{пиксельная_магия}

```vibee
{пиксель_код}
```

## Команды Shell

```
{shell_команды}
```

## Мудрость

> *{мораль}*

---

[← Глава {prev}]({prev_link}) | [Глава {next} →]({next_link})
"""

# ═══════════════════════════════════════════════════════════════════════════
# БАЗА ЭПИГРАФОВ
# ═══════════════════════════════════════════════════════════════════════════

ЭПИГРАФЫ = {
    "три": [
        "В тридевятом царстве, в тридесятом государстве...",
        "Было у царя три сына...",
        "Три дороги перед тобой, добрый молодец...",
        "Три раза ударил Иван мечом...",
        "Три дня и три ночи скакал богатырь...",
    ],
    "физика": [
        "И увидел мудрец, что мир состоит из трёх начал...",
        "Три силы движут Вселенной...",
        "В каждом атоме — три кварка...",
        "Свет, тьма и сумерки — три состояния мира...",
    ],
    "алгоритмы": [
        "Разделяй на три части, и властвуй...",
        "Три пути ведут к решению...",
        "Сортируй по трём корзинам...",
        "Ищи в трёх направлениях...",
    ],
    "vibee_os": [
        "И построил Иван терем о трёх этажах...",
        "Каждый пиксель — живая душа...",
        "Два миллиона процессов работают как один...",
        "Система дышит, система живёт...",
    ],
    "кощей": [
        "Смерть моя на конце иглы...",
        "Та игла в яйце, то яйцо в утке...",
        "Кощей бессмертен, пока жива ссылка...",
    ],
}

# ═══════════════════════════════════════════════════════════════════════════
# БАЗА ПЕРСОНАЖЕЙ
# ═══════════════════════════════════════════════════════════════════════════

ПЕРСОНАЖИ = {
    "герои": [
        ("Иван-царевич", "он", "программист-герой"),
        ("Василиса Премудрая", "она", "архитектор системы"),
        ("Илья Муромец", "он", "менеджер памяти"),
        ("Добрыня Никитич", "он", "планировщик процессов"),
        ("Алёша Попович", "он", "мастер IPC"),
    ],
    "злодеи": [
        ("Кощей Бессмертный", "он", "legacy-код"),
        ("Баба-Яга", "она", "garbage collector"),
        ("Змей Горыныч", "он", "race condition"),
    ],
    "помощники": [
        ("Серый Волк", "он", "Box<T>"),
        ("Жар-птица", "она", "async/await"),
        ("Щука", "она", "Arc<T>"),
    ],
}

# ═══════════════════════════════════════════════════════════════════════════
# БАЗА КОДА
# ═══════════════════════════════════════════════════════════════════════════

ПРИМЕРЫ_КОДА = {
    "trinity_sort": """
fn trinity_sort<T: Ord>(arr: &mut [T]) {
    if arr.len() <= 27 {  // Тридевятое!
        insertion_sort(arr);
        return;
    }
    
    let pivot_idx = (arr.len() as f64 * 0.618) as usize;  // φ
    let pivot = arr[pivot_idx].clone();
    
    let (lt, gt) = partition_3way(arr, &pivot);
    
    trinity_sort(&mut arr[..lt]);
    trinity_sort(&mut arr[gt..]);
}
""",
    "tribool": """
enum Tribool {
    True,
    False,
    Unknown,
}

impl Tribool {
    fn and(self, other: Tribool) -> Tribool {
        match (self, other) {
            (True, True) => True,
            (False, _) | (_, False) => False,
            _ => Unknown,
        }
    }
}
""",
    "pixel_process": """
struct Pixel {
    x: u16,
    y: u16,
    color: RGB,
}

impl Pixel {
    fn handle_wave(&mut self, wave: Wave) {
        let intensity = wave.intensity_at(self.x, self.y);
        self.color = self.color.blend(wave.color, intensity);
    }
}

// 1920 × 1080 = 2,073,600 процессов!
let grid: Vec<Vec<Pixel>> = create_pixel_grid(1920, 1080);
""",
    "koschei_death": """
struct СмертьКощея {
    море: Box<Остров>,
}

// Цепочка указателей:
// море -> остров -> дуб -> сундук -> заяц -> утка -> яйцо -> игла -> смерть

fn найти_смерть(мир: &СмертьКощея) -> &mut bool {
    &mut мир.море.дуб.сундук.заяц.утка.яйцо.игла.смерть
}
""",
}

# ═══════════════════════════════════════════════════════════════════════════
# ФУНКЦИИ ГЕНЕРАЦИИ
# ═══════════════════════════════════════════════════════════════════════════

def выбрать_шаблон(том: int, книга: int) -> str:
    """Выбирает шаблон по тому и книге"""
    if том == 1:
        return TEMPLATE_THEORY
    elif том == 2:
        if книга == 16:  # Vibee OS
            return TEMPLATE_VIBEE_OS
        return TEMPLATE_PRACTICE
    else:
        return TEMPLATE_FAIRYTALE

def выбрать_эпиграф(тема: str) -> str:
    """Выбирает эпиграф по теме"""
    import random
    категория = "три"  # По умолчанию
    
    if "физик" in тема.lower() or "констант" in тема.lower():
        категория = "физика"
    elif "сорт" in тема.lower() or "структур" in тема.lower():
        категория = "алгоритмы"
    elif "os" in тема.lower() or "систем" in тема.lower():
        категория = "vibee_os"
    elif "кощей" in тема.lower() or "указател" in тема.lower():
        категория = "кощей"
    
    return random.choice(ЭПИГРАФЫ.get(категория, ЭПИГРАФЫ["три"]))

def выбрать_персонажа(номер: int) -> tuple:
    """Выбирает персонажа по номеру главы"""
    все_персонажи = (
        ПЕРСОНАЖИ["герои"] + 
        ПЕРСОНАЖИ["злодеи"] + 
        ПЕРСОНАЖИ["помощники"]
    )
    return все_персонажи[номер % len(все_персонажи)]

def выбрать_код(тема: str) -> str:
    """Выбирает пример кода по теме"""
    if "сорт" in тема.lower():
        return ПРИМЕРЫ_КОДА["trinity_sort"]
    elif "bool" in тема.lower() or "логик" in тема.lower():
        return ПРИМЕРЫ_КОДА["tribool"]
    elif "пиксел" in тема.lower() or "os" in тема.lower():
        return ПРИМЕРЫ_КОДА["pixel_process"]
    elif "кощей" in тема.lower() or "указател" in тема.lower():
        return ПРИМЕРЫ_КОДА["koschei_death"]
    else:
        return ПРИМЕРЫ_КОДА["tribool"]  # По умолчанию

# ═══════════════════════════════════════════════════════════════════════════
# ТЕСТ
# ═══════════════════════════════════════════════════════════════════════════

if __name__ == "__main__":
    print("Шаблоны загружены!")
    print(f"  • Эпиграфов: {sum(len(v) for v in ЭПИГРАФЫ.values())}")
    print(f"  • Персонажей: {sum(len(v) for v in ПЕРСОНАЖИ.values())}")
    print(f"  • Примеров кода: {len(ПРИМЕРЫ_КОДА)}")
