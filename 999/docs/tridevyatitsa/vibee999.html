<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚öîÔ∏è VIBEE 999 ‚Äî –ö–Ω–∏–≥–∞ –Ø–∑—ã–∫–∞</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
:root{--gold:#d4af37;--copper:#b87333;--silver:#c0c0c0;--bg:#0a0a12;--code-bg:#0d1117;--hp:#e74c3c;--mp:#3498db;--xp:#2ecc71}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Cinzel',serif;background:var(--bg);color:#f0e6d3;min-height:100vh}
.game{display:grid;grid-template-rows:auto 1fr auto;height:100vh;max-width:1400px;margin:0 auto}

/* HUD */
.hud{display:grid;grid-template-columns:250px 1fr 250px;padding:12px 20px;background:linear-gradient(180deg,rgba(20,20,30,0.95),rgba(10,10,18,0.98));border-bottom:2px solid var(--gold);gap:20px}
.player{display:flex;align-items:center;gap:12px}
.avatar{width:50px;height:50px;border-radius:50%;border:2px solid var(--gold);display:flex;align-items:center;justify-content:center;font-size:1.8em;background:radial-gradient(circle,rgba(212,175,55,0.2),transparent)}
.stats{flex:1}
.stat-row{display:flex;align-items:center;gap:8px;margin:3px 0}
.stat-label{font-size:0.7em;width:25px;color:var(--silver)}
.bar{flex:1;height:14px;background:#1a1a2e;border-radius:7px;overflow:hidden;position:relative}
.bar-fill{height:100%;transition:width 0.5s ease}
.bar-hp .bar-fill{background:linear-gradient(90deg,#8b0000,#e74c3c)}
.bar-mp .bar-fill{background:linear-gradient(90deg,#1a5276,#3498db)}
.bar-xp .bar-fill{background:linear-gradient(90deg,#145a32,#2ecc71)}
.bar-text{position:absolute;right:5px;top:50%;transform:translateY(-50%);font-size:0.6em;font-family:'JetBrains Mono',monospace}

.chapter-display{text-align:center}
.chapter-num{font-size:2.8em;color:var(--gold);text-shadow:0 0 30px rgba(212,175,55,0.6);line-height:1}
.chapter-sacred{font-size:0.9em;color:var(--silver);margin-top:2px}

.quick-nav{display:flex;gap:8px;justify-content:flex-end;align-items:center;flex-wrap:wrap}
.qbtn{background:rgba(212,175,55,0.15);border:1px solid rgba(212,175,55,0.4);color:var(--gold);padding:6px 12px;cursor:pointer;font-size:0.75em;font-family:'Cinzel',serif;transition:all 0.2s;border-radius:3px}
.qbtn:hover{background:rgba(212,175,55,0.3);box-shadow:0 0 10px rgba(212,175,55,0.3)}

/* Main */
.main{display:grid;grid-template-columns:220px 1fr 220px;gap:15px;padding:15px;overflow:hidden}

/* Sidebars */
.sidebar{background:rgba(0,0,0,0.6);border:1px solid rgba(212,175,55,0.2);padding:15px;border-radius:8px;overflow-y:auto}
.sidebar h3{color:var(--gold);font-size:0.9em;margin-bottom:12px;padding-bottom:8px;border-bottom:1px solid rgba(212,175,55,0.2);text-align:center;letter-spacing:0.1em}

/* Alphabet */
.alphabet{display:grid;grid-template-columns:repeat(3,1fr);gap:5px}
.alpha-btn{background:rgba(0,0,0,0.4);border:1px solid rgba(212,175,55,0.2);padding:8px 4px;text-align:center;cursor:pointer;transition:all 0.2s;border-radius:4px}
.alpha-btn:hover{background:rgba(212,175,55,0.2);border-color:var(--gold)}
.alpha-btn.active{background:rgba(212,175,55,0.3);border-color:var(--gold);box-shadow:0 0 10px rgba(212,175,55,0.3)}
.alpha-btn .sym{font-size:1.4em;display:block}
.alpha-btn .num{font-size:0.6em;color:var(--silver)}

/* Topics */
.topic{padding:10px;margin:8px 0;background:rgba(0,0,0,0.4);border-left:3px solid var(--gold);font-size:0.8em;cursor:pointer;transition:all 0.2s;border-radius:0 4px 4px 0}
.topic:hover{background:rgba(212,175,55,0.15);padding-left:15px}
.topic.active{background:rgba(212,175,55,0.2);border-left-width:5px}
.topic-num{color:var(--gold);font-weight:bold}

/* Content */
.content{background:rgba(0,0,0,0.5);border:1px solid rgba(212,175,55,0.2);border-radius:10px;padding:25px;overflow-y:auto}

.letter-header{text-align:center;padding-bottom:20px;border-bottom:1px solid rgba(212,175,55,0.2);margin-bottom:20px}
.letter-symbol{font-size:5em;text-shadow:0 0 40px currentColor;animation:glow 3s ease-in-out infinite}
@keyframes glow{0%,100%{text-shadow:0 0 30px currentColor}50%{text-shadow:0 0 60px currentColor,0 0 90px currentColor}}
.letter-name{font-size:1.6em;color:var(--gold);margin:10px 0}
.letter-meaning{font-size:1.1em;color:var(--silver)}

.kingdom-badge{display:inline-block;padding:8px 25px;margin:15px 0;border-radius:25px;font-size:1em}
.kingdom-badge.copper{background:linear-gradient(135deg,rgba(184,115,51,0.3),rgba(184,115,51,0.1));border:2px solid var(--copper);color:var(--copper)}
.kingdom-badge.silver{background:linear-gradient(135deg,rgba(192,192,192,0.3),rgba(192,192,192,0.1));border:2px solid var(--silver);color:var(--silver)}
.kingdom-badge.gold{background:linear-gradient(135deg,rgba(212,175,55,0.3),rgba(212,175,55,0.1));border:2px solid var(--gold);color:var(--gold)}

.pattern-box{background:var(--code-bg);padding:20px;border-radius:8px;text-align:center;margin:20px 0;border:1px solid #30363d}
.pattern-formula{font-size:1.4em;color:var(--gold);font-family:'JetBrains Mono',monospace}
.pattern-result{font-size:2.2em;margin-top:8px;font-family:'JetBrains Mono',monospace}

.section{margin:25px 0}
.section-title{color:var(--gold);font-size:1.1em;margin-bottom:12px;display:flex;align-items:center;gap:10px}
.section-title::after{content:'';flex:1;height:1px;background:linear-gradient(90deg,rgba(212,175,55,0.5),transparent)}

/* Code */
.code-block{background:var(--code-bg);border:1px solid #30363d;border-radius:8px;padding:20px;font-family:'JetBrains Mono',monospace;font-size:0.85em;overflow-x:auto;white-space:pre;line-height:1.6;color:#e6edf3}
.code-block .comment{color:#8b949e}
.code-block .keyword{color:#ff7b72}
.code-block .string{color:#a5d6ff}
.code-block .number{color:#79c0ff}
.code-block .type{color:#ffa657}
.code-block .function{color:#d2a8ff}

.explanation{background:linear-gradient(135deg,rgba(212,175,55,0.1),rgba(0,0,0,0.3));padding:20px;border-radius:8px;border-left:4px solid var(--gold);font-size:1.05em;line-height:1.7}

.wisdom{text-align:center;padding:25px;margin-top:25px;border:1px solid var(--gold);border-radius:10px;background:radial-gradient(ellipse at center,rgba(212,175,55,0.1),transparent)}
.wisdom-text{font-size:1.3em;font-style:italic;color:var(--gold)}

/* Controls */
.controls{display:flex;justify-content:center;gap:12px;padding:12px;background:linear-gradient(0deg,rgba(20,20,30,0.95),rgba(10,10,18,0.98));border-top:2px solid var(--gold);flex-wrap:wrap}
.btn{font-family:'Cinzel',serif;background:linear-gradient(180deg,rgba(212,175,55,0.25),rgba(0,0,0,0.5));border:2px solid var(--gold);color:var(--gold);padding:10px 25px;cursor:pointer;font-size:0.95em;transition:all 0.3s;border-radius:5px}
.btn:hover{background:linear-gradient(180deg,rgba(212,175,55,0.4),rgba(0,0,0,0.3));box-shadow:0 0 20px rgba(212,175,55,0.4);transform:translateY(-2px)}
.btn:disabled{opacity:0.3;cursor:not-allowed;transform:none}
.btn.sacred{animation:pulse 2s infinite}
@keyframes pulse{0%,100%{box-shadow:0 0 5px var(--gold)}50%{box-shadow:0 0 25px var(--gold),0 0 40px var(--gold)}}

.chapter-input{font-family:'JetBrains Mono',monospace;background:rgba(0,0,0,0.5);border:2px solid var(--gold);color:var(--gold);padding:10px;width:80px;text-align:center;font-size:1.1em;border-radius:5px}

/* Achievement */
.achievement{position:fixed;top:20px;right:20px;background:rgba(0,0,0,0.95);border:2px solid var(--gold);padding:20px 25px;border-radius:10px;animation:slideIn 0.5s;z-index:100;box-shadow:0 0 30px rgba(212,175,55,0.5)}
@keyframes slideIn{from{transform:translateX(100%);opacity:0}to{transform:translateX(0);opacity:1}}
.achievement h4{color:var(--gold);margin-bottom:8px;font-size:1.1em}
.hidden{display:none}

/* Responsive */
@media(max-width:1200px){.main{grid-template-columns:180px 1fr 180px}}
@media(max-width:900px){.main{grid-template-columns:1fr}.sidebar{display:none}}
    </style>
</head>
<body>
<div class="game">
    <div class="hud">
        <div class="player">
            <div class="avatar">üßô</div>
            <div class="stats">
                <div class="stat-row"><span class="stat-label">HP</span><div class="bar bar-hp"><div class="bar-fill" id="hp" style="width:100%"></div><span class="bar-text">100</span></div></div>
                <div class="stat-row"><span class="stat-label">MP</span><div class="bar bar-mp"><div class="bar-fill" id="mp" style="width:100%"></div><span class="bar-text">27</span></div></div>
                <div class="stat-row"><span class="stat-label">XP</span><div class="bar bar-xp"><div class="bar-fill" id="xp" style="width:0%"></div><span class="bar-text">0/999</span></div></div>
            </div>
        </div>
        <div class="chapter-display">
            <div class="chapter-num" id="chNum">1</div>
            <div class="chapter-sacred" id="chSacred">VIBEE</div>
        </div>
        <div class="quick-nav">
            <button class="qbtn" onclick="go(1)">1</button>
            <button class="qbtn" onclick="go(27)">27</button>
            <button class="qbtn" onclick="go(81)">81</button>
            <button class="qbtn" onclick="go(243)">243</button>
            <button class="qbtn" onclick="go(333)">333</button>
            <button class="qbtn" onclick="go(666)">666</button>
            <button class="qbtn" onclick="go(729)">729</button>
            <button class="qbtn" onclick="go(999)">999</button>
        </div>
    </div>
    
    <div class="main">
        <div class="sidebar">
            <h3>‚≤Ä-‚≥Ç –ê–õ–§–ê–í–ò–¢</h3>
            <div class="alphabet" id="alphabet"></div>
        </div>
        
        <div class="content" id="content"></div>
        
        <div class="sidebar">
            <h3>üìö –¢–ï–ú–´ VIBEE</h3>
            <div id="topics"></div>
        </div>
    </div>
    
    <div class="controls">
        <button class="btn" onclick="go(c-1)" id="btnPrev">‚Üê –ù–ê–ó–ê–î</button>
        <input type="number" class="chapter-input" id="chInput" value="1" min="1" max="999" onchange="go(this.value)">
        <button class="btn" onclick="go(c+1)" id="btnNext">–í–ü–ï–†–Å–î ‚Üí</button>
        <button class="btn" onclick="goRandom()">‚öÇ –°–õ–£–ß–ê–ô–ù–û</button>
        <button class="btn" onclick="goSacred()" id="btnSacred">‚ú® –°–í–Ø–©–ï–ù–ù–ê–Ø</button>
    </div>
</div>

<div class="achievement hidden" id="ach">
    <h4>üèÜ –î–û–°–¢–ò–ñ–ï–ù–ò–ï</h4>
    <div id="achText"></div>
</div>

<script>
let bookData = null;
let c = 1;
let xp = 0, hp = 100, mp = 27;
let visited = new Set([1]);
let achievements = [];

const TOPICS = {
    1: {t:"let –∏ const",d:"–û–±—ä—è–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö"},
    2: {t:"bool –∏ Tribool",d:"–õ–æ–≥–∏—á–µ—Å–∫–∏–µ —Ç–∏–ø—ã"},
    3: {t:"–¢—Ä–∏ —Ç–∏–ø–∞ –¥–∞–Ω–Ω—ã—Ö",d:"–ü—Ä–∏–º–∏—Ç–∏–≤—ã, —Å–æ—Å—Ç–∞–≤–Ω—ã–µ, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ"},
    4: {t:"struct",d:"–°—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö"},
    5: {t:"fn —Ñ—É–Ω–∫—Ü–∏–∏",d:"–§—É–Ω–∫—Ü–∏–∏ –∏ –º–µ—Ç–æ–¥—ã"},
    6: {t:"impl –º–µ—Ç–æ–¥—ã",d:"–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –º–µ—Ç–æ–¥–æ–≤"},
    7: {t:"Option<T>",d:"–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è"},
    8: {t:"–¶–∏–∫–ª—ã loop",d:"–¶–∏–∫–ª—ã –∏ –∏—Ç–µ—Ä–∞—Ü–∏–∏"},
    9: {t:"Result<T,E>",d:"–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫"},
    10:{t:"–ò—Ç–µ—Ä–∞—Ç–æ—Ä—ã",d:"iter() –∏ —Ü–µ–ø–æ—á–∫–∏"},
    11:{t:"Ownership",d:"–í–ª–∞–¥–µ–Ω–∏–µ –ø–∞–º—è—Ç—å—é"},
    12:{t:"Generics <T>",d:"–û–±–æ–±—â—ë–Ω–Ω—ã–µ —Ç–∏–ø—ã"},
    13:{t:"trait",d:"–¢—Ä–µ–π—Ç—ã –∏ –ø–æ–≤–µ–¥–µ–Ω–∏–µ"},
    14:{t:"enum",d:"–ü–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏—è"},
    15:{t:"References &",d:"–°—Å—ã–ª–∫–∏ –∏ –∑–∞–∏–º—Å—Ç–≤–æ–≤–∞–Ω–∏–µ"},
    16:{t:"mod –º–æ–¥—É–ª–∏",d:"–ú–æ–¥—É–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞"},
    17:{t:"use –ø—É—Ç–∏",d:"–ò–º–ø–æ—Ä—Ç –∏ –ø—É—Ç–∏"},
    18:{t:"macro!",d:"–ú–∞–∫—Ä–æ—Å—ã"},
    19:{t:"String –∏ &str",d:"–°—Ç—Ä–æ–∫–∏"},
    20:{t:"Vec<T>",d:"–í–µ–∫—Ç–æ—Ä—ã –∏ –º–∞—Å—Å–∏–≤—ã"},
    21:{t:"async/await",d:"–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å"},
    22:{t:"unsafe",d:"–ù–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–π –∫–æ–¥"},
    23:{t:"lifetime 'a",d:"–í—Ä–µ–º—è –∂–∏–∑–Ω–∏"},
    24:{t:"closure ||",d:"–ó–∞–º—ã–∫–∞–Ω–∏—è"},
    25:{t:"Box, Rc, Arc",d:"–£–º–Ω—ã–µ —É–∫–∞–∑–∞—Ç–µ–ª–∏"},
    26:{t:"Cargo",d:"–ü–∞–∫–µ—Ç–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä"},
    27:{t:"–í—Å—ë –≤–º–µ—Å—Ç–µ",d:"–ü–æ–ª–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞"}
};

const ALPHABET = [
    {s:"‚≤Ä",n:"–ê–ª—å—Ñ–∞",m:"–ù–∞—á–∞–ª–æ"},{s:"‚≤Ç",n:"–í–∏—Ç–∞",m:"–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ"},{s:"‚≤Ñ",n:"–ì–∞–º–º–∞",m:"–¢—Ä–æ–∏—Ü–∞"},
    {s:"‚≤Ü",n:"–î–µ–ª—å—Ç–∞",m:"–û—Å–Ω–æ–≤–∞"},{s:"‚≤à",n:"–≠–π",m:"–ñ–∏–∑–Ω—å"},{s:"‚≤ä",n:"–°–∞—É",m:"–ì–∞—Ä–º–æ–Ω–∏—è"},
    {s:"‚≤å",n:"–ó–µ—Ç–∞",m:"–¢–∞–π–Ω–∞"},{s:"‚≤é",n:"–≠—Ç–∞",m:"–ë–µ—Å–∫–æ–Ω–µ—á–Ω–æ—Å—Ç—å"},{s:"‚≤ê",n:"–¢–µ—Ç–∞",m:"–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ"},
    {s:"‚≤í",n:"–ô–æ—Ç–∞",m:"–î–≤–∏–∂–µ–Ω–∏–µ"},{s:"‚≤î",n:"–ö–∞–ø–ø–∞",m:"–°–∏–ª–∞"},{s:"‚≤ñ",n:"–õ—è–º–±–¥–∞",m:"–°–≤–µ—Ç"},
    {s:"‚≤ò",n:"–ú—é",m:"–ú—É–¥—Ä–æ—Å—Ç—å"},{s:"‚≤ö",n:"–ù—é",m:"–ü–æ—Ä—è–¥–æ–∫"},{s:"‚≤ú",n:"–ö—Å–∏",m:"–°–≤—è–∑—å"},
    {s:"‚≤û",n:"–û–º–∏–∫—Ä–æ–Ω",m:"–¶–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å"},{s:"‚≤†",n:"–ü–∏",m:"–ü—É—Ç—å"},{s:"‚≤¢",n:"–†–æ",m:"–†–µ—á—å"},
    {s:"‚≤§",n:"–°–∏–≥–º–∞",m:"–°–ª–æ–≤–æ"},{s:"‚≤¶",n:"–¢–∞—É",m:"–¢–≤–µ—Ä–¥—å"},{s:"‚≤®",n:"–ò–ø—Å–∏–ª–æ–Ω",m:"–í—ã—Å–æ—Ç–∞"},
    {s:"‚≤™",n:"–§–∏",m:"–û–≥–æ–Ω—å"},{s:"‚≤¨",n:"–•–∏",m:"–î—É—Ö"},{s:"‚≤Æ",n:"–ü—Å–∏",m:"–î—É—à–∞"},
    {s:"‚≤∞",n:"–û–º–µ–≥–∞",m:"–í–µ—á–Ω–æ—Å—Ç—å"},{s:"‚≥Ä",n:"–°–∞–º–ø–∏",m:"–¶–∞—Ä—Å—Ç–≤–æ"},{s:"‚≥Ç",n:"–ö–æ–ø–ø–∞",m:"–ü–æ–ª–Ω–æ—Ç–∞"}
];

const œÄ = Math.PI;

async function loadBook() {
    try {
        const resp = await fetch('generated_tridevyatitsa/vibee_book/chapters.json');
        bookData = await resp.json();
        initUI();
        go(1);
    } catch(e) {
        console.error(e);
        document.getElementById('content').innerHTML = '<p style="text-align:center;padding:50px">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</p>';
    }
}

function initUI() {
    // Alphabet
    let alphaHTML = '';
    for (let i = 0; i < 27; i++) {
        const a = ALPHABET[i];
        alphaHTML += `<div class="alpha-btn" onclick="goToLetter(${i+1})" id="alpha${i+1}"><span class="sym">${a.s}</span><span class="num">${i+1}</span></div>`;
    }
    document.getElementById('alphabet').innerHTML = alphaHTML;
    
    // Topics
    let topicsHTML = '';
    for (let i = 1; i <= 27; i++) {
        const t = TOPICS[i];
        topicsHTML += `<div class="topic" onclick="goToLetter(${i})" id="topic${i}"><span class="topic-num">${i}.</span> ${t.t}</div>`;
    }
    document.getElementById('topics').innerHTML = topicsHTML;
}

function goToLetter(n) {
    // Find first chapter with this letter
    go(n);
}

function pattern(g) {
    let n = ((g - 1) % 27) + 1;
    let k = Math.min(Math.floor((g - 1) / 333), 2);
    let m = g % 27 === 0 ? 2 : g % 9 === 0 ? 1 : g % 3 === 0 ? 0.5 : 0;
    return {n, k, m, v: n * Math.pow(3, k) * Math.pow(œÄ, m)};
}

function go(g) {
    g = parseInt(g);
    if (g < 1 || g > 999 || !bookData) return;
    c = g;
    visited.add(g);
    
    const ch = bookData[g - 1];
    const p = pattern(g);
    
    xp = Math.min(999, visited.size);
    if (p.m >= 1) mp = Math.min(27, mp + 3);
    
    updateHUD(ch, p);
    render(ch, p);
    checkAchievements(g, p);
}

function updateHUD(ch, p) {
    document.getElementById('hp').style.width = hp + '%';
    document.getElementById('mp').style.width = (mp / 27 * 100) + '%';
    document.getElementById('xp').style.width = (xp / 999 * 100) + '%';
    document.querySelector('.bar-xp .bar-text').textContent = xp + '/999';
    
    document.getElementById('chNum').textContent = c;
    document.getElementById('chSacred').textContent = ch.—Å–≤—è—â–µ–Ω–Ω–æ—Å—Ç—å === '–æ–±—ã—á–Ω–æ–µ' ? 'VIBEE' : ch.—Å–≤—è—â–µ–Ω–Ω–æ—Å—Ç—å.toUpperCase();
    document.getElementById('chInput').value = c;
    
    document.getElementById('btnPrev').disabled = c <= 1;
    document.getElementById('btnNext').disabled = c >= 999;
    document.getElementById('btnSacred').className = p.m >= 1 ? 'btn sacred' : 'btn';
    
    // Update active states
    document.querySelectorAll('.alpha-btn').forEach((el, i) => {
        el.classList.toggle('active', i + 1 === p.n);
    });
    document.querySelectorAll('.topic').forEach((el, i) => {
        el.classList.toggle('active', i + 1 === p.n);
    });
}

function highlightCode(code) {
    return code
        .replace(/(\/\/.*)/g, '<span class="comment">$1</span>')
        .replace(/\b(let|const|fn|struct|impl|enum|type|match|if|else|for|while|loop|return|use|mod|pub|async|await|unsafe|trait|where|self|Self)\b/g, '<span class="keyword">$1</span>')
        .replace(/\b(i8|i16|i32|i64|u8|u16|u32|u64|f32|f64|bool|char|str|String|Vec|Option|Result|Some|None|Ok|Err|Box|Rc|Arc)\b/g, '<span class="type">$1</span>')
        .replace(/"([^"]*)"/g, '<span class="string">"$1"</span>')
        .replace(/\b(\d+)\b/g, '<span class="number">$1</span>');
}

function render(ch, p) {
    const kingdom = ch.—Ü–∞—Ä—Å—Ç–≤–æ;
    const kClass = kingdom === '–ú–µ–¥–Ω–æ–µ' ? 'copper' : kingdom === '–°–µ—Ä–µ–±—Ä—è–Ω–æ–µ' ? 'silver' : 'gold';
    const kColor = kingdom === '–ú–µ–¥–Ω–æ–µ' ? '#b87333' : kingdom === '–°–µ—Ä–µ–±—Ä—è–Ω–æ–µ' ? '#c0c0c0' : '#d4af37';
    const stars = p.m === 2 ? '‚≠ê‚≠ê‚≠ê' : p.m === 1 ? '‚≠ê‚≠ê' : p.m >= 0.5 ? '‚≠ê' : '';
    
    document.getElementById('content').innerHTML = `
<div class="letter-header">
    <div class="letter-symbol" style="color:${kColor}">${ch.–±—É–∫–≤–∞}</div>
    <div class="letter-name">${ch.–∏–º—è} ‚Äî ${ch.—Å–º—ã—Å–ª}</div>
    <div class="letter-meaning">–ì–ª–∞–≤–∞ ${ch.–Ω–æ–º–µ—Ä}</div>
    <div class="kingdom-badge ${kClass}">${kingdom} —Ü–∞—Ä—Å—Ç–≤–æ ${stars}</div>
</div>

<div class="pattern-box">
    <div class="pattern-formula">${p.n} √ó 3<sup>${p.k}</sup> √ó œÄ<sup>${p.m}</sup></div>
    <div class="pattern-result">= ${p.v.toFixed(6)}</div>
</div>

<div class="section">
    <div class="section-title">üìñ –¢–ï–ú–ê VIBEE: ${ch.vibee_—Ç–µ–º–∞}</div>
    <div class="code-block">${highlightCode(ch.vibee_–∫–æ–¥)}</div>
</div>

<div class="section">
    <div class="section-title">üí° –û–ë–™–Ø–°–ù–ï–ù–ò–ï</div>
    <div class="explanation">${ch.vibee_–æ–±—ä—è—Å–Ω–µ–Ω–∏–µ}</div>
</div>

<div class="wisdom">
    <div class="wisdom-text">¬´ ${ch.—Å–º—ã—Å–ª} ‚Üí ${TOPICS[p.n].t} ¬ª</div>
</div>`;
}

function goRandom() { go(Math.floor(Math.random() * 999) + 1); }
function goSacred() {
    const sacred = [27,54,81,108,135,162,189,216,243,270,297,324,351,378,405,432,459,486,513,540,567,594,621,648,675,702,729,756,783,810,837,864,891,918,945,972,999];
    go(sacred[Math.floor(Math.random() * sacred.length)]);
}

function checkAchievements(g, p) {
    let newAch = null;
    if (visited.size === 27 && !achievements.includes('27')) { achievements.push('27'); newAch = 'üìö –ò–∑—É—á–µ–Ω—ã –≤—Å–µ 27 —Ç–µ–º Vibee!'; }
    if (g === 999 && !achievements.includes('999')) { achievements.push('999'); newAch = 'üèÜ –î–æ—Å—Ç–∏–≥–Ω—É—Ç–∞ –≥–ª–∞–≤–∞ 999!'; }
    if (p.m === 2 && !achievements.includes('sacred')) { achievements.push('sacred'); newAch = '‚ú® –ù–∞–π–¥–µ–Ω–∞ —Å–≤—è—â–µ–Ω–Ω–∞—è –≥–ª–∞–≤–∞!'; }
    if (newAch) {
        document.getElementById('achText').textContent = newAch;
        document.getElementById('ach').classList.remove('hidden');
        setTimeout(() => document.getElementById('ach').classList.add('hidden'), 3000);
    }
}

loadBook();
</script>
</body>
</html>
