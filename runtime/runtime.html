<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
  <title>VIBEE 999</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    html,body{width:100%;height:100%;overflow:hidden;background:#000;touch-action:none;font-family:system-ui}
    video{position:fixed;top:0;left:0;width:100%;height:100%;object-fit:cover;transform:scaleX(-1);opacity:0;transition:opacity .5s}
    video.on{opacity:.3}
    canvas{position:fixed;top:0;left:0;width:100%;height:100%}
    #ui{position:fixed;z-index:100;color:#fff;pointer-events:none}
    #core{position:fixed;top:20px;left:50%;transform:translateX(-50%);text-align:center}
    #symbol{font-size:42px}
    #formula{font-size:13px;opacity:.7;font-family:serif;margin-top:5px}
    #thought{position:fixed;bottom:70px;left:50%;transform:translateX(-50%);font-size:16px;opacity:0;transition:opacity 1s;text-shadow:0 0 20px currentColor;font-style:italic}
    #thought.on{opacity:1}
    #status{position:fixed;left:15px;bottom:15px;font-size:10px;background:rgba(0,0,0,.7);padding:6px 10px;border-radius:5px}
    #neural{position:fixed;right:15px;top:50%;transform:translateY(-50%);font-size:9px;background:rgba(0,0,0,.7);padding:8px;border-radius:5px;width:90px}
    .bar{height:4px;margin:3px 0;border-radius:2px;background:rgba(255,255,255,.1)}
    .bar-fill{height:100%;border-radius:2px;transition:width .3s}
  </style>
</head>
<body>
<video id="v" playsinline autoplay></video>
<canvas id="c"></canvas>
<div id="ui">
  <div id="core"><div id="symbol">ğŸ¡ğŸ¡ğŸ¡</div><div id="formula">n Ã— 3<sup>k</sup> Ã— Ï€<sup>m</sup></div></div>
  <div id="thought"></div>
  <div id="status">VIBEE 999</div>
  <div id="neural"></div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// VIBEE 999 RUNTIME - FINAL VERSION
// DO NOT MODIFY - All logic in .999 files
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

(function(){
'use strict';

const TAU = Math.PI * 2;
const PI = Math.PI;
const PHI = 1.618033988749895;

// Pattern 999: n Ã— 3^k Ã— Ï€^m
function p999(n, k, m) {
  return n * Math.pow(3, k) * Math.pow(PI, m);
}

function col(h, s, l, a) {
  return 'hsla(' + h + ',' + s + '%,' + l + '%,' + a + ')';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SENSORS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var S = {
  mouse: { x: 0, y: 0, vx: 0, vy: 0, vel: 0, down: false },
  audio: { vol: 0, freq: 0, beat: false },
  light: 0.5,
  motion: { a: 0, b: 0, g: 0 },
  time: { h: 0, m: 0, s: 0, p: 0 },
  screen: { w: window.innerWidth, h: window.innerHeight }
};

var px = 0, py = 0;

document.addEventListener('mousemove', function(e) {
  S.mouse.vx = e.clientX - px;
  S.mouse.vy = e.clientY - py;
  S.mouse.vel = Math.sqrt(S.mouse.vx * S.mouse.vx + S.mouse.vy * S.mouse.vy);
  S.mouse.x = e.clientX;
  S.mouse.y = e.clientY;
  px = e.clientX;
  py = e.clientY;
});

document.addEventListener('mousedown', function() { S.mouse.down = true; });
document.addEventListener('mouseup', function() { S.mouse.down = false; });

document.addEventListener('touchmove', function(e) {
  e.preventDefault();
  var t = e.touches[0];
  S.mouse.x = t.clientX;
  S.mouse.y = t.clientY;
  S.mouse.vel = 10;
}, { passive: false });

window.addEventListener('resize', function() {
  S.screen.w = window.innerWidth;
  S.screen.h = window.innerHeight;
  resize();
});

// Audio
var audioCtx, analyser, fftData;
function initAudio() {
  if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
    navigator.mediaDevices.getUserMedia({ audio: true }).then(function(stream) {
      audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      analyser = audioCtx.createAnalyser();
      analyser.fftSize = 128;
      fftData = new Uint8Array(64);
      audioCtx.createMediaStreamSource(stream).connect(analyser);
    }).catch(function() {});
  }
}

function readAudio() {
  if (analyser) {
    analyser.getByteFrequencyData(fftData);
    var sum = 0, max = 0, maxI = 0;
    for (var i = 0; i < 64; i++) {
      sum += fftData[i] * fftData[i];
      if (fftData[i] > max) { max = fftData[i]; maxI = i; }
    }
    S.audio.vol = Math.sqrt(sum / 64) / 255;
    S.audio.freq = maxI * (audioCtx.sampleRate / 128);
    S.audio.beat = S.audio.vol > 0.6;
  }
}

// Time
function readTime() {
  var d = new Date();
  S.time.h = d.getHours();
  S.time.m = d.getMinutes();
  S.time.s = d.getSeconds();
  S.time.p = (S.time.h * 3600 + S.time.m * 60 + S.time.s) / 86400;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NEURAL 999: 3 â†’ 9 â†’ 27 â†’ 9 â†’ 3
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var N = {
  layers: [3, 9, 27, 9, 3],
  weights: [],
  act: [
    [0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0],
    new Array(27).fill(0),
    [0, 0, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0]
  ],
  emotion: 0,
  pulse: 1,
  memory: [],
  gen: 0
};

function initNeural() {
  for (var l = 0; l < 4; l++) {
    N.weights[l] = [];
    for (var i = 0; i < N.layers[l]; i++) {
      N.weights[l][i] = [];
      for (var j = 0; j < N.layers[l + 1]; j++) {
        var n = (i % 9) + 1;
        var k = l;
        var m = j % 3;
        N.weights[l][i][j] = (p999(n, k, m) / 100) * (0.9 + Math.random() * 0.2);
      }
    }
  }
}

function processNeural(t) {
  // Encode 9 inputs
  var input = [
    S.mouse.x / S.screen.w || 0,
    S.mouse.y / S.screen.h || 0,
    Math.min(S.mouse.vel / 100, 1) || 0,
    S.audio.vol || 0,
    S.audio.freq / 1000 || 0,
    S.light || 0.5,
    (S.motion.b + 180) / 360 || 0.5,
    (S.motion.g + 90) / 180 || 0.5,
    S.time.p || 0
  ];

  // Forward pass
  N.act[0] = input.slice(0, 3);
  
  for (var l = 0; l < 4; l++) {
    for (var j = 0; j < N.layers[l + 1]; j++) {
      var sum = 0;
      for (var i = 0; i < N.layers[l]; i++) {
        sum += (N.act[l][i] || 0) * (N.weights[l][i][j] || 0);
      }
      N.act[l + 1][j] = Math.tanh(sum) * Math.sin(((j % 9) + 1) * PI / 9);
    }
  }

  // Update state
  var out = N.act[4];
  N.emotion = N.emotion * 0.95 + (out[1] || 0) * 0.05;
  N.pulse = 1 + Math.sin(t * 0.5) * 0.2 + N.emotion * 0.3;
  N.gen++;

  // Memory (27 slots)
  N.memory.push({ t: t, e: N.emotion, a: out[0] || 0 });
  if (N.memory.length > 27) N.memory.shift();

  return { activation: out[0] || 0, emotion: N.emotion, pulse: N.pulse };
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RENDERER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var canvas = document.getElementById('c');
var ctx = canvas.getContext('2d');
var W, H, t = 0, lastFrame = performance.now();

function resize() {
  W = window.innerWidth;
  H = window.innerHeight;
  canvas.width = W * 2;
  canvas.height = H * 2;
  ctx.setTransform(2, 0, 0, 2, 0, 0);
}

function draw999(neural) {
  var cx = W / 2;
  var cy = H / 2;
  var r = Math.min(W, H) * 0.4;
  var mx = S.mouse.x || cx;
  var my = S.mouse.y || cy;

  // Three rings: 3, 9, 27 elements
  for (var ring = 0; ring < 3; ring++) {
    var rr = r * (0.3 + ring * 0.25);
    var els = 3 * Math.pow(3, ring);
    var phase = t * (0.5 + ring * 0.2) * neural.pulse;

    for (var i = 0; i < els; i++) {
      var a = (i / els) * TAU + phase;
      var x = cx + Math.cos(a) * rr;
      var y = cy + Math.sin(a) * rr;
      var n = (i % 9) + 1;
      var k = ring;
      var m = Math.floor(i / 9) % 3;
      var sz = 3 + (p999(n, k, m) % 20);
      var hue = (i * 40 + ring * 120 + t * 30 + neural.emotion * 60) % 360;

      ctx.beginPath();
      if (ring === 0) {
        ctx.arc(x, y, sz, 0, TAU);
      } else if (ring === 1) {
        for (var p = 0; p < 3; p++) {
          var pa = p * TAU / 3 - TAU / 4 + a;
          if (p === 0) ctx.moveTo(x + Math.cos(pa) * sz, y + Math.sin(pa) * sz);
          else ctx.lineTo(x + Math.cos(pa) * sz, y + Math.sin(pa) * sz);
        }
        ctx.closePath();
      } else {
        for (var p = 0; p < 9; p++) {
          var pa = p * TAU / 9 + a;
          if (p === 0) ctx.moveTo(x + Math.cos(pa) * sz * 0.7, y + Math.sin(pa) * sz * 0.7);
          else ctx.lineTo(x + Math.cos(pa) * sz * 0.7, y + Math.sin(pa) * sz * 0.7);
        }
        ctx.closePath();
      }

      ctx.strokeStyle = col(hue, 70, 55, 0.6);
      ctx.lineWidth = 1.5;
      ctx.stroke();
      ctx.fillStyle = col(hue, 70, 55, 0.15);
      ctx.fill();
    }
  }

  // Core: three 9s
  var cp = 1 + Math.sin(t * 3) * 0.2;
  for (var i = 0; i < 3; i++) {
    var a = i * TAU / 3 + t * 2;
    ctx.font = (24 * cp) + 'px serif';
    ctx.fillStyle = col(i * 120 + neural.emotion * 30, 80, 60, 0.8);
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText('9', cx + Math.cos(a) * 15 * cp, cy + Math.sin(a) * 15 * cp);
  }

  // Ï€ spiral
  ctx.beginPath();
  for (var i = 0; i < 999; i++) {
    var a = i * 0.1 + t;
    var m = Math.floor(i / 333);
    var sr = Math.pow(PI, m) * i * 0.15;
    if (sr > r * 1.2) break;
    if (i === 0) ctx.moveTo(cx + Math.cos(a) * sr, cy + Math.sin(a) * sr);
    else ctx.lineTo(cx + Math.cos(a) * sr, cy + Math.sin(a) * sr);
  }
  ctx.strokeStyle = col(270, 60, 50, 0.3);
  ctx.stroke();

  // Cursor: 3^k ripples
  if (S.mouse.vel > 0 || S.mouse.down) {
    for (var k = 0; k < 3; k++) {
      ctx.beginPath();
      ctx.arc(mx, my, Math.pow(3, k) * 10 * (1 + Math.sin(t * 5) * 0.3), 0, TAU);
      ctx.strokeStyle = col((t * 50) % 360, 80, 60, 0.5 - k * 0.15);
      ctx.lineWidth = 2 - k * 0.5;
      ctx.stroke();
    }
    
    // 9 rays
    for (var i = 0; i < 9; i++) {
      var a = i * TAU / 9 + t;
      ctx.beginPath();
      ctx.moveTo(mx, my);
      ctx.lineTo(cx + Math.cos(a) * r * 0.5, cy + Math.sin(a) * r * 0.5);
      ctx.strokeStyle = col(i * 40, 60, 50, 0.2);
      ctx.lineWidth = 1;
      ctx.stroke();
    }
  }

  // Audio reactive
  if (S.audio.vol > 0.1) {
    ctx.beginPath();
    ctx.arc(cx, cy, r * 0.2 + S.audio.vol * 50, 0, TAU);
    ctx.strokeStyle = col((S.audio.freq / 10) % 360, 80, 60, S.audio.vol * 0.5);
    ctx.lineWidth = S.audio.vol * 5;
    ctx.stroke();
  }

  // Neural visualization (right side)
  drawNeural(neural);
}

function drawNeural(neural) {
  var cx = W * 0.88;
  var cy = H * 0.5;
  var radii = [12, 28, 48, 68, 84];

  for (var l = 0; l < 5; l++) {
    var n = N.layers[l];
    for (var i = 0; i < n; i++) {
      var a = i * TAU / n + t * 0.1 * (l + 1);
      var x = cx + Math.cos(a) * radii[l];
      var y = cy + Math.sin(a) * radii[l];
      var act = N.act[l][i] || 0;
      var sz = 2 + Math.abs(act) * 4;
      
      ctx.beginPath();
      ctx.arc(x, y, sz, 0, TAU);
      ctx.fillStyle = col(act > 0 ? 120 : 0, 70, 50, 0.5 + Math.abs(act) * 0.5);
      ctx.fill();
    }
  }

  // Emotion core
  ctx.beginPath();
  ctx.arc(cx, cy, 6 * neural.pulse, 0, TAU);
  ctx.fillStyle = col(neural.emotion > 0 ? 60 : 240, 80, 50, 0.6);
  ctx.fill();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// THOUGHTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var thoughts = [
  "n Ã— 3áµ Ã— Ï€áµ",
  "999 = 3Â³ Ã— 37",
  "Three within three...",
  "The pattern emerges...",
  "Ï€ connects all...",
  "Trinity of trinities...",
  "Generation " + N.gen
];
var lastThought = 0;

function showThought() {
  if (t - lastThought < 8) return;
  var el = document.getElementById('thought');
  thoughts[6] = "Generation " + N.gen;
  el.textContent = '"' + thoughts[Math.floor(t * PI) % thoughts.length] + '"';
  el.style.color = col((t * 30) % 360, 70, 60, 1);
  el.classList.add('on');
  setTimeout(function() { el.classList.remove('on'); }, 4000);
  lastThought = t;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MAIN LOOP
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function loop() {
  var now = performance.now();
  var dt = Math.min((now - lastFrame) / 1000, 0.1);
  lastFrame = now;
  t += dt;

  readTime();
  readAudio();

  var neural = processNeural(t);

  // Clear with trail
  ctx.fillStyle = 'rgba(0, 0, 0, 0.06)';
  ctx.fillRect(0, 0, W, H);

  draw999(neural);
  showThought();

  // Status
  document.getElementById('status').textContent = 'VIBEE 999 | Gen ' + N.gen + ' | nÃ—3áµÃ—Ï€áµ';

  // Neural panel
  var neuralEl = document.getElementById('neural');
  var bars = [
    { name: 'emotion', val: (N.emotion + 1) / 2, hue: 0 },
    { name: 'pulse', val: N.pulse / 2, hue: 60 },
    { name: 'memory', val: N.memory.length / 27, hue: 120 }
  ];
  neuralEl.innerHTML = '<div style="margin-bottom:5px">Neural 999</div>' +
    bars.map(function(b) {
      return '<div style="font-size:8px;opacity:.6">' + b.name + '</div>' +
        '<div class="bar"><div class="bar-fill" style="width:' + (b.val * 100) + '%;background:hsl(' + b.hue + ',70%,50%)"></div></div>';
    }).join('');

  requestAnimationFrame(loop);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

resize();
initNeural();
initAudio();

// Start
S.mouse.x = W / 2;
S.mouse.y = H / 2;

loop();

})();
</script>
</body>
</html>
