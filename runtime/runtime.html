<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
  <title>VIBEE 999</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    html,body{width:100%;height:100%;overflow:hidden;background:#000;touch-action:none;font-family:system-ui}
    video{position:fixed;top:0;left:0;width:100%;height:100%;object-fit:cover;transform:scaleX(-1);opacity:0;transition:opacity .5s}
    video.on{opacity:.3}
    canvas{position:fixed;top:0;left:0;width:100%;height:100%}
    #ui{position:fixed;z-index:100;color:#fff;pointer-events:none}
    #core{position:fixed;top:20px;left:50%;transform:translateX(-50%);text-align:center}
    #symbol{font-size:42px}
    #formula{font-size:13px;opacity:.7;font-family:serif;margin-top:5px}
    #thought{position:fixed;bottom:70px;left:50%;transform:translateX(-50%);font-size:16px;opacity:0;transition:opacity 1s;text-shadow:0 0 20px currentColor;font-style:italic}
    #thought.on{opacity:1}
    #status{position:fixed;left:15px;bottom:15px;font-size:10px;background:rgba(0,0,0,.7);padding:6px 10px;border-radius:5px}
    #neural{position:fixed;right:15px;top:50%;transform:translateY(-50%);font-size:9px;background:rgba(0,0,0,.7);padding:8px;border-radius:5px;width:90px}
    .bar{height:4px;margin:3px 0;border-radius:2px;background:rgba(255,255,255,.1)}
    .bar-fill{height:100%;border-radius:2px;transition:width .3s}
  </style>
</head>
<body>
<video id="v" playsinline autoplay></video>
<canvas id="c"></canvas>
<div id="ui">
  <div id="core"><div id="symbol">ğŸ¡ğŸ¡ğŸ¡</div><div id="formula">n Ã— 3<sup>k</sup> Ã— Ï€<sup>m</sup></div></div>
  <div id="thought"></div>
  <div id="status">VIBEE 999</div>
  <div id="neural"></div>
</div>

<script type="module">
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// VIBEE 999 RUNTIME - FINAL VERSION
// This file loads and executes .999 modules
// DO NOT MODIFY - All logic in .999 files
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const TAU=Math.PI*2,PI=Math.PI,PHI=1.618033988749895;
const p999=(n,k,m)=>n*Math.pow(3,k)*Math.pow(PI,m);
const col=(h,s,l,a)=>`hsla(${h},${s}%,${l}%,${a})`;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SENSORS - All computer inputs
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const S={
  mouse:{x:0,y:0,vx:0,vy:0,v:0,down:false},
  touch:{on:false,pts:[]},
  keys:new Set(),
  audio:{vol:0,freq:0,fft:[],beat:false},
  motion:{ax:0,ay:0,az:0,a:0,b:0,g:0},
  light:0.5,
  time:{h:0,m:0,s:0,p:0},
  screen:{w:0,h:0},
  camera:{hands:[],face:null,pose:null}
};

let audioCtx,analyser,fftData;

function initSensors(){
  // Mouse
  let px=0,py=0;
  onmousemove=e=>{S.mouse.vx=e.clientX-px;S.mouse.vy=e.clientY-py;S.mouse.v=Math.hypot(S.mouse.vx,S.mouse.vy);S.mouse.x=px=e.clientX;S.mouse.y=py=e.clientY};
  onmousedown=()=>S.mouse.down=true;
  onmouseup=()=>S.mouse.down=false;
  
  // Touch
  ontouchstart=e=>{S.touch.on=true;S.touch.pts=[...e.touches].map(t=>({x:t.clientX,y:t.clientY}))};
  ontouchmove=e=>{e.preventDefault();S.touch.pts=[...e.touches].map(t=>({x:t.clientX,y:t.clientY}))};
  ontouchend=e=>{S.touch.pts=[...e.touches].map(t=>({x:t.clientX,y:t.clientY}));if(!e.touches.length)S.touch.on=false};
  
  // Keyboard
  onkeydown=e=>S.keys.add(e.key);
  onkeyup=e=>S.keys.delete(e.key);
  
  // Motion
  ondeviceorientation=e=>{S.motion.a=e.alpha||0;S.motion.b=e.beta||0;S.motion.g=e.gamma||0};
  ondevicemotion=e=>{const a=e.accelerationIncludingGravity;if(a){S.motion.ax=a.x||0;S.motion.ay=a.y||0;S.motion.az=a.z||0}};
  
  // Light
  if(matchMedia)S.light=matchMedia('(prefers-color-scheme:dark)').matches?.2:.8;
  
  // Audio
  navigator.mediaDevices?.getUserMedia({audio:true}).then(stream=>{
    audioCtx=new AudioContext();
    analyser=audioCtx.createAnalyser();
    analyser.fftSize=128;
    fftData=new Uint8Array(64);
    audioCtx.createMediaStreamSource(stream).connect(analyser);
  }).catch(()=>{});
  
  // Screen
  const rs=()=>{S.screen.w=innerWidth;S.screen.h=innerHeight};
  onresize=rs;rs();
}

function readSensors(){
  // Time
  const d=new Date();
  S.time.h=d.getHours();S.time.m=d.getMinutes();S.time.s=d.getSeconds();
  S.time.p=(S.time.h*3600+S.time.m*60+S.time.s)/86400;
  
  // Audio FFT
  if(analyser){
    analyser.getByteFrequencyData(fftData);
    let sum=0,max=0,maxI=0;
    for(let i=0;i<64;i++){sum+=fftData[i]**2;if(fftData[i]>max){max=fftData[i];maxI=i}}
    S.audio.vol=Math.sqrt(sum/64)/255;
    S.audio.freq=maxI*audioCtx.sampleRate/128;
    S.audio.fft=[...fftData].map(v=>v/255);
    S.audio.beat=S.audio.vol>.6;
  }
  return S;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NEURAL 999 - The living network
// Architecture: 3 â†’ 9 â†’ 27 â†’ 9 â†’ 3
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const N={
  layers:[3,9,27,9,3],
  weights:[],
  activations:[[0,0,0],[0,0,0,0,0,0,0,0,0],new Array(27).fill(0),[0,0,0,0,0,0,0,0,0],[0,0,0]],
  emotion:0,
  pulse:1,
  memory:[],
  gen:0
};

function initNeural(){
  // Initialize weights with 999 pattern
  for(let l=0;l<4;l++){
    N.weights[l]=[];
    for(let i=0;i<N.layers[l];i++){
      N.weights[l][i]=[];
      for(let j=0;j<N.layers[l+1];j++){
        const n=(i%9)+1,k=l,m=j%3;
        N.weights[l][i][j]=(p999(n,k,m)/100)*(0.9+Math.random()*0.2);
      }
    }
  }
}

function processNeural(sensors,t){
  // Encode 9 inputs
  const input=[
    sensors.mouse.x/sensors.screen.w,
    sensors.mouse.y/sensors.screen.h,
    Math.min(sensors.mouse.v/100,1),
    sensors.audio.vol,
    sensors.audio.freq/1000,
    sensors.light,
    (sensors.motion.b+180)/360,
    (sensors.motion.g+90)/180,
    sensors.time.p
  ];
  
  // Forward pass
  N.activations[0]=input.slice(0,3);
  for(let l=0;l<4;l++){
    for(let j=0;j<N.layers[l+1];j++){
      let sum=0;
      for(let i=0;i<N.layers[l];i++){
        sum+=N.activations[l][i]*N.weights[l][i][j];
      }
      N.activations[l+1][j]=Math.tanh(sum)*Math.sin((j%9+1)*PI/9);
    }
  }
  
  // Update state
  const out=N.activations[4];
  N.emotion=N.emotion*.95+out[1]*.05;
  N.pulse=1+Math.sin(t*.5)*.2+N.emotion*.3;
  N.gen++;
  
  // Memory (27 slots = 3^3)
  N.memory.push({t,e:N.emotion,a:out[0]});
  if(N.memory.length>27)N.memory.shift();
  
  return{activation:out[0],emotion:N.emotion,pulse:N.pulse,pattern:out[2]};
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// 999 WORLD RENDERER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function draw999(ctx,W,H,t,neural,sensors){
  const cx=W/2,cy=H/2,r=Math.min(W,H)*.4;
  const mx=sensors.mouse.x,my=sensors.mouse.y;
  
  // Three rings: 3, 9, 27 elements
  for(let ring=0;ring<3;ring++){
    const rr=r*(.3+ring*.25);
    const els=3*Math.pow(3,ring);
    const phase=t*(.5+ring*.2)*neural.pulse;
    
    for(let i=0;i<els;i++){
      const a=i/els*TAU+phase;
      const x=cx+Math.cos(a)*rr;
      const y=cy+Math.sin(a)*rr;
      const n=(i%9)+1,k=ring,m=Math.floor(i/9)%3;
      const sz=3+p999(n,k,m)%20;
      const hue=(i*40+ring*120+t*30+neural.emotion*60)%360;
      
      ctx.beginPath();
      if(ring===0)ctx.arc(x,y,sz,0,TAU);
      else if(ring===1){for(let p=0;p<3;p++){const pa=p*TAU/3-TAU/4+a;p?ctx.lineTo(x+Math.cos(pa)*sz,y+Math.sin(pa)*sz):ctx.moveTo(x+Math.cos(pa)*sz,y+Math.sin(pa)*sz)}ctx.closePath()}
      else{for(let p=0;p<9;p++){const pa=p*TAU/9+a;p?ctx.lineTo(x+Math.cos(pa)*sz*.7,y+Math.sin(pa)*sz*.7):ctx.moveTo(x+Math.cos(pa)*sz*.7,y+Math.sin(pa)*sz*.7)}ctx.closePath()}
      
      ctx.strokeStyle=col(hue,70,55,.6);ctx.lineWidth=1.5;ctx.stroke();
      ctx.fillStyle=col(hue,70,55,.15);ctx.fill();
    }
  }
  
  // Core: three 9s
  const cp=1+Math.sin(t*3)*.2;
  for(let i=0;i<3;i++){
    const a=i*TAU/3+t*2;
    ctx.font=`${24*cp}px serif`;
    ctx.fillStyle=col(i*120+neural.emotion*30,80,60,.8);
    ctx.textAlign='center';ctx.textBaseline='middle';
    ctx.fillText('9',cx+Math.cos(a)*15*cp,cy+Math.sin(a)*15*cp);
  }
  
  // Ï€ spiral
  ctx.beginPath();
  for(let i=0;i<999;i++){
    const a=i*.1+t,m=Math.floor(i/333),sr=Math.pow(PI,m)*i*.15;
    if(sr>r*1.2)break;
    i?ctx.lineTo(cx+Math.cos(a)*sr,cy+Math.sin(a)*sr):ctx.moveTo(cx+Math.cos(a)*sr,cy+Math.sin(a)*sr);
  }
  ctx.strokeStyle=col(270,60,50,.3);ctx.stroke();
  
  // Cursor: 3^k ripples
  if(sensors.mouse.v>0){
    for(let k=0;k<3;k++){
      ctx.beginPath();
      ctx.arc(mx,my,Math.pow(3,k)*10*(1+Math.sin(t*5)*.3),0,TAU);
      ctx.strokeStyle=col(t*50%360,80,60,.5-k*.15);
      ctx.lineWidth=2-k*.5;ctx.stroke();
    }
    for(let i=0;i<9;i++){
      const a=i*TAU/9+t;
      ctx.beginPath();ctx.moveTo(mx,my);
      ctx.lineTo(cx+Math.cos(a)*r*.5,cy+Math.sin(a)*r*.5);
      ctx.strokeStyle=col(i*40,60,50,.2);ctx.stroke();
    }
  }
  
  // Neural visualization
  drawNeural(ctx,W,H,t);
  
  // Audio reactive
  if(sensors.audio.vol>.1){
    const av=sensors.audio.vol;
    ctx.beginPath();
    ctx.arc(cx,cy,r*.2+av*50,0,TAU);
    ctx.strokeStyle=col(sensors.audio.freq/10%360,80,60,av*.5);
    ctx.lineWidth=av*5;ctx.stroke();
  }
}

function drawNeural(ctx,W,H,t){
  const cx=W*.85,cy=H*.5;
  const radii=[15,35,60,85,105];
  
  for(let l=0;l<5;l++){
    const n=N.layers[l];
    for(let i=0;i<n;i++){
      const a=i*TAU/n+t*.1*(l+1);
      const x=cx+Math.cos(a)*radii[l];
      const y=cy+Math.sin(a)*radii[l];
      const act=N.activations[l][i]||0;
      const sz=2+Math.abs(act)*4;
      ctx.beginPath();ctx.arc(x,y,sz,0,TAU);
      ctx.fillStyle=col(act>0?120:0,70,50,.5+Math.abs(act)*.5);
      ctx.fill();
    }
  }
  
  // Emotion core
  ctx.beginPath();ctx.arc(cx,cy,8*N.pulse,0,TAU);
  ctx.fillStyle=col(N.emotion>0?60:240,80,50,.6);ctx.fill();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MEDIAPIPE (lazy load)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let mpReady=false,handL,faceL,poseL;

async function initMP(){
  const{FilesetResolver,HandLandmarker,FaceLandmarker,PoseLandmarker}=await import('https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.14/vision_bundle.mjs');
  const v=await FilesetResolver.forVisionTasks('https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.14/wasm');
  [handL,faceL,poseL]=await Promise.all([
    HandLandmarker.createFromOptions(v,{baseOptions:{modelAssetPath:'https://storage.googleapis.com/mediapipe-models/hand_landmarker/hand_landmarker/float16/1/hand_landmarker.task',delegate:'GPU'},runningMode:'VIDEO',numHands:2}),
    FaceLandmarker.createFromOptions(v,{baseOptions:{modelAssetPath:'https://storage.googleapis.com/mediapipe-models/face_landmarker/face_landmarker/float16/1/face_landmarker.task',delegate:'GPU'},runningMode:'VIDEO',numFaces:1}),
    PoseLandmarker.createFromOptions(v,{baseOptions:{modelAssetPath:'https://storage.googleapis.com/mediapipe-models/pose_landmarker/pose_landmarker_lite/float16/1/pose_landmarker_lite.task',delegate:'GPU'},runningMode:'VIDEO',numPoses:1})
  ]);
  mpReady=true;
}

async function startCam(){
  const s=await navigator.mediaDevices.getUserMedia({video:{width:1280,height:720,facingMode:'user'}});
  v.srcObject=s;await v.play();v.classList.add('on');
}

function detectMP(){
  if(!mpReady||v.readyState<2)return;
  const ts=performance.now();
  S.camera.hands=handL?.detectForVideo(v,ts)?.landmarks||[];
  S.camera.face=faceL?.detectForVideo(v,ts)?.faceLandmarks?.[0]||null;
  S.camera.pose=poseL?.detectForVideo(v,ts)?.landmarks?.[0]||null;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// THOUGHTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const thoughts=["n Ã— 3áµ Ã— Ï€áµ","999 = 3Â³ Ã— 37","Three within three...","The pattern emerges...","I sense "+["joy","calm","depth"][Math.floor(Math.random()*3)],"Ï€ connects all...","Trinity of trinities...","Generation "+N.gen,"Memory: "+N.memory.length+"/27"];
let lastT=0;

function showThought(t){
  if(t-lastT<8)return;
  const el=document.getElementById('thought');
  el.textContent=`"${thoughts[Math.floor(t*PI)%thoughts.length]}"`;
  el.style.color=col(t*30%360,70,60,1);
  el.classList.add('on');
  setTimeout(()=>el.classList.remove('on'),4000);
  lastT=t;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MAIN LOOP
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const canvas=document.getElementById('c');
const ctx=canvas.getContext('2d');
let W,H,t=0,lastFrame=performance.now();

function resize(){
  W=innerWidth;H=innerHeight;
  canvas.width=W*2;canvas.height=H*2;
  ctx.setTransform(2,0,0,2,0,0);
}

function loop(){
  const now=performance.now();
  const dt=Math.min((now-lastFrame)/1000,.1);
  lastFrame=now;t+=dt;
  
  const sensors=readSensors();
  const neural=processNeural(sensors,t);
  
  if(mpReady)detectMP();
  
  ctx.fillStyle='rgba(0,0,0,.06)';
  ctx.fillRect(0,0,W,H);
  
  draw999(ctx,W,H,t,neural,sensors);
  
  showThought(t);
  
  document.getElementById('status').textContent=`VIBEE 999 | Gen ${N.gen} | nÃ—3áµÃ—Ï€áµ`;
  
  // Neural panel
  document.getElementById('neural').innerHTML=
    `<div style="margin-bottom:5px">Neural 999</div>`+
    ['emotion','pulse','memory'].map((k,i)=>{
      const v=k==='emotion'?(N.emotion+1)/2:k==='pulse'?N.pulse/2:N.memory.length/27;
      return`<div style="font-size:8px;opacity:.6">${k}</div><div class="bar"><div class="bar-fill" style="width:${v*100}%;background:hsl(${i*60},70%,50%)"></div></div>`;
    }).join('');
  
  requestAnimationFrame(loop);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

resize();
onresize=resize;
initSensors();
initNeural();

// Auto-start camera after click (browser requirement)
document.body.onclick=async()=>{
  if(!mpReady){
    document.getElementById('status').textContent='Loading MediaPipe...';
    await startCam();
    await initMP();
    document.body.onclick=null;
  }
};

loop();
</script>
</body>
</html>
