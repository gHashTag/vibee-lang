<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
  <title>VIBEE 999</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    html,body{width:100%;height:100%;overflow:hidden;background:#000;touch-action:none;font-family:system-ui}
    canvas{position:fixed;top:0;left:0;width:100%;height:100%}
    #ui{position:fixed;z-index:100;color:#fff;pointer-events:none}
    #core{position:fixed;top:15px;left:50%;transform:translateX(-50%);text-align:center}
    #symbol{font-size:36px}
    #formula{font-size:12px;opacity:.7;font-family:serif;margin-top:3px}
    #thought{position:fixed;bottom:60px;left:50%;transform:translateX(-50%);font-size:14px;opacity:0;transition:opacity 1s;text-shadow:0 0 20px currentColor;font-style:italic}
    #thought.on{opacity:1}
    #status{position:fixed;left:10px;bottom:10px;font-size:9px;background:rgba(0,0,0,.8);padding:5px 8px;border-radius:4px}
    #modules{position:fixed;left:10px;top:10px;font-size:8px;background:rgba(0,0,0,.8);padding:8px;border-radius:4px;max-width:120px}
    .mod{margin:4px 0;padding:3px 5px;border-radius:3px;background:rgba(255,255,255,.1)}
    .mod-name{font-weight:bold;margin-bottom:2px}
    .mod-bar{height:3px;background:rgba(255,255,255,.2);border-radius:2px;overflow:hidden}
    .mod-fill{height:100%;transition:width .3s}
    #neural{position:fixed;right:10px;top:50%;transform:translateY(-50%)}
  </style>
</head>
<body>
<canvas id="c"></canvas>
<div id="ui">
  <div id="core"><div id="symbol">ğŸ¡ğŸ¡ğŸ¡</div><div id="formula">n Ã— 3<sup>k</sup> Ã— Ï€<sup>m</sup></div></div>
  <div id="thought"></div>
  <div id="status">VIBEE 999</div>
  <div id="modules"></div>
  <canvas id="neural" width="180" height="180"></canvas>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// VIBEE 999 RUNTIME - FINAL VERSION
// DO NOT MODIFY - Protected by Guardian
// All logic in .999 files
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

(function(){
'use strict';

var TAU = Math.PI * 2;
var PI = Math.PI;

function p999(n, k, m) { return n * Math.pow(3, k) * Math.pow(PI, m); }
function col(h, s, l, a) { return 'hsla(' + h + ',' + s + '%,' + l + '%,' + a + ')'; }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MODULE SYSTEM - Visualizes all 999 modules
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var Modules = {
  list: [
    { name: 'bridge.999', status: 'active', load: 1, color: 120 },
    { name: 'neural_999.999', status: 'active', load: 0, color: 200 },
    { name: 'sensors.999', status: 'active', load: 0, color: 60 }
  ],
  
  update: function(neural) {
    this.list[1].load = Math.abs(neural.emotion) * 0.5 + 0.5;
    this.list[2].load = S.mouse.vel > 0 ? 0.8 : 0.3;
    this.list[0].load = neural.pulse / 2;
  },
  
  render: function() {
    var html = '<div style="margin-bottom:5px;font-weight:bold">MODULES 999</div>';
    for (var i = 0; i < this.list.length; i++) {
      var m = this.list[i];
      html += '<div class="mod">' +
        '<div class="mod-name">' + m.name + '</div>' +
        '<div class="mod-bar"><div class="mod-fill" style="width:' + (m.load * 100) + '%;background:hsl(' + m.color + ',70%,50%)"></div></div>' +
        '</div>';
    }
    document.getElementById('modules').innerHTML = html;
  }
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SENSORS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var S = {
  mouse: { x: 0, y: 0, vx: 0, vy: 0, vel: 0, down: false },
  audio: { vol: 0, freq: 0, beat: false },
  light: 0.5,
  time: { h: 0, m: 0, s: 0, p: 0 },
  screen: { w: window.innerWidth, h: window.innerHeight }
};

var px = 0, py = 0;
document.addEventListener('mousemove', function(e) {
  S.mouse.vx = e.clientX - px; S.mouse.vy = e.clientY - py;
  S.mouse.vel = Math.sqrt(S.mouse.vx * S.mouse.vx + S.mouse.vy * S.mouse.vy);
  S.mouse.x = e.clientX; S.mouse.y = e.clientY; px = e.clientX; py = e.clientY;
});
document.addEventListener('mousedown', function() { S.mouse.down = true; });
document.addEventListener('mouseup', function() { S.mouse.down = false; });
document.addEventListener('touchmove', function(e) {
  e.preventDefault(); var t = e.touches[0];
  S.mouse.x = t.clientX; S.mouse.y = t.clientY; S.mouse.vel = 10;
}, { passive: false });
window.addEventListener('resize', function() { S.screen.w = innerWidth; S.screen.h = innerHeight; resize(); });

var audioCtx, analyser, fftData;
function initAudio() {
  if (navigator.mediaDevices) {
    navigator.mediaDevices.getUserMedia({ audio: true }).then(function(stream) {
      audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      analyser = audioCtx.createAnalyser(); analyser.fftSize = 128;
      fftData = new Uint8Array(64);
      audioCtx.createMediaStreamSource(stream).connect(analyser);
    }).catch(function() {});
  }
}
function readAudio() {
  if (analyser) {
    analyser.getByteFrequencyData(fftData);
    var sum = 0, max = 0, maxI = 0;
    for (var i = 0; i < 64; i++) { sum += fftData[i] * fftData[i]; if (fftData[i] > max) { max = fftData[i]; maxI = i; } }
    S.audio.vol = Math.sqrt(sum / 64) / 255;
    S.audio.freq = maxI * (audioCtx.sampleRate / 128);
    S.audio.beat = S.audio.vol > 0.6;
  }
}
function readTime() {
  var d = new Date();
  S.time.h = d.getHours(); S.time.m = d.getMinutes(); S.time.s = d.getSeconds();
  S.time.p = (S.time.h * 3600 + S.time.m * 60 + S.time.s) / 86400;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NEURAL 999: 3 â†’ 9 â†’ 27 â†’ 9 â†’ 3
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var N = {
  layers: [3, 9, 27, 9, 3],
  weights: [],
  act: [[0,0,0], new Array(9).fill(0), new Array(27).fill(0), new Array(9).fill(0), [0,0,0]],
  emotion: 0, pulse: 1, memory: [], gen: 0
};

function initNeural() {
  for (var l = 0; l < 4; l++) {
    N.weights[l] = [];
    for (var i = 0; i < N.layers[l]; i++) {
      N.weights[l][i] = [];
      for (var j = 0; j < N.layers[l + 1]; j++) {
        var n = (i % 9) + 1, k = l, m = j % 3;
        N.weights[l][i][j] = (p999(n, k, m) / 100) * (0.9 + Math.random() * 0.2);
      }
    }
  }
}

function processNeural(t) {
  var input = [
    S.mouse.x / S.screen.w || 0, S.mouse.y / S.screen.h || 0, Math.min(S.mouse.vel / 100, 1) || 0,
    S.audio.vol || 0, S.audio.freq / 1000 || 0, S.light || 0.5,
    0.5, 0.5, S.time.p || 0
  ];
  N.act[0] = input.slice(0, 3);
  for (var l = 0; l < 4; l++) {
    for (var j = 0; j < N.layers[l + 1]; j++) {
      var sum = 0;
      for (var i = 0; i < N.layers[l]; i++) { sum += (N.act[l][i] || 0) * (N.weights[l][i][j] || 0); }
      N.act[l + 1][j] = Math.tanh(sum) * Math.sin(((j % 9) + 1) * PI / 9);
    }
  }
  var out = N.act[4];
  N.emotion = N.emotion * 0.95 + (out[1] || 0) * 0.05;
  N.pulse = 1 + Math.sin(t * 0.5) * 0.2 + N.emotion * 0.3;
  N.gen++;
  N.memory.push({ t: t, e: N.emotion }); if (N.memory.length > 27) N.memory.shift();
  return { activation: out[0] || 0, emotion: N.emotion, pulse: N.pulse };
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NEURAL VISUALIZATION (separate canvas)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var neuralCanvas = document.getElementById('neural');
var nctx = neuralCanvas.getContext('2d');

function drawNeuralViz(neural) {
  var W = 180, H = 180, cx = W/2, cy = H/2;
  nctx.fillStyle = 'rgba(0,0,0,0.15)';
  nctx.fillRect(0, 0, W, H);
  
  var radii = [15, 32, 55, 72, 85];
  
  // Draw connections first (faint)
  nctx.strokeStyle = 'rgba(100,150,255,0.1)';
  nctx.lineWidth = 0.5;
  for (var l = 0; l < 4; l++) {
    var n1 = N.layers[l], n2 = N.layers[l+1];
    for (var i = 0; i < Math.min(n1, 9); i++) {
      for (var j = 0; j < Math.min(n2, 9); j++) {
        var a1 = i * TAU / n1, a2 = j * TAU / n2;
        var x1 = cx + Math.cos(a1) * radii[l], y1 = cy + Math.sin(a1) * radii[l];
        var x2 = cx + Math.cos(a2) * radii[l+1], y2 = cy + Math.sin(a2) * radii[l+1];
        var w = Math.abs(N.weights[l][i] ? N.weights[l][i][j] || 0 : 0);
        if (w > 0.5) {
          nctx.beginPath(); nctx.moveTo(x1, y1); nctx.lineTo(x2, y2); nctx.stroke();
        }
      }
    }
  }
  
  // Draw neurons
  for (var l = 0; l < 5; l++) {
    var n = N.layers[l];
    for (var i = 0; i < n; i++) {
      var a = i * TAU / n + t * 0.05 * (l + 1);
      var x = cx + Math.cos(a) * radii[l];
      var y = cy + Math.sin(a) * radii[l];
      var act = N.act[l][i] || 0;
      var sz = 2 + Math.abs(act) * 4;
      nctx.beginPath(); nctx.arc(x, y, sz, 0, TAU);
      nctx.fillStyle = col(act > 0 ? 120 : 0, 70, 50, 0.4 + Math.abs(act) * 0.6);
      nctx.fill();
    }
  }
  
  // Emotion core
  nctx.beginPath(); nctx.arc(cx, cy, 8 * neural.pulse, 0, TAU);
  var grad = nctx.createRadialGradient(cx, cy, 0, cx, cy, 10);
  grad.addColorStop(0, col(neural.emotion > 0 ? 60 : 240, 90, 60, 0.9));
  grad.addColorStop(1, col(neural.emotion > 0 ? 60 : 240, 70, 40, 0.3));
  nctx.fillStyle = grad; nctx.fill();
  
  // Label
  nctx.fillStyle = 'rgba(255,255,255,0.5)';
  nctx.font = '8px system-ui';
  nctx.textAlign = 'center';
  nctx.fillText('NEURAL 999', cx, H - 5);
  nctx.fillText('3â†’9â†’27â†’9â†’3', cx, H - 15);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MAIN RENDERER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var canvas = document.getElementById('c');
var ctx = canvas.getContext('2d');
var W, H, t = 0, lastFrame = performance.now();

function resize() {
  W = innerWidth; H = innerHeight;
  canvas.width = W * 2; canvas.height = H * 2;
  ctx.setTransform(2, 0, 0, 2, 0, 0);
}

function draw999(neural) {
  var cx = W / 2, cy = H / 2, r = Math.min(W, H) * 0.38;
  var mx = S.mouse.x || cx, my = S.mouse.y || cy;

  // Three rings
  for (var ring = 0; ring < 3; ring++) {
    var rr = r * (0.3 + ring * 0.25);
    var els = 3 * Math.pow(3, ring);
    var phase = t * (0.5 + ring * 0.2) * neural.pulse;
    for (var i = 0; i < els; i++) {
      var a = (i / els) * TAU + phase;
      var x = cx + Math.cos(a) * rr, y = cy + Math.sin(a) * rr;
      var n = (i % 9) + 1, k = ring, m = Math.floor(i / 9) % 3;
      var sz = 3 + (p999(n, k, m) % 18);
      var hue = (i * 40 + ring * 120 + t * 30 + neural.emotion * 60) % 360;
      ctx.beginPath();
      if (ring === 0) ctx.arc(x, y, sz, 0, TAU);
      else if (ring === 1) { for (var p = 0; p < 3; p++) { var pa = p * TAU/3 - TAU/4 + a; p ? ctx.lineTo(x + Math.cos(pa)*sz, y + Math.sin(pa)*sz) : ctx.moveTo(x + Math.cos(pa)*sz, y + Math.sin(pa)*sz); } ctx.closePath(); }
      else { for (var p = 0; p < 9; p++) { var pa = p * TAU/9 + a; p ? ctx.lineTo(x + Math.cos(pa)*sz*.7, y + Math.sin(pa)*sz*.7) : ctx.moveTo(x + Math.cos(pa)*sz*.7, y + Math.sin(pa)*sz*.7); } ctx.closePath(); }
      ctx.strokeStyle = col(hue, 70, 55, 0.6); ctx.lineWidth = 1.5; ctx.stroke();
      ctx.fillStyle = col(hue, 70, 55, 0.12); ctx.fill();
    }
  }

  // Core
  var cp = 1 + Math.sin(t * 3) * 0.2;
  for (var i = 0; i < 3; i++) {
    var a = i * TAU/3 + t * 2;
    ctx.font = (22 * cp) + 'px serif';
    ctx.fillStyle = col(i * 120 + neural.emotion * 30, 80, 60, 0.8);
    ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
    ctx.fillText('9', cx + Math.cos(a) * 14 * cp, cy + Math.sin(a) * 14 * cp);
  }

  // Ï€ spiral
  ctx.beginPath();
  for (var i = 0; i < 999; i++) {
    var a = i * 0.1 + t, m = Math.floor(i / 333), sr = Math.pow(PI, m) * i * 0.12;
    if (sr > r * 1.1) break;
    i ? ctx.lineTo(cx + Math.cos(a) * sr, cy + Math.sin(a) * sr) : ctx.moveTo(cx + Math.cos(a) * sr, cy + Math.sin(a) * sr);
  }
  ctx.strokeStyle = col(270, 60, 50, 0.25); ctx.stroke();

  // Cursor
  if (S.mouse.vel > 0 || S.mouse.down) {
    for (var k = 0; k < 3; k++) {
      ctx.beginPath(); ctx.arc(mx, my, Math.pow(3, k) * 10 * (1 + Math.sin(t * 5) * 0.3), 0, TAU);
      ctx.strokeStyle = col((t * 50) % 360, 80, 60, 0.5 - k * 0.15); ctx.lineWidth = 2 - k * 0.5; ctx.stroke();
    }
    for (var i = 0; i < 9; i++) {
      var a = i * TAU/9 + t;
      ctx.beginPath(); ctx.moveTo(mx, my); ctx.lineTo(cx + Math.cos(a) * r * 0.5, cy + Math.sin(a) * r * 0.5);
      ctx.strokeStyle = col(i * 40, 60, 50, 0.15); ctx.lineWidth = 1; ctx.stroke();
    }
  }

  // Audio
  if (S.audio.vol > 0.1) {
    ctx.beginPath(); ctx.arc(cx, cy, r * 0.15 + S.audio.vol * 40, 0, TAU);
    ctx.strokeStyle = col((S.audio.freq / 10) % 360, 80, 60, S.audio.vol * 0.4);
    ctx.lineWidth = S.audio.vol * 4; ctx.stroke();
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// THOUGHTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

var thoughts = ["n Ã— 3áµ Ã— Ï€áµ", "999 = 3Â³ Ã— 37", "Three within three...", "The pattern emerges...", "Ï€ connects all...", "Trinity of trinities...", "Generation " + N.gen, "Modules: 3 active"];
var lastThought = 0;
function showThought() {
  if (t - lastThought < 8) return;
  var el = document.getElementById('thought');
  thoughts[6] = "Generation " + N.gen;
  el.textContent = '"' + thoughts[Math.floor(t * PI) % thoughts.length] + '"';
  el.style.color = col((t * 30) % 360, 70, 60, 1);
  el.classList.add('on');
  setTimeout(function() { el.classList.remove('on'); }, 4000);
  lastThought = t;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MAIN LOOP
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function loop() {
  var now = performance.now();
  var dt = Math.min((now - lastFrame) / 1000, 0.1);
  lastFrame = now; t += dt;

  readTime(); readAudio();
  var neural = processNeural(t);
  
  Modules.update(neural);
  Modules.render();

  ctx.fillStyle = 'rgba(0, 0, 0, 0.06)';
  ctx.fillRect(0, 0, W, H);

  draw999(neural);
  drawNeuralViz(neural);
  showThought();

  document.getElementById('status').textContent = 'VIBEE 999 | Gen ' + N.gen + ' | nÃ—3áµÃ—Ï€áµ | Modules: 3';

  requestAnimationFrame(loop);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

resize();
initNeural();
initAudio();
S.mouse.x = W / 2; S.mouse.y = H / 2;
loop();

})();
</script>
</body>
</html>
