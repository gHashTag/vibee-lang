name: genome
version: "1.0.0"
language: zig
module: genome
description: |
  Геном физического закона
  
  Кодирует комбинацию фундаментальных констант:
  value = coefficient × ∏(constant[i]^power[i])
  
  12 констант: c, G, ℏ, kB, e, me, mp, mn, α, H₀, ε₀, μ₀

creation_pattern:
  source: RandomSeed
  transformer: generate_genome
  result: LawGenome
  iteration: single

behaviors:
  - name: compute_value
    given: Геном с набором степеней
    when: Вычисляется значение
    then: Результат - произведение констант в степенях
    test_cases:
      - name: speed_of_light
        input: {powers: [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], coefficient: 1.0}
        expected: {value: 299792458, tolerance: 1}
      - name: planck_constant
        input: {powers: [0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0], coefficient: 1.0}
        expected: {value: 1.055e-34, tolerance: 0.01}
      - name: fine_structure
        input: {powers: [0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0], coefficient: 1.0}
        expected: {value: 0.00729735, tolerance: 0.0001}

  - name: compute_dimension
    given: Геном физического закона
    when: Вычисляется размерность
    then: Размерность = сумма размерностей констант × степени
    test_cases:
      - name: mass_dimension
        input: {powers: [0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0]}
        expected: {M: 1, L: 0, T: 0, Q: 0, K: 0}
      - name: length_dimension
        input: {powers: [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]}
        expected: {M: 0, L: 1, T: -1, Q: 0, K: 0}
      - name: dimensionless
        input: {powers: [0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0]}
        expected: {M: 0, L: 0, T: 0, Q: 0, K: 0}

  - name: hubble_relation
    given: Комбинация ℏ²H₀/(cG·mₑ·mₚ²)
    when: Вычисляется
    then: Результат ≈ 0.48 ≈ 1/2
    test_cases:
      - name: hubble_value
        input: {powers: [-1, -1, 2, 0, 0, -1, -2, 0, 0, 1, 0, 0], coefficient: 1.0}
        expected: {value: 0.48, tolerance: 0.05}
      - name: hubble_dimensionless
        input: {powers: [-1, -1, 2, 0, 0, -1, -2, 0, 0, 1, 0, 0]}
        expected: {dimensionless: true}

  - name: complexity
    given: Геном
    when: Вычисляется сложность
    then: Сложность = число ненулевых степеней + сумма |степеней|
    test_cases:
      - name: simple
        input: {powers: [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]}
        expected: {complexity: 2}
      - name: complex
        input: {powers: [2, -1, 1, 0, 0, -1, -2, 0, 0, 1, 0, 0]}
        expected: {complexity: 14}

transformers:
  - name: compute_value
    type: pure
    input: LawGenome
    output: float
    rule: |
      value = genome.coefficient
      for i in 0..12:
        if powers[i] != 0:
          value *= pow(CONSTANTS[i].value, powers[i])
      if genome.sqrt_applied and value > 0:
        value = sqrt(value)
      return value

  - name: compute_dimension
    type: pure
    input: LawGenome
    output: Dimension
    rule: |
      dim = {M: 0, L: 0, T: 0, Q: 0, K: 0}
      for i in 0..12:
        p = powers[i]
        if p != 0:
          dim.M += p * CONSTANTS[i].dim.M
          dim.L += p * CONSTANTS[i].dim.L
          dim.T += p * CONSTANTS[i].dim.T
          dim.Q += p * CONSTANTS[i].dim.Q
          dim.K += p * CONSTANTS[i].dim.K
      return dim

  - name: is_dimensionless
    type: pure
    input: LawGenome
    output: bool
    rule: |
      dim = compute_dimension(genome)
      return dim.M == 0 and dim.L == 0 and dim.T == 0 and dim.Q == 0 and dim.K == 0

  - name: random_genome
    type: stochastic
    input: RandomState
    output: LawGenome
    rule: |
      genome = LawGenome.init()
      for i in 0..12:
        genome.powers[i] = random_int(-4, 4)
      genome.coefficient = random_choice([0.5, 1.0, 2.0, 3.0, 4.0])
      genome.sqrt_applied = random_bool()
      return genome

types:
  LawGenome:
    powers: [12]int8
    coefficient: float
    sqrt_applied: bool
    fitness: float
    generation: uint32
    mutations: uint32

  Dimension:
    M: int8
    L: int8
    T: int8
    Q: int8
    K: int8

  Constant:
    name: string
    symbol: string
    value: float
    dim: Dimension

constants:
  NUM_CONSTANTS: 12
  MAX_POWER: 4
  
  CONSTANTS:
    - {name: "speed_of_light", symbol: "c", value: 299792458, dim: {M: 0, L: 1, T: -1, Q: 0, K: 0}}
    - {name: "gravitational", symbol: "G", value: 6.67430e-11, dim: {M: -1, L: 3, T: -2, Q: 0, K: 0}}
    - {name: "planck", symbol: "ℏ", value: 1.054571817e-34, dim: {M: 1, L: 2, T: -1, Q: 0, K: 0}}
    - {name: "boltzmann", symbol: "kB", value: 1.380649e-23, dim: {M: 1, L: 2, T: -2, Q: 0, K: -1}}
    - {name: "electron_charge", symbol: "e", value: 1.602176634e-19, dim: {M: 0, L: 0, T: 1, Q: 1, K: 0}}
    - {name: "electron_mass", symbol: "me", value: 9.1093837015e-31, dim: {M: 1, L: 0, T: 0, Q: 0, K: 0}}
    - {name: "proton_mass", symbol: "mp", value: 1.67262192369e-27, dim: {M: 1, L: 0, T: 0, Q: 0, K: 0}}
    - {name: "neutron_mass", symbol: "mn", value: 1.67492749804e-27, dim: {M: 1, L: 0, T: 0, Q: 0, K: 0}}
    - {name: "fine_structure", symbol: "α", value: 7.2973525693e-3, dim: {M: 0, L: 0, T: 0, Q: 0, K: 0}}
    - {name: "hubble", symbol: "H₀", value: 2.2e-18, dim: {M: 0, L: 0, T: -1, Q: 0, K: 0}}
    - {name: "vacuum_permittivity", symbol: "ε₀", value: 8.8541878128e-12, dim: {M: -1, L: -3, T: 4, Q: 2, K: 0}}
    - {name: "vacuum_permeability", symbol: "μ₀", value: 1.25663706212e-6, dim: {M: 1, L: 1, T: -2, Q: -2, K: 0}}

functions:
  - name: init
    params: {}
    returns: LawGenome
    
  - name: random
    params: {rng: RandomState}
    returns: LawGenome
    
  - name: compute_value
    params: {genome: LawGenome}
    returns: float
    
  - name: compute_dimension
    params: {genome: LawGenome}
    returns: Dimension
    
  - name: is_dimensionless
    params: {genome: LawGenome}
    returns: bool
    
  - name: complexity
    params: {genome: LawGenome}
    returns: uint32
    
  - name: print_formula
    params: {genome: LawGenome}
    returns: void
    
  - name: clone
    params: {genome: LawGenome}
    returns: LawGenome
    
  - name: equals
    params: {a: LawGenome, b: LawGenome}
    returns: bool

test_generation:
  boundary: true
  property: true
  coverage: 95
