name: chemical_reactions
version: "1.0.0"
language: zig
module: chemistry
description: |
  Creation Pattern in Chemistry
  
  Source: Reactants (atoms, molecules)
  Transformer: Chemical Reaction (catalyst, energy, conditions)
  Result: Products (new molecules)
  
  Key Insight: All chemical reactions follow the Creation Pattern!
  
  Examples:
  - 2H₂ + O₂ → 2H₂O (combustion)
  - NaCl → Na⁺ + Cl⁻ (dissociation)
  - 6CO₂ + 6H₂O → C₆H₁₂O₆ + 6O₂ (photosynthesis)

creation_pattern:
  source: Reactants
  transformer: ChemicalReaction
  result: Products
  iteration: until_equilibrium
  condition: delta_G_equals_zero

# Chemical element types
types:
  Element:
    symbol: str
    atomic_number: int
    atomic_mass: float
    electronegativity: float
    
  Molecule:
    formula: str
    elements: [ElementCount]
    molar_mass: float
    charge: int
    
  ElementCount:
    element: Element
    count: int
    
  Reaction:
    reactants: [MoleculeCount]
    products: [MoleculeCount]
    catalyst: str?
    delta_h: float  # Enthalpy change (kJ/mol)
    delta_g: float  # Gibbs free energy
    activation_energy: float
    
  MoleculeCount:
    molecule: Molecule
    coefficient: int
    
  ReactionResult:
    products: [MoleculeCount]
    energy_released: float
    is_spontaneous: bool
    equilibrium_constant: float

# Transformer types for chemistry
transformers:
  - name: combustion
    type: mapping
    input: [Fuel, Oxygen]
    output: [CarbonDioxide, Water]
    rule: "CₓHᵧ + O₂ → CO₂ + H₂O + energy"
    
  - name: synthesis
    type: mapping
    input: [ElementA, ElementB]
    output: Compound
    rule: "A + B → AB"
    
  - name: decomposition
    type: pure
    input: Compound
    output: [Elements]
    rule: "AB → A + B"
    
  - name: single_replacement
    type: mapping
    input: [ElementA, CompoundBC]
    output: [CompoundAC, ElementB]
    rule: "A + BC → AC + B (if A more reactive)"
    
  - name: double_replacement
    type: mapping
    input: [CompoundAB, CompoundCD]
    output: [CompoundAD, CompoundCB]
    rule: "AB + CD → AD + CB"
    
  - name: oxidation_reduction
    type: mapping
    input: [Oxidizer, Reducer]
    output: [OxidizedProduct, ReducedProduct]
    rule: "Transfer of electrons"

behaviors:
  # Water formation (combustion of hydrogen)
  - name: water_synthesis
    given: Hydrogen gas (H₂) and Oxygen gas (O₂)
    when: Combustion reaction occurs with spark
    then: Water (H₂O) is formed with energy release
    test_cases:
      - name: stoichiometric
        input: {h2_moles: 2.0, o2_moles: 1.0}
        expected: {h2o_moles: 2.0, energy_kj: 572.0}
      - name: excess_hydrogen
        input: {h2_moles: 4.0, o2_moles: 1.0}
        expected: {h2o_moles: 2.0, h2_remaining: 2.0}
      - name: excess_oxygen
        input: {h2_moles: 2.0, o2_moles: 2.0}
        expected: {h2o_moles: 2.0, o2_remaining: 1.0}

  # Salt dissociation
  - name: nacl_dissociation
    given: Sodium chloride (NaCl) in water
    when: Dissolution occurs
    then: Na⁺ and Cl⁻ ions are formed
    test_cases:
      - name: complete_dissociation
        input: {nacl_moles: 1.0, water_liters: 1.0}
        expected: {na_plus_moles: 1.0, cl_minus_moles: 1.0}
      - name: concentration
        input: {nacl_grams: 58.44, water_liters: 1.0}
        expected: {molarity: 1.0}

  # Photosynthesis
  - name: photosynthesis
    given: Carbon dioxide (CO₂) and Water (H₂O) with sunlight
    when: Photosynthesis occurs in chloroplasts
    then: Glucose (C₆H₁₂O₆) and Oxygen (O₂) are produced
    test_cases:
      - name: balanced_equation
        input: {co2_moles: 6.0, h2o_moles: 6.0, light_energy: true}
        expected: {glucose_moles: 1.0, o2_moles: 6.0}
      - name: energy_stored
        input: {co2_moles: 6.0, h2o_moles: 6.0}
        expected: {energy_stored_kj: 2870.0}

  # Acid-base neutralization
  - name: acid_base_neutralization
    given: Hydrochloric acid (HCl) and Sodium hydroxide (NaOH)
    when: Neutralization reaction occurs
    then: Salt (NaCl) and Water (H₂O) are formed
    test_cases:
      - name: stoichiometric_neutralization
        input: {hcl_moles: 1.0, naoh_moles: 1.0}
        expected: {nacl_moles: 1.0, h2o_moles: 1.0, ph: 7.0}
      - name: excess_acid
        input: {hcl_moles: 2.0, naoh_moles: 1.0}
        expected: {nacl_moles: 1.0, h2o_moles: 1.0, ph_less_than: 7.0}

  # Electrochemistry - Battery
  - name: battery_discharge
    given: Zinc anode and Copper cathode in electrolyte
    when: Circuit is closed
    then: Electrons flow from Zn to Cu, producing current
    test_cases:
      - name: daniell_cell
        input: {zn_electrode: true, cu_electrode: true}
        expected: {voltage: 1.1, zn_oxidized: true, cu_reduced: true}

  # Equilibrium
  - name: chemical_equilibrium
    given: Reversible reaction A + B ⇌ C + D
    when: System reaches equilibrium
    then: Forward and reverse rates are equal
    test_cases:
      - name: le_chatelier_pressure
        input: {initial_a: 1.0, initial_b: 1.0, pressure_increase: true}
        expected: {shift_direction: "toward_fewer_moles"}
      - name: le_chatelier_temperature
        input: {initial_a: 1.0, initial_b: 1.0, temp_increase: true, is_exothermic: true}
        expected: {shift_direction: "toward_reactants"}

  # Reaction kinetics
  - name: reaction_rate
    given: Reactants with known rate constant k
    when: Reaction proceeds
    then: Rate follows rate law
    test_cases:
      - name: first_order
        input: {concentration_a: 1.0, rate_constant: 0.1, order: 1}
        expected: {rate: 0.1, half_life: 6.93}
      - name: second_order
        input: {concentration_a: 1.0, rate_constant: 0.1, order: 2}
        expected: {rate: 0.1, half_life: 10.0}

  # Creation Pattern: Periodic Table
  - name: periodic_trend_electronegativity
    given: Elements in the periodic table
    when: Moving across a period (left to right)
    then: Electronegativity increases
    test_cases:
      - name: period_2
        input: {elements: ["Li", "Be", "B", "C", "N", "O", "F"]}
        expected: {trend: "increasing", max_element: "F"}
      - name: period_3
        input: {elements: ["Na", "Mg", "Al", "Si", "P", "S", "Cl"]}
        expected: {trend: "increasing", max_element: "Cl"}

  # Molecular orbital theory
  - name: molecular_orbital_formation
    given: Two atomic orbitals
    when: Atoms approach and orbitals overlap
    then: Bonding and antibonding molecular orbitals form
    test_cases:
      - name: h2_formation
        input: {atom1: "H", atom2: "H", orbital: "1s"}
        expected: {bonding_orbital: "σ1s", antibonding_orbital: "σ*1s", bond_order: 1}
      - name: o2_formation
        input: {atom1: "O", atom2: "O"}
        expected: {bond_order: 2, paramagnetic: true}

functions:
  - name: calculate_molar_mass
    params: {formula: str}
    returns: float
    
  - name: balance_equation
    params: {reactants: [str], products: [str]}
    returns: [int]
    
  - name: calculate_delta_g
    params: {delta_h: float, delta_s: float, temperature: float}
    returns: float
    
  - name: calculate_equilibrium_constant
    params: {delta_g: float, temperature: float}
    returns: float
    
  - name: calculate_reaction_rate
    params: {k: float, concentrations: [float], orders: [int]}
    returns: float
    
  - name: predict_product
    params: {reactants: [Molecule], reaction_type: str}
    returns: [Molecule]

test_generation:
  boundary: true
  stress: true
  property: true
  coverage: 90
