#!/bin/bash
# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
# PRE-COMMIT HOOK for 999 OS
# Validates ULTRA-STRICT rules before commit
# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

echo "üîç ULTRA-STRICT Pre-commit validation..."

# Check 1: No .vibee files outside specs/
vibee_outside=$(find . -name "*.vibee" -type f | grep -v "^./specs/" | grep -v node_modules | wc -l)
if [ "$vibee_outside" -gt 0 ]; then
    echo "‚ùå ERROR: .vibee files found outside specs/"
    find . -name "*.vibee" -type f | grep -v "^./specs/" | grep -v node_modules
    echo ""
    echo "Move them to specs/ directory!"
    exit 1
fi

# Check 2: No forbidden files in 999/
forbidden=$(find 999 -type f \( -name "*.py" -o -name "*.js" -o -name "*.go" -o -name "*.rs" -o -name "*.ts" \) 2>/dev/null | wc -l)
if [ "$forbidden" -gt 0 ]; then
    echo "‚ùå ERROR: Forbidden file types in 999/"
    find 999 -type f \( -name "*.py" -o -name "*.js" -o -name "*.go" -o -name "*.rs" -o -name "*.ts" \)
    exit 1
fi

# Check 3: Staged .999 files must have generation marker
staged_999=$(git diff --cached --name-only | grep "\.999$" || true)
if [ -n "$staged_999" ]; then
    for file in $staged_999; do
        if [ -f "$file" ] && ! grep -q "–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ –∏–∑:" "$file"; then
            echo "‚ùå ERROR: $file missing generation marker"
            echo "   .999 files must be generated from .vibee specs!"
            exit 1
        fi
    done
fi

echo "‚úÖ ULTRA-STRICT validation passed!"
