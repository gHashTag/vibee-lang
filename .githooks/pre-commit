#!/bin/bash
# Pre-commit hook to prevent manual code
# This enforces spec-driven development

echo "üîç Checking for manual code..."

# Find all .gleam files (except FFI)
manual_files=$(find honeycomb gleam/src vibeec/src -name "*.gleam" -type f 2>/dev/null | grep -v "_ffi.erl" | grep -v "generated/")

if [ -n "$manual_files" ]; then
  echo ""
  echo "‚ùå ERROR: Manual .gleam files detected!"
  echo ""
  echo "The following files are manually written:"
  echo "$manual_files" | while read file; do
    echo "  - $file"
  done
  echo ""
  echo "üö® SPEC-DRIVEN DEVELOPMENT VIOLATION!"
  echo ""
  echo "All code MUST be generated from spec.yml files."
  echo "See SPEC_DRIVEN_DEVELOPMENT_RULES.md for details."
  echo ""
  echo "To fix this:"
  echo "  1. Create a spec.yml for your module"
  echo "  2. Generate code: gleam run -m generate_from_spec -- your_spec.yml"
  echo "  3. Delete the manual file"
  echo "  4. Commit the spec.yml and generated code"
  echo ""
  exit 1
fi

# Check if there are any spec.yml files being committed
spec_files=$(git diff --cached --name-only | grep "\.yml$")

if [ -z "$spec_files" ]; then
  echo ""
  echo "‚ö†Ô∏è  WARNING: No spec.yml files in this commit"
  echo ""
  echo "Are you sure you want to commit without specs?"
  echo "Press Ctrl+C to cancel, or Enter to continue..."
  read
fi

echo "‚úÖ All code is spec-driven!"
echo ""

exit 0
