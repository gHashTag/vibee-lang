#!/bin/bash
# Pre-push hook: Test live site before pushing changes

echo "üîç Running pre-push tests..."
echo ""

# Quick smoke test
echo "Testing https://vibee-ui.fly.dev..."
STATUS=$(curl -s -o /dev/null -w "%{http_code}" https://vibee-ui.fly.dev/)

if [ "$STATUS" = "200" ]; then
  echo "‚úÖ Site is UP"
  
  # Check components
  COUNT=$(curl -s https://vibee-ui.fly.dev/components | jq '. | length' 2>/dev/null)
  echo "üìä Components: $COUNT"
  
  if [ "$COUNT" = "99" ] || [ "$COUNT" = "105" ]; then
    echo "‚úÖ Component count OK"
  else
    echo "‚ö†Ô∏è  Unexpected component count: $COUNT"
  fi
else
  echo "‚ùå Site is DOWN (HTTP $STATUS)"
  echo ""
  echo "‚ö†Ô∏è  Warning: Live site may have issues"
  echo "Continue anyway? (y/n)"
  read -r response
  if [ "$response" != "y" ]; then
    exit 1
  fi
fi

echo ""
echo "‚úÖ Pre-push checks passed"
exit 0
